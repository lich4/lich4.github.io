<!DOCTYPE html>
<html lang="zh-CN"
  dir="ltr">

  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width">



<link rel="icon" type="image/ico" href="https://lich4.github.io//favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://lich4.github.io//favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://lich4.github.io//favicon-32x32.png">
<link rel="icon" type="image/png" sizes="192x192" href="https://lich4.github.io//android-chrome-192x192.png">
<link rel="apple-touch-icon" sizes="180x180" href="https://lich4.github.io//apple-touch-icon.png">

<meta name="description" content=""/>

<title>
    
    对彗星DNS加速器的分析 | 超哥的博客
    
</title>

<link rel="canonical" href="https://lich4.github.io/win_posts/20150222_fastdns/"/>












<link rel="stylesheet" href="/assets/combined.min.cbcb816aefdb3b7380c5921cbb3b89d12f07742cb3f869754adb56da84f0d729.css" media="all">









  </head>

  

  
  
  

  <body class="light">

    <div class="content">
      <header>
        

<div class="header">

    

</div>

      </header>

      <main class="main">
        





<div class="breadcrumbs">
    
    <a href="/">Home</a>
    <span class="breadcrumbs-separator"> > </span>
    
    <a href="/win_posts/">Win_posts</a>
    <span class="breadcrumbs-separator"> > </span>
    
    <a class="breadcrumbs-current" href="/win_posts/20150222_fastdns/">对彗星DNS加速器的分析</a>
</div>



<div >

  <div class="single-intro-container">

    

    <h1 class="single-title">对彗星DNS加速器的分析</h1>
    
    <p class="single-summary">对彗星DNS加速器的分析</p>
    

    

    <p class="single-readtime">
      
      
      
      <time datetime="2015-02-22T00:00:00&#43;00:00">February 22, 2015</time>
      

      
    </p>

  </div>

  

  
  

  <div class="single-tags">
    
    <span>
      <a href="https://lich4.github.io/tags/%E9%80%86%E5%90%91/">#逆向</a>
    </span>
    
    
  </div>

  
  

  

  
  <aside class="toc">
    <p><strong>Table of contents</strong></p>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#背景介绍">背景介绍</a></li>
    <li><a href="#开始分析">开始分析</a></li>
    <li><a href="#得到设置dns逻辑">得到设置DNS逻辑</a></li>
    <li><a href="#fastdns如何列出网卡的">FASTDNS如何列出网卡的？</a></li>
    <li><a href="#fastdns如何初始化那些dns串的存储在哪里">FASTDNS如何初始化那些DNS串的，存储在哪里？</a></li>
    <li><a href="#fastdns怎么测网速的呢也就是最核心的部分">FASTDNS怎么测网速的呢？也就是最核心的部分？</a></li>
    <li><a href="#结果">结果</a></li>
    <li><a href="#自制dns加速器">自制DNS加速器</a></li>
  </ul>
</nav>
  </aside>
  

  

  <div class="single-content">
    <h2 id="背景介绍">背景介绍</h2>
<p>  FASTDNS作者是张慧星，该软件能很好地测试dns并自动设置系统，一直以来都在用却不知道原理，这2天我做了逆向分析，并打算将delphi的移植为vc++的源码，如果有可能以后会兼容ipv6 dns。<br>
  提前声明：手动标注是逆向分析的重要步骤，下面代码中有些是API名，其余大部分有名称的都是分析了函数以后手动做的命名，为分析结构方便，以下汇集了我3天的成果，目的就是为了用VC++完成同样的功能，并期盼以后可以改进，比如兼容Ipv6和结合代理软件。</p>
<h2 id="开始分析">开始分析</h2>
<p>  看到设置界面发现可以设置多线程的，因此从这里入手，bp CreateThread，发现断不下来，于是bm <em>!CreateThread</em>，断到这里：</p>
<div class="highlight"><pre tabindex="0" style="color:#757575;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Asm" data-lang="Asm"><span style="display:flex;"><span><span style="color:#5f5fff">ecx</span><span style="color:#ec0000">=</span><span style="color:#008900">param0</span>
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">edx</span><span style="color:#ec0000">=</span><span style="color:#008900">dwStackSize</span>
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">eax</span><span style="color:#ec0000">=</span><span style="color:#008900">lpThreadAttributes</span>
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">param1</span><span style="color:#ec0000">=</span><span style="color:#008900">lpThreadId</span>
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">param2</span><span style="color:#ec0000">=</span><span style="color:#008900">dwCreationFlags</span>
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">param3</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0043</span><span style="color:#008900">D348</span> <span style="color:#008900">push</span>    <span style="color:#008900">ebp</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0043</span><span style="color:#008900">D349</span> <span style="color:#008900">mov</span>     <span style="color:#008900">ebp</span>, <span style="color:#008900">esp</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0043</span><span style="color:#008900">D34B</span> <span style="color:#008900">push</span>    <span style="color:#008900">ebx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0043</span><span style="color:#008900">D34C</span> <span style="color:#008900">push</span>    <span style="color:#008900">esi</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0043</span><span style="color:#008900">D34D</span> <span style="color:#008900">push</span>    <span style="color:#008900">edi</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0043</span><span style="color:#008900">D34E</span> <span style="color:#008900">mov</span>     <span style="color:#008900">edi</span>, <span style="color:#008900">ecx</span>//edi=param1  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0043</span><span style="color:#5f5fff">D350</span> <span style="color:#008900">mov</span>     <span style="color:#008900">esi</span>, <span style="color:#008900">edx</span>//esi=dwStackSize  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0043</span><span style="color:#5f5fff">D352</span> <span style="color:#008900">mov</span>     <span style="color:#008900">ebx</span>, <span style="color:#008900">eax</span>//ebx=lpThreadAttributes  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0043</span><span style="color:#5f5fff">D354</span> <span style="color:#008900">mov</span>     <span style="color:#008900">eax</span>, <span style="color:#008900">8</span>//DWORD[2]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0043</span><span style="color:#5f5fff">D359</span> <span style="color:#008900">call</span>    <span style="color:#008900">sub_43B5C0</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0043</span><span style="color:#008900">D35E</span> <span style="color:#008900">mov</span>     [<span style="color:#008900">eax</span>], <span style="color:#008900">edi</span>//DWORD[0]=param0;FARPROC  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0043</span><span style="color:#5f5fff">D360</span> <span style="color:#008900">mov</span>     <span style="color:#008900">edx</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">arg_8</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0043</span><span style="color:#008900">D363</span> <span style="color:#008900">mov</span>     [<span style="color:#008900">eax</span><span style="color:#ec0000">+</span><span style="color:#008900">4</span>], <span style="color:#008900">edx</span>//DWORD[1]=param3;PARAM  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0043</span><span style="color:#5f5fff">D366</span> <span style="color:#008900">mov</span>     <span style="color:#008900">byte_4B9C2D</span>, <span style="color:#008900">1</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0043</span><span style="color:#008900">D36D</span> <span style="color:#008900">mov</span>     <span style="color:#008900">edx</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">dwCreationFlags_1</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0043</span><span style="color:#008900">D370</span> <span style="color:#008900">push</span>    <span style="color:#008900">edx</span>                            ; lpThreadId  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0043</span><span style="color:#5f5fff">D371</span> <span style="color:#008900">mov</span>     <span style="color:#008900">edx</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">dwCreationFlags</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0043</span><span style="color:#008900">D374</span> <span style="color:#008900">push</span>    <span style="color:#008900">edx</span>                            ; dwCreationFlags  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0043</span><span style="color:#5f5fff">D375</span> <span style="color:#008900">push</span>    <span style="color:#008900">eax</span>                            ; lpParameter  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0043</span><span style="color:#5f5fff">D376</span> <span style="color:#008900">mov</span>     <span style="color:#008900">eax</span>, <span style="color:#008900">offset</span> <span style="color:#008900">SpeedTest</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0043</span><span style="color:#008900">D37B</span> <span style="color:#008900">push</span>    <span style="color:#008900">eax</span>                            ; lpStartAddress  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0043</span><span style="color:#5f5fff">D37C</span> <span style="color:#008900">push</span>    <span style="color:#008900">esi</span>                            ; dwStackSize  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0043</span><span style="color:#5f5fff">D37D</span> <span style="color:#008900">push</span>    <span style="color:#008900">ebx</span>                            ; lpThreadAttributes  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0043</span><span style="color:#5f5fff">D37E</span> <span style="color:#008900">call</span>    <span style="color:#008900">CreateThread</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0043</span><span style="color:#008900">D383</span> <span style="color:#008900">pop</span>     <span style="color:#008900">edi</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0043</span><span style="color:#008900">D384</span> <span style="color:#008900">pop</span>     <span style="color:#008900">esi</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0043</span><span style="color:#008900">D385</span> <span style="color:#008900">pop</span>     <span style="color:#008900">ebx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0043</span><span style="color:#008900">D386</span> <span style="color:#008900">pop</span>     <span style="color:#008900">ebp</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0043</span><span style="color:#008900">D387</span> <span style="color:#008900">retn</span>    <span style="color:#008900">0</span><span style="color:#008900">Ch</span> 
</span></span></code></pre></div><p>  可以看到实际只执行了参数中的函数指针部分，现在我们来找CreateThread的StartAddress和Param部分，往上层找到StartAddress的值为Classes::_17197</p>
<div class="highlight"><pre tabindex="0" style="color:#757575;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Asm" data-lang="Asm"><span style="display:flex;"><span><span style="color:#ec0000">004254</span><span style="color:#5f5fff">A4</span> <span style="color:#ec0000">@</span><span style="color:#008900">Classes@TThread@$bctr$qqro</span> <span style="color:#008900">proc</span> <span style="color:#008900">near</span>  ; CODE XREF: sub_40E908+33 p  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">04254</span><span style="color:#5f5fff">E6</span> <span style="color:#008900">push</span>    <span style="color:#008900">esi</span>                            ; param3  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">004254</span><span style="color:#5f5fff">E7</span> <span style="color:#008900">push</span>    <span style="color:#008900">4</span>                              ; dwCreationFlags  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">004254</span><span style="color:#5f5fff">E9</span> <span style="color:#008900">lea</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">esi</span><span style="color:#ec0000">+</span><span style="color:#008900">8</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">004254</span><span style="color:#008900">EC</span> <span style="color:#008900">push</span>    <span style="color:#008900">eax</span>                            ; lpThreadId  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">004254</span><span style="color:#5f5fff">ED</span> <span style="color:#008900">mov</span>     <span style="color:#008900">ecx</span>, <span style="color:#008900">offset</span> <span style="color:#ec0000">@</span><span style="color:#008900">Classes@_17197</span>    ; a3  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">004254</span><span style="color:#5f5fff">F2</span> <span style="color:#008900">xor</span>     <span style="color:#008900">edx</span>, <span style="color:#008900">edx</span>                       ; dwStackSize  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">004254</span><span style="color:#5f5fff">F4</span> <span style="color:#008900">xor</span>     <span style="color:#008900">eax</span>, <span style="color:#008900">eax</span>                       ; lpThreadAttributes  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">004254</span><span style="color:#5f5fff">F6</span> <span style="color:#008900">call</span>    <span style="color:#ec0000">@</span><span style="color:#008900">BeginThread</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#008900">00425404</span> <span style="color:#ec0000">@</span><span style="color:#008900">Classes@_17197</span> <span style="color:#008900">proc</span> <span style="color:#008900">near</span>              ; DATA XREF: Classes::TThread::TThread(bool)+49 o  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">00425404</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">00425404</span> <span style="color:#5f5fff">var_4</span><span style="color:#ec0000">=</span> <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> -<span style="color:#008900">4</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">00425404</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">00425404</span> <span style="color:#008900">push</span>    <span style="color:#008900">ebp</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">00425405</span> <span style="color:#008900">mov</span>     <span style="color:#008900">ebp</span>, <span style="color:#008900">esp</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">00425407</span> <span style="color:#008900">push</span>    <span style="color:#008900">ecx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">00425408</span> <span style="color:#008900">push</span>    <span style="color:#008900">ebx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">00425409</span> <span style="color:#008900">push</span>    <span style="color:#008900">esi</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0042540</span><span style="color:#008900">A</span> <span style="color:#008900">push</span>    <span style="color:#008900">edi</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0042540</span><span style="color:#008900">B</span> <span style="color:#008900">mov</span>     [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_4</span>], <span style="color:#008900">eax</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0042540</span><span style="color:#008900">E</span> <span style="color:#008900">xor</span>     <span style="color:#008900">eax</span>, <span style="color:#008900">eax</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">00425410</span> <span style="color:#008900">push</span>    <span style="color:#008900">ebp</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">00425411</span> <span style="color:#008900">push</span>    <span style="color:#008900">offset</span> <span style="color:#008900">j_@@HandleFinally_0</span>     ; __linkproc__ HandleFinally  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">00425416</span> <span style="color:#5f5fff">push</span>    <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> <span style="color:#008900">fs</span>:[<span style="color:#008900">eax</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">00425419</span> <span style="color:#008900">mov</span>     <span style="color:#008900">fs</span>:[<span style="color:#008900">eax</span>], <span style="color:#008900">esp</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0042541</span><span style="color:#008900">C</span> <span style="color:#008900">mov</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0042541</span><span style="color:#008900">F</span> <span style="color:#008900">cmp</span>     <span style="color:#008900">byte</span> <span style="color:#008900">ptr</span> [<span style="color:#008900">eax</span><span style="color:#ec0000">+</span><span style="color:#008900">0</span><span style="color:#008900">Dh</span>], <span style="color:#008900">0</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">00425423</span> <span style="color:#008900">jnz</span>     <span style="color:#008900">short</span> <span style="color:#008900">loc_42545A</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">00425425</span> <span style="color:#008900">xor</span>     <span style="color:#008900">eax</span>, <span style="color:#008900">eax</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">00425427</span> <span style="color:#008900">push</span>    <span style="color:#008900">ebp</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">00425428</span> <span style="color:#008900">push</span>    <span style="color:#008900">offset</span> <span style="color:#008900">loc_425445</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0042542</span><span style="color:#008900">D</span> <span style="color:#008900">push</span>    <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> <span style="color:#008900">fs</span>:[<span style="color:#008900">eax</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">00425430</span> <span style="color:#008900">mov</span>     <span style="color:#008900">fs</span>:[<span style="color:#008900">eax</span>], <span style="color:#008900">esp</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">00425433</span> <span style="color:#008900">mov</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">00425436</span> <span style="color:#008900">mov</span>     <span style="color:#008900">edx</span>, [<span style="color:#008900">eax</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">00425438</span> <span style="color:#008900">call</span>    <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> [<span style="color:#008900">edx</span><span style="color:#ec0000">+</span><span style="color:#008900">4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0042543</span><span style="color:#008900">B</span> <span style="color:#008900">xor</span>     <span style="color:#008900">eax</span>, <span style="color:#008900">eax</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0042543</span><span style="color:#008900">D</span> <span style="color:#008900">pop</span>     <span style="color:#008900">edx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0042543</span><span style="color:#008900">E</span> <span style="color:#008900">pop</span>     <span style="color:#008900">ecx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0042543</span><span style="color:#008900">F</span> <span style="color:#008900">pop</span>     <span style="color:#008900">ecx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">00425440</span> <span style="color:#008900">mov</span>     <span style="color:#008900">fs</span>:[<span style="color:#008900">eax</span>], <span style="color:#008900">edx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">00425443</span> <span style="color:#008900">jmp</span>     <span style="color:#008900">short</span> <span style="color:#008900">loc_42545A</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">00425445</span> ; ---------------------------------------------------------------------------  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">00425445</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">00425445</span> <span style="color:#ec0000">loc_425445:</span>                            ; DATA XREF: Classes::_17197+24 o  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">00425445</span> <span style="color:#5f5fff">jmp</span>     <span style="color:#ec0000">@@</span><span style="color:#008900">HandleAnyException</span>           ; __linkproc__ HandleAnyException  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0042544</span><span style="color:#5f5fff">A</span> ; ---------------------------------------------------------------------------  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0042544</span><span style="color:#5f5fff">A</span> <span style="color:#008900">call</span>    <span style="color:#ec0000">@</span><span style="color:#008900">AcquireExceptionObject</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0042544</span><span style="color:#008900">F</span> <span style="color:#008900">mov</span>     <span style="color:#008900">edx</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">00425452</span> <span style="color:#008900">mov</span>     [<span style="color:#008900">edx</span><span style="color:#ec0000">+</span><span style="color:#008900">2</span><span style="color:#008900">Ch</span>], <span style="color:#008900">eax</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">00425455</span> <span style="color:#008900">call</span>    <span style="color:#ec0000">@@</span><span style="color:#008900">DoneExcept</span>                   ; __linkproc__ DoneExcept  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0042545</span><span style="color:#5f5fff">A</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0042545</span><span style="color:#008900">A</span> <span style="color:#008900">loc_42545A</span>:                            ; CODE XREF: Classes::_17197+1F j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0042545</span><span style="color:#5f5fff">A</span>                                        ; Classes::_17197+3F j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0042545</span><span style="color:#5f5fff">A</span> <span style="color:#008900">xor</span>     <span style="color:#008900">eax</span>, <span style="color:#008900">eax</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0042545</span><span style="color:#008900">C</span> <span style="color:#008900">pop</span>     <span style="color:#008900">edx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0042545</span><span style="color:#008900">D</span> <span style="color:#008900">pop</span>     <span style="color:#008900">ecx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0042545</span><span style="color:#008900">E</span> <span style="color:#008900">pop</span>     <span style="color:#008900">ecx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0042545</span><span style="color:#008900">F</span> <span style="color:#008900">mov</span>     <span style="color:#008900">fs</span>:[<span style="color:#008900">eax</span>], <span style="color:#008900">edx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">00425462</span> <span style="color:#008900">push</span>    <span style="color:#008900">offset</span> <span style="color:#008900">unk_42549C</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">00425467</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">00425467</span> <span style="color:#008900">loc_425467</span>:                            ; CODE XREF: .text:0042549A j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">00425467</span> <span style="color:#5f5fff">mov</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0042546</span><span style="color:#008900">A</span> <span style="color:#008900">mov</span>     <span style="color:#008900">bl</span>, [<span style="color:#008900">eax</span><span style="color:#ec0000">+</span><span style="color:#008900">0</span><span style="color:#008900">Fh</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0042546</span><span style="color:#008900">D</span> <span style="color:#008900">mov</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">00425470</span> <span style="color:#008900">mov</span>     <span style="color:#008900">esi</span>, [<span style="color:#008900">eax</span><span style="color:#ec0000">+</span><span style="color:#008900">14</span><span style="color:#008900">h</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">00425473</span> <span style="color:#008900">mov</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">00425476</span> <span style="color:#008900">mov</span>     <span style="color:#008900">byte</span> <span style="color:#008900">ptr</span> [<span style="color:#008900">eax</span><span style="color:#ec0000">+</span><span style="color:#008900">10</span><span style="color:#008900">h</span>], <span style="color:#008900">1</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0042547</span><span style="color:#008900">A</span> <span style="color:#008900">mov</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0042547</span><span style="color:#008900">D</span> <span style="color:#008900">mov</span>     <span style="color:#008900">edx</span>, [<span style="color:#008900">eax</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0042547</span><span style="color:#008900">F</span> <span style="color:#008900">call</span>    <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> [<span style="color:#008900">edx</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">00425481</span> <span style="color:#008900">test</span>    <span style="color:#008900">bl</span>, <span style="color:#008900">bl</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">00425483</span> <span style="color:#008900">jz</span>      <span style="color:#008900">short</span> <span style="color:#008900">loc_42548D</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">00425485</span> <span style="color:#008900">mov</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">00425488</span> <span style="color:#008900">call</span>    <span style="color:#ec0000">@</span><span style="color:#008900">TObject@Free</span>                  ; TObject::Free  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0042548</span><span style="color:#5f5fff">D</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0042548</span><span style="color:#008900">D</span> <span style="color:#008900">loc_42548D</span>:                            ; CODE XREF: Classes::_17197+7F j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0042548</span><span style="color:#5f5fff">D</span> <span style="color:#008900">mov</span>     <span style="color:#008900">eax</span>, <span style="color:#008900">esi</span>                       ; dwExitCode  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0042548</span><span style="color:#5f5fff">F</span> <span style="color:#008900">call</span>    <span style="color:#ec0000">@</span><span style="color:#008900">EndThread</span> 
</span></span></code></pre></div><p>  实际执行的又是参数中的函数指针；先执行*(param+4)(param) 在执行*(param(param),（感觉delphi的这个结构构造的很巧妙，传入CreateThread的param之前在堆上分配，而进了startaddress后自动释放，param里面也是StartAddress+Param的结构^_^可以无限这么套下去），而param的值需要再往上找。</p>
<div class="highlight"><pre tabindex="0" style="color:#757575;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Asm" data-lang="Asm"><span style="display:flex;"><span><span style="color:#ec0000">004254</span><span style="color:#5f5fff">A4</span> <span style="color:#ec0000">@</span><span style="color:#008900">Classes@TThread@$bctr$qqro</span> <span style="color:#008900">proc</span> <span style="color:#008900">near</span>  ; CODE XREF: sub_40E908+33 p  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">004254</span><span style="color:#5f5fff">A4</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">004254</span><span style="color:#008900">A4</span> <span style="color:#008900">var_10</span><span style="color:#ec0000">=</span> <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> -<span style="color:#008900">10</span><span style="color:#008900">h</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">004254</span><span style="color:#008900">A4</span> <span style="color:#008900">var_C</span><span style="color:#ec0000">=</span> <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> -<span style="color:#008900">0</span><span style="color:#008900">Ch</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">004254</span><span style="color:#008900">A4</span> <span style="color:#008900">var_8</span><span style="color:#ec0000">=</span> <span style="color:#008900">byte</span> <span style="color:#008900">ptr</span> -<span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">004254</span><span style="color:#008900">A4</span> <span style="color:#008900">var_1</span><span style="color:#ec0000">=</span> <span style="color:#008900">byte</span> <span style="color:#008900">ptr</span> -<span style="color:#008900">1</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">004254</span><span style="color:#008900">A4</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">004254</span><span style="color:#008900">A4</span> <span style="color:#008900">push</span>    <span style="color:#008900">ebp</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">004254</span><span style="color:#008900">A5</span> <span style="color:#008900">mov</span>     <span style="color:#008900">ebp</span>, <span style="color:#008900">esp</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">004254</span><span style="color:#008900">A7</span> <span style="color:#008900">add</span>     <span style="color:#008900">esp</span>, <span style="color:#008900">0</span><span style="color:#008900">FFFFFFF0h</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">004254</span><span style="color:#008900">AA</span> <span style="color:#008900">push</span>    <span style="color:#008900">ebx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">004254</span><span style="color:#008900">AB</span> <span style="color:#008900">push</span>    <span style="color:#008900">esi</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">004254</span><span style="color:#008900">AC</span> <span style="color:#008900">xor</span>     <span style="color:#008900">ebx</span>, <span style="color:#008900">ebx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">004254</span><span style="color:#008900">AE</span> <span style="color:#008900">mov</span>     [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_10</span>], <span style="color:#008900">ebx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">004254</span><span style="color:#008900">B1</span> <span style="color:#008900">test</span>    <span style="color:#008900">dl</span>, <span style="color:#008900">dl</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">004254</span><span style="color:#008900">B3</span> <span style="color:#008900">jz</span>      <span style="color:#008900">short</span> <span style="color:#008900">loc_4254BD</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">004254</span><span style="color:#008900">B5</span> <span style="color:#008900">add</span>     <span style="color:#008900">esp</span>, <span style="color:#008900">0</span><span style="color:#008900">FFFFFFF0h</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">004254</span><span style="color:#008900">B8</span> <span style="color:#008900">call</span>    <span style="color:#ec0000">@@</span><span style="color:#008900">ClassCreate</span>                  ; __linkproc__ ClassCreate  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">004254</span><span style="color:#5f5fff">BD</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">004254</span><span style="color:#008900">BD</span> <span style="color:#008900">loc_4254BD</span>:                            ; CODE XREF: Classes::TThread::TThread(bool)+F j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">004254</span><span style="color:#5f5fff">BD</span> <span style="color:#008900">mov</span>     <span style="color:#008900">ebx</span>, <span style="color:#008900">ecx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">004254</span><span style="color:#008900">BF</span> <span style="color:#008900">mov</span>     [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_1</span>], <span style="color:#008900">dl</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">004254</span><span style="color:#008900">C2</span> <span style="color:#008900">mov</span>     <span style="color:#008900">esi</span>, <span style="color:#008900">eax</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">004254</span><span style="color:#008900">C4</span> <span style="color:#008900">xor</span>     <span style="color:#008900">eax</span>, <span style="color:#008900">eax</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">004254</span><span style="color:#008900">C6</span> <span style="color:#008900">push</span>    <span style="color:#008900">ebp</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">004254</span><span style="color:#008900">C7</span> <span style="color:#008900">push</span>    <span style="color:#008900">offset</span> <span style="color:#008900">loc_42554E</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">004254</span><span style="color:#008900">CC</span> <span style="color:#008900">push</span>    <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> <span style="color:#008900">fs</span>:[<span style="color:#008900">eax</span>]             ; lpThreadIda  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">004254</span><span style="color:#5f5fff">CF</span> <span style="color:#008900">mov</span>     <span style="color:#008900">fs</span>:[<span style="color:#008900">eax</span>], <span style="color:#008900">esp</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">004254</span><span style="color:#008900">D2</span> <span style="color:#008900">xor</span>     <span style="color:#008900">edx</span>, <span style="color:#008900">edx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">004254</span><span style="color:#008900">D4</span> <span style="color:#008900">mov</span>     <span style="color:#008900">eax</span>, <span style="color:#008900">esi</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">004254</span><span style="color:#008900">D6</span> <span style="color:#008900">call</span>    <span style="color:#ec0000">@</span><span style="color:#008900">TObject@$bctr_0</span>               ; TObject::`...&#39;  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">004254</span><span style="color:#5f5fff">DB</span> <span style="color:#008900">call</span>    <span style="color:#008900">sub_42522C</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">004254</span><span style="color:#008900">E0</span> <span style="color:#008900">mov</span>     [<span style="color:#008900">esi</span><span style="color:#ec0000">+</span><span style="color:#008900">0</span><span style="color:#008900">Eh</span>], <span style="color:#008900">bl</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">004254</span><span style="color:#008900">E3</span> <span style="color:#008900">mov</span>     [<span style="color:#008900">esi</span><span style="color:#ec0000">+</span><span style="color:#008900">0</span><span style="color:#008900">Ch</span>], <span style="color:#008900">bl</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">004254</span><span style="color:#008900">E6</span> <span style="color:#008900">push</span>    <span style="color:#008900">esi</span>                            ; param3  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">004254</span><span style="color:#5f5fff">E7</span> <span style="color:#008900">push</span>    <span style="color:#008900">4</span>                              ; dwCreationFlags  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">004254</span><span style="color:#5f5fff">E9</span> <span style="color:#008900">lea</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">esi</span><span style="color:#ec0000">+</span><span style="color:#008900">8</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">004254</span><span style="color:#008900">EC</span> <span style="color:#008900">push</span>    <span style="color:#008900">eax</span>                            ; lpThreadId  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">004254</span><span style="color:#5f5fff">ED</span> <span style="color:#008900">mov</span>     <span style="color:#008900">ecx</span>, <span style="color:#008900">offset</span> <span style="color:#ec0000">@</span><span style="color:#008900">Classes@_17197</span>    ; a3  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">004254</span><span style="color:#5f5fff">F2</span> <span style="color:#008900">xor</span>     <span style="color:#008900">edx</span>, <span style="color:#008900">edx</span>                       ; dwStackSize  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">004254</span><span style="color:#5f5fff">F4</span> <span style="color:#008900">xor</span>     <span style="color:#008900">eax</span>, <span style="color:#008900">eax</span>                       ; lpThreadAttributes  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">004254</span><span style="color:#5f5fff">F6</span> <span style="color:#008900">call</span>    <span style="color:#ec0000">@</span><span style="color:#008900">BeginThread</span> 
</span></span></code></pre></div><p>  看到004254E6处push的第一个参数位esi，往上看到004254C2处eax做了赋值，往前再没给eax赋值的，因此eax是传入参数，还要往调用者找，（delphi程序喜欢用ecx eax edx传值，不过这样的话在调用系统api前后，要做栈&lt;&ndash;&gt;寄存器参数变换）</p>
<div class="highlight"><pre tabindex="0" style="color:#757575;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Asm" data-lang="Asm"><span style="display:flex;"><span><span style="color:#ec0000">0040</span><span style="color:#5f5fff">E908</span> <span style="color:#008900">sub_40E908</span> <span style="color:#008900">proc</span> <span style="color:#008900">near</span>                   ; CODE XREF: sub_4094B4+46 p  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0040</span><span style="color:#5f5fff">E908</span> <span style="color:#008900">push</span>    <span style="color:#008900">ebp</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">E909</span> <span style="color:#008900">mov</span>     <span style="color:#008900">ebp</span>, <span style="color:#008900">esp</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">E90B</span> <span style="color:#008900">add</span>     <span style="color:#008900">esp</span>, <span style="color:#008900">0</span><span style="color:#008900">FFFFFFD4h</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">E90E</span> <span style="color:#008900">mov</span>     [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_8</span>], <span style="color:#008900">dl</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">E911</span> <span style="color:#008900">test</span>    <span style="color:#008900">dl</span>, <span style="color:#008900">dl</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">E913</span> <span style="color:#008900">jle</span>     <span style="color:#008900">short</span> <span style="color:#008900">loc_40E91A</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">E915</span> <span style="color:#008900">call</span>    <span style="color:#008900">__ClassCreate</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">E91A</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">E91A</span> <span style="color:#008900">loc_40E91A</span>:                            ; CODE XREF: sub_40E908+B j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0040</span><span style="color:#5f5fff">E91A</span> <span style="color:#008900">mov</span>     [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_2A</span>], <span style="color:#008900">cl</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">E91D</span> <span style="color:#008900">mov</span>     [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_29</span>], <span style="color:#008900">dl</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">E920</span> <span style="color:#008900">mov</span>     [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_4</span>], <span style="color:#008900">eax</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">E923</span> <span style="color:#008900">mov</span>     <span style="color:#008900">eax</span>, <span style="color:#008900">offset</span> <span style="color:#008900">unk_4B3C0C</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">E928</span> <span style="color:#008900">call</span>    <span style="color:#ec0000">@</span><span style="color:#008900">__InitExceptBlockLDTC</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">E92D</span> <span style="color:#008900">mov</span>     [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_18</span>], <span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">E933</span> <span style="color:#008900">mov</span>     <span style="color:#008900">cl</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_2A</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">E936</span> <span style="color:#008900">xor</span>     <span style="color:#008900">edx</span>, <span style="color:#008900">edx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">E938</span> <span style="color:#008900">mov</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">E93B</span> <span style="color:#008900">call</span>    <span style="color:#ec0000">@</span><span style="color:#008900">Classes@TThread@$bctr$qqro</span>    ; Classes::TThread::TThread(bool) 
</span></span></code></pre></div><p>  看到0040E938处var_4对eax赋值，而往上0040E920处eax又赋值给var_4，之前eax再没有赋值行为，同样eax也是该函数参数，继续往调用者走</p>
<div class="highlight"><pre tabindex="0" style="color:#757575;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Asm" data-lang="Asm"><span style="display:flex;"><span><span style="color:#ec0000">004094</span><span style="color:#5f5fff">B4</span> <span style="color:#008900">push</span>    <span style="color:#008900">ebp</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">004094</span><span style="color:#008900">B5</span> <span style="color:#008900">mov</span>     <span style="color:#008900">ebp</span>, <span style="color:#008900">esp</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">004094</span><span style="color:#008900">B7</span> <span style="color:#008900">add</span>     <span style="color:#008900">esp</span>, <span style="color:#008900">0</span><span style="color:#008900">FFFFFFD4h</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">004094</span><span style="color:#008900">BA</span> <span style="color:#008900">push</span>    <span style="color:#008900">ebx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">004094</span><span style="color:#008900">BB</span> <span style="color:#008900">push</span>    <span style="color:#008900">esi</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">004094</span><span style="color:#008900">BC</span> <span style="color:#008900">push</span>    <span style="color:#008900">edi</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">004094</span><span style="color:#008900">BD</span> <span style="color:#008900">mov</span>     [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_8</span>], <span style="color:#008900">dl</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">004094</span><span style="color:#008900">C0</span> <span style="color:#008900">test</span>    <span style="color:#008900">dl</span>, <span style="color:#008900">dl</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">004094</span><span style="color:#008900">C2</span> <span style="color:#008900">jle</span>     <span style="color:#008900">short</span> <span style="color:#008900">loc_4094C9</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">004094</span><span style="color:#008900">C4</span> <span style="color:#008900">call</span>    <span style="color:#008900">__ClassCreate</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">004094</span><span style="color:#008900">C9</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">004094</span><span style="color:#008900">C9</span> <span style="color:#008900">loc_4094C9</span>:                            ; CODE XREF: sub_4094B4+E j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">004094</span><span style="color:#5f5fff">C9</span> <span style="color:#008900">mov</span>     <span style="color:#008900">ebx</span>, <span style="color:#008900">ecx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">004094</span><span style="color:#008900">CB</span> <span style="color:#008900">mov</span>     [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_29</span>], <span style="color:#008900">dl</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">004094</span><span style="color:#008900">CE</span> <span style="color:#008900">mov</span>     [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_4</span>], <span style="color:#008900">eax</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">004094</span><span style="color:#008900">D1</span> <span style="color:#008900">mov</span>     <span style="color:#008900">eax</span>, <span style="color:#008900">offset</span> <span style="color:#008900">unk_4B24D0</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">004094</span><span style="color:#008900">D6</span> <span style="color:#008900">call</span>    <span style="color:#ec0000">@</span><span style="color:#008900">__InitExceptBlockLDTC</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">004094</span><span style="color:#008900">DB</span> <span style="color:#008900">mov</span>     [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_18</span>], <span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">004094</span><span style="color:#008900">E1</span> <span style="color:#008900">mov</span>     <span style="color:#008900">edx</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">arg_10</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">004094</span><span style="color:#008900">E4</span> <span style="color:#008900">mov</span>     <span style="color:#008900">ecx</span>, <span style="color:#008900">ebx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">004094</span><span style="color:#008900">E6</span> <span style="color:#008900">push</span>    <span style="color:#008900">edx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">004094</span><span style="color:#008900">E7</span> <span style="color:#008900">push</span>    [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">arg_C</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">004094</span><span style="color:#008900">EA</span> <span style="color:#008900">push</span>    [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">arg_8</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">004094</span><span style="color:#008900">ED</span> <span style="color:#008900">mov</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">arg_4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">004094</span><span style="color:#008900">F0</span> <span style="color:#008900">push</span>    <span style="color:#008900">eax</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">004094</span><span style="color:#008900">F1</span> <span style="color:#008900">mov</span>     <span style="color:#008900">edx</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">arg_0</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">004094</span><span style="color:#008900">F4</span> <span style="color:#008900">push</span>    <span style="color:#008900">edx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">004094</span><span style="color:#008900">F5</span> <span style="color:#008900">xor</span>     <span style="color:#008900">edx</span>, <span style="color:#008900">edx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">004094</span><span style="color:#008900">F7</span> <span style="color:#008900">mov</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">004094</span><span style="color:#008900">FA</span> <span style="color:#008900">call</span>    <span style="color:#008900">sub_40E908</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#008900">00402748</span> <span style="color:#008900">push</span>    <span style="color:#008900">ebp</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">00402749</span> <span style="color:#008900">mov</span>     <span style="color:#008900">ebp</span>, <span style="color:#008900">esp</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040274</span><span style="color:#008900">B</span> <span style="color:#008900">add</span>     <span style="color:#008900">esp</span>, <span style="color:#008900">0</span><span style="color:#008900">FFFFFF98h</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040274</span><span style="color:#008900">E</span> <span style="color:#008900">mov</span>     <span style="color:#008900">eax</span>, <span style="color:#008900">offset</span> <span style="color:#008900">unk_4A2608</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">00402753</span> <span style="color:#008900">push</span>    <span style="color:#008900">ebx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">00402754</span> <span style="color:#008900">push</span>    <span style="color:#008900">esi</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">00402755</span> <span style="color:#008900">push</span>    <span style="color:#008900">edi</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">00402756</span> <span style="color:#008900">mov</span>     <span style="color:#008900">esi</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">arg_0</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">00402759</span> <span style="color:#008900">call</span>    <span style="color:#ec0000">@</span><span style="color:#008900">__InitExceptBlockLDTC</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040275</span><span style="color:#008900">E</span> <span style="color:#008900">mov</span>     <span style="color:#008900">ebx</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">arg_4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">00402761</span> <span style="color:#008900">cmp</span>     <span style="color:#008900">byte</span> <span style="color:#008900">ptr</span> [<span style="color:#008900">ebx</span><span style="color:#ec0000">+</span><span style="color:#008900">10</span><span style="color:#008900">h</span>], <span style="color:#008900">1</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">00402765</span> <span style="color:#008900">jnz</span>     <span style="color:#008900">loc_4028A0</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040276</span><span style="color:#008900">B</span> <span style="color:#008900">mov</span>     [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_34</span>], <span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">00402771</span> <span style="color:#008900">push</span>    <span style="color:#008900">ebx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">00402772</span> <span style="color:#008900">lea</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_4C</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">00402775</span> <span style="color:#008900">mov</span>     [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_4C</span>], <span style="color:#008900">offset</span> <span style="color:#008900">sub_402990</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040277</span><span style="color:#008900">C</span> <span style="color:#008900">mov</span>     [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_48</span>], <span style="color:#008900">esi</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040277</span><span style="color:#008900">F</span> <span style="color:#008900">mov</span>     <span style="color:#008900">dl</span>, <span style="color:#008900">1</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">00402781</span> <span style="color:#008900">push</span>    <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> [<span style="color:#008900">eax</span><span style="color:#ec0000">+</span><span style="color:#008900">4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">00402784</span> <span style="color:#008900">push</span>    <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> [<span style="color:#008900">eax</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">00402786</span> <span style="color:#008900">mov</span>     <span style="color:#008900">ecx</span>, [<span style="color:#008900">esi</span><span style="color:#ec0000">+</span><span style="color:#008900">3</span><span style="color:#008900">ECh</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040278</span><span style="color:#008900">C</span> <span style="color:#008900">push</span>    <span style="color:#008900">ecx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040278</span><span style="color:#008900">D</span> <span style="color:#008900">mov</span>     <span style="color:#008900">cl</span>, <span style="color:#008900">1</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040278</span><span style="color:#008900">F</span> <span style="color:#008900">mov</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">esi</span><span style="color:#ec0000">+</span><span style="color:#008900">3</span><span style="color:#008900">F0h</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">00402795</span> <span style="color:#008900">push</span>    <span style="color:#008900">eax</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">00402796</span> <span style="color:#008900">mov</span>     <span style="color:#008900">eax</span>, <span style="color:#008900">off_4B2618</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040279</span><span style="color:#008900">B</span> <span style="color:#008900">call</span>    <span style="color:#008900">sub_4094B4</span> 
</span></span></code></pre></div><p>  最后找到这里，发现eax是4B2618，来看该处2个函数指针(应该说是虚函数表，从后面可以看到param其实是个类)：</p>
<div class="highlight"><pre tabindex="0" style="color:#757575;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Asm" data-lang="Asm"><span style="display:flex;"><span><span style="color:#ec0000">.data:</span><span style="color:#ec0000">004</span><span style="color:#5f5fff">B2618</span> <span style="color:#008900">off_4B2618</span> <span style="color:#008900">dd</span> <span style="color:#008900">offset</span> <span style="color:#008900">_cls_DNSSpending_TDNSSpending</span>//虚表
</span></span><span style="display:flex;"><span><span style="color:#ec0000">。。。。。。。。。。。</span>//类成员
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ec0000">.data:</span><span style="color:#ec0000">004</span><span style="color:#5f5fff">B2664</span> <span style="color:#008900">_cls_DNSSpending_TDNSSpending</span> <span style="color:#008900">dd</span> <span style="color:#008900">offset</span> <span style="color:#ec0000">@</span><span style="color:#008900">TThread@DoTerminate</span>
</span></span><span style="display:flex;"><span><span style="color:#ec0000">.data:</span><span style="color:#ec0000">004</span><span style="color:#5f5fff">B2664</span>                                         ; DATA XREF: .text:00409906 o
</span></span><span style="display:flex;"><span><span style="color:#ec0000">.data:</span><span style="color:#ec0000">004</span><span style="color:#5f5fff">B2664</span>                                         ; .dataff_4B2618 o
</span></span><span style="display:flex;"><span><span style="color:#ec0000">.data:</span><span style="color:#ec0000">004</span><span style="color:#5f5fff">B2664</span>                                         ; TThread:oTerminate
</span></span><span style="display:flex;"><span><span style="color:#ec0000">.data:</span><span style="color:#ec0000">004</span><span style="color:#5f5fff">B2668</span> <span style="color:#008900">dd</span> <span style="color:#008900">offset</span> <span style="color:#008900">sub_40EA3C</span>
</span></span><span style="display:flex;"><span><span style="color:#ec0000">.data:</span><span style="color:#ec0000">004</span><span style="color:#5f5fff">B266C</span> <span style="color:#008900">dd</span> <span style="color:#008900">offset</span> <span style="color:#008900">sub_40970C</span>
</span></span></code></pre></div><p>  再往上走可以看到程序按照分的线程数创建线程：</p>
<div class="highlight"><pre tabindex="0" style="color:#757575;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Asm" data-lang="Asm"><span style="display:flex;"><span><span style="color:#ec0000">00402940</span> <span style="color:#5f5fff">sub_402940</span>      <span style="color:#008900">proc</span> <span style="color:#008900">near</span>              ; CODE XREF: showstatus+43 p  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">00402940</span>                                        ; _TfrmFastDNS_actTestSpendingExecute+138 p  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">00402940</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">00402940</span> <span style="color:#5f5fff">var_8</span>           <span style="color:#ec0000">=</span> <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> -<span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">00402940</span> <span style="color:#008900">var_4</span>           <span style="color:#ec0000">=</span> <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> -<span style="color:#008900">4</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">00402940</span> <span style="color:#008900">arg_0</span>           <span style="color:#ec0000">=</span> <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span>  <span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">00402940</span> <span style="color:#008900">arg_4</span>           <span style="color:#ec0000">=</span> <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span>  <span style="color:#008900">0</span><span style="color:#008900">Ch</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">00402940</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">00402940</span>                 <span style="color:#008900">push</span>    <span style="color:#008900">ebp</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">00402941</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">ebp</span>, <span style="color:#008900">esp</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">00402943</span>                 <span style="color:#008900">add</span>     <span style="color:#008900">esp</span>, <span style="color:#008900">0</span><span style="color:#008900">FFFFFFF8h</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">00402946</span>                 <span style="color:#008900">push</span>    <span style="color:#008900">ebx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">00402947</span>                 <span style="color:#008900">push</span>    <span style="color:#008900">esi</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">00402948</span>                 <span style="color:#008900">push</span>    <span style="color:#008900">edi</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">00402949</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">edi</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">arg_4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040294</span><span style="color:#008900">C</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">ebx</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">arg_0</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040294</span><span style="color:#008900">F</span>                 <span style="color:#008900">cmp</span>     <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> [<span style="color:#008900">ebx</span><span style="color:#ec0000">+</span><span style="color:#008900">400</span><span style="color:#008900">h</span>], <span style="color:#008900">0</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">00402956</span>                 <span style="color:#008900">jz</span>      <span style="color:#008900">short</span> <span style="color:#008900">loc_402988</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">00402958</span>                 <span style="color:#008900">xor</span>     <span style="color:#008900">esi</span>, <span style="color:#008900">esi</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040295</span><span style="color:#008900">A</span>                 <span style="color:#008900">cmp</span>     <span style="color:#008900">edi</span>, <span style="color:#008900">esi</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040295</span><span style="color:#008900">C</span>                 <span style="color:#008900">jle</span>     <span style="color:#008900">short</span> <span style="color:#008900">loc_402988</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040295</span><span style="color:#008900">E</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040295</span><span style="color:#008900">E</span> <span style="color:#008900">loc_40295E</span>:                            ; CODE XREF: sub_402940+46 j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0040295</span><span style="color:#5f5fff">E</span>                 <span style="color:#008900">push</span>    <span style="color:#008900">0</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">00402960</span>                 <span style="color:#008900">push</span>    <span style="color:#008900">0</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">00402962</span>                 <span style="color:#008900">mov</span>     [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_8</span>], <span style="color:#008900">offset</span> <span style="color:#008900">sub_402748</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">00402969</span>                 <span style="color:#008900">mov</span>     [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_4</span>], <span style="color:#008900">ebx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040296</span><span style="color:#008900">C</span>                 <span style="color:#008900">lea</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_8</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040296</span><span style="color:#008900">F</span>                 <span style="color:#008900">push</span>    <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> [<span style="color:#008900">eax</span><span style="color:#ec0000">+</span><span style="color:#008900">4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">00402972</span>                 <span style="color:#008900">push</span>    <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> [<span style="color:#008900">eax</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">00402974</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">ecx</span>, [<span style="color:#008900">ebx</span><span style="color:#ec0000">+</span><span style="color:#008900">400</span><span style="color:#008900">h</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040297</span><span style="color:#008900">A</span>                 <span style="color:#008900">push</span>    <span style="color:#008900">ecx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040297</span><span style="color:#008900">B</span>                 <span style="color:#008900">call</span>    <span style="color:#008900">sub_40C400</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">00402980</span>                 <span style="color:#008900">add</span>     <span style="color:#008900">esp</span>, <span style="color:#008900">14</span><span style="color:#008900">h</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">00402983</span>                 <span style="color:#008900">inc</span>     <span style="color:#008900">esi</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">00402984</span>                 <span style="color:#008900">cmp</span>     <span style="color:#008900">edi</span>, <span style="color:#008900">esi</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">00402986</span>                 <span style="color:#008900">jg</span>      <span style="color:#008900">short</span> <span style="color:#008900">loc_40295E</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">00402988</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">00402988</span> <span style="color:#008900">loc_402988</span>:                            ; CODE XREF: sub_402940+16 j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">00402988</span>                                        ; sub_402940+1C j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">00402988</span>                 <span style="color:#5f5fff">pop</span>     <span style="color:#008900">edi</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">00402989</span>                 <span style="color:#008900">pop</span>     <span style="color:#008900">esi</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040298</span><span style="color:#008900">A</span>                 <span style="color:#008900">pop</span>     <span style="color:#008900">ebx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040298</span><span style="color:#008900">B</span>                 <span style="color:#008900">pop</span>     <span style="color:#008900">ecx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040298</span><span style="color:#008900">C</span>                 <span style="color:#008900">pop</span>     <span style="color:#008900">ecx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040298</span><span style="color:#008900">D</span>                 <span style="color:#008900">pop</span>     <span style="color:#008900">ebp</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040298</span><span style="color:#008900">E</span>                 <span style="color:#008900">retn</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040298</span><span style="color:#008900">E</span> <span style="color:#008900">sub_402940</span>      <span style="color:#008900">endp</span> 
</span></span></code></pre></div><p>  再往上走就是TfrmFastDNS_actTestSpendingExecute，也就是点击了测试按钮之后的回调函数</p>
<div class="highlight"><pre tabindex="0" style="color:#757575;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Asm" data-lang="Asm"><span style="display:flex;"><span><span style="color:#ec0000">004033</span><span style="color:#5f5fff">D4</span> <span style="color:#008900">_TfrmFastDNS_actTestSpendingExecute</span> <span style="color:#008900">proc</span> <span style="color:#008900">near</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">004033</span><span style="color:#008900">D4</span>                                        ; DATA XREF: .data:fastdns___CPPdebugHook+13E3 o  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">004033</span><span style="color:#5f5fff">D4</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">004033</span><span style="color:#008900">D4</span> <span style="color:#008900">var_38</span>          <span style="color:#ec0000">=</span> <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> -<span style="color:#008900">38</span><span style="color:#008900">h</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">004033</span><span style="color:#008900">D4</span> <span style="color:#008900">var_34</span>          <span style="color:#ec0000">=</span> <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> -<span style="color:#008900">34</span><span style="color:#008900">h</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">004033</span><span style="color:#008900">D4</span> <span style="color:#008900">var_30</span>          <span style="color:#ec0000">=</span> <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> -<span style="color:#008900">30</span><span style="color:#008900">h</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">004033</span><span style="color:#008900">D4</span> <span style="color:#008900">var_20</span>          <span style="color:#ec0000">=</span> <span style="color:#008900">word</span> <span style="color:#008900">ptr</span> -<span style="color:#008900">20</span><span style="color:#008900">h</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">004033</span><span style="color:#008900">D4</span> <span style="color:#008900">var_14</span>          <span style="color:#ec0000">=</span> <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> -<span style="color:#008900">14</span><span style="color:#008900">h</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">004033</span><span style="color:#008900">D4</span> <span style="color:#008900">var_C</span>           <span style="color:#ec0000">=</span> <span style="color:#008900">byte</span> <span style="color:#008900">ptr</span> -<span style="color:#008900">0</span><span style="color:#008900">Ch</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">004033</span><span style="color:#008900">D4</span> <span style="color:#008900">var_8</span>           <span style="color:#ec0000">=</span> <span style="color:#008900">byte</span> <span style="color:#008900">ptr</span> -<span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">004033</span><span style="color:#008900">D4</span> <span style="color:#008900">var_4</span>           <span style="color:#ec0000">=</span> <span style="color:#008900">byte</span> <span style="color:#008900">ptr</span> -<span style="color:#008900">4</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">004033</span><span style="color:#008900">D4</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">004033</span><span style="color:#008900">D4</span>                 <span style="color:#008900">push</span>    <span style="color:#008900">ebp</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">004033</span><span style="color:#008900">D5</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">ebp</span>, <span style="color:#008900">esp</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">004033</span><span style="color:#008900">D7</span>                 <span style="color:#008900">add</span>     <span style="color:#008900">esp</span>, <span style="color:#008900">0</span><span style="color:#008900">FFFFFFC8h</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">004033</span><span style="color:#008900">DA</span>                 <span style="color:#008900">push</span>    <span style="color:#008900">ebx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">004033</span><span style="color:#008900">DB</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">ebx</span>, <span style="color:#008900">eax</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">004033</span><span style="color:#008900">DD</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">eax</span>, <span style="color:#008900">offset</span> <span style="color:#008900">unk_4A2954</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">004033</span><span style="color:#008900">E2</span>                 <span style="color:#008900">call</span>    <span style="color:#ec0000">@</span><span style="color:#008900">__InitExceptBlockLDTC</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">004033</span><span style="color:#008900">E7</span>                 <span style="color:#008900">xor</span>     <span style="color:#008900">edx</span>, <span style="color:#008900">edx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">004033</span><span style="color:#008900">E9</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">ebx</span><span style="color:#ec0000">+</span><span style="color:#008900">304</span><span style="color:#008900">h</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">004033</span><span style="color:#008900">EF</span>                 <span style="color:#008900">call</span>    <span style="color:#008900">sub_443028</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">004033</span><span style="color:#008900">F4</span>                 <span style="color:#008900">xor</span>     <span style="color:#008900">edx</span>, <span style="color:#008900">edx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">004033</span><span style="color:#008900">F6</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">ebx</span><span style="color:#ec0000">+</span><span style="color:#008900">364</span><span style="color:#008900">h</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">004033</span><span style="color:#008900">FC</span>                 <span style="color:#008900">call</span>    <span style="color:#008900">sub_443028</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">00403401</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">byte</span> <span style="color:#008900">ptr</span> [<span style="color:#008900">ebx</span><span style="color:#ec0000">+</span><span style="color:#008900">404</span><span style="color:#008900">h</span>], <span style="color:#008900">0</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">00403408</span>                 <span style="color:#008900">call</span>    <span style="color:#ec0000">@</span><span style="color:#008900">GetCurrentTime</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040340</span><span style="color:#008900">D</span>                 <span style="color:#008900">mov</span>     [<span style="color:#008900">ebx</span><span style="color:#ec0000">+</span><span style="color:#008900">3</span><span style="color:#008900">E8h</span>], <span style="color:#008900">eax</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">00403413</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">edx</span>, <span style="color:#008900">8000000</span><span style="color:#008900">Fh</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">00403418</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">ebx</span><span style="color:#ec0000">+</span><span style="color:#008900">350</span><span style="color:#008900">h</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040341</span><span style="color:#008900">E</span>                 <span style="color:#008900">call</span>    <span style="color:#ec0000">@</span><span style="color:#008900">TControl@SetColor</span> ; TControl::SetColor  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">00403423</span>                 <span style="color:#5f5fff">mov</span>     [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_20</span>], <span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">00403429</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">edx</span>, <span style="color:#008900">offset</span> <span style="color:#008900">unk_4A22AA</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040342</span><span style="color:#008900">E</span>                 <span style="color:#008900">lea</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">00403431</span>                 <span style="color:#008900">call</span>    <span style="color:#ec0000">@</span><span style="color:#008900">System@AnsiString@$bctr$qqrpxc</span> ; System::AnsiString::AnsiString(char *)  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">00403436</span>                 <span style="color:#5f5fff">inc</span>     [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_14</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">00403439</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">edx</span>, [<span style="color:#008900">eax</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040343</span><span style="color:#008900">B</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">ebx</span><span style="color:#ec0000">+</span><span style="color:#008900">350</span><span style="color:#008900">h</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">00403441</span>                 <span style="color:#008900">call</span>    <span style="color:#ec0000">@</span><span style="color:#008900">TControl@SetText</span> ; TControl::SetText  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">00403446</span>                 <span style="color:#5f5fff">dec</span>     [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_14</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">00403449</span>                 <span style="color:#008900">lea</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040344</span><span style="color:#008900">C</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">edx</span>, <span style="color:#008900">2</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">00403451</span>                 <span style="color:#008900">call</span>    <span style="color:#ec0000">@</span><span style="color:#008900">System@AnsiString@$bdtr$qqrv</span> ; System::AnsiString::~AnsiString(void)  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">00403456</span>                 <span style="color:#5f5fff">mov</span>     <span style="color:#008900">dl</span>, <span style="color:#008900">1</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">00403458</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">ebx</span><span style="color:#ec0000">+</span><span style="color:#008900">35</span><span style="color:#008900">Ch</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040345</span><span style="color:#008900">E</span>                 <span style="color:#008900">call</span>    <span style="color:#008900">unknown_libname_1860</span> ; Delphi2006/BDS2006 Visual Component Library  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0040345</span><span style="color:#5f5fff">E</span>                                        ; BDS 4.0 RTL and VCL  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">00403463</span>                 <span style="color:#5f5fff">mov</span>     [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_20</span>], <span style="color:#008900">14</span><span style="color:#008900">h</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">00403469</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">edx</span>, <span style="color:#008900">offset</span> <span style="color:#008900">unk_4A22AB</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040346</span><span style="color:#008900">E</span>                 <span style="color:#008900">lea</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_8</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">00403471</span>                 <span style="color:#008900">call</span>    <span style="color:#ec0000">@</span><span style="color:#008900">System@AnsiString@$bctr$qqrpxc</span> ; System::AnsiString::AnsiString(char *)  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">00403476</span>                 <span style="color:#5f5fff">inc</span>     [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_14</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">00403479</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">edx</span>, [<span style="color:#008900">eax</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040347</span><span style="color:#008900">B</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">ebx</span><span style="color:#ec0000">+</span><span style="color:#008900">34</span><span style="color:#008900">Ch</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">00403481</span>                 <span style="color:#008900">call</span>    <span style="color:#ec0000">@</span><span style="color:#008900">TControl@SetText</span> ; TControl::SetText  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">00403486</span>                 <span style="color:#5f5fff">dec</span>     [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_14</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">00403489</span>                 <span style="color:#008900">lea</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_8</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040348</span><span style="color:#008900">C</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">edx</span>, <span style="color:#008900">2</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">00403491</span>                 <span style="color:#008900">call</span>    <span style="color:#ec0000">@</span><span style="color:#008900">System@AnsiString@$bdtr$qqrv</span> ; System::AnsiString::~AnsiString(void)  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">00403496</span>                 <span style="color:#5f5fff">xor</span>     <span style="color:#008900">edx</span>, <span style="color:#008900">edx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">00403498</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">ebx</span><span style="color:#ec0000">+</span><span style="color:#008900">30</span><span style="color:#008900">Ch</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040349</span><span style="color:#008900">E</span>                 <span style="color:#008900">call</span>    <span style="color:#008900">sub_443028</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">004034</span><span style="color:#008900">A3</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">ebx</span><span style="color:#ec0000">+</span><span style="color:#008900">400</span><span style="color:#008900">h</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">004034</span><span style="color:#008900">A9</span>                 <span style="color:#008900">test</span>    <span style="color:#008900">eax</span>, <span style="color:#008900">eax</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">004034</span><span style="color:#008900">AB</span>                 <span style="color:#008900">jz</span>      <span style="color:#008900">short</span> <span style="color:#008900">loc_4034CC</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">004034</span><span style="color:#008900">AD</span>                 <span style="color:#008900">push</span>    <span style="color:#008900">0</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">004034</span><span style="color:#008900">AF</span>                 <span style="color:#008900">push</span>    <span style="color:#008900">0</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">004034</span><span style="color:#008900">B1</span>                 <span style="color:#008900">mov</span>     [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_38</span>], <span style="color:#008900">offset</span> <span style="color:#008900">sub_4033B0</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">004034</span><span style="color:#008900">B8</span>                 <span style="color:#008900">mov</span>     [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_34</span>], <span style="color:#008900">ebx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">004034</span><span style="color:#008900">BB</span>                 <span style="color:#008900">lea</span>     <span style="color:#008900">edx</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_38</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">004034</span><span style="color:#008900">BE</span>                 <span style="color:#008900">push</span>    <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> [<span style="color:#008900">edx</span><span style="color:#ec0000">+</span><span style="color:#008900">4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">004034</span><span style="color:#008900">C1</span>                 <span style="color:#008900">push</span>    <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> [<span style="color:#008900">edx</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">004034</span><span style="color:#008900">C3</span>                 <span style="color:#008900">push</span>    <span style="color:#008900">eax</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">004034</span><span style="color:#008900">C4</span>                 <span style="color:#008900">call</span>    <span style="color:#008900">sub_40C400</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">004034</span><span style="color:#008900">C9</span>                 <span style="color:#008900">add</span>     <span style="color:#008900">esp</span>, <span style="color:#008900">14</span><span style="color:#008900">h</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">004034</span><span style="color:#008900">CC</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">004034</span><span style="color:#008900">CC</span> <span style="color:#008900">loc_4034CC</span>:                            ; CODE XREF: _TfrmFastDNS_actTestSpendingExecute+D7 j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">004034</span><span style="color:#5f5fff">CC</span>                 <span style="color:#008900">xor</span>     <span style="color:#008900">eax</span>, <span style="color:#008900">eax</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">004034</span><span style="color:#008900">CE</span>                 <span style="color:#008900">xor</span>     <span style="color:#008900">edx</span>, <span style="color:#008900">edx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">004034</span><span style="color:#008900">D0</span>                 <span style="color:#008900">mov</span>     [<span style="color:#008900">ebx</span><span style="color:#ec0000">+</span><span style="color:#008900">37</span><span style="color:#008900">Ch</span>], <span style="color:#008900">eax</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">004034</span><span style="color:#008900">D6</span>                 <span style="color:#008900">lea</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_C</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">004034</span><span style="color:#008900">D9</span>                 <span style="color:#008900">mov</span>     [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_20</span>], <span style="color:#008900">20</span><span style="color:#008900">h</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">004034</span><span style="color:#008900">DF</span>                 <span style="color:#008900">call</span>    <span style="color:#008900">unknown_libname_1523</span> ; CBuilder 4 and Delphi 4 VCL  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">004034</span><span style="color:#5f5fff">DF</span>                                        ; CBuilder 5 runtime  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">004034</span><span style="color:#5f5fff">E4</span>                 <span style="color:#008900">inc</span>     [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_14</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">004034</span><span style="color:#008900">E7</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">edx</span>, [<span style="color:#008900">eax</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">004034</span><span style="color:#008900">E9</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">ebx</span><span style="color:#ec0000">+</span><span style="color:#008900">358</span><span style="color:#008900">h</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">004034</span><span style="color:#008900">EF</span>                 <span style="color:#008900">call</span>    <span style="color:#ec0000">@</span><span style="color:#008900">TControl@SetText</span> ; TControl::SetText  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">004034</span><span style="color:#5f5fff">F4</span>                 <span style="color:#008900">dec</span>     [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_14</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">004034</span><span style="color:#008900">F7</span>                 <span style="color:#008900">lea</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_C</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">004034</span><span style="color:#008900">FA</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">edx</span>, <span style="color:#008900">2</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">004034</span><span style="color:#008900">FF</span>                 <span style="color:#008900">call</span>    <span style="color:#ec0000">@</span><span style="color:#008900">System@AnsiString@$bdtr$qqrv</span> ; System::AnsiString::~AnsiString(void)  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">00403504</span>                 <span style="color:#5f5fff">mov</span>     <span style="color:#008900">ecx</span>, [<span style="color:#008900">ebx</span><span style="color:#ec0000">+</span><span style="color:#008900">3</span><span style="color:#008900">F4h</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040350</span><span style="color:#008900">A</span>                 <span style="color:#008900">push</span>    <span style="color:#008900">ecx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040350</span><span style="color:#008900">B</span>                 <span style="color:#008900">push</span>    <span style="color:#008900">ebx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040350</span><span style="color:#008900">C</span>                 <span style="color:#008900">call</span>    <span style="color:#008900">sub_402940</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">00403511</span>                 <span style="color:#008900">add</span>     <span style="color:#008900">esp</span>, <span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">00403514</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_30</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">00403517</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">large</span> <span style="color:#008900">fs</span>:<span style="color:#008900">0</span>, <span style="color:#008900">eax</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040351</span><span style="color:#008900">D</span>                 <span style="color:#008900">pop</span>     <span style="color:#008900">ebx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040351</span><span style="color:#008900">E</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">esp</span>, <span style="color:#008900">ebp</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">00403520</span>                 <span style="color:#008900">pop</span>     <span style="color:#008900">ebp</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">00403521</span>                 <span style="color:#008900">retn</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">00403521</span> <span style="color:#008900">_TfrmFastDNS_actTestSpendingExecute</span> <span style="color:#008900">endp</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">00403521</span> 
</span></span></code></pre></div><p>可知以下3个函数为关键函数，下断点：</p>
<ul>
<li>bp 425690 =&gt;STOP</li>
<li>bp 40ea3c =&gt;FUNC1</li>
<li>bp 40970c =&gt;FUNC2</li>
</ul>
<p>  发现正如上面分析那样，调用顺序为FUNC1 -&gt; FUNC2 -&gt; STOP  FUNC2通过调用堆栈可以得知是在FUNC1中调用的。先来分析三个函数类型：前面425404已经得知第一个和第二个，先断在425690，看调用栈，通过在上层函数中查看当前函数调用之前的状况粗略分析类型：</p>
<pre tabindex="0"><code class="language-Txt" data-lang="Txt">0:001&gt; k
ChildEBP RetAddr  
WARNING: Stack unwind information not available. Following frames may be wrong.
0273ff74 0043d33a FastDNS!Rtflabelinitialization$qqrv+0xd7d8
0273ff88 76b2919f FastDNS!Rtflabelinitialization$qqrv+0x25482
0273ff94 7745b5af KERNEL32!BaseThreadInitThunk+0xe
0273ffdc 7745b57a ntdll!__RtlUserThreadStart+0x2f
0273ffec 00000000 ntdll!_RtlUserThreadStart+0x1b
</code></pre><div class="highlight"><pre tabindex="0" style="color:#757575;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Asm" data-lang="Asm"><span style="display:flex;"><span><span style="color:#ec0000">0043</span><span style="color:#5f5fff">D311</span> <span style="color:#008900">mov</span>     <span style="color:#008900">ebp</span>, <span style="color:#008900">esp</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0043</span><span style="color:#008900">D313</span> <span style="color:#008900">call</span>    <span style="color:#ec0000">@</span><span style="color:#008900">System@_16542</span>                 ; System::_16542  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0043</span><span style="color:#5f5fff">D318</span> <span style="color:#008900">push</span>    <span style="color:#008900">ebp</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0043</span><span style="color:#008900">D319</span> <span style="color:#008900">xor</span>     <span style="color:#008900">ecx</span>, <span style="color:#008900">ecx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0043</span><span style="color:#008900">D31B</span> <span style="color:#008900">push</span>    <span style="color:#008900">offset</span> <span style="color:#ec0000">@</span><span style="color:#008900">System@_16754</span>          ; System::_16754  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0043</span><span style="color:#5f5fff">D320</span> <span style="color:#008900">mov</span>     <span style="color:#008900">edx</span>, <span style="color:#008900">fs</span>:[<span style="color:#008900">ecx</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0043</span><span style="color:#008900">D323</span> <span style="color:#008900">push</span>    <span style="color:#008900">edx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0043</span><span style="color:#008900">D324</span> <span style="color:#008900">mov</span>     <span style="color:#008900">fs</span>:[<span style="color:#008900">ecx</span>], <span style="color:#008900">esp</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0043</span><span style="color:#008900">D327</span> <span style="color:#008900">mov</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">arg_0</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0043</span><span style="color:#008900">D32A</span> <span style="color:#008900">mov</span>     <span style="color:#008900">ecx</span>, [<span style="color:#008900">eax</span><span style="color:#ec0000">+</span><span style="color:#008900">4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0043</span><span style="color:#008900">D32D</span> <span style="color:#008900">mov</span>     <span style="color:#008900">edx</span>, [<span style="color:#008900">eax</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0043</span><span style="color:#008900">D32F</span> <span style="color:#008900">push</span>    <span style="color:#008900">ecx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0043</span><span style="color:#008900">D330</span> <span style="color:#008900">push</span>    <span style="color:#008900">edx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0043</span><span style="color:#008900">D331</span> <span style="color:#008900">call</span>    <span style="color:#008900">sub_43B5E0</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0043</span><span style="color:#008900">D336</span> <span style="color:#008900">pop</span>     <span style="color:#008900">edx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0043</span><span style="color:#008900">D337</span> <span style="color:#008900">pop</span>     <span style="color:#008900">eax</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0043</span><span style="color:#008900">D338</span> <span style="color:#008900">call</span>    <span style="color:#008900">edx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0043</span><span style="color:#008900">D33A</span> <span style="color:#008900">xor</span>     <span style="color:#008900">edx</span>, <span style="color:#008900">edx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0043</span><span style="color:#008900">D33C</span> <span style="color:#008900">pop</span>     <span style="color:#008900">ecx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0043</span><span style="color:#008900">D33D</span> <span style="color:#008900">mov</span>     <span style="color:#008900">fs</span>:[<span style="color:#008900">edx</span>], <span style="color:#008900">ecx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0043</span><span style="color:#008900">D340</span> <span style="color:#008900">pop</span>     <span style="color:#008900">ecx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0043</span><span style="color:#008900">D341</span> <span style="color:#008900">pop</span>     <span style="color:#008900">ebp</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0043</span><span style="color:#008900">D342</span> <span style="color:#008900">pop</span>     <span style="color:#008900">ebp</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0043</span><span style="color:#008900">D343</span> <span style="color:#008900">retn</span>    <span style="color:#008900">4</span> 
</span></span></code></pre></div><p>  根据栈平衡，同时call edx处可能传递的参数应该在当前call之前，上个call之后，加上调用者代码可以推断使用了eax，没有用到栈参数，其他2函数同理，再到STOP中看：（显然这是终止线程之类的收尾工作，所以这里我取名STOP）</p>
<div class="highlight"><pre tabindex="0" style="color:#757575;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Asm" data-lang="Asm"><span style="display:flex;"><span><span style="color:#ec0000">.text:</span><span style="color:#ec0000">00425690</span> ; TThread:oTerminate
</span></span><span style="display:flex;"><span><span style="color:#ec0000">.text:</span><span style="color:#ec0000">00425690</span> <span style="color:#ec0000">@</span><span style="color:#5f5fff">TThread@DoTerminate</span> <span style="color:#008900">proc</span> <span style="color:#008900">near</span>          ; DATA XREF: .text:_cls_Classes_TThread o
</span></span><span style="display:flex;"><span><span style="color:#ec0000">.text:</span><span style="color:#ec0000">00425690</span>                                         ; .data:_cls_CalcSpendingThread_TCalcSpendingThread o
</span></span><span style="display:flex;"><span><span style="color:#ec0000">.text:</span><span style="color:#ec0000">00425690</span> <span style="color:#5f5fff">cmp</span>     <span style="color:#008900">word</span> <span style="color:#008900">ptr</span> [<span style="color:#008900">eax</span><span style="color:#ec0000">+</span><span style="color:#008900">1</span><span style="color:#008900">Ah</span>], <span style="color:#008900">0</span>
</span></span><span style="display:flex;"><span><span style="color:#ec0000">.text:</span><span style="color:#ec0000">00425695</span> <span style="color:#5f5fff">jz</span>      <span style="color:#008900">short</span> <span style="color:#008900">locret_4256A2</span>
</span></span><span style="display:flex;"><span><span style="color:#ec0000">.text:</span><span style="color:#ec0000">00425697</span> <span style="color:#5f5fff">push</span>    <span style="color:#008900">eax</span>
</span></span><span style="display:flex;"><span><span style="color:#ec0000">.text:</span><span style="color:#ec0000">00425698</span> <span style="color:#5f5fff">push</span>    <span style="color:#008900">offset</span> <span style="color:#ec0000">@</span><span style="color:#008900">Controls@TSizeConstraints@Change$qqrv</span> ; Delphi 5 Visual Component Library
</span></span><span style="display:flex;"><span><span style="color:#ec0000">.text:</span><span style="color:#ec0000">00425698</span>                                         ; Delphi2006/BDS2006 Visual Component Library
</span></span><span style="display:flex;"><span><span style="color:#ec0000">.text:</span><span style="color:#ec0000">0042569</span><span style="color:#5f5fff">D</span> <span style="color:#008900">call</span>    <span style="color:#008900">terminate</span>
</span></span><span style="display:flex;"><span><span style="color:#ec0000">.text:</span><span style="color:#ec0000">004256</span><span style="color:#5f5fff">A2</span>
</span></span><span style="display:flex;"><span><span style="color:#ec0000">.text:</span><span style="color:#ec0000">004256</span><span style="color:#5f5fff">A2</span> <span style="color:#008900">locret_4256A2</span>:                          ; CODE XREF: TThread:oTerminate+5 j
</span></span><span style="display:flex;"><span><span style="color:#ec0000">.text:</span><span style="color:#ec0000">004256</span><span style="color:#5f5fff">A2</span> <span style="color:#008900">retn</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0040</span><span style="color:#5f5fff">EA3C</span> <span style="color:#008900">sub_40EA3C</span>      <span style="color:#008900">proc</span> <span style="color:#008900">near</span>              ; DATA XREF: .data:fastdns___CPPdebugHook+105D0 o  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0040</span><span style="color:#5f5fff">EA3C</span>                                        ; .data:fastdns___CPPdebugHook+11C3C o  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0040</span><span style="color:#5f5fff">EA3C</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA3C</span> <span style="color:#008900">var_14</span>          <span style="color:#ec0000">=</span> <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> -<span style="color:#008900">14</span><span style="color:#008900">h</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA3C</span> <span style="color:#008900">var_10</span>          <span style="color:#ec0000">=</span> <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> -<span style="color:#008900">10</span><span style="color:#008900">h</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA3C</span> <span style="color:#008900">pertime</span>         <span style="color:#ec0000">=</span> <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> -<span style="color:#008900">0</span><span style="color:#008900">Ch</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA3C</span> <span style="color:#008900">var_8</span>           <span style="color:#ec0000">=</span> <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> -<span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA3C</span> <span style="color:#008900">a1</span>              <span style="color:#ec0000">=</span> <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> -<span style="color:#008900">4</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA3C</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA3C</span>                 <span style="color:#008900">push</span>    <span style="color:#008900">ebp</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA3D</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">ebp</span>, <span style="color:#008900">esp</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA3F</span>                 <span style="color:#008900">add</span>     <span style="color:#008900">esp</span>, <span style="color:#008900">0</span><span style="color:#008900">FFFFFFECh</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA42</span>                 <span style="color:#008900">mov</span>     [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">a1</span>], <span style="color:#008900">eax</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA45</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">a1</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA48</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">byte</span> <span style="color:#008900">ptr</span> [<span style="color:#008900">eax</span><span style="color:#ec0000">+</span><span style="color:#008900">0</span><span style="color:#008900">Fh</span>], <span style="color:#008900">1</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA4C</span>                 <span style="color:#008900">lea</span>     <span style="color:#008900">edx</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">pertime</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA4F</span>                 <span style="color:#008900">push</span>    <span style="color:#008900">edx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA50</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">ecx</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">a1</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA53</span>                 <span style="color:#008900">push</span>    <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> [<span style="color:#008900">ecx</span><span style="color:#ec0000">+</span><span style="color:#008900">30</span><span style="color:#008900">h</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA56</span>                 <span style="color:#008900">push</span>    [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">a1</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA59</span>                 <span style="color:#008900">call</span>    <span style="color:#008900">sub_40EAE0</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA5E</span>                 <span style="color:#008900">add</span>     <span style="color:#008900">esp</span>, <span style="color:#008900">0</span><span style="color:#008900">Ch</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA61</span>                 <span style="color:#008900">test</span>    <span style="color:#008900">al</span>, <span style="color:#008900">al</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA63</span>                 <span style="color:#008900">jz</span>      <span style="color:#008900">short</span> <span style="color:#008900">loc_40EA8B</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA65</span>                 <span style="color:#008900">push</span>    [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_8</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA68</span>                 <span style="color:#008900">push</span>    [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">pertime</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA6B</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">edx</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">a1</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA6E</span>                 <span style="color:#008900">push</span>    <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> [<span style="color:#008900">edx</span><span style="color:#ec0000">+</span><span style="color:#008900">30</span><span style="color:#008900">h</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA71</span>                 <span style="color:#008900">call</span>    <span style="color:#008900">sub_40EABC</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA76</span>                 <span style="color:#008900">add</span>     <span style="color:#008900">esp</span>, <span style="color:#008900">0</span><span style="color:#008900">Ch</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA79</span>                 <span style="color:#008900">push</span>    <span style="color:#008900">0</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA7B</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">ecx</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">a1</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA7E</span>                 <span style="color:#008900">push</span>    <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> [<span style="color:#008900">ecx</span><span style="color:#ec0000">+</span><span style="color:#008900">30</span><span style="color:#008900">h</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA81</span>                 <span style="color:#008900">call</span>    <span style="color:#008900">sub_40EAD0</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA86</span>                 <span style="color:#008900">add</span>     <span style="color:#008900">esp</span>, <span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA89</span>                 <span style="color:#008900">jmp</span>     <span style="color:#008900">short</span> <span style="color:#008900">loc_40EA9B</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA8B</span> ; ---------------------------------------------------------------------------  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0040</span><span style="color:#5f5fff">EA8B</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA8B</span> <span style="color:#008900">loc_40EA8B</span>:                            ; CODE XREF: sub_40EA3C+27 j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0040</span><span style="color:#5f5fff">EA8B</span>                 <span style="color:#008900">push</span>    <span style="color:#008900">3</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA8D</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">a1</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA90</span>                 <span style="color:#008900">push</span>    <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> [<span style="color:#008900">eax</span><span style="color:#ec0000">+</span><span style="color:#008900">30</span><span style="color:#008900">h</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA93</span>                 <span style="color:#008900">call</span>    <span style="color:#008900">sub_40EAD0</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA98</span>                 <span style="color:#008900">add</span>     <span style="color:#008900">esp</span>, <span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA9B</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA9B</span> <span style="color:#008900">loc_40EA9B</span>:                            ; CODE XREF: sub_40EA3C+4D j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0040</span><span style="color:#5f5fff">EA9B</span>                 <span style="color:#008900">mov</span>     [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_14</span>], <span style="color:#008900">offset</span> <span style="color:#008900">sub_40EA10</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EAA2</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">edx</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">a1</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EAA5</span>                 <span style="color:#008900">mov</span>     [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_10</span>], <span style="color:#008900">edx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EAA8</span>                 <span style="color:#008900">lea</span>     <span style="color:#008900">ecx</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_14</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EAAB</span>                 <span style="color:#008900">push</span>    <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> [<span style="color:#008900">ecx</span><span style="color:#ec0000">+</span><span style="color:#008900">4</span>] ; a5  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0040</span><span style="color:#5f5fff">EAAE</span>                 <span style="color:#008900">push</span>    <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> [<span style="color:#008900">ecx</span>] ; a4  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0040</span><span style="color:#5f5fff">EAB0</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">a1</span>]  ; a1  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0040</span><span style="color:#5f5fff">EAB3</span>                 <span style="color:#008900">call</span>    <span style="color:#008900">terminate</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EAB8</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">esp</span>, <span style="color:#008900">ebp</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EABA</span>                 <span style="color:#008900">pop</span>     <span style="color:#008900">ebp</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EABB</span>                 <span style="color:#008900">retn</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EAE0</span> <span style="color:#008900">sub_40EAE0</span>      <span style="color:#008900">proc</span> <span style="color:#008900">near</span>              ; CODE XREF: sub_40EA3C+1D p  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0040</span><span style="color:#5f5fff">EAE0</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EAE0</span> <span style="color:#008900">var_40</span>          <span style="color:#ec0000">=</span> <span style="color:#008900">qword</span> <span style="color:#008900">ptr</span> -<span style="color:#008900">40</span><span style="color:#008900">h</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EAE0</span> <span style="color:#008900">var_38</span>          <span style="color:#ec0000">=</span> <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> -<span style="color:#008900">38</span><span style="color:#008900">h</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EAE0</span> <span style="color:#008900">usedtime</span>        <span style="color:#ec0000">=</span> <span style="color:#008900">qword</span> <span style="color:#008900">ptr</span> -<span style="color:#008900">34</span><span style="color:#008900">h</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EAE0</span> <span style="color:#008900">totoaltime</span>      <span style="color:#ec0000">=</span> <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> -<span style="color:#008900">2</span><span style="color:#008900">Ch</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EAE0</span> <span style="color:#008900">var_28</span>          <span style="color:#ec0000">=</span> <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> -<span style="color:#008900">28</span><span style="color:#008900">h</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EAE0</span> <span style="color:#008900">var_18</span>          <span style="color:#ec0000">=</span> <span style="color:#008900">word</span> <span style="color:#008900">ptr</span> -<span style="color:#008900">18</span><span style="color:#008900">h</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EAE0</span> <span style="color:#008900">var_C</span>           <span style="color:#ec0000">=</span> <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> -<span style="color:#008900">0</span><span style="color:#008900">Ch</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EAE0</span> <span style="color:#008900">var_4</span>           <span style="color:#ec0000">=</span> <span style="color:#008900">byte</span> <span style="color:#008900">ptr</span> -<span style="color:#008900">4</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EAE0</span> <span style="color:#008900">arg_0</span>           <span style="color:#ec0000">=</span> <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span>  <span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EAE0</span> <span style="color:#008900">arg_4</span>           <span style="color:#ec0000">=</span> <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span>  <span style="color:#008900">0</span><span style="color:#008900">Ch</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EAE0</span> <span style="color:#008900">arg_8</span>           <span style="color:#ec0000">=</span> <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span>  <span style="color:#008900">10</span><span style="color:#008900">h</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EAE0</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EAE0</span>                 <span style="color:#008900">push</span>    <span style="color:#008900">ebp</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EAE1</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">ebp</span>, <span style="color:#008900">esp</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EAE3</span>                 <span style="color:#008900">add</span>     <span style="color:#008900">esp</span>, <span style="color:#008900">0</span><span style="color:#008900">FFFFFFC0h</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EAE6</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">eax</span>, <span style="color:#008900">offset</span> <span style="color:#008900">unk_4B3C64</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EAEB</span>                 <span style="color:#008900">call</span>    <span style="color:#ec0000">@</span><span style="color:#008900">__InitExceptBlockLDTC</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EAF0</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">edx</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">arg_0</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EAF3</span>                 <span style="color:#008900">push</span>    <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> [<span style="color:#008900">edx</span><span style="color:#ec0000">+</span><span style="color:#008900">40</span><span style="color:#008900">h</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EAF6</span>                 <span style="color:#008900">push</span>    [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">arg_4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EAF9</span>                 <span style="color:#008900">call</span>    <span style="color:#008900">unknown_libname_1142</span> ; CBuilder 5 runtime  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0040</span><span style="color:#5f5fff">EAFE</span>                 <span style="color:#008900">add</span>     <span style="color:#008900">esp</span>, <span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EB01</span>                 <span style="color:#008900">mov</span>     [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_18</span>], <span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EB07</span>                 <span style="color:#008900">lea</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EB0A</span>                 <span style="color:#008900">call</span>    <span style="color:#008900">unknown_libname_1128</span> ; CBuilder 5 runtime  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0040</span><span style="color:#5f5fff">EB0F</span>                 <span style="color:#008900">inc</span>     [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_C</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EB12</span>                 <span style="color:#008900">mov</span>     [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_18</span>], <span style="color:#008900">14</span><span style="color:#008900">h</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EB18</span>                 <span style="color:#008900">xor</span>     <span style="color:#008900">edx</span>, <span style="color:#008900">edx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EB1A</span>                 <span style="color:#008900">mov</span>     [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">totoaltime</span>], <span style="color:#008900">edx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EB1D</span>                 <span style="color:#008900">xor</span>     <span style="color:#008900">ecx</span>, <span style="color:#008900">ecx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EB1F</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">usedtime</span><span style="color:#ec0000">+</span><span style="color:#008900">4</span>], <span style="color:#008900">ecx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EB22</span>                 <span style="color:#008900">jmp</span>     <span style="color:#008900">short</span> <span style="color:#008900">loc_40EB61</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EB24</span> ; ---------------------------------------------------------------------------  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0040</span><span style="color:#5f5fff">EB24</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EB24</span> <span style="color:#008900">loc_40EB24</span>:                            ; CODE XREF: sub_40EAE0+8A j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0040</span><span style="color:#5f5fff">EB24</span>                 <span style="color:#008900">lea</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">usedtime</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EB27</span>                 <span style="color:#008900">push</span>    <span style="color:#008900">eax</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EB28</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">edx</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">arg_0</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EB2B</span>                 <span style="color:#008900">push</span>    <span style="color:#008900">edx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EB2C</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">ecx</span>, [<span style="color:#008900">edx</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EB2E</span>                 <span style="color:#008900">call</span>    <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> [<span style="color:#008900">ecx</span><span style="color:#ec0000">+</span><span style="color:#008900">8</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EB31</span>                 <span style="color:#008900">add</span>     <span style="color:#008900">esp</span>, <span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EB34</span>                 <span style="color:#008900">test</span>    <span style="color:#008900">al</span>, <span style="color:#008900">al</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EB36</span>                 <span style="color:#008900">jz</span>      <span style="color:#008900">short</span> <span style="color:#008900">loc_40EB54</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EB38</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">eax</span>, <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">usedtime</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EB3B</span>                 <span style="color:#008900">add</span>     [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">totoaltime</span>], <span style="color:#008900">eax</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EB3E</span>                 <span style="color:#008900">push</span>    [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">arg_4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EB41</span>                 <span style="color:#008900">call</span>    <span style="color:#ec0000">@</span><span style="color:#008900">AspHlpr@TMTSASPObject@getObjectContext$qv_4</span> ; CBuilder 5 runtime  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0040</span><span style="color:#5f5fff">EB41</span>                                        ; BCC v4.x/5.x class library 32 bit  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0040</span><span style="color:#5f5fff">EB46</span>                 <span style="color:#008900">pop</span>     <span style="color:#008900">ecx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EB47</span>                 <span style="color:#008900">dec</span>     <span style="color:#008900">eax</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EB48</span>                 <span style="color:#008900">push</span>    <span style="color:#008900">eax</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EB49</span>                 <span style="color:#008900">push</span>    [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">arg_4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EB4C</span>                 <span style="color:#008900">call</span>    <span style="color:#008900">unknown_libname_1142</span> ; CBuilder 5 runtime  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0040</span><span style="color:#5f5fff">EB51</span>                 <span style="color:#008900">add</span>     <span style="color:#008900">esp</span>, <span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EB54</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EB54</span> <span style="color:#008900">loc_40EB54</span>:                            ; CODE XREF: sub_40EAE0+56 j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0040</span><span style="color:#5f5fff">EB54</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">eax</span>, <span style="color:#008900">64</span><span style="color:#008900">h</span>       ; dwMilliseconds  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0040</span><span style="color:#5f5fff">EB59</span>                 <span style="color:#008900">call</span>    <span style="color:#ec0000">@</span><span style="color:#008900">Sleep</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EB5E</span>                 <span style="color:#008900">inc</span>     <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">usedtime</span><span style="color:#ec0000">+</span><span style="color:#008900">4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EB61</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EB61</span> <span style="color:#008900">loc_40EB61</span>:                            ; CODE XREF: sub_40EAE0+42 j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0040</span><span style="color:#5f5fff">EB61</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">edx</span>, <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">usedtime</span><span style="color:#ec0000">+</span><span style="color:#008900">4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EB64</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">ecx</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">arg_0</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EB67</span>                 <span style="color:#008900">cmp</span>     <span style="color:#008900">edx</span>, [<span style="color:#008900">ecx</span><span style="color:#ec0000">+</span><span style="color:#008900">40</span><span style="color:#008900">h</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EB6A</span>                 <span style="color:#008900">jl</span>      <span style="color:#008900">short</span> <span style="color:#008900">loc_40EB24</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EB6C</span>                 <span style="color:#008900">push</span>    [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">arg_4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EB6F</span>                 <span style="color:#008900">call</span>    <span style="color:#ec0000">@</span><span style="color:#008900">AspHlpr@TMTSASPObject@getObjectContext$qv_4</span> ; CBuilder 5 runtime  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0040</span><span style="color:#5f5fff">EB6F</span>                                        ; BCC v4.x/5.x class library 32 bit  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0040</span><span style="color:#5f5fff">EB74</span>                 <span style="color:#008900">pop</span>     <span style="color:#008900">ecx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EB75</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">edx</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">arg_0</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EB78</span>                 <span style="color:#008900">cmp</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">edx</span><span style="color:#ec0000">+</span><span style="color:#008900">40</span><span style="color:#008900">h</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EB7B</span>                 <span style="color:#008900">jz</span>      <span style="color:#008900">short</span> <span style="color:#008900">loc_40EBC9</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EB7D</span>                 <span style="color:#008900">push</span>    [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">arg_4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EB80</span>                 <span style="color:#008900">call</span>    <span style="color:#ec0000">@</span><span style="color:#008900">AspHlpr@TMTSASPObject@getObjectContext$qv_4</span> ; CBuilder 5 runtime  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0040</span><span style="color:#5f5fff">EB80</span>                                        ; BCC v4.x/5.x class library 32 bit  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0040</span><span style="color:#5f5fff">EB85</span>                 <span style="color:#008900">pop</span>     <span style="color:#008900">ecx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EB86</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">ecx</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">arg_0</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EB89</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">edx</span>, [<span style="color:#008900">ecx</span><span style="color:#ec0000">+</span><span style="color:#008900">40</span><span style="color:#008900">h</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EB8C</span>                 <span style="color:#008900">sub</span>     <span style="color:#008900">edx</span>, <span style="color:#008900">eax</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EB8E</span>                 <span style="color:#008900">mov</span>     [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_38</span>], <span style="color:#008900">edx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EB91</span>                 <span style="color:#008900">fild</span>    [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_38</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EB94</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">totoaltime</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EB97</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_40</span>], <span style="color:#008900">eax</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EB9A</span>                 <span style="color:#008900">xor</span>     <span style="color:#008900">ecx</span>, <span style="color:#008900">ecx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EB9C</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_40</span><span style="color:#ec0000">+</span><span style="color:#008900">4</span>], <span style="color:#008900">ecx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EB9F</span>                 <span style="color:#008900">fild</span>    [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_40</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EBA2</span>                 <span style="color:#008900">fdivrp</span>  <span style="color:#008900">st</span>(<span style="color:#008900">1</span>), <span style="color:#008900">st</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EBA4</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">arg_8</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EBA7</span>                 <span style="color:#008900">fstp</span>    <span style="color:#008900">qword</span> <span style="color:#008900">ptr</span> [<span style="color:#008900">eax</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EBA9</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">al</span>, <span style="color:#008900">1</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EBAB</span>                 <span style="color:#008900">push</span>    <span style="color:#008900">eax</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EBAC</span>                 <span style="color:#008900">dec</span>     [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_C</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EBAF</span>                 <span style="color:#008900">lea</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EBB2</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">edx</span>, <span style="color:#008900">2</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EBB7</span>                 <span style="color:#008900">call</span>    <span style="color:#ec0000">@</span><span style="color:#008900">System@AnsiString@$bdtr$qqrv</span> ; System::AnsiString::~AnsiString(void)  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0040</span><span style="color:#5f5fff">EBBC</span>                 <span style="color:#008900">pop</span>     <span style="color:#008900">eax</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EBBD</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">edx</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_28</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EBC0</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">large</span> <span style="color:#008900">fs</span>:<span style="color:#008900">0</span>, <span style="color:#008900">edx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EBC7</span>                 <span style="color:#008900">jmp</span>     <span style="color:#008900">short</span> <span style="color:#008900">loc_40EBE7</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EBC9</span> ; ---------------------------------------------------------------------------  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0040</span><span style="color:#5f5fff">EBC9</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EBC9</span> <span style="color:#008900">loc_40EBC9</span>:                            ; CODE XREF: sub_40EAE0+9B j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0040</span><span style="color:#5f5fff">EBC9</span>                 <span style="color:#008900">xor</span>     <span style="color:#008900">eax</span>, <span style="color:#008900">eax</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EBCB</span>                 <span style="color:#008900">push</span>    <span style="color:#008900">eax</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EBCC</span>                 <span style="color:#008900">dec</span>     [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_C</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EBCF</span>                 <span style="color:#008900">lea</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EBD2</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">edx</span>, <span style="color:#008900">2</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EBD7</span>                 <span style="color:#008900">call</span>    <span style="color:#ec0000">@</span><span style="color:#008900">System@AnsiString@$bdtr$qqrv</span> ; System::AnsiString::~AnsiString(void)  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0040</span><span style="color:#5f5fff">EBDC</span>                 <span style="color:#008900">pop</span>     <span style="color:#008900">eax</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EBDD</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">edx</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_28</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EBE0</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">large</span> <span style="color:#008900">fs</span>:<span style="color:#008900">0</span>, <span style="color:#008900">edx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EBE7</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EBE7</span> <span style="color:#008900">loc_40EBE7</span>:                            ; CODE XREF: sub_40EAE0+E7 j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0040</span><span style="color:#5f5fff">EBE7</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">esp</span>, <span style="color:#008900">ebp</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EBE9</span>                 <span style="color:#008900">pop</span>     <span style="color:#008900">ebp</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EBEA</span>                 <span style="color:#008900">retn</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EBEA</span> <span style="color:#008900">sub_40EAE0</span>      <span style="color:#008900">endp</span> 
</span></span></code></pre></div><p>  可以得知该函数循环执行指定次数的dns连接，使用的时间累加到totaltime中，后面使用该时间计算平均用时，整个程序精华在于<br>
<code> (unsigned __int8)(*(int (__cdecl **)(int, int *))(*(_DWORD *)a1 + 8))(a1, &amp;usedtime)</code><br>
  这个call，实际上是FUNC2，而sub_40EA3C中可以解释为：</p>
<div class="highlight"><pre tabindex="0" style="color:#757575;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Asm" data-lang="Asm"><span style="display:flex;"><span><span style="color:#ec0000">0040</span><span style="color:#5f5fff">EA3C</span> <span style="color:#008900">sub_40EA3C</span>      <span style="color:#008900">proc</span> <span style="color:#008900">near</span>              ; DATA XREF: .data:fastdns___CPPdebugHook+105D0 o  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0040</span><span style="color:#5f5fff">EA3C</span>                                        ; .data:fastdns___CPPdebugHook+11C3C o  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0040</span><span style="color:#5f5fff">EA3C</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA3C</span> <span style="color:#008900">var_14</span>          <span style="color:#ec0000">=</span> <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> -<span style="color:#008900">14</span><span style="color:#008900">h</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA3C</span> <span style="color:#008900">var_10</span>          <span style="color:#ec0000">=</span> <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> -<span style="color:#008900">10</span><span style="color:#008900">h</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA3C</span> <span style="color:#008900">pertime</span>         <span style="color:#ec0000">=</span> <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> -<span style="color:#008900">0</span><span style="color:#008900">Ch</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA3C</span> <span style="color:#008900">var_8</span>           <span style="color:#ec0000">=</span> <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> -<span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA3C</span> <span style="color:#008900">a1</span>              <span style="color:#ec0000">=</span> <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> -<span style="color:#008900">4</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA3C</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA3C</span>                 <span style="color:#008900">push</span>    <span style="color:#008900">ebp</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA3D</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">ebp</span>, <span style="color:#008900">esp</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA3F</span>                 <span style="color:#008900">add</span>     <span style="color:#008900">esp</span>, <span style="color:#008900">0</span><span style="color:#008900">FFFFFFECh</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA42</span>                 <span style="color:#008900">mov</span>     [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">a1</span>], <span style="color:#008900">eax</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA45</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">a1</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA48</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">byte</span> <span style="color:#008900">ptr</span> [<span style="color:#008900">eax</span><span style="color:#ec0000">+</span><span style="color:#008900">0</span><span style="color:#008900">Fh</span>], <span style="color:#008900">1</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA4C</span>                 <span style="color:#008900">lea</span>     <span style="color:#008900">edx</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">pertime</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA4F</span>                 <span style="color:#008900">push</span>    <span style="color:#008900">edx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA50</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">ecx</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">a1</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA53</span>                 <span style="color:#008900">push</span>    <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> [<span style="color:#008900">ecx</span><span style="color:#ec0000">+</span><span style="color:#008900">30</span><span style="color:#008900">h</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA56</span>                 <span style="color:#008900">push</span>    [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">a1</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA59</span>                 <span style="color:#008900">call</span>    <span style="color:#008900">sub_40EAE0</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA5E</span>                 <span style="color:#008900">add</span>     <span style="color:#008900">esp</span>, <span style="color:#008900">0</span><span style="color:#008900">Ch</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA61</span>                 <span style="color:#008900">test</span>    <span style="color:#008900">al</span>, <span style="color:#008900">al</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA63</span>                 <span style="color:#008900">jz</span>      <span style="color:#008900">short</span> <span style="color:#008900">loc_40EA8B</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA65</span>                 <span style="color:#008900">push</span>    [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_8</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA68</span>                 <span style="color:#008900">push</span>    [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">pertime</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA6B</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">edx</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">a1</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA6E</span>                 <span style="color:#008900">push</span>    <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> [<span style="color:#008900">edx</span><span style="color:#ec0000">+</span><span style="color:#008900">30</span><span style="color:#008900">h</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA71</span>                 <span style="color:#008900">call</span>    <span style="color:#008900">sub_40EABC</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA76</span>                 <span style="color:#008900">add</span>     <span style="color:#008900">esp</span>, <span style="color:#008900">0</span><span style="color:#008900">Ch</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA79</span>                 <span style="color:#008900">push</span>    <span style="color:#008900">0</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA7B</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">ecx</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">a1</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA7E</span>                 <span style="color:#008900">push</span>    <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> [<span style="color:#008900">ecx</span><span style="color:#ec0000">+</span><span style="color:#008900">30</span><span style="color:#008900">h</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA81</span>                 <span style="color:#008900">call</span>    <span style="color:#008900">sub_40EAD0</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA86</span>                 <span style="color:#008900">add</span>     <span style="color:#008900">esp</span>, <span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA89</span>                 <span style="color:#008900">jmp</span>     <span style="color:#008900">short</span> <span style="color:#008900">loc_40EA9B</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA8B</span> ; ---------------------------------------------------------------------------  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0040</span><span style="color:#5f5fff">EA8B</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA8B</span> <span style="color:#008900">loc_40EA8B</span>:                            ; CODE XREF: sub_40EA3C+27 j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0040</span><span style="color:#5f5fff">EA8B</span>                 <span style="color:#008900">push</span>    <span style="color:#008900">3</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA8D</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">a1</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA90</span>                 <span style="color:#008900">push</span>    <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> [<span style="color:#008900">eax</span><span style="color:#ec0000">+</span><span style="color:#008900">30</span><span style="color:#008900">h</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA93</span>                 <span style="color:#008900">call</span>    <span style="color:#008900">sub_40EAD0</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA98</span>                 <span style="color:#008900">add</span>     <span style="color:#008900">esp</span>, <span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA9B</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EA9B</span> <span style="color:#008900">loc_40EA9B</span>:                            ; CODE XREF: sub_40EA3C+4D j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0040</span><span style="color:#5f5fff">EA9B</span>                 <span style="color:#008900">mov</span>     [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_14</span>], <span style="color:#008900">offset</span> <span style="color:#008900">sub_40EA10</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EAA2</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">edx</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">a1</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EAA5</span>                 <span style="color:#008900">mov</span>     [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_10</span>], <span style="color:#008900">edx</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EAA8</span>                 <span style="color:#008900">lea</span>     <span style="color:#008900">ecx</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_14</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EAAB</span>                 <span style="color:#008900">push</span>    <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> [<span style="color:#008900">ecx</span><span style="color:#ec0000">+</span><span style="color:#008900">4</span>] ; a5  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0040</span><span style="color:#5f5fff">EAAE</span>                 <span style="color:#008900">push</span>    <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> [<span style="color:#008900">ecx</span>] ; a4  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0040</span><span style="color:#5f5fff">EAB0</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">a1</span>]  ; a1  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">0040</span><span style="color:#5f5fff">EAB3</span>                 <span style="color:#008900">call</span>    <span style="color:#008900">terminate</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EAB8</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">esp</span>, <span style="color:#008900">ebp</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EABA</span>                 <span style="color:#008900">pop</span>     <span style="color:#008900">ebp</span> 
</span></span><span style="display:flex;"><span><span style="color:#008900">0040</span><span style="color:#008900">EABB</span>                 <span style="color:#008900">retn</span> 
</span></span></code></pre></div><p>  现在同时推测param类结构，可知</p>
<pre tabindex="0"><code class="language-Txt" data-lang="Txt">+00h virtualtable
          +0 STOP
          +4 FUNC1
          +8 FUNC2
+04h HANDLE hthread ??
+0Fh bool Initaled ??
+10h 
+18h FARPROC func0
+1Ch LPVOID param0
+20h FARPROC func1//OnIdle处理函数
+24h LPVOID param1
+28h BOOL IsMainthread??
+30h struct*
                +00h int leftTime//剩余次数
                +08h double pertime//平均消耗时间
                +10h flag statu  //成功0 失败3
+38h FARPROC func2
+3Ch DWORD param2
+40h int repeatTime//取样次数
+44h int timeout//超时
</code></pre><h2 id="得到设置dns逻辑">得到设置DNS逻辑</h2>
<p>  通过字符串搜索，可以定位到TfrmSetDNS_btnConfirmClick函数为点击了设置dns窗口的“设置”按钮后回调函数</p>
<div class="highlight"><pre tabindex="0" style="color:#757575;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#ec0000">__int32</span> <span style="color:#ec0000">*</span><span style="color:#ec0000">__fastcall</span> <span style="color:#5f5fff">TfrmSetDNS_btnConfirmClick</span>(<span style="color:#5f5fff">int</span> a1, <span style="color:#5f5fff">int</span> a2)  
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span>  v32 <span style="color:#ec0000">=</span> a2;  
</span></span><span style="display:flex;"><span>  v33 <span style="color:#ec0000">=</span> a1;  
</span></span><span style="display:flex;"><span>  __InitExceptBlockLDTC();  
</span></span><span style="display:flex;"><span>  v31 <span style="color:#ec0000">=</span> <span style="color:#ec0000">&amp;</span>v48;  
</span></span><span style="display:flex;"><span>  v52 <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>;  
</span></span><span style="display:flex;"><span>  v53 <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>;  
</span></span><span style="display:flex;"><span>  v54 <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>;  
</span></span><span style="display:flex;"><span>  v36 <span style="color:#ec0000">+=</span> <span style="color:#008900">4</span>;  
</span></span><span style="display:flex;"><span>  v35 <span style="color:#ec0000">=</span> <span style="color:#008900">8</span>;  
</span></span><span style="display:flex;"><span>  <span style="color:#ec0000">for</span> ( i <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>; i <span style="color:#ec0000">&lt;</span> (<span style="color:#ec0000">*</span>(<span style="color:#5f5fff">int</span> (<span style="color:#ec0000">**</span>)(<span style="color:#5f5fff">void</span>))(<span style="color:#ec0000">**</span>(_DWORD <span style="color:#ec0000">**</span>)(<span style="color:#ec0000">*</span>(_DWORD <span style="color:#ec0000">*</span>)(v33 <span style="color:#ec0000">+</span> <span style="color:#008900">772</span>) <span style="color:#ec0000">+</span> <span style="color:#008900">536</span>) <span style="color:#ec0000">+</span> <span style="color:#008900">20</span>))(); <span style="color:#ec0000">++</span>i )// 0044a604 GetCount 选中DNS地址个数  
</span></span><span style="display:flex;"><span>  {  
</span></span><span style="display:flex;"><span>    v35 <span style="color:#ec0000">=</span> <span style="color:#008900">44</span>;  
</span></span><span style="display:flex;"><span>    v3 <span style="color:#ec0000">=</span> <span style="color:#ec0000">*</span>(_DWORD <span style="color:#ec0000">*</span>)(v33 <span style="color:#ec0000">+</span> <span style="color:#008900">0x304</span>);  
</span></span><span style="display:flex;"><span>    addrstring <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>;  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">++</span>v36;  
</span></span><span style="display:flex;"><span>    (<span style="color:#ec0000">*</span>(<span style="color:#5f5fff">void</span> (<span style="color:#ec0000">__fastcall</span> <span style="color:#ec0000">**</span>)(_DWORD, <span style="color:#5f5fff">int</span>, <span style="color:#5f5fff">int</span> <span style="color:#ec0000">*</span>))(<span style="color:#ec0000">**</span>(_DWORD <span style="color:#ec0000">**</span>)(v3 <span style="color:#ec0000">+</span> <span style="color:#008900">0x218</span>)  
</span></span><span style="display:flex;"><span>                                               <span style="color:#ec0000">+</span> <span style="color:#008900">12</span>))(// 0044a620  getaddrstring  获取地址文本串  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">*</span>(_DWORD <span style="color:#ec0000">*</span>)(v3 <span style="color:#ec0000">+</span> <span style="color:#008900">0x218</span>),  
</span></span><span style="display:flex;"><span>      i,  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">&amp;</span>addrstring);  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">if</span> ( v53 <span style="color:#ec0000">==</span> v54 )  
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>      sub_403C34((<span style="color:#5f5fff">int</span>)<span style="color:#ec0000">&amp;</span>v52, v53, (<span style="color:#5f5fff">int</span>)<span style="color:#ec0000">&amp;</span>addrstring, (<span style="color:#5f5fff">int</span>)<span style="color:#ec0000">&amp;</span>v30, <span style="color:#008900">1u</span>, <span style="color:#008900">1</span>);  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">else</span> 
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>      v46 <span style="color:#ec0000">=</span> v53;  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">if</span> ( v53 )  
</span></span><span style="display:flex;"><span>      {  
</span></span><span style="display:flex;"><span>        v35 <span style="color:#ec0000">=</span> <span style="color:#008900">56</span>;  
</span></span><span style="display:flex;"><span>        System<span style="color:#ec0000">::</span>AnsiString<span style="color:#ec0000">::</span>AnsiString(v46, <span style="color:#ec0000">&amp;</span>addrstring);  
</span></span><span style="display:flex;"><span>        v35 <span style="color:#ec0000">=</span> <span style="color:#008900">44</span>;  
</span></span><span style="display:flex;"><span>      }  
</span></span><span style="display:flex;"><span>      v53 <span style="color:#ec0000">+=</span> <span style="color:#008900">4</span>;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">--</span>v36;  
</span></span><span style="display:flex;"><span>    System<span style="color:#ec0000">::</span>AnsiString<span style="color:#ec0000">::~</span>AnsiString(<span style="color:#ec0000">&amp;</span>addrstring, <span style="color:#008900">2</span>);  
</span></span><span style="display:flex;"><span>  }  
</span></span><span style="display:flex;"><span>  <span style="color:#ec0000">++</span>v36;  
</span></span><span style="display:flex;"><span>  v29 <span style="color:#ec0000">=</span> <span style="color:#ec0000">&amp;</span>v45;  
</span></span><span style="display:flex;"><span>  v49 <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>;  
</span></span><span style="display:flex;"><span>  v50 <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>;  
</span></span><span style="display:flex;"><span>  <span style="color:#ec0000">++</span>v36;  
</span></span><span style="display:flex;"><span>  v51 <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>;  
</span></span><span style="display:flex;"><span>  <span style="color:#ec0000">++</span>v36;  
</span></span><span style="display:flex;"><span>  <span style="color:#ec0000">++</span>v36;  
</span></span><span style="display:flex;"><span>  <span style="color:#ec0000">++</span>v36;  
</span></span><span style="display:flex;"><span>  <span style="color:#ec0000">--</span>v36;  
</span></span><span style="display:flex;"><span>  v35 <span style="color:#ec0000">=</span> <span style="color:#008900">8</span>;  
</span></span><span style="display:flex;"><span>  <span style="color:#ec0000">for</span> ( j <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>; j <span style="color:#ec0000">&lt;</span> (<span style="color:#ec0000">*</span>(<span style="color:#5f5fff">int</span> (<span style="color:#ec0000">**</span>)(<span style="color:#5f5fff">void</span>))(<span style="color:#ec0000">**</span>(_DWORD <span style="color:#ec0000">**</span>)(<span style="color:#ec0000">*</span>(_DWORD <span style="color:#ec0000">*</span>)(v33 <span style="color:#ec0000">+</span> <span style="color:#008900">768</span>) <span style="color:#ec0000">+</span> <span style="color:#008900">536</span>) <span style="color:#ec0000">+</span> <span style="color:#008900">20</span>))(); <span style="color:#ec0000">++</span>j )// 对于网卡列表中的每一项  
</span></span><span style="display:flex;"><span>  {  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">if</span> ( (<span style="color:#5f5fff">unsigned</span> <span style="color:#ec0000">__int8</span>)TCheckListBox<span style="color:#ec0000">::</span>GetChecked(<span style="color:#ec0000">*</span>(_DWORD <span style="color:#ec0000">*</span>)(v33 <span style="color:#ec0000">+</span> <span style="color:#008900">768</span>), j) )// 如果复选框选中  
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>      v35 <span style="color:#ec0000">=</span> <span style="color:#008900">92</span>;  
</span></span><span style="display:flex;"><span>      v5 <span style="color:#ec0000">=</span> <span style="color:#ec0000">*</span>(_DWORD <span style="color:#ec0000">*</span>)(v33 <span style="color:#ec0000">+</span> <span style="color:#008900">768</span>);  
</span></span><span style="display:flex;"><span>      v44 <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>;  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">++</span>v36;  
</span></span><span style="display:flex;"><span>      (<span style="color:#ec0000">*</span>(<span style="color:#5f5fff">void</span> (<span style="color:#ec0000">__fastcall</span> <span style="color:#ec0000">**</span>)(_DWORD, <span style="color:#5f5fff">int</span>, <span style="color:#5f5fff">int</span> <span style="color:#ec0000">*</span>))(<span style="color:#ec0000">**</span>(_DWORD <span style="color:#ec0000">**</span>)(v5 <span style="color:#ec0000">+</span> <span style="color:#008900">536</span>) <span style="color:#ec0000">+</span> <span style="color:#008900">12</span>))(<span style="color:#ec0000">*</span>(_DWORD <span style="color:#ec0000">*</span>)(v5 <span style="color:#ec0000">+</span> <span style="color:#008900">536</span>), j, <span style="color:#ec0000">&amp;</span>v44);// 获取网卡名称  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">if</span> ( v50 <span style="color:#ec0000">==</span> v51 )  
</span></span><span style="display:flex;"><span>      {  
</span></span><span style="display:flex;"><span>        sub_403C34((<span style="color:#5f5fff">int</span>)<span style="color:#ec0000">&amp;</span>v49, v50, (<span style="color:#5f5fff">int</span>)<span style="color:#ec0000">&amp;</span>v44, (<span style="color:#5f5fff">int</span>)<span style="color:#ec0000">&amp;</span>v28, <span style="color:#008900">1u</span>, <span style="color:#008900">1</span>);  
</span></span><span style="display:flex;"><span>      }  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">else</span> 
</span></span><span style="display:flex;"><span>      {  
</span></span><span style="display:flex;"><span>        v43 <span style="color:#ec0000">=</span> v50;  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">if</span> ( v50 )  
</span></span><span style="display:flex;"><span>        {  
</span></span><span style="display:flex;"><span>          v35 <span style="color:#ec0000">=</span> <span style="color:#008900">104</span>;  
</span></span><span style="display:flex;"><span>          System<span style="color:#ec0000">::</span>AnsiString<span style="color:#ec0000">::</span>AnsiString(v43, <span style="color:#ec0000">&amp;</span>v44);  
</span></span><span style="display:flex;"><span>          v35 <span style="color:#ec0000">=</span> <span style="color:#008900">92</span>;  
</span></span><span style="display:flex;"><span>        }  
</span></span><span style="display:flex;"><span>        v50 <span style="color:#ec0000">+=</span> <span style="color:#008900">4</span>;  
</span></span><span style="display:flex;"><span>      }  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">--</span>v36;  
</span></span><span style="display:flex;"><span>      System<span style="color:#ec0000">::</span>AnsiString<span style="color:#ec0000">::~</span>AnsiString(<span style="color:#ec0000">&amp;</span>v44, <span style="color:#008900">2</span>);  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>  }  
</span></span><span style="display:flex;"><span>  <span style="color:#ec0000">if</span> ( (<span style="color:#5f5fff">unsigned</span> <span style="color:#5f5fff">int</span>)((v53 <span style="color:#ec0000">-</span> v52) <span style="color:#ec0000">/</span> <span style="color:#008900">4</span>) <span style="color:#ec0000">&lt;=</span> <span style="color:#008900">50</span> )  // 如果选中dns地址小于50个  
</span></span><span style="display:flex;"><span>  {  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">if</span> ( (v50 <span style="color:#ec0000">-</span> v49) <span style="color:#ec0000">/</span> <span style="color:#008900">4</span> )                      // 如果选中了网卡  
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>      v35 <span style="color:#ec0000">=</span> <span style="color:#008900">284</span>;  
</span></span><span style="display:flex;"><span>      v10 <span style="color:#ec0000">=</span> sub_407DCC((<span style="color:#5f5fff">int</span>)off_4A4404, <span style="color:#008900">1</span>, v33);  
</span></span><span style="display:flex;"><span>      sub_407F6C(v10, (<span style="color:#5f5fff">int</span>)<span style="color:#ec0000">&amp;</span>v49, (<span style="color:#5f5fff">int</span>)<span style="color:#ec0000">&amp;</span>v52);      
</span></span><span style="display:flex;"><span>      (<span style="color:#ec0000">*</span>(<span style="color:#5f5fff">void</span> (<span style="color:#ec0000">**</span>)(<span style="color:#5f5fff">void</span>))(<span style="color:#ec0000">*</span>(_DWORD <span style="color:#ec0000">*</span>)v10 <span style="color:#ec0000">+</span> <span style="color:#008900">0xE8</span>))();// 004670dc  showmodel and setsetting 设置dns并显示进度  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">*</span>(_BYTE <span style="color:#ec0000">*</span>)(v33 <span style="color:#ec0000">+</span> <span style="color:#008900">776</span>) <span style="color:#ec0000">=</span> (<span style="color:#5f5fff">unsigned</span> <span style="color:#5f5fff">int</span>)<span style="color:#ec0000">*</span>(_BYTE <span style="color:#ec0000">*</span>)(v10 <span style="color:#ec0000">+</span> <span style="color:#008900">776</span>) <span style="color:#ec0000">&lt;</span> <span style="color:#008900">1</span>;  
</span></span><span style="display:flex;"><span>      v35 <span style="color:#ec0000">=</span> <span style="color:#008900">8</span>;  
</span></span><span style="display:flex;"><span>      v37 <span style="color:#ec0000">=</span> v10;  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">if</span> ( v10 )  
</span></span><span style="display:flex;"><span>      {  
</span></span><span style="display:flex;"><span>        v38 <span style="color:#ec0000">=</span> <span style="color:#ec0000">*</span>(_DWORD <span style="color:#ec0000">*</span>)v10;  
</span></span><span style="display:flex;"><span>        v35 <span style="color:#ec0000">=</span> <span style="color:#008900">308</span>;  
</span></span><span style="display:flex;"><span>        (<span style="color:#ec0000">*</span>(<span style="color:#5f5fff">void</span> (<span style="color:#ec0000">__fastcall</span> <span style="color:#ec0000">**</span>)(<span style="color:#5f5fff">int</span>, <span style="color:#5f5fff">signed</span> <span style="color:#5f5fff">int</span>))(<span style="color:#ec0000">*</span>(_DWORD <span style="color:#ec0000">*</span>)v37 <span style="color:#ec0000">-</span> <span style="color:#008900">4</span>))(v37, <span style="color:#008900">3</span>);  
</span></span><span style="display:flex;"><span>        v35 <span style="color:#ec0000">=</span> <span style="color:#008900">296</span>;  
</span></span><span style="display:flex;"><span>      }  
</span></span><span style="display:flex;"><span>      sub_466E84(v33);  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">--</span>v36;  
</span></span><span style="display:flex;"><span>      sub_403254(v49, v50);  
</span></span><span style="display:flex;"><span>      v35 <span style="color:#ec0000">=</span> <span style="color:#008900">8</span>;  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">--</span>v36;  
</span></span><span style="display:flex;"><span>      v9 <span style="color:#ec0000">=</span> (v51 <span style="color:#ec0000">-</span> v49) <span style="color:#ec0000">/</span> <span style="color:#008900">4</span>;  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">if</span> ( v49 )  
</span></span><span style="display:flex;"><span>      {  
</span></span><span style="display:flex;"><span>        v8 <span style="color:#ec0000">=</span> <span style="color:#008900">4</span> <span style="color:#ec0000">*</span> v9;  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">if</span> ( (<span style="color:#5f5fff">unsigned</span> <span style="color:#5f5fff">int</span>)(<span style="color:#008900">4</span> <span style="color:#ec0000">*</span> v9) <span style="color:#ec0000">&lt;=</span> <span style="color:#008900">0x80</span> )  
</span></span><span style="display:flex;"><span>          sub_4A0CA4(v49, v8);  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">else</span> 
</span></span><span style="display:flex;"><span>          _rtl_close(v49);  
</span></span><span style="display:flex;"><span>      }  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">--</span>v36;  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">--</span>v36;  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">--</span>v36;  
</span></span><span style="display:flex;"><span>      sub_403254(v52, v53);  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">--</span>v36;  
</span></span><span style="display:flex;"><span>      result <span style="color:#ec0000">=</span> (<span style="color:#ec0000">__int32</span> <span style="color:#ec0000">*</span>)v52;  
</span></span><span style="display:flex;"><span>      v7 <span style="color:#ec0000">=</span> (v54 <span style="color:#ec0000">-</span> v52) <span style="color:#ec0000">/</span> <span style="color:#008900">4</span>;  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">if</span> ( v52 )  
</span></span><span style="display:flex;"><span>      {  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">if</span> ( (<span style="color:#5f5fff">unsigned</span> <span style="color:#5f5fff">int</span>)(<span style="color:#008900">4</span> <span style="color:#ec0000">*</span> v7) <span style="color:#ec0000">&lt;=</span> <span style="color:#008900">0x80</span> )  
</span></span><span style="display:flex;"><span>          result <span style="color:#ec0000">=</span> sub_4A0CA4(v52, <span style="color:#008900">4</span> <span style="color:#ec0000">*</span> v7);  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">else</span> 
</span></span><span style="display:flex;"><span>          result <span style="color:#ec0000">=</span> (<span style="color:#ec0000">__int32</span> <span style="color:#ec0000">*</span>)_rtl_close(v52);  
</span></span><span style="display:flex;"><span>      }  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">else</span> 
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>      v35 <span style="color:#ec0000">=</span> <span style="color:#008900">200</span>;  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">++</span>v36;  
</span></span><span style="display:flex;"><span>      FormatString(<span style="color:#ec0000">&amp;</span>v39, (<span style="color:#5f5fff">char</span> <span style="color:#ec0000">*</span>)<span style="color:#008900">&#34;请至少选择一个连接。&#34;</span>);  
</span></span><span style="display:flex;"><span>      v36 <span style="color:#ec0000">+=</span> <span style="color:#008900">4</span>;  
</span></span><span style="display:flex;"><span>      MessageBox((<span style="color:#5f5fff">int</span>)<span style="color:#ec0000">&amp;</span>v39);  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">--</span>v36;  
</span></span><span style="display:flex;"><span>      v35 <span style="color:#ec0000">=</span> <span style="color:#008900">8</span>;  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">--</span>v36;  
</span></span><span style="display:flex;"><span>      v19 <span style="color:#ec0000">=</span> v40 <span style="color:#ec0000">-</span> v39;  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">if</span> ( v39 )  
</span></span><span style="display:flex;"><span>      {  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">if</span> ( (<span style="color:#5f5fff">unsigned</span> <span style="color:#5f5fff">int</span>)v19 <span style="color:#ec0000">&lt;=</span> <span style="color:#008900">0x80</span> )  
</span></span><span style="display:flex;"><span>          sub_4A0CA4(v39, v19);  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">else</span> 
</span></span><span style="display:flex;"><span>          _rtl_close(v39);  
</span></span><span style="display:flex;"><span>      }  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">--</span>v36;  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">--</span>v36;  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">--</span>v36;  
</span></span><span style="display:flex;"><span>      (<span style="color:#ec0000">*</span>(<span style="color:#5f5fff">void</span> (<span style="color:#ec0000">**</span>)(<span style="color:#5f5fff">void</span>))(<span style="color:#ec0000">**</span>(_DWORD <span style="color:#ec0000">**</span>)(v33 <span style="color:#ec0000">+</span> <span style="color:#008900">768</span>) <span style="color:#ec0000">+</span> <span style="color:#008900">192</span>))();  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">--</span>v36;  
</span></span><span style="display:flex;"><span>      v18 <span style="color:#ec0000">=</span> v50;  
</span></span><span style="display:flex;"><span>      v17 <span style="color:#ec0000">=</span> v49;  
</span></span><span style="display:flex;"><span>      sub_403254(v49, v50);  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">--</span>v36;  
</span></span><span style="display:flex;"><span>      v16 <span style="color:#ec0000">=</span> (v51 <span style="color:#ec0000">-</span> v49) <span style="color:#ec0000">/</span> <span style="color:#008900">4</span>;  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">if</span> ( v49 )  
</span></span><span style="display:flex;"><span>      {  
</span></span><span style="display:flex;"><span>        v15 <span style="color:#ec0000">=</span> <span style="color:#008900">4</span> <span style="color:#ec0000">*</span> v16;  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">if</span> ( (<span style="color:#5f5fff">unsigned</span> <span style="color:#5f5fff">int</span>)(<span style="color:#008900">4</span> <span style="color:#ec0000">*</span> v16) <span style="color:#ec0000">&lt;=</span> <span style="color:#008900">0x80</span> )  
</span></span><span style="display:flex;"><span>          sub_4A0CA4(v49, v15);  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">else</span> 
</span></span><span style="display:flex;"><span>          _rtl_close(v49);  
</span></span><span style="display:flex;"><span>      }  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">--</span>v36;  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">--</span>v36;  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">--</span>v36;  
</span></span><span style="display:flex;"><span>      v14 <span style="color:#ec0000">=</span> v53;  
</span></span><span style="display:flex;"><span>      v13 <span style="color:#ec0000">=</span> v52;  
</span></span><span style="display:flex;"><span>      sub_403254(v52, v53);  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">--</span>v36;  
</span></span><span style="display:flex;"><span>      v12 <span style="color:#ec0000">=</span> (v54 <span style="color:#ec0000">-</span> v52) <span style="color:#ec0000">/</span> <span style="color:#008900">4</span>;  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">if</span> ( v52 )  
</span></span><span style="display:flex;"><span>      {  
</span></span><span style="display:flex;"><span>        v11 <span style="color:#ec0000">=</span> <span style="color:#008900">4</span> <span style="color:#ec0000">*</span> v12;  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">if</span> ( (<span style="color:#5f5fff">unsigned</span> <span style="color:#5f5fff">int</span>)(<span style="color:#008900">4</span> <span style="color:#ec0000">*</span> v12) <span style="color:#ec0000">&lt;=</span> <span style="color:#008900">0x80</span> )  
</span></span><span style="display:flex;"><span>          sub_4A0CA4(v52, v11);  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">else</span> 
</span></span><span style="display:flex;"><span>          _rtl_close(v52);  
</span></span><span style="display:flex;"><span>      }  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">--</span>v36;  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">--</span>v36;  
</span></span><span style="display:flex;"><span>      result <span style="color:#ec0000">=</span> v34;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>  }  
</span></span><span style="display:flex;"><span>  <span style="color:#ec0000">else</span> 
</span></span><span style="display:flex;"><span>  {  
</span></span><span style="display:flex;"><span>    v35 <span style="color:#ec0000">=</span> <span style="color:#008900">116</span>;  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">++</span>v36;  
</span></span><span style="display:flex;"><span>    FormatString(<span style="color:#ec0000">&amp;</span>handle, <span style="color:#008900">&#34;选中的DNS地址数量过多。</span><span style="color:#008900">\n</span><span style="color:#008900">只允许选择不超过50个的DNS地址。&#34;</span>);  
</span></span><span style="display:flex;"><span>    v36 <span style="color:#ec0000">+=</span> <span style="color:#008900">4</span>;  
</span></span><span style="display:flex;"><span>    MessageBox((<span style="color:#5f5fff">int</span>)<span style="color:#ec0000">&amp;</span>handle);  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">--</span>v36;  
</span></span><span style="display:flex;"><span>    v35 <span style="color:#ec0000">=</span> <span style="color:#008900">8</span>;  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">--</span>v36;  
</span></span><span style="display:flex;"><span>    v27 <span style="color:#ec0000">=</span> v42 <span style="color:#ec0000">-</span> handle;  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">if</span> ( handle )  
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">if</span> ( (<span style="color:#5f5fff">unsigned</span> <span style="color:#5f5fff">int</span>)v27 <span style="color:#ec0000">&lt;=</span> <span style="color:#008900">0x80</span> )  
</span></span><span style="display:flex;"><span>        sub_4A0CA4(handle, v27);  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">else</span> 
</span></span><span style="display:flex;"><span>        _rtl_close(handle);  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">--</span>v36;  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">--</span>v36;  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">--</span>v36;  
</span></span><span style="display:flex;"><span>    (<span style="color:#ec0000">*</span>(<span style="color:#5f5fff">void</span> (<span style="color:#ec0000">**</span>)(<span style="color:#5f5fff">void</span>))(<span style="color:#ec0000">**</span>(_DWORD <span style="color:#ec0000">**</span>)(v33 <span style="color:#ec0000">+</span> <span style="color:#008900">764</span>) <span style="color:#ec0000">+</span> <span style="color:#008900">192</span>))();  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">--</span>v36;  
</span></span><span style="display:flex;"><span>    v26 <span style="color:#ec0000">=</span> v50;  
</span></span><span style="display:flex;"><span>    v25 <span style="color:#ec0000">=</span> v49;  
</span></span><span style="display:flex;"><span>    sub_403254(v49, v50);  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">--</span>v36;  
</span></span><span style="display:flex;"><span>    v24 <span style="color:#ec0000">=</span> (v51 <span style="color:#ec0000">-</span> v49) <span style="color:#ec0000">/</span> <span style="color:#008900">4</span>;  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">if</span> ( v49 )  
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">if</span> ( (<span style="color:#5f5fff">unsigned</span> <span style="color:#5f5fff">int</span>)(<span style="color:#008900">4</span> <span style="color:#ec0000">*</span> v24) <span style="color:#ec0000">&lt;=</span> <span style="color:#008900">0x80</span> )  
</span></span><span style="display:flex;"><span>        sub_4A0CA4(v49, <span style="color:#008900">4</span> <span style="color:#ec0000">*</span> v24);  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">else</span> 
</span></span><span style="display:flex;"><span>        _rtl_close(v49);  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">--</span>v36;  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">--</span>v36;  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">--</span>v36;  
</span></span><span style="display:flex;"><span>    v23 <span style="color:#ec0000">=</span> v53;  
</span></span><span style="display:flex;"><span>    v22 <span style="color:#ec0000">=</span> v52;  
</span></span><span style="display:flex;"><span>    result <span style="color:#ec0000">=</span> (<span style="color:#ec0000">__int32</span> <span style="color:#ec0000">*</span>)sub_403254(v52, v53);  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">--</span>v36;  
</span></span><span style="display:flex;"><span>    v21 <span style="color:#ec0000">=</span> (v54 <span style="color:#ec0000">-</span> v52) <span style="color:#ec0000">/</span> <span style="color:#008900">4</span>;  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">if</span> ( v52 )  
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>      v20 <span style="color:#ec0000">=</span> <span style="color:#008900">4</span> <span style="color:#ec0000">*</span> v21;  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">if</span> ( (<span style="color:#5f5fff">unsigned</span> <span style="color:#5f5fff">int</span>)(<span style="color:#008900">4</span> <span style="color:#ec0000">*</span> v21) <span style="color:#ec0000">&lt;=</span> <span style="color:#008900">0x80</span> )  
</span></span><span style="display:flex;"><span>        result <span style="color:#ec0000">=</span> sub_4A0CA4(v52, v20);  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">else</span> 
</span></span><span style="display:flex;"><span>        result <span style="color:#ec0000">=</span> (<span style="color:#ec0000">__int32</span> <span style="color:#ec0000">*</span>)_rtl_close(v52);  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">--</span>v36;  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">--</span>v36;  
</span></span><span style="display:flex;"><span>  }  
</span></span><span style="display:flex;"><span>  <span style="color:#ec0000">return</span> result;  
</span></span><span style="display:flex;"><span>} 
</span></span></code></pre></div><p>  <code>(*(void (**)(void))(*(_DWORD *)v10 + 0xE8))()</code>通过消息机制最终调用了<code>_TfrmSetDNSProccess_tmrStartTimer</code>，该函数真正执行设置dns：<br>
对于每个网卡接口<br>
  00407F88先清除dns<br>
    netsh interface ip set dns name=&quot;??网&quot;  source=static addr=none<br>
  对于每个dns地址<br>
    004082F4逐个添加dns<br>
      netsh interface ip add dns name=&quot;??网&quot; addr=??.??.??.??</p>
<div class="highlight"><pre tabindex="0" style="color:#757575;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#5f5fff">int</span> <span style="color:#ec0000">__fastcall</span> <span style="color:#5f5fff">TfrmSetDNSProccess_tmrStartTimer</span>(<span style="color:#5f5fff">int</span> a1)  
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span>  <span style="color:#5f5fff">int</span> v1; // ebx@1  
</span></span><span style="display:flex;"><span>  <span style="color:#5f5fff">int</span> i; // edi@1  
</span></span><span style="display:flex;"><span>  <span style="color:#5f5fff">int</span> v3; // ST0C_4@2  
</span></span><span style="display:flex;"><span>  <span style="color:#5f5fff">int</span> <span style="color:#ec0000">*</span>v4; // eax@2  
</span></span><span style="display:flex;"><span>  <span style="color:#5f5fff">int</span> v5; // esi@4  
</span></span><span style="display:flex;"><span>  <span style="color:#5f5fff">int</span> v6; // ST0C_4@5  
</span></span><span style="display:flex;"><span>  <span style="color:#5f5fff">int</span> v7; // ST08_4@5  
</span></span><span style="display:flex;"><span>  <span style="color:#5f5fff">int</span> <span style="color:#ec0000">*</span>v8; // eax@5  
</span></span><span style="display:flex;"><span>  <span style="color:#5f5fff">int</span> v10; // [sp+Ch] [bp-30h]@4  
</span></span><span style="display:flex;"><span>  <span style="color:#5f5fff">int</span> v11; // [sp+34h] [bp-8h]@5  
</span></span><span style="display:flex;"><span>  <span style="color:#5f5fff">int</span> v12; // [sp+38h] [bp-4h]@2  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>  v1 <span style="color:#ec0000">=</span> a1;  
</span></span><span style="display:flex;"><span>  __InitExceptBlockLDTC();  
</span></span><span style="display:flex;"><span>  unknown_libname_1860(<span style="color:#ec0000">*</span>(_DWORD <span style="color:#ec0000">*</span>)(v1 <span style="color:#ec0000">+</span> <span style="color:#008900">760</span>), <span style="color:#008900">0</span>);  
</span></span><span style="display:flex;"><span>  sub_486B60(<span style="color:#ec0000">*</span>(_DWORD <span style="color:#ec0000">*</span>)(v1 <span style="color:#ec0000">+</span> <span style="color:#008900">752</span>), <span style="color:#008900">1</span>);  
</span></span><span style="display:flex;"><span>  sub_486B6C(  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">*</span>(_DWORD <span style="color:#ec0000">*</span>)(v1 <span style="color:#ec0000">+</span> <span style="color:#008900">752</span>),  
</span></span><span style="display:flex;"><span>    ((<span style="color:#ec0000">*</span>(_DWORD <span style="color:#ec0000">*</span>)(<span style="color:#ec0000">*</span>(_DWORD <span style="color:#ec0000">*</span>)(v1 <span style="color:#ec0000">+</span> <span style="color:#008900">768</span>) <span style="color:#ec0000">+</span> <span style="color:#008900">4</span>) <span style="color:#ec0000">-</span> <span style="color:#ec0000">**</span>(_DWORD <span style="color:#ec0000">**</span>)(v1 <span style="color:#ec0000">+</span> <span style="color:#008900">768</span>)) <span style="color:#ec0000">/</span> <span style="color:#008900">4</span> <span style="color:#ec0000">+</span> <span style="color:#008900">1</span>)  
</span></span><span style="display:flex;"><span>  <span style="color:#ec0000">*</span> ((<span style="color:#ec0000">*</span>(_DWORD <span style="color:#ec0000">*</span>)(<span style="color:#ec0000">*</span>(_DWORD <span style="color:#ec0000">*</span>)(v1 <span style="color:#ec0000">+</span> <span style="color:#008900">764</span>) <span style="color:#ec0000">+</span> <span style="color:#008900">4</span>) <span style="color:#ec0000">-</span> <span style="color:#ec0000">**</span>(_DWORD <span style="color:#ec0000">**</span>)(v1 <span style="color:#ec0000">+</span> <span style="color:#008900">764</span>))  
</span></span><span style="display:flex;"><span>   <span style="color:#ec0000">/</span> <span style="color:#008900">4</span>));  
</span></span><span style="display:flex;"><span>  <span style="color:#ec0000">for</span> ( i <span style="color:#ec0000">=</span> <span style="color:#ec0000">**</span>(_DWORD <span style="color:#ec0000">**</span>)(v1 <span style="color:#ec0000">+</span> <span style="color:#008900">764</span>); i <span style="color:#ec0000">!=</span> <span style="color:#ec0000">*</span>(_DWORD <span style="color:#ec0000">*</span>)(<span style="color:#ec0000">*</span>(_DWORD <span style="color:#ec0000">*</span>)(v1 <span style="color:#ec0000">+</span> <span style="color:#008900">764</span>) <span style="color:#ec0000">+</span> <span style="color:#008900">4</span>); i <span style="color:#ec0000">+=</span> <span style="color:#008900">4</span> )  
</span></span><span style="display:flex;"><span>  {  
</span></span><span style="display:flex;"><span>    v3 <span style="color:#ec0000">=</span> <span style="color:#ec0000">*</span>(_DWORD <span style="color:#ec0000">*</span>)i;  
</span></span><span style="display:flex;"><span>    v12 <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>;  
</span></span><span style="display:flex;"><span>    v4 <span style="color:#ec0000">=</span> (<span style="color:#5f5fff">int</span> <span style="color:#ec0000">*</span>)System<span style="color:#ec0000">::</span>AnsiString<span style="color:#ec0000">::</span>sprintf(<span style="color:#ec0000">&amp;</span>v12, (<span style="color:#ec0000">const</span> <span style="color:#5f5fff">char</span> <span style="color:#ec0000">*</span>)<span style="color:#ec0000">&amp;</span>unk_4A40BB, v3);  
</span></span><span style="display:flex;"><span>    TControl<span style="color:#ec0000">::</span>SetText(<span style="color:#ec0000">*</span>(_DWORD <span style="color:#ec0000">*</span>)(v1 <span style="color:#ec0000">+</span> <span style="color:#008900">756</span>), <span style="color:#ec0000">*</span>v4);// 显示清除原有设置  
</span></span><span style="display:flex;"><span>    System<span style="color:#ec0000">::</span>AnsiString<span style="color:#ec0000">::~</span>AnsiString(<span style="color:#ec0000">&amp;</span>v12, <span style="color:#008900">2</span>);  
</span></span><span style="display:flex;"><span>    TApplication<span style="color:#ec0000">::</span>ProcessMessages(<span style="color:#ec0000">*</span>off_4B9450[<span style="color:#008900">0</span>]);  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">if</span> ( <span style="color:#ec0000">!</span>cleardns(v1, i) )  
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">*</span>(_BYTE <span style="color:#ec0000">*</span>)(v1 <span style="color:#ec0000">+</span> <span style="color:#008900">776</span>) <span style="color:#ec0000">=</span> <span style="color:#008900">1</span>;  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">return</span> sub_466E84(v1);  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    TProgressBar<span style="color:#ec0000">::</span>StepBy(<span style="color:#ec0000">*</span>(_DWORD <span style="color:#ec0000">*</span>)(v1 <span style="color:#ec0000">+</span> <span style="color:#008900">752</span>), <span style="color:#008900">1</span>);// 更新进度条  
</span></span><span style="display:flex;"><span>    v5 <span style="color:#ec0000">=</span> <span style="color:#ec0000">**</span>(_DWORD <span style="color:#ec0000">**</span>)(v1 <span style="color:#ec0000">+</span> <span style="color:#008900">768</span>);  
</span></span><span style="display:flex;"><span>    v10 <span style="color:#ec0000">=</span> <span style="color:#008900">1</span>;  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">while</span> ( v5 <span style="color:#ec0000">!=</span> <span style="color:#ec0000">*</span>(_DWORD <span style="color:#ec0000">*</span>)(<span style="color:#ec0000">*</span>(_DWORD <span style="color:#ec0000">*</span>)(v1 <span style="color:#ec0000">+</span> <span style="color:#008900">768</span>) <span style="color:#ec0000">+</span> <span style="color:#008900">4</span>) )  
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>      v6 <span style="color:#ec0000">=</span> <span style="color:#ec0000">*</span>(_DWORD <span style="color:#ec0000">*</span>)v5;  
</span></span><span style="display:flex;"><span>      v7 <span style="color:#ec0000">=</span> <span style="color:#ec0000">*</span>(_DWORD <span style="color:#ec0000">*</span>)i;  
</span></span><span style="display:flex;"><span>      v11 <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>;  
</span></span><span style="display:flex;"><span>      v8 <span style="color:#ec0000">=</span> (<span style="color:#5f5fff">int</span> <span style="color:#ec0000">*</span>)System<span style="color:#ec0000">::</span>AnsiString<span style="color:#ec0000">::</span>sprintf(<span style="color:#ec0000">&amp;</span>v11, (<span style="color:#ec0000">const</span> <span style="color:#5f5fff">char</span> <span style="color:#ec0000">*</span>)<span style="color:#ec0000">&amp;</span>unk_4A40D9, v7, v6);  
</span></span><span style="display:flex;"><span>      TControl<span style="color:#ec0000">::</span>SetText(<span style="color:#ec0000">*</span>(_DWORD <span style="color:#ec0000">*</span>)(v1 <span style="color:#ec0000">+</span> <span style="color:#008900">756</span>), <span style="color:#ec0000">*</span>v8);// 显示正在写入dns  
</span></span><span style="display:flex;"><span>      System<span style="color:#ec0000">::</span>AnsiString<span style="color:#ec0000">::~</span>AnsiString(<span style="color:#ec0000">&amp;</span>v11, <span style="color:#008900">2</span>);  
</span></span><span style="display:flex;"><span>      TApplication<span style="color:#ec0000">::</span>ProcessMessages(<span style="color:#ec0000">*</span>off_4B9450[<span style="color:#008900">0</span>]);  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">if</span> ( adddns(v1, i, v5, v10) )  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">++</span>v10;  
</span></span><span style="display:flex;"><span>      TProgressBar<span style="color:#ec0000">::</span>StepBy(<span style="color:#ec0000">*</span>(_DWORD <span style="color:#ec0000">*</span>)(v1 <span style="color:#ec0000">+</span> <span style="color:#008900">752</span>), <span style="color:#008900">1</span>);  
</span></span><span style="display:flex;"><span>      v5 <span style="color:#ec0000">+=</span> <span style="color:#008900">4</span>;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>  }  
</span></span><span style="display:flex;"><span>  <span style="color:#ec0000">return</span> sub_466E84(v1);  
</span></span><span style="display:flex;"><span>} 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">bool</span> <span style="color:#ec0000">__cdecl</span> <span style="color:#5f5fff">cleardns</span>(<span style="color:#5f5fff">int</span> a1, <span style="color:#5f5fff">int</span> a2)  
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span>  __InitExceptBlockLDTC();  
</span></span><span style="display:flex;"><span>  qmemcpy(<span style="color:#ec0000">&amp;</span>v17, <span style="color:#ec0000">&amp;</span>unk_4A3F18, <span style="color:#008900">0x40u</span>);  
</span></span><span style="display:flex;"><span>  <span style="color:#ec0000">do</span> 
</span></span><span style="display:flex;"><span>  {  
</span></span><span style="display:flex;"><span>    v15 <span style="color:#ec0000">=</span> <span style="color:#008900">2</span>;  
</span></span><span style="display:flex;"><span>    ExitCode <span style="color:#ec0000">=</span> <span style="color:#ec0000">-</span><span style="color:#008900">1</span>;  
</span></span><span style="display:flex;"><span>    v10 <span style="color:#ec0000">=</span> <span style="color:#ec0000">*</span>(_DWORD <span style="color:#ec0000">*</span>)(a1 <span style="color:#ec0000">+</span> <span style="color:#008900">772</span>);  
</span></span><span style="display:flex;"><span>    v18 <span style="color:#ec0000">=</span> <span style="color:#008900">8</span>;  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">++</span>v19;  
</span></span><span style="display:flex;"><span>    v9 <span style="color:#ec0000">=</span> <span style="color:#ec0000">*</span>(_DWORD <span style="color:#ec0000">*</span>)a2;  
</span></span><span style="display:flex;"><span>    v32 <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>;  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">++</span>v19;  
</span></span><span style="display:flex;"><span>    sub_40CA68((<span style="color:#5f5fff">int</span>)<span style="color:#ec0000">&amp;</span>v32, (<span style="color:#5f5fff">int</span>)<span style="color:#ec0000">&amp;</span>v17, <span style="color:#008900">64</span>);  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">if</span> ( v32 )  
</span></span><span style="display:flex;"><span>      v2 <span style="color:#ec0000">=</span> v32;  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">else</span> 
</span></span><span style="display:flex;"><span>      v2 <span style="color:#ec0000">=</span> (<span style="color:#ec0000">const</span> <span style="color:#5f5fff">char</span> <span style="color:#ec0000">*</span>)<span style="color:#ec0000">&amp;</span>unk_4A3F8E;  
</span></span><span style="display:flex;"><span>    v31 <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>;  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">++</span>v19;  
</span></span><span style="display:flex;"><span>    v14 <span style="color:#ec0000">=</span> (<span style="color:#5f5fff">char</span> <span style="color:#ec0000">**</span>)System<span style="color:#ec0000">::</span>AnsiString<span style="color:#ec0000">::</span>sprintf(<span style="color:#ec0000">&amp;</span>v31, v2, v9);// 构造netsh命令  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">if</span> ( <span style="color:#ec0000">*</span>v14 )  
</span></span><span style="display:flex;"><span>      v3 <span style="color:#ec0000">=</span> <span style="color:#ec0000">*</span>v14;  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">else</span> 
</span></span><span style="display:flex;"><span>      v3 <span style="color:#ec0000">=</span> (<span style="color:#5f5fff">char</span> <span style="color:#ec0000">*</span>)<span style="color:#ec0000">&amp;</span>unk_4A3F8F;  
</span></span><span style="display:flex;"><span>    FormatString(<span style="color:#ec0000">&amp;</span>v29, v3);  
</span></span><span style="display:flex;"><span>    v19 <span style="color:#ec0000">+=</span> <span style="color:#008900">4</span>;  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">++</span>v19;  
</span></span><span style="display:flex;"><span>    v28 <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>;  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">++</span>v19;  
</span></span><span style="display:flex;"><span>    unknown_libname_1857(<span style="color:#ec0000">*</span>off_4B9450[<span style="color:#008900">0</span>], <span style="color:#ec0000">&amp;</span>v28);  
</span></span><span style="display:flex;"><span>    s <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>;  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">++</span>v19;  
</span></span><span style="display:flex;"><span>    ExtractFilePath(v28, <span style="color:#ec0000">&amp;</span>s);  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">if</span> ( s )  
</span></span><span style="display:flex;"><span>      v4 <span style="color:#ec0000">=</span> s;  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">else</span> 
</span></span><span style="display:flex;"><span>      v4 <span style="color:#ec0000">=</span> (<span style="color:#5f5fff">char</span> <span style="color:#ec0000">*</span>)<span style="color:#ec0000">&amp;</span>unk_4A3F8D;  
</span></span><span style="display:flex;"><span>    FormatString(<span style="color:#ec0000">&amp;</span>handle, v4);  
</span></span><span style="display:flex;"><span>    v19 <span style="color:#ec0000">+=</span> <span style="color:#008900">4</span>;  
</span></span><span style="display:flex;"><span>    v11 <span style="color:#ec0000">=</span> (<span style="color:#5f5fff">unsigned</span> <span style="color:#ec0000">__int8</span>)sub_40E30C((<span style="color:#5f5fff">int</span>)<span style="color:#ec0000">&amp;</span>handle, (<span style="color:#5f5fff">int</span>)<span style="color:#ec0000">&amp;</span>v29, v10, <span style="color:#ec0000">&amp;</span>ExitCode) <span style="color:#ec0000">&lt;</span> <span style="color:#008900">1u</span>;// CreateProcess   netsh程序  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">--</span>v19;  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">--</span>v19;  
</span></span><span style="display:flex;"><span>    v13 <span style="color:#ec0000">=</span> v26 <span style="color:#ec0000">-</span> handle;  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">if</span> ( handle )  
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">if</span> ( (<span style="color:#5f5fff">unsigned</span> <span style="color:#5f5fff">int</span>)v13 <span style="color:#ec0000">&lt;=</span> <span style="color:#008900">0x80</span> )  
</span></span><span style="display:flex;"><span>        sub_4A0CA4(handle, v13);  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">else</span> 
</span></span><span style="display:flex;"><span>        _rtl_close(handle);  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">--</span>v19;  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">--</span>v19;  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">--</span>v19;  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">--</span>v19;  
</span></span><span style="display:flex;"><span>    System<span style="color:#ec0000">::</span>AnsiString<span style="color:#ec0000">::~</span>AnsiString(<span style="color:#ec0000">&amp;</span>s, <span style="color:#008900">2</span>);  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">--</span>v19;  
</span></span><span style="display:flex;"><span>    System<span style="color:#ec0000">::</span>AnsiString<span style="color:#ec0000">::~</span>AnsiString(<span style="color:#ec0000">&amp;</span>v28, <span style="color:#008900">2</span>);  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">--</span>v19;  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">--</span>v19;  
</span></span><span style="display:flex;"><span>    v12 <span style="color:#ec0000">=</span> v30 <span style="color:#ec0000">-</span> v29;  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">if</span> ( v29 )  
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">if</span> ( (<span style="color:#5f5fff">unsigned</span> <span style="color:#5f5fff">int</span>)v12 <span style="color:#ec0000">&lt;=</span> <span style="color:#008900">0x80</span> )  
</span></span><span style="display:flex;"><span>        sub_4A0CA4(v29, v12);  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">else</span> 
</span></span><span style="display:flex;"><span>        _rtl_close(v29);  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">--</span>v19;  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">--</span>v19;  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">--</span>v19;  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">--</span>v19;  
</span></span><span style="display:flex;"><span>    System<span style="color:#ec0000">::</span>AnsiString<span style="color:#ec0000">::~</span>AnsiString(<span style="color:#ec0000">&amp;</span>v32, <span style="color:#008900">2</span>);  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">--</span>v19;  
</span></span><span style="display:flex;"><span>    System<span style="color:#ec0000">::</span>AnsiString<span style="color:#ec0000">::~</span>AnsiString(<span style="color:#ec0000">&amp;</span>v31, <span style="color:#008900">2</span>);  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">if</span> ( v11 )  
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>      v18 <span style="color:#ec0000">=</span> <span style="color:#008900">68</span>;  
</span></span><span style="display:flex;"><span>      v5 <span style="color:#ec0000">=</span> System<span style="color:#ec0000">::</span>AnsiString<span style="color:#ec0000">::</span>AnsiString(<span style="color:#ec0000">&amp;</span>v24, <span style="color:#ec0000">&amp;</span>unk_4A3F90);// 调用的动态库不存在。  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">++</span>v19;  
</span></span><span style="display:flex;"><span>      (<span style="color:#ec0000">*</span>(<span style="color:#5f5fff">void</span> (<span style="color:#ec0000">__fastcall</span> <span style="color:#ec0000">**</span>)(_DWORD, _DWORD))(<span style="color:#ec0000">**</span>(_DWORD <span style="color:#ec0000">**</span>)(a1 <span style="color:#ec0000">+</span> <span style="color:#008900">772</span>) <span style="color:#ec0000">+</span> <span style="color:#008900">44</span>))(<span style="color:#ec0000">*</span>(_DWORD <span style="color:#ec0000">*</span>)(a1 <span style="color:#ec0000">+</span> <span style="color:#008900">772</span>), <span style="color:#ec0000">*</span>(_DWORD <span style="color:#ec0000">*</span>)v5);  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">--</span>v19;  
</span></span><span style="display:flex;"><span>      System<span style="color:#ec0000">::</span>AnsiString<span style="color:#ec0000">::~</span>AnsiString(<span style="color:#ec0000">&amp;</span>v24, <span style="color:#008900">2</span>);  
</span></span><span style="display:flex;"><span>      ExitCode <span style="color:#ec0000">=</span> <span style="color:#008900">9999</span>;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">if</span> ( ExitCode )  
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>      v18 <span style="color:#ec0000">=</span> <span style="color:#008900">80</span>;  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">++</span>v19;  
</span></span><span style="display:flex;"><span>      v23 <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>;                                  // 设置中遇到问题。设置停止。.若不能解决问题，测试结果仍然有效，可据此在网络属性中手工设置DNS。  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">++</span>v19;  
</span></span><span style="display:flex;"><span>      (<span style="color:#ec0000">*</span>(<span style="color:#5f5fff">void</span> (<span style="color:#ec0000">__fastcall</span> <span style="color:#ec0000">**</span>)(_DWORD, <span style="color:#5f5fff">int</span> <span style="color:#ec0000">*</span>))(<span style="color:#ec0000">**</span>(_DWORD <span style="color:#ec0000">**</span>)(a1 <span style="color:#ec0000">+</span> <span style="color:#008900">772</span>) <span style="color:#ec0000">+</span> <span style="color:#008900">28</span>))(<span style="color:#ec0000">*</span>(_DWORD <span style="color:#ec0000">*</span>)(a1 <span style="color:#ec0000">+</span> <span style="color:#008900">772</span>), <span style="color:#ec0000">&amp;</span>v23);  
</span></span><span style="display:flex;"><span>      v22 <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>;  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">++</span>v19;  
</span></span><span style="display:flex;"><span>      v6 <span style="color:#ec0000">=</span> (<span style="color:#5f5fff">char</span> <span style="color:#ec0000">**</span>)System<span style="color:#ec0000">::</span>AnsiString<span style="color:#ec0000">::</span>sprintf(<span style="color:#ec0000">&amp;</span>v22, (<span style="color:#ec0000">const</span> <span style="color:#5f5fff">char</span> <span style="color:#ec0000">*</span>)<span style="color:#ec0000">&amp;</span>unk_4A3FA5, v23);  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">if</span> ( <span style="color:#ec0000">*</span>v6 )  
</span></span><span style="display:flex;"><span>        v7 <span style="color:#ec0000">=</span> <span style="color:#ec0000">*</span>v6;  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">else</span> 
</span></span><span style="display:flex;"><span>        v7 <span style="color:#ec0000">=</span> (<span style="color:#5f5fff">char</span> <span style="color:#ec0000">*</span>)<span style="color:#ec0000">&amp;</span>unk_4A40AA;  
</span></span><span style="display:flex;"><span>      FormatString(<span style="color:#ec0000">&amp;</span>v20, v7);  
</span></span><span style="display:flex;"><span>      v19 <span style="color:#ec0000">+=</span> <span style="color:#008900">4</span>;  
</span></span><span style="display:flex;"><span>      v15 <span style="color:#ec0000">=</span> sub_40E26C((<span style="color:#5f5fff">int</span>)<span style="color:#ec0000">&amp;</span>v20, <span style="color:#008900">64</span>, <span style="color:#008900">5</span>, <span style="color:#008900">0</span>, <span style="color:#008900">0</span>);  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">--</span>v19;  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">--</span>v19;  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">if</span> ( v20 )  
</span></span><span style="display:flex;"><span>      {  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">if</span> ( (<span style="color:#5f5fff">unsigned</span> <span style="color:#5f5fff">int</span>)(v21 <span style="color:#ec0000">-</span> v20) <span style="color:#ec0000">&lt;=</span> <span style="color:#008900">0x80</span> )  
</span></span><span style="display:flex;"><span>          sub_4A0CA4(v20, v21 <span style="color:#ec0000">-</span> v20);  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">else</span> 
</span></span><span style="display:flex;"><span>          _rtl_close(v20);  
</span></span><span style="display:flex;"><span>      }  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">--</span>v19;  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">--</span>v19;  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">--</span>v19;  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">--</span>v19;  
</span></span><span style="display:flex;"><span>      System<span style="color:#ec0000">::</span>AnsiString<span style="color:#ec0000">::~</span>AnsiString(<span style="color:#ec0000">&amp;</span>v23, <span style="color:#008900">2</span>);  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">--</span>v19;  
</span></span><span style="display:flex;"><span>      System<span style="color:#ec0000">::</span>AnsiString<span style="color:#ec0000">::~</span>AnsiString(<span style="color:#ec0000">&amp;</span>v22, <span style="color:#008900">2</span>);  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>  }  
</span></span><span style="display:flex;"><span>  <span style="color:#ec0000">while</span> ( v15 <span style="color:#ec0000">==</span> <span style="color:#008900">4</span> );  
</span></span><span style="display:flex;"><span>  <span style="color:#ec0000">return</span> ExitCode <span style="color:#ec0000">==</span> <span style="color:#008900">0</span>;  
</span></span><span style="display:flex;"><span>} 
</span></span></code></pre></div><p>adddns可类似分析，这里不再赘述</p>
<h2 id="fastdns如何列出网卡的">FASTDNS如何列出网卡的？</h2>
<p>  开始以为是找注册表，但是procmon无结果，后来还是根据字符串找到了下面的函数，该函数为设置dns的回调：</p>
<div class="highlight"><pre tabindex="0" style="color:#757575;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00403524</span> _TfrmFastDNS_actSetDNSExecute proc near ; DATA <span style="color:#ec0000">XREF</span>: .<span style="color:#ec0000">data</span>:fastdns___CPPdebugHook<span style="color:#ec0000">+</span><span style="color:#008900">1400</span> o
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00403524</span> var_58          <span style="color:#ec0000">=</span> dword ptr <span style="color:#ec0000">-</span><span style="color:#008900">58</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00403524</span> var_54          <span style="color:#ec0000">=</span> dword ptr <span style="color:#ec0000">-</span><span style="color:#008900">54</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00403524</span> var_44          <span style="color:#ec0000">=</span> word ptr <span style="color:#ec0000">-</span><span style="color:#008900">44</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00403524</span> var_38          <span style="color:#ec0000">=</span> dword ptr <span style="color:#ec0000">-</span><span style="color:#008900">38</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00403524</span> var_30          <span style="color:#ec0000">=</span> dword ptr <span style="color:#ec0000">-</span><span style="color:#008900">30</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00403524</span> var_2C          <span style="color:#ec0000">=</span> dword ptr <span style="color:#ec0000">-</span><span style="color:#008900">2</span>Ch  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00403524</span> handle          <span style="color:#ec0000">=</span> dword ptr <span style="color:#ec0000">-</span><span style="color:#008900">28</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00403524</span> var_18          <span style="color:#ec0000">=</span> dword ptr <span style="color:#ec0000">-</span><span style="color:#008900">18</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00403524</span> var_10          <span style="color:#ec0000">=</span> byte ptr <span style="color:#ec0000">-</span><span style="color:#008900">10</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00403524</span> var_8           <span style="color:#ec0000">=</span> byte ptr <span style="color:#ec0000">-</span><span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00403524</span> var_4           <span style="color:#ec0000">=</span> byte ptr <span style="color:#ec0000">-</span><span style="color:#008900">4</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00403524</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00403524</span>                 push    ebp 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00403525</span>                 mov     ebp, esp 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00403527</span>                 add     esp, <span style="color:#008900">0FF</span>FFFFA8h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040352</span>A                 push    ebx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040352</span>B                 push    esi 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040352</span>C                 push    edi 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040352</span>D                 mov     ebx, eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040352F</span>                 mov     eax, offset unk_4A29EC  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00403534</span>                 call    <span style="color:#ec0000">@</span>__InitExceptBlockLDTC  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040353</span><span style="color:#008900">9</span>                 mov     [ebp<span style="color:#ec0000">+</span>var_44], <span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040353F</span>                 mov     edx, offset unk_4A22C4  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00403544</span>                 lea     eax, [ebp<span style="color:#ec0000">+</span>var_4]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00403547</span>                 call    <span style="color:#ec0000">@</span>System<span style="color:#ec0000">@</span>AnsiString<span style="color:#ec0000">@$</span>bctr<span style="color:#ec0000">$</span>qqrpxc ; System<span style="color:#ec0000">::</span>AnsiString<span style="color:#ec0000">::</span>AnsiString(<span style="color:#5f5fff">char</span> <span style="color:#ec0000">*</span>)  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040354</span>C                 inc     [ebp<span style="color:#ec0000">+</span>var_38]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040354F</span>                 mov     edx, [eax]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00403551</span>                 mov     eax, [ebx<span style="color:#ec0000">+</span><span style="color:#008900">34</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00403557</span>                 call    <span style="color:#ec0000">@</span>TControl<span style="color:#ec0000">@</span>SetText ; TControl<span style="color:#ec0000">::</span>SetText  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040355</span>C                 dec     [ebp<span style="color:#ec0000">+</span>var_38]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040355F</span>                 lea     eax, [ebp<span style="color:#ec0000">+</span>var_4]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00403562</span>                 mov     edx, <span style="color:#008900">2</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00403567</span>                 call    <span style="color:#ec0000">@</span>System<span style="color:#ec0000">@</span>AnsiString<span style="color:#ec0000">@$</span>bdtr<span style="color:#ec0000">$</span>qqrv ; System<span style="color:#ec0000">::</span>AnsiString<span style="color:#ec0000">::~</span>AnsiString(<span style="color:#5f5fff">void</span>)  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040356</span>C                 xor     ecx, ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040356</span>E                 mov     dl, <span style="color:#008900">1</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00403570</span>                 mov     [ebp<span style="color:#ec0000">+</span>var_58], ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00403573</span>                 mov     ecx, ebx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00403575</span>                 mov     [ebp<span style="color:#ec0000">+</span>var_44], <span style="color:#008900">14</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040357</span>B                 mov     eax, off_4A3D2C  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004035</span><span style="color:#008900">80</span>                 call    sub_40738C  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004035</span><span style="color:#008900">85</span>                 mov     [ebp<span style="color:#ec0000">+</span>var_58], eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004035</span><span style="color:#008900">88</span>                 mov     eax, [ebx<span style="color:#ec0000">+</span><span style="color:#008900">340</span>h]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004035</span><span style="color:#008900">8</span>E                 call    <span style="color:#ec0000">@</span>TCustomListView<span style="color:#ec0000">@</span>GetSelection ; TCustomListView<span style="color:#ec0000">::</span>GetSelection  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004035</span><span style="color:#008900">93</span>                 test    eax, eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004035</span><span style="color:#008900">95</span>                 jz      loc_403642  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004035</span><span style="color:#008900">9</span>B                 mov     edx, [ebp<span style="color:#ec0000">+</span>var_58]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004035</span><span style="color:#008900">9</span>E                 mov     eax, [edx<span style="color:#ec0000">+</span><span style="color:#008900">304</span>h]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004035</span>A4                 mov     edx, [eax]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004035</span>A6                 call    dword ptr [edx<span style="color:#ec0000">+</span><span style="color:#008900">0</span>D4h]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004035</span>AC                 mov     [ebp<span style="color:#ec0000">+</span>var_44], <span style="color:#008900">14</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004035</span>B2                 xor     esi, esi 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004035</span>B4                 jmp     <span style="color:#5f5fff">short</span> loc_403629  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004035</span>B6 ; <span style="color:#ec0000">---------------------------------------------------------------------------</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004035</span>B6  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004035</span>B6 <span style="color:#ec0000">loc_4035B6</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: _TfrmFastDNS_actSetDNSExecute<span style="color:#ec0000">+</span><span style="color:#008900">118</span> j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004035</span>B6                 mov     eax, [ebx<span style="color:#ec0000">+</span><span style="color:#008900">340</span>h]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004035</span>BC                 mov     edx, esi 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004035</span>BE                 mov     eax, [eax<span style="color:#ec0000">+</span><span style="color:#008900">22</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004035</span>C4                 call    sub_48A1E4  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004035</span>C9                 mov     edx, <span style="color:#008900">3</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004035</span>CE                 call    <span style="color:#ec0000">@</span>TListItem<span style="color:#ec0000">@</span>GetState ; TListItem<span style="color:#ec0000">::</span>GetState  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004035</span>D3                 test    al, al 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004035</span>D5                 jz      <span style="color:#5f5fff">short</span> loc_403628  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004035</span>D7                 mov     eax, [ebp<span style="color:#ec0000">+</span>var_58]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004035</span>DA                 mov     edx, esi 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004035</span>DC                 mov     edi, [eax<span style="color:#ec0000">+</span><span style="color:#008900">304</span>h]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004035E2</span>                 mov     [ebp<span style="color:#ec0000">+</span>var_44], <span style="color:#008900">20</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004035E8</span>                 mov     eax, [ebx<span style="color:#ec0000">+</span><span style="color:#008900">340</span>h]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004035</span>EE                 add     edi, <span style="color:#008900">218</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004035F</span><span style="color:#008900">4</span>                 mov     eax, [eax<span style="color:#ec0000">+</span><span style="color:#008900">22</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004035F</span>A                 call    sub_48A1E4  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004035FF</span>                 mov     edx, eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00403601</span>                 lea     eax, [ebp<span style="color:#ec0000">+</span>var_8]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00403604</span>                 add     edx, <span style="color:#008900">24</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00403607</span>                 call    <span style="color:#ec0000">@</span>System<span style="color:#ec0000">@</span>AnsiString<span style="color:#ec0000">@$</span>bctr<span style="color:#ec0000">$</span>qqrrx17System<span style="color:#ec0000">@</span>AnsiString ; System<span style="color:#ec0000">::</span>AnsiString<span style="color:#ec0000">::</span>AnsiString(System<span style="color:#ec0000">::</span>AnsiString <span style="color:#ec0000">&amp;</span>)  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040360</span>C                 inc     [ebp<span style="color:#ec0000">+</span>var_38]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040360F</span>                 mov     edx, [eax]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00403611</span>                 mov     eax, [edi]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00403613</span>                 mov     ecx, [eax]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00403615</span>                 call    dword ptr [ecx<span style="color:#ec0000">+</span><span style="color:#008900">38</span>h]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040361</span><span style="color:#008900">8</span>                 dec     [ebp<span style="color:#ec0000">+</span>var_38]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040361</span>B                 lea     eax, [ebp<span style="color:#ec0000">+</span>var_8]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040361</span>E                 mov     edx, <span style="color:#008900">2</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00403623</span>                 call    <span style="color:#ec0000">@</span>System<span style="color:#ec0000">@</span>AnsiString<span style="color:#ec0000">@$</span>bdtr<span style="color:#ec0000">$</span>qqrv ; System<span style="color:#ec0000">::</span>AnsiString<span style="color:#ec0000">::~</span>AnsiString(<span style="color:#5f5fff">void</span>)  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040362</span><span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040362</span><span style="color:#008900">8</span> <span style="color:#ec0000">loc_403628</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: _TfrmFastDNS_actSetDNSExecute<span style="color:#ec0000">+</span>B1 j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040362</span><span style="color:#008900">8</span>                 inc     esi 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040362</span><span style="color:#008900">9</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040362</span><span style="color:#008900">9</span> <span style="color:#ec0000">loc_403629</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: _TfrmFastDNS_actSetDNSExecute<span style="color:#ec0000">+</span><span style="color:#008900">90</span> j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040362</span><span style="color:#008900">9</span>                 mov     ecx, [ebx<span style="color:#ec0000">+</span><span style="color:#008900">340</span>h]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040362F</span>                 mov     eax, [ecx<span style="color:#ec0000">+</span><span style="color:#008900">22</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00403635</span>                 call    <span style="color:#ec0000">@</span>TListItems<span style="color:#ec0000">@</span>GetCount ; TListItems<span style="color:#ec0000">::</span>GetCount  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040363</span>A                 cmp     esi, eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040363</span>C                 jl      loc_4035B6  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00403642</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00403642</span> <span style="color:#ec0000">loc_403642</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: _TfrmFastDNS_actSetDNSExecute<span style="color:#ec0000">+</span><span style="color:#008900">71</span> j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00403642</span>                 mov     eax, [ebp<span style="color:#ec0000">+</span>var_58]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00403645</span>                 mov     edx, [eax]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00403647</span>                 call    dword ptr [edx<span style="color:#ec0000">+</span><span style="color:#008900">0E8</span>h]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040364</span>D                 mov     ecx, [ebp<span style="color:#ec0000">+</span>var_58]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00403650</span>                 cmp     byte ptr [ecx<span style="color:#ec0000">+</span><span style="color:#008900">308</span>h], <span style="color:#008900">0</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00403657</span>                 jz      <span style="color:#5f5fff">short</span> loc_4036C3  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040365</span><span style="color:#008900">9</span>                 mov     [ebp<span style="color:#ec0000">+</span>var_44], <span style="color:#008900">2</span>Ch  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040365F</span>                 lea     eax, [ebp<span style="color:#ec0000">+</span>var_10]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00403662</span>                 lea     edx, [ebp<span style="color:#ec0000">+</span>handle]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00403665</span>                 push    eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00403666</span>                 inc     [ebp<span style="color:#ec0000">+</span>var_38]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040366</span><span style="color:#008900">9</span>                 push    offset aSDnsBg ; <span style="color:#008900">&#34;设置DNS完成。&#34;</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040366</span>E                 push    edx            ; _DWORD  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040366F</span>                 call    FormatString  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00403674</span>                 add     esp, <span style="color:#008900">0</span>Ch  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00403677</span>                 lea     ecx, [ebp<span style="color:#ec0000">+</span>handle]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040367</span>A                 add     [ebp<span style="color:#ec0000">+</span>var_38], <span style="color:#008900">4</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040367</span>E                 push    ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040367F</span>                 call    MessageBox  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004036</span><span style="color:#008900">84</span>                 pop     ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004036</span><span style="color:#008900">85</span>                 dec     [ebp<span style="color:#ec0000">+</span>var_38]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004036</span><span style="color:#008900">88</span>                 mov     [ebp<span style="color:#ec0000">+</span>var_44], <span style="color:#008900">14</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004036</span><span style="color:#008900">8</span>E                 dec     [ebp<span style="color:#ec0000">+</span>var_38]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004036</span><span style="color:#008900">91</span>                 mov     esi, [ebp<span style="color:#ec0000">+</span>var_18]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004036</span><span style="color:#008900">94</span>                 mov     eax, [ebp<span style="color:#ec0000">+</span>handle]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004036</span><span style="color:#008900">97</span>                 sub     esi, eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004036</span><span style="color:#008900">99</span>                 mov     ebx, eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004036</span><span style="color:#008900">9</span>B                 test    ebx, ebx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004036</span><span style="color:#008900">9</span>D                 jz      <span style="color:#5f5fff">short</span> loc_4036BA  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040369F</span>                 cmp     esi, <span style="color:#008900">80</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004036</span>A5                 jbe     <span style="color:#5f5fff">short</span> loc_4036B0  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004036</span>A7                 push    ebx            ; handle  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004036</span>A8                 call    __rtl_close  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004036</span>AD                 pop     ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004036</span>AE                 jmp     <span style="color:#5f5fff">short</span> loc_4036BA  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004036</span>B0 ; <span style="color:#ec0000">---------------------------------------------------------------------------</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004036</span>B0  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004036</span>B0 <span style="color:#ec0000">loc_4036B0</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: _TfrmFastDNS_actSetDNSExecute<span style="color:#ec0000">+</span><span style="color:#008900">181</span> j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004036</span>B0                 push    esi 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004036</span>B1                 push    ebx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004036</span>B2                 call    sub_4A0CA4  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004036</span>B7                 add     esp, <span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004036</span>BA  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004036</span>BA <span style="color:#ec0000">loc_4036BA</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: _TfrmFastDNS_actSetDNSExecute<span style="color:#ec0000">+</span><span style="color:#008900">179</span> j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004036</span>BA                                        ; _TfrmFastDNS_actSetDNSExecute<span style="color:#ec0000">+</span><span style="color:#008900">18</span>A j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004036</span>BA                 dec     [ebp<span style="color:#ec0000">+</span>var_38]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004036</span>BD                 dec     [ebp<span style="color:#ec0000">+</span>var_38]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004036</span>C0                 dec     [ebp<span style="color:#ec0000">+</span>var_38]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004036</span>C3  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004036</span>C3 <span style="color:#ec0000">loc_4036C3</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: _TfrmFastDNS_actSetDNSExecute<span style="color:#ec0000">+</span><span style="color:#008900">133</span> j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004036</span>C3                 mov     [ebp<span style="color:#ec0000">+</span>var_44], <span style="color:#008900">0</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004036</span>C9                 jmp     <span style="color:#5f5fff">short</span> loc_4036D6  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004036</span>CB ; <span style="color:#ec0000">---------------------------------------------------------------------------</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004036</span>CB  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004036</span>CB <span style="color:#ec0000">loc_4036CB</span>:                            ; DATA <span style="color:#ec0000">XREF</span>: .<span style="color:#ec0000">data</span>:fastdns___CPPdebugHook<span style="color:#ec0000">+</span><span style="color:#008900">8F</span><span style="color:#008900">0</span> o  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004036</span>CB                 mov     [ebp<span style="color:#ec0000">+</span>var_44], <span style="color:#008900">1</span>Ch  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004036</span>D1                 call    <span style="color:#ec0000">@</span>_CatchCleanup<span style="color:#ec0000">$</span>qv ; _CatchCleanup(<span style="color:#5f5fff">void</span>)  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004036</span>D6  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004036</span>D6 <span style="color:#ec0000">loc_4036D6</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: _TfrmFastDNS_actSetDNSExecute<span style="color:#ec0000">+</span><span style="color:#008900">1</span>A5 j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004036</span>D6                 mov     ebx, [ebp<span style="color:#ec0000">+</span>var_58]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004036</span>D9                 mov     [ebp<span style="color:#ec0000">+</span>var_30], ebx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004036</span>DC                 test    ebx, ebx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004036</span>DE                 jz      <span style="color:#5f5fff">short</span> loc_4036FE  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004036E0</span>                 mov     eax, [ebx]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004036E2</span>                 mov     [ebp<span style="color:#ec0000">+</span>var_2C], eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004036E5</span>                 mov     [ebp<span style="color:#ec0000">+</span>var_44], <span style="color:#008900">5</span>Ch  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004036</span>EB                 mov     edx, <span style="color:#008900">3</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004036F</span><span style="color:#008900">0</span>                 mov     eax, [ebp<span style="color:#ec0000">+</span>var_30]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004036F</span><span style="color:#008900">3</span>                 mov     ecx, [eax]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004036F</span><span style="color:#008900">5</span>                 call    dword ptr [ecx<span style="color:#ec0000">-</span><span style="color:#008900">4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004036F</span><span style="color:#008900">8</span>                 mov     [ebp<span style="color:#ec0000">+</span>var_44], <span style="color:#008900">50</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004036F</span>E  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004036F</span>E <span style="color:#ec0000">loc_4036FE</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: _TfrmFastDNS_actSetDNSExecute<span style="color:#ec0000">+</span><span style="color:#008900">1</span>BA j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004036F</span>E                 mov     edx, [ebp<span style="color:#ec0000">+</span>var_54]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00403701</span>                 mov     large <span style="color:#ec0000">fs</span>:<span style="color:#008900">0</span>, edx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040370</span><span style="color:#008900">8</span>                 pop     edi 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040370</span><span style="color:#008900">9</span>                 pop     esi 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040370</span>A                 pop     ebx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040370</span>B                 mov     esp, ebp 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040370</span>D                 pop     ebp 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040370</span>E                 retn 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040370</span>E _TfrmFastDNS_actSetDNSExecute endp 
</span></span><span style="display:flex;"><span>t  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004073</span><span style="color:#008900">8</span>C sub_40738C      proc near              ; CODE <span style="color:#ec0000">XREF</span>: _TfrmFastDNS_actSetDNSExecute<span style="color:#ec0000">+</span><span style="color:#008900">5</span>C p  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004073</span><span style="color:#008900">8</span>C                                        ; DATA <span style="color:#ec0000">XREF</span>: .<span style="color:#ec0000">data</span>:fastdns___CPPdebugHook<span style="color:#ec0000">+</span><span style="color:#008900">1</span>D0C o  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004073</span><span style="color:#008900">8</span>C  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004073</span><span style="color:#008900">8</span>C var_54          <span style="color:#ec0000">=</span> byte ptr <span style="color:#ec0000">-</span><span style="color:#008900">54</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004073</span><span style="color:#008900">8</span>C var_49          <span style="color:#ec0000">=</span> byte ptr <span style="color:#ec0000">-</span><span style="color:#008900">49</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004073</span><span style="color:#008900">8</span>C var_48          <span style="color:#ec0000">=</span> dword ptr <span style="color:#ec0000">-</span><span style="color:#008900">48</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004073</span><span style="color:#008900">8</span>C var_38          <span style="color:#ec0000">=</span> word ptr <span style="color:#ec0000">-</span><span style="color:#008900">38</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004073</span><span style="color:#008900">8</span>C var_2C          <span style="color:#ec0000">=</span> dword ptr <span style="color:#ec0000">-</span><span style="color:#008900">2</span>Ch  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004073</span><span style="color:#008900">8</span>C var_28          <span style="color:#ec0000">=</span> byte ptr <span style="color:#ec0000">-</span><span style="color:#008900">28</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004073</span><span style="color:#008900">8</span>C var_1C          <span style="color:#ec0000">=</span> byte ptr <span style="color:#ec0000">-</span><span style="color:#008900">1</span>Ch  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004073</span><span style="color:#008900">8</span>C var_4           <span style="color:#ec0000">=</span> dword ptr <span style="color:#ec0000">-</span><span style="color:#008900">4</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004073</span><span style="color:#008900">8</span>C  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004073</span><span style="color:#008900">8</span>C                 push    ebp 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004073</span><span style="color:#008900">8</span>D                 mov     ebp, esp 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040738F</span>                 add     esp, <span style="color:#008900">0FF</span>FFFFACh  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004073</span><span style="color:#008900">92</span>                 push    ebx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004073</span><span style="color:#008900">93</span>                 push    esi 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004073</span><span style="color:#008900">94</span>                 push    edi 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004073</span><span style="color:#008900">95</span>                 mov     [ebp<span style="color:#ec0000">+</span>var_28], dl 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004073</span><span style="color:#008900">98</span>                 test    dl, dl 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004073</span><span style="color:#008900">9</span>A                 jle     <span style="color:#5f5fff">short</span> loc_4073A1  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004073</span><span style="color:#008900">9</span>C                 call    __ClassCreate  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004073</span>A1  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004073</span>A1 <span style="color:#ec0000">loc_4073A1</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: sub_40738C<span style="color:#ec0000">+</span>E j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004073</span>A1                 mov     ebx, ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004073</span>A3                 mov     [ebp<span style="color:#ec0000">+</span>var_49], dl 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004073</span>A6                 mov     [ebp<span style="color:#ec0000">+</span>var_4], eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004073</span>A9                 lea     esi, [ebp<span style="color:#ec0000">+</span>var_1C]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004073</span>AC                 mov     eax, offset unk_4A3A70  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004073</span>B1                 call    <span style="color:#ec0000">@</span>__InitExceptBlockLDTC  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004073</span>B6                 mov     [ebp<span style="color:#ec0000">+</span>var_38], <span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004073</span>BC                 mov     ecx, ebx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004073</span>BE                 xor     edx, edx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004073</span>C0                 mov     eax, [ebp<span style="color:#ec0000">+</span>var_4]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004073</span>C3                 call    sub_401EFC  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004073</span>C8                 add     [ebp<span style="color:#ec0000">+</span>var_2C], <span style="color:#008900">10</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004073</span>CC                 mov     edx, [ebp<span style="color:#ec0000">+</span>var_4]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004073</span>CF                 xor     ecx, ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004073</span>D1                 xor     eax, eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004073</span>D3                 mov     byte ptr [edx<span style="color:#ec0000">+</span><span style="color:#008900">308</span>h], <span style="color:#008900">0</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004073</span>DA                 mov     [ebp<span style="color:#ec0000">+</span>var_38], <span style="color:#008900">20</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004073E0</span>                 inc     [ebp<span style="color:#ec0000">+</span>var_2C]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004073E3</span>                 mov     [esi], ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004073E5</span>                 mov     [esi<span style="color:#ec0000">+</span><span style="color:#008900">4</span>], eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004073E8</span>                 xor     edx, edx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004073</span>EA                 inc     [ebp<span style="color:#ec0000">+</span>var_2C]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004073</span>ED                 mov     [esi<span style="color:#ec0000">+</span><span style="color:#008900">10</span>h], edx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004073F</span><span style="color:#008900">0</span>                 inc     [ebp<span style="color:#ec0000">+</span>var_2C]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004073F</span><span style="color:#008900">3</span>                 inc     [ebp<span style="color:#ec0000">+</span>var_2C]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004073F</span><span style="color:#008900">6</span>                 inc     [ebp<span style="color:#ec0000">+</span>var_2C]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004073F</span><span style="color:#008900">9</span>                 dec     [ebp<span style="color:#ec0000">+</span>var_2C]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004073F</span>C                 mov     [ebp<span style="color:#ec0000">+</span>var_38], <span style="color:#008900">14</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407402</span>                 push    esi 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407403</span>                 call    sub_4071FC  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040740</span><span style="color:#008900">8</span>                 pop     ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040740</span><span style="color:#008900">9</span>                 mov     ebx, [esi]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040740</span>B                 jmp     <span style="color:#5f5fff">short</span> loc_407427  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040740</span>D ; <span style="color:#ec0000">---------------------------------------------------------------------------</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040740</span>D  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040740</span>D <span style="color:#ec0000">loc_40740D</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: sub_40738C<span style="color:#ec0000">+</span><span style="color:#008900">9</span>E j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040740</span>D                 mov     eax, [ebp<span style="color:#ec0000">+</span>var_4]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407410</span>                 mov     eax, [eax<span style="color:#ec0000">+</span><span style="color:#008900">300</span>h]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407416</span>                 add     eax, <span style="color:#008900">218</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040741</span>B                 mov     edx, [ebx]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040741</span>D                 mov     eax, [eax]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040741F</span>                 mov     ecx, [eax]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407421</span>                 call    dword ptr [ecx<span style="color:#ec0000">+</span><span style="color:#008900">38</span>h]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407424</span>                 add     ebx, <span style="color:#008900">4</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407427</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407427</span> <span style="color:#ec0000">loc_407427</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: sub_40738C<span style="color:#ec0000">+</span><span style="color:#008900">7F</span> j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407427</span>                 cmp     ebx, [esi<span style="color:#ec0000">+</span><span style="color:#008900">4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040742</span>A                 jnz     <span style="color:#5f5fff">short</span> loc_40740D  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040742</span>C                 dec     [ebp<span style="color:#ec0000">+</span>var_2C]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040742F</span>                 lea     ecx, [ebp<span style="color:#ec0000">+</span>var_54]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407432</span>                 mov     eax, [esi<span style="color:#ec0000">+</span><span style="color:#008900">4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407435</span>                 mov     edx, [esi]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407437</span>                 push    ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040743</span><span style="color:#008900">8</span>                 push    eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040743</span><span style="color:#008900">9</span>                 push    edx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040743</span>A                 call    sub_403254  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040743F</span>                 mov     [ebp<span style="color:#ec0000">+</span>var_38], <span style="color:#008900">14</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407445</span>                 dec     [ebp<span style="color:#ec0000">+</span>var_2C]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040744</span><span style="color:#008900">8</span>                 add     esp, <span style="color:#008900">0</span>Ch  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040744</span>B                 mov     edi, [esi<span style="color:#ec0000">+</span><span style="color:#008900">10</span>h]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040744</span>E                 mov     eax, [esi]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407450</span>                 sub     edi, eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407452</span>                 test    edi, edi 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407454</span>                 jns     <span style="color:#5f5fff">short</span> loc_407459  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407456</span>                 add     edi, <span style="color:#008900">3</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040745</span><span style="color:#008900">9</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040745</span><span style="color:#008900">9</span> <span style="color:#ec0000">loc_407459</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: sub_40738C<span style="color:#ec0000">+</span>C8 j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040745</span><span style="color:#008900">9</span>                 sar     edi, <span style="color:#008900">2</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040745</span>C                 mov     ebx, eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040745</span>E                 test    ebx, ebx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407460</span>                 jz      <span style="color:#5f5fff">short</span> loc_407482  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407462</span>                 mov     esi, edi 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407464</span>                 shl     esi, <span style="color:#008900">2</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407467</span>                 cmp     esi, <span style="color:#008900">80</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040746</span>D                 jbe     <span style="color:#5f5fff">short</span> loc_407478  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040746F</span>                 push    ebx            ; handle  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407470</span>                 call    __rtl_close  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407475</span>                 pop     ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407476</span>                 jmp     <span style="color:#5f5fff">short</span> loc_407482  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040747</span><span style="color:#008900">8</span> ; <span style="color:#ec0000">---------------------------------------------------------------------------</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040747</span><span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040747</span><span style="color:#008900">8</span> <span style="color:#ec0000">loc_407478</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: sub_40738C<span style="color:#ec0000">+</span>E1 j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040747</span><span style="color:#008900">8</span>                 push    esi 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040747</span><span style="color:#008900">9</span>                 push    ebx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040747</span>A                 call    sub_4A0CA4  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040747F</span>                 add     esp, <span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004074</span><span style="color:#008900">82</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004074</span><span style="color:#008900">82</span> <span style="color:#ec0000">loc_407482</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: sub_40738C<span style="color:#ec0000">+</span>D4 j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004074</span><span style="color:#008900">82</span>                                        ; sub_40738C<span style="color:#ec0000">+</span>EA j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004074</span><span style="color:#008900">82</span>                 dec     [ebp<span style="color:#ec0000">+</span>var_2C]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004074</span><span style="color:#008900">85</span>                 dec     [ebp<span style="color:#ec0000">+</span>var_2C]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004074</span><span style="color:#008900">88</span>                 mov     [ebp<span style="color:#ec0000">+</span>var_38], <span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004074</span><span style="color:#008900">8</span>E                 mov     eax, [ebp<span style="color:#ec0000">+</span>var_48]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004074</span><span style="color:#008900">91</span>                 mov     large <span style="color:#ec0000">fs</span>:<span style="color:#008900">0</span>, eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004074</span><span style="color:#008900">97</span>                 mov     eax, [ebp<span style="color:#ec0000">+</span>var_4]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004074</span><span style="color:#008900">9</span>A                 cmp     [ebp<span style="color:#ec0000">+</span>var_49], <span style="color:#008900">0</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004074</span><span style="color:#008900">9</span>E                 jz      <span style="color:#5f5fff">short</span> loc_4074A5  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004074</span>A0                 call    <span style="color:#ec0000">@@</span>AfterConstruction ; __AfterConstruction  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004074</span>A5  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004074</span>A5 <span style="color:#ec0000">loc_4074A5</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: sub_40738C<span style="color:#ec0000">+</span><span style="color:#008900">112</span> j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004074</span>A5                 pop     edi 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004074</span>A6                 pop     esi 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004074</span>A7                 pop     ebx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004074</span>A8                 mov     esp, ebp 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004074</span>AA                 pop     ebp 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004074</span>AB                 retn 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004074</span>AB sub_40738C      endp 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004074</span>AB  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004071F</span>C sub_4071FC      proc near              ; CODE <span style="color:#ec0000">XREF</span>: showstatus<span style="color:#ec0000">+</span><span style="color:#008900">374</span> p  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004071F</span>C                                        ; sub_40738C<span style="color:#ec0000">+</span><span style="color:#008900">77</span> p  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004071F</span>C  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004071F</span>C var_54          <span style="color:#ec0000">=</span> byte ptr <span style="color:#ec0000">-</span><span style="color:#008900">54</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004071F</span>C var_4C          <span style="color:#ec0000">=</span> dword ptr <span style="color:#ec0000">-</span><span style="color:#008900">4</span>Ch  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004071F</span>C SizePointer     <span style="color:#ec0000">=</span> dword ptr <span style="color:#ec0000">-</span><span style="color:#008900">48</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004071F</span>C var_44          <span style="color:#ec0000">=</span> byte ptr <span style="color:#ec0000">-</span><span style="color:#008900">44</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004071F</span>C var_3C          <span style="color:#ec0000">=</span> byte ptr <span style="color:#ec0000">-</span><span style="color:#008900">3</span>Ch  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004071F</span>C var_34          <span style="color:#ec0000">=</span> dword ptr <span style="color:#ec0000">-</span><span style="color:#008900">34</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004071F</span>C var_30          <span style="color:#ec0000">=</span> dword ptr <span style="color:#ec0000">-</span><span style="color:#008900">30</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004071F</span>C var_20          <span style="color:#ec0000">=</span> word ptr <span style="color:#ec0000">-</span><span style="color:#008900">20</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004071F</span>C var_14          <span style="color:#ec0000">=</span> dword ptr <span style="color:#ec0000">-</span><span style="color:#008900">14</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004071F</span>C var_C           <span style="color:#ec0000">=</span> dword ptr <span style="color:#ec0000">-</span><span style="color:#008900">0</span>Ch  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004071F</span>C var_8           <span style="color:#ec0000">=</span> byte ptr <span style="color:#ec0000">-</span><span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004071F</span>C var_4           <span style="color:#ec0000">=</span> dword ptr <span style="color:#ec0000">-</span><span style="color:#008900">4</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004071F</span>C arg_0           <span style="color:#ec0000">=</span> dword ptr  <span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004071F</span>C  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004071F</span>C                 push    ebp 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004071F</span>D                 mov     ebp, esp 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004071FF</span>                 add     esp, <span style="color:#008900">0FF</span>FFFFACh  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407202</span>                 mov     eax, offset unk_4A39F0  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407207</span>                 push    ebx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040720</span><span style="color:#008900">8</span>                 push    esi 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040720</span><span style="color:#008900">9</span>                 push    edi 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040720</span>A                 mov     ebx, [ebp<span style="color:#ec0000">+</span>arg_0]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040720</span>D                 call    <span style="color:#ec0000">@</span>__InitExceptBlockLDTC  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407212</span>                 mov     edi, [ebx<span style="color:#ec0000">+</span><span style="color:#008900">4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407215</span>                 mov     esi, [ebx]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407217</span>                 mov     eax, [ebx<span style="color:#ec0000">+</span><span style="color:#008900">4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040721</span>A                 lea     edx, [ebp<span style="color:#ec0000">+</span>var_3C]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040721</span>D                 mov     [ebp<span style="color:#ec0000">+</span>var_34], eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407220</span>                 push    <span style="color:#008900">0</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407222</span>                 push    edx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407223</span>                 push    esi 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407224</span>                 mov     ecx, [ebp<span style="color:#ec0000">+</span>var_34]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407227</span>                 push    ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040722</span><span style="color:#008900">8</span>                 push    edi 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040722</span><span style="color:#008900">9</span>                 call    sub_403BF8  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040722</span>E                 add     esp, <span style="color:#008900">14</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407231</span>                 mov     edi, eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407233</span>                 mov     eax, [ebx<span style="color:#ec0000">+</span><span style="color:#008900">4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407236</span>                 mov     edx, edi 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040723</span><span style="color:#008900">8</span>                 lea     ecx, [ebp<span style="color:#ec0000">+</span>var_44]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040723</span>B                 push    ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040723</span>C                 push    eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040723</span>D                 push    edx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040723</span>E                 call    sub_403254  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407243</span>                 add     esp, <span style="color:#008900">0</span>Ch  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407246</span>                 mov     [ebx<span style="color:#ec0000">+</span><span style="color:#008900">4</span>], edi 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040724</span><span style="color:#008900">9</span>                 mov     [ebp<span style="color:#ec0000">+</span>var_20], <span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040724F</span>                 push    <span style="color:#008900">280</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407254</span>                 call    <span style="color:#ec0000">@$</span>bnwa<span style="color:#ec0000">$</span>qui     ; <span style="color:#ec0000">operator</span> <span style="color:#ec0000">new</span>[](uint)  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040725</span><span style="color:#008900">9</span>                 pop     ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040725</span>A                 mov     edi, eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040725</span>C                 mov     [ebp<span style="color:#ec0000">+</span>SizePointer], <span style="color:#008900">280</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407263</span>                 mov     [ebp<span style="color:#ec0000">+</span>var_20], <span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040726</span><span style="color:#008900">9</span>                 lea     eax, [ebp<span style="color:#ec0000">+</span>SizePointer]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040726</span>C                 push    eax            ; SizePointer  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040726</span>D                 push    edi            ; AdapterInfo  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040726</span>E                 call    GetAdaptersInfo  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407273</span>                 cmp     eax, <span style="color:#008900">6F</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407276</span>                 jnz     <span style="color:#5f5fff">short</span> loc_40728B  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040727</span><span style="color:#008900">8</span>                 push    edi            ; handle  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040727</span><span style="color:#008900">9</span>                 call    __close  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040727</span>E                 pop     ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040727F</span>                 mov     edx, [ebp<span style="color:#ec0000">+</span>SizePointer]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004072</span><span style="color:#008900">82</span>                 push    edx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004072</span><span style="color:#008900">83</span>                 call    <span style="color:#ec0000">@$</span>bnwa<span style="color:#ec0000">$</span>qui     ; <span style="color:#ec0000">operator</span> <span style="color:#ec0000">new</span>[](uint)  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004072</span><span style="color:#008900">88</span>                 pop     ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004072</span><span style="color:#008900">89</span>                 mov     edi, eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004072</span><span style="color:#008900">8</span>B  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004072</span><span style="color:#008900">8</span>B <span style="color:#ec0000">loc_40728B</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: sub_4071FC<span style="color:#ec0000">+</span><span style="color:#008900">7</span>A j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004072</span><span style="color:#008900">8</span>B                 lea     eax, [ebp<span style="color:#ec0000">+</span>SizePointer]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004072</span><span style="color:#008900">8</span>E                 push    eax            ; SizePointer  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040728F</span>                 push    edi            ; AdapterInfo  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004072</span><span style="color:#008900">90</span>                 call    GetAdaptersInfo  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004072</span><span style="color:#008900">95</span>                 test    eax, eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004072</span><span style="color:#008900">97</span>                 jnz     loc_40735D  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004072</span><span style="color:#008900">9</span>D                 mov     esi, edi 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040729F</span>                 test    esi, esi 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004072</span>A1                 jz      loc_40735D  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004072</span>A7  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004072</span>A7 <span style="color:#ec0000">loc_4072A7</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: sub_4071FC<span style="color:#ec0000">+</span><span style="color:#008900">15</span>B j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004072</span>A7                 mov     [ebp<span style="color:#ec0000">+</span>var_20], <span style="color:#008900">20</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004072</span>AD                 lea     edx, [esi<span style="color:#ec0000">+</span><span style="color:#008900">8</span>]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004072</span>B0                 lea     eax, [ebp<span style="color:#ec0000">+</span>var_8]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004072</span>B3                 call    <span style="color:#ec0000">@</span>System<span style="color:#ec0000">@</span>AnsiString<span style="color:#ec0000">@$</span>bctr<span style="color:#ec0000">$</span>qqrpxc ; System<span style="color:#ec0000">::</span>AnsiString<span style="color:#ec0000">::</span>AnsiString(<span style="color:#5f5fff">char</span> <span style="color:#ec0000">*</span>)  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004072</span>B8                 inc     [ebp<span style="color:#ec0000">+</span>var_14]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004072</span>BB                 lea     ecx, [ebp<span style="color:#ec0000">+</span>var_8]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004072</span>BE                 push    ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004072</span>BF                 xor     eax, eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004072</span>C1                 mov     [ebp<span style="color:#ec0000">+</span>var_4], eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004072</span>C4                 lea     edx, [ebp<span style="color:#ec0000">+</span>var_4]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004072</span>C7                 push    edx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004072</span>C8                 inc     [ebp<span style="color:#ec0000">+</span>var_14]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004072</span>CB                 call    sub_406FD8  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004072</span>D0                 add     esp, <span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004072</span>D3                 dec     [ebp<span style="color:#ec0000">+</span>var_14]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004072</span>D6                 lea     eax, [ebp<span style="color:#ec0000">+</span>var_8]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004072</span>D9                 mov     edx, <span style="color:#008900">2</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004072</span>DE                 call    <span style="color:#ec0000">@</span>System<span style="color:#ec0000">@</span>AnsiString<span style="color:#ec0000">@$</span>bdtr<span style="color:#ec0000">$</span>qqrv ; System<span style="color:#ec0000">::</span>AnsiString<span style="color:#ec0000">::~</span>AnsiString(<span style="color:#5f5fff">void</span>)  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004072E3</span>                 mov     [ebp<span style="color:#ec0000">+</span>var_20], <span style="color:#008900">14</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004072E9</span>                 cmp     [ebp<span style="color:#ec0000">+</span>var_4], <span style="color:#008900">0</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004072</span>ED                 jz      <span style="color:#5f5fff">short</span> loc_40733D  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004072</span>EF                 mov     ecx, [ebx<span style="color:#ec0000">+</span><span style="color:#008900">4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004072F</span><span style="color:#008900">2</span>                 cmp     ecx, [ebx<span style="color:#ec0000">+</span><span style="color:#008900">10</span>h]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004072F</span><span style="color:#008900">5</span>                 jz      <span style="color:#5f5fff">short</span> loc_407324  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004072F</span><span style="color:#008900">7</span>                 mov     eax, [ebx<span style="color:#ec0000">+</span><span style="color:#008900">4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004072F</span>A                 mov     [ebp<span style="color:#ec0000">+</span>var_4C], eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004072F</span>D                 mov     edx, [ebp<span style="color:#ec0000">+</span>var_4C]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407300</span>                 mov     [ebp<span style="color:#ec0000">+</span>var_C], edx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407303</span>                 test    edx, edx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407305</span>                 jz      <span style="color:#5f5fff">short</span> loc_40731E  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407307</span>                 mov     [ebp<span style="color:#ec0000">+</span>var_20], <span style="color:#008900">38</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040730</span>D                 lea     edx, [ebp<span style="color:#ec0000">+</span>var_4]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407310</span>                 mov     eax, [ebp<span style="color:#ec0000">+</span>var_C]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407313</span>                 call    <span style="color:#ec0000">@</span>System<span style="color:#ec0000">@</span>AnsiString<span style="color:#ec0000">@$</span>bctr<span style="color:#ec0000">$</span>qqrrx17System<span style="color:#ec0000">@</span>AnsiString ; System<span style="color:#ec0000">::</span>AnsiString<span style="color:#ec0000">::</span>AnsiString(System<span style="color:#ec0000">::</span>AnsiString <span style="color:#ec0000">&amp;</span>)  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040731</span><span style="color:#008900">8</span>                 mov     [ebp<span style="color:#ec0000">+</span>var_20], <span style="color:#008900">2</span>Ch  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040731</span>E  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040731</span>E <span style="color:#ec0000">loc_40731E</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: sub_4071FC<span style="color:#ec0000">+</span><span style="color:#008900">109</span> j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040731</span>E                 add     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">4</span>], <span style="color:#008900">4</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407322</span>                 jmp     <span style="color:#5f5fff">short</span> loc_40733D  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407324</span> ; <span style="color:#ec0000">---------------------------------------------------------------------------</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407324</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407324</span> <span style="color:#ec0000">loc_407324</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: sub_4071FC<span style="color:#ec0000">+</span>F9 j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407324</span>                 push    <span style="color:#008900">1</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407326</span>                 push    <span style="color:#008900">1</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040732</span><span style="color:#008900">8</span>                 lea     ecx, [ebp<span style="color:#ec0000">+</span>var_54]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040732</span>B                 push    ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040732</span>C                 lea     eax, [ebp<span style="color:#ec0000">+</span>var_4]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040732F</span>                 push    eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407330</span>                 mov     edx, [ebx<span style="color:#ec0000">+</span><span style="color:#008900">4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407333</span>                 push    edx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407334</span>                 push    ebx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407335</span>                 call    sub_403C34  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040733</span>A                 add     esp, <span style="color:#008900">18</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040733</span>D  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040733</span>D <span style="color:#ec0000">loc_40733D</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: sub_4071FC<span style="color:#ec0000">+</span>F1 j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040733</span>D                                        ; sub_4071FC<span style="color:#ec0000">+</span><span style="color:#008900">126</span> j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040733</span>D                 mov     esi, [esi]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040733F</span>                 dec     [ebp<span style="color:#ec0000">+</span>var_14]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407342</span>                 lea     eax, [ebp<span style="color:#ec0000">+</span>var_4]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407345</span>                 mov     edx, <span style="color:#008900">2</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040734</span>A                 call    <span style="color:#ec0000">@</span>System<span style="color:#ec0000">@</span>AnsiString<span style="color:#ec0000">@$</span>bdtr<span style="color:#ec0000">$</span>qqrv ; System<span style="color:#ec0000">::</span>AnsiString<span style="color:#ec0000">::~</span>AnsiString(<span style="color:#5f5fff">void</span>)  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040734F</span>                 mov     [ebp<span style="color:#ec0000">+</span>var_20], <span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407355</span>                 test    esi, esi 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407357</span>                 jnz     loc_4072A7  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040735</span>D  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040735</span>D <span style="color:#ec0000">loc_40735D</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: sub_4071FC<span style="color:#ec0000">+</span><span style="color:#008900">9</span>B j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040735</span>D                                        ; sub_4071FC<span style="color:#ec0000">+</span>A5 j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040735</span>D                 mov     [ebp<span style="color:#ec0000">+</span>var_20], <span style="color:#008900">0</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407363</span>                 jmp     <span style="color:#5f5fff">short</span> loc_407372  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407365</span> ; <span style="color:#ec0000">---------------------------------------------------------------------------</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407365</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407365</span> <span style="color:#ec0000">loc_407365</span>:                            ; DATA <span style="color:#ec0000">XREF</span>: .<span style="color:#ec0000">data</span>:fastdns___CPPdebugHook<span style="color:#ec0000">+</span><span style="color:#008900">1904</span> o  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407365</span>                 xor     edi, edi 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407367</span>                 mov     [ebp<span style="color:#ec0000">+</span>var_20], <span style="color:#008900">10</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040736</span>D                 call    <span style="color:#ec0000">@</span>_CatchCleanup<span style="color:#ec0000">$</span>qv ; _CatchCleanup(<span style="color:#5f5fff">void</span>)  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407372</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407372</span> <span style="color:#ec0000">loc_407372</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: sub_4071FC<span style="color:#ec0000">+</span><span style="color:#008900">167</span> j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407372</span>                 push    edi            ; handle  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00407373</span>                 call    __close  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040737</span><span style="color:#008900">8</span>                 pop     ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040737</span><span style="color:#008900">9</span>                 mov     eax, [ebp<span style="color:#ec0000">+</span>var_30]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040737</span>C                 mov     large <span style="color:#ec0000">fs</span>:<span style="color:#008900">0</span>, eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004073</span><span style="color:#008900">82</span>                 pop     edi 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004073</span><span style="color:#008900">83</span>                 pop     esi 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004073</span><span style="color:#008900">84</span>                 pop     ebx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004073</span><span style="color:#008900">85</span>                 mov     esp, ebp 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004073</span><span style="color:#008900">87</span>                 pop     ebp 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004073</span><span style="color:#008900">88</span>                 retn 
</span></span></code></pre></div><p>  这里可以看到是用GetAdapterInfo得到的，得到的每个AdapterName再送到sub_406FDB中检查：</p>
<div class="highlight"><pre tabindex="0" style="color:#757575;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#5f5fff">int</span> <span style="color:#ec0000">__cdecl</span> <span style="color:#5f5fff">sub_406FD8</span>(<span style="color:#5f5fff">int</span> a1, <span style="color:#5f5fff">int</span> a2)  
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span>  __InitExceptBlockLDTC();  
</span></span><span style="display:flex;"><span>  v15 <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>;  
</span></span><span style="display:flex;"><span>  v7 <span style="color:#ec0000">=</span> TRegistry<span style="color:#ec0000">::</span><span style="color:#ec0000">`</span>...<span style="color:#ec0000">&#39;</span>(dword_427AA0, <span style="color:#008900">1</span>, <span style="color:#008900">131097</span>);  
</span></span><span style="display:flex;"><span>  TRegistry<span style="color:#ec0000">::</span>SetRootKey(v7, <span style="color:#ec0000">-</span><span style="color:#008900">2147483646</span>);  
</span></span><span style="display:flex;"><span>  v2 <span style="color:#ec0000">=</span> System<span style="color:#ec0000">::</span>AnsiString<span style="color:#ec0000">::</span>AnsiString(  
</span></span><span style="display:flex;"><span>         <span style="color:#ec0000">&amp;</span>v14,  
</span></span><span style="display:flex;"><span>         <span style="color:#008900">&#34;SYSTEM</span><span style="color:#008900">\\</span><span style="color:#008900">CurrentControlSet</span><span style="color:#008900">\\</span><span style="color:#008900">Control</span><span style="color:#008900">\\</span><span style="color:#008900">Network</span><span style="color:#008900">\\</span><span style="color:#008900">{4D36E972-E325-11CE-BFC1-08002BE10318}</span><span style="color:#008900">\\</span><span style="color:#008900">&#34;</span>);  
</span></span><span style="display:flex;"><span>  v13 <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>;  
</span></span><span style="display:flex;"><span>  System<span style="color:#ec0000">::</span>AnsiString<span style="color:#ec0000">::</span><span style="color:#ec0000">operator</span><span style="color:#ec0000">+</span>(v2, a2, <span style="color:#ec0000">&amp;</span>v13);  
</span></span><span style="display:flex;"><span>  System<span style="color:#ec0000">::</span>AnsiString<span style="color:#ec0000">::</span>AnsiString(<span style="color:#ec0000">&amp;</span>v12, <span style="color:#008900">&#34;</span><span style="color:#008900">\\</span><span style="color:#008900">Connection</span><span style="color:#008900">\\</span><span style="color:#008900">&#34;</span>);  
</span></span><span style="display:flex;"><span>  v11 <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>;  
</span></span><span style="display:flex;"><span>  System<span style="color:#ec0000">::</span>AnsiString<span style="color:#ec0000">::</span><span style="color:#ec0000">operator</span><span style="color:#ec0000">+</span>(<span style="color:#ec0000">&amp;</span>v13, <span style="color:#ec0000">&amp;</span>v12, <span style="color:#ec0000">&amp;</span>v11);  
</span></span><span style="display:flex;"><span>  v3 <span style="color:#ec0000">=</span> TRegistry<span style="color:#ec0000">::</span>OpenKey(v7, v11, <span style="color:#008900">0</span>);  
</span></span><span style="display:flex;"><span>  System<span style="color:#ec0000">::</span>AnsiString<span style="color:#ec0000">::~</span>AnsiString(<span style="color:#ec0000">&amp;</span>v11, <span style="color:#008900">2</span>);  
</span></span><span style="display:flex;"><span>  System<span style="color:#ec0000">::</span>AnsiString<span style="color:#ec0000">::~</span>AnsiString(<span style="color:#ec0000">&amp;</span>v12, <span style="color:#008900">2</span>);  
</span></span><span style="display:flex;"><span>  System<span style="color:#ec0000">::</span>AnsiString<span style="color:#ec0000">::~</span>AnsiString(<span style="color:#ec0000">&amp;</span>v13, <span style="color:#008900">2</span>);  
</span></span><span style="display:flex;"><span>  System<span style="color:#ec0000">::</span>AnsiString<span style="color:#ec0000">::~</span>AnsiString(<span style="color:#ec0000">&amp;</span>v14, <span style="color:#008900">2</span>);  
</span></span><span style="display:flex;"><span>  <span style="color:#ec0000">if</span> ( v3 )  
</span></span><span style="display:flex;"><span>  {  
</span></span><span style="display:flex;"><span>    v4 <span style="color:#ec0000">=</span> <span style="color:#ec0000">*</span>(_DWORD <span style="color:#ec0000">*</span>)System<span style="color:#ec0000">::</span>AnsiString<span style="color:#ec0000">::</span>AnsiString(<span style="color:#ec0000">&amp;</span>v10, <span style="color:#008900">&#34;Name&#34;</span>);  
</span></span><span style="display:flex;"><span>    v9 <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>;  
</span></span><span style="display:flex;"><span>    TRegistry<span style="color:#ec0000">::</span>ReadString(v7, v4);  
</span></span><span style="display:flex;"><span>    sub_4A0484(<span style="color:#ec0000">&amp;</span>v15, <span style="color:#ec0000">&amp;</span>v9);  
</span></span><span style="display:flex;"><span>    System<span style="color:#ec0000">::</span>AnsiString<span style="color:#ec0000">::~</span>AnsiString(<span style="color:#ec0000">&amp;</span>v9, <span style="color:#008900">2</span>);  
</span></span><span style="display:flex;"><span>    System<span style="color:#ec0000">::</span>AnsiString<span style="color:#ec0000">::~</span>AnsiString(<span style="color:#ec0000">&amp;</span>v10, <span style="color:#008900">2</span>);  
</span></span><span style="display:flex;"><span>  }  
</span></span><span style="display:flex;"><span>  <span style="color:#ec0000">else</span> 
</span></span><span style="display:flex;"><span>  {  
</span></span><span style="display:flex;"><span>    System<span style="color:#ec0000">::</span>AnsiString<span style="color:#ec0000">::</span>AnsiString(<span style="color:#ec0000">&amp;</span>v8, <span style="color:#ec0000">&amp;</span>unk_4A37E9);  
</span></span><span style="display:flex;"><span>    sub_4A0484(<span style="color:#ec0000">&amp;</span>v15, <span style="color:#ec0000">&amp;</span>v8);  
</span></span><span style="display:flex;"><span>    System<span style="color:#ec0000">::</span>AnsiString<span style="color:#ec0000">::~</span>AnsiString(<span style="color:#ec0000">&amp;</span>v8, <span style="color:#008900">2</span>);  
</span></span><span style="display:flex;"><span>  }  
</span></span><span style="display:flex;"><span>  <span style="color:#ec0000">if</span> ( v7 )  
</span></span><span style="display:flex;"><span>  {  
</span></span><span style="display:flex;"><span>    v5 <span style="color:#ec0000">=</span> <span style="color:#ec0000">*</span>(_DWORD <span style="color:#ec0000">*</span>)v7;  
</span></span><span style="display:flex;"><span>    (<span style="color:#ec0000">*</span>(<span style="color:#5f5fff">void</span> (<span style="color:#ec0000">__fastcall</span> <span style="color:#ec0000">**</span>)(<span style="color:#5f5fff">int</span>, <span style="color:#5f5fff">signed</span> <span style="color:#5f5fff">int</span>))(<span style="color:#ec0000">*</span>(_DWORD <span style="color:#ec0000">*</span>)v7 <span style="color:#ec0000">-</span> <span style="color:#008900">4</span>))(v7, <span style="color:#008900">3</span>);  
</span></span><span style="display:flex;"><span>  }  
</span></span><span style="display:flex;"><span>  sub_4A0484(a1, <span style="color:#ec0000">&amp;</span>v15);  
</span></span><span style="display:flex;"><span>  System<span style="color:#ec0000">::</span>AnsiString<span style="color:#ec0000">::~</span>AnsiString(<span style="color:#ec0000">&amp;</span>v15, <span style="color:#008900">2</span>);  
</span></span><span style="display:flex;"><span>  <span style="color:#ec0000">return</span> a1;  
</span></span><span style="display:flex;"><span>} 
</span></span></code></pre></div><p>  做一些字符串操作然后查注册表中存储的网卡信息，取得name并存储</p>
<h2 id="fastdns如何初始化那些dns串的存储在哪里">FASTDNS如何初始化那些DNS串的，存储在哪里？</h2>
<p>  熟悉windows消息机制的会清楚，ListView显示条目用的是SendMessage LVM_SETITEXT或类似机制，而绝不是自己设置，那么我们只需要在启动时加载程序并拦截该函数，看看数目和ip数目吻合程度就知道了。由于结果较多只贴出循环节：</p>
<pre tabindex="0"><code class="language-Txt" data-lang="Txt">hwnd=812a0 msg=4103 
hwnd=812a0 msg=4101 
hwnd=812a0 msg=4109 
hwnd=812a0 msg=4142 
</code></pre><p>  此时可以用spy++查下hwnd是不是ListView，然后看看消息代码，可知分别对应：<code>LVM_GETITEMA LVM_INSERTITEMA LVM_FINDITEMA LVM_SETITEMTEXTA</code>，第二个和第四个正是我们处理多column的ListView所用的操作，没想到Delphi程序也是这么做的（只不过可能经过层层封装）。下条件断点，进入后发现LVITEM.pszText为-1(LPSTR_TEXTCALLBACK，该消息是说显示到哪再加载那里的数据，较为灵活，对分析造成了困难)，也就是说并未再此时赋值，因此使用该方法寻找dns地址根源是失败的，那么我们再次想到字符串，用WinHex搜索地址串，并下数据断点，等移动ListView的滚动条时，程序自动断下，进入<code>.text:0048C33C ; TCustomListView::CNNotify</code></p>
<div class="highlight"><pre tabindex="0" style="color:#757575;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#ec0000">else</span> 
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span>  v4 <span style="color:#ec0000">=</span> v3 <span style="color:#ec0000">+</span> <span style="color:#008900">308</span>;  
</span></span><span style="display:flex;"><span>  <span style="color:#ec0000">if</span> ( v4 )  
</span></span><span style="display:flex;"><span>  {  
</span></span><span style="display:flex;"><span>    v5 <span style="color:#ec0000">=</span> v4 <span style="color:#ec0000">-</span> <span style="color:#008900">151</span>;  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">if</span> ( v5 )  
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>      v6 <span style="color:#ec0000">=</span> v5 <span style="color:#ec0000">-</span> <span style="color:#008900">5</span>;  
</span></span><span style="display:flex;"><span>      <span style="color:#ec0000">if</span> ( v6 )  
</span></span><span style="display:flex;"><span>      {  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">if</span> ( v6 <span style="color:#ec0000">==</span> <span style="color:#008900">2</span> )                        // LVN_GETDISPINFOA  
</span></span><span style="display:flex;"><span>        {  
</span></span><span style="display:flex;"><span>          v64 <span style="color:#ec0000">=</span> TCustomListView<span style="color:#ec0000">::</span>GetItem(v106, (<span style="color:#ec0000">const</span> <span style="color:#5f5fff">void</span> <span style="color:#ec0000">*</span>)(v2 <span style="color:#ec0000">+</span> <span style="color:#008900">12</span>));  
</span></span><span style="display:flex;"><span>          v65 <span style="color:#ec0000">=</span> <span style="color:#ec0000">*</span>(_DWORD <span style="color:#ec0000">*</span>)(v105 <span style="color:#ec0000">+</span> <span style="color:#008900">8</span>);  
</span></span><span style="display:flex;"><span>          v66 <span style="color:#ec0000">=</span> v65 <span style="color:#ec0000">+</span> <span style="color:#008900">12</span>;  
</span></span><span style="display:flex;"><span>          <span style="color:#ec0000">if</span> ( <span style="color:#ec0000">*</span>(_BYTE <span style="color:#ec0000">*</span>)(v65 <span style="color:#ec0000">+</span> <span style="color:#008900">12</span>) <span style="color:#ec0000">&amp;</span> <span style="color:#008900">1</span> )  
</span></span><span style="display:flex;"><span>          {  
</span></span><span style="display:flex;"><span>            v67 <span style="color:#ec0000">=</span> <span style="color:#ec0000">*</span>(_DWORD <span style="color:#ec0000">*</span>)(v65 <span style="color:#ec0000">+</span> <span style="color:#008900">20</span>);  
</span></span><span style="display:flex;"><span>            <span style="color:#ec0000">if</span> ( v67 )  
</span></span><span style="display:flex;"><span>            {  
</span></span><span style="display:flex;"><span>              v96 <span style="color:#ec0000">=</span> <span style="color:#ec0000">*</span>(_DWORD <span style="color:#ec0000">*</span>)(v64 <span style="color:#ec0000">+</span> <span style="color:#008900">8</span>);  
</span></span><span style="display:flex;"><span>              <span style="color:#ec0000">if</span> ( v67 <span style="color:#ec0000">&gt;</span> (<span style="color:#ec0000">*</span>(<span style="color:#5f5fff">int</span> (<span style="color:#ec0000">__cdecl</span> <span style="color:#ec0000">**</span>)(<span style="color:#5f5fff">unsigned</span> <span style="color:#5f5fff">int</span>, _UNKNOWN <span style="color:#ec0000">*</span>, <span style="color:#5f5fff">int</span> <span style="color:#ec0000">*</span>))(<span style="color:#ec0000">*</span>(_DWORD <span style="color:#ec0000">*</span>)v96 <span style="color:#ec0000">+</span> <span style="color:#008900">20</span>))(v87, v88, v89) )  
</span></span><span style="display:flex;"><span>              {  
</span></span><span style="display:flex;"><span>                <span style="color:#ec0000">**</span>(_BYTE <span style="color:#ec0000">**</span>)(v66 <span style="color:#ec0000">+</span> <span style="color:#008900">20</span>) <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>;  
</span></span><span style="display:flex;"><span>              }  
</span></span><span style="display:flex;"><span>              <span style="color:#ec0000">else</span> 
</span></span><span style="display:flex;"><span>              {  
</span></span><span style="display:flex;"><span>                (<span style="color:#ec0000">*</span>(<span style="color:#5f5fff">void</span> (<span style="color:#ec0000">__fastcall</span> <span style="color:#ec0000">**</span>)(<span style="color:#5f5fff">int</span>, <span style="color:#5f5fff">int</span>, <span style="color:#5f5fff">int</span> <span style="color:#ec0000">*</span>))(<span style="color:#ec0000">*</span>(_DWORD <span style="color:#ec0000">*</span>)v96 <span style="color:#ec0000">+</span> <span style="color:#008900">12</span>))(v96, <span style="color:#ec0000">*</span>(_DWORD <span style="color:#ec0000">*</span>)(v66 <span style="color:#ec0000">+</span> <span style="color:#008900">8</span>) <span style="color:#ec0000">-</span> <span style="color:#008900">1</span>, <span style="color:#ec0000">&amp;</span>v91);  
</span></span><span style="display:flex;"><span>                StrPLCopy(<span style="color:#ec0000">*</span>(<span style="color:#5f5fff">void</span> <span style="color:#ec0000">**</span>)(v66 <span style="color:#ec0000">+</span> <span style="color:#008900">20</span>), v91, <span style="color:#ec0000">*</span>(_DWORD <span style="color:#ec0000">*</span>)(v66 <span style="color:#ec0000">+</span> <span style="color:#008900">24</span>) <span style="color:#ec0000">-</span> <span style="color:#008900">1</span>);  
</span></span><span style="display:flex;"><span>              }  
</span></span><span style="display:flex;"><span>            }  
</span></span><span style="display:flex;"><span>            <span style="color:#ec0000">else</span> 
</span></span><span style="display:flex;"><span>            {  
</span></span><span style="display:flex;"><span>              StrPLCopy(<span style="color:#ec0000">*</span>(<span style="color:#5f5fff">void</span> <span style="color:#ec0000">**</span>)(v65 <span style="color:#ec0000">+</span> <span style="color:#008900">32</span>), <span style="color:#ec0000">*</span>(<span style="color:#5f5fff">char</span> <span style="color:#ec0000">**</span>)(v64 <span style="color:#ec0000">+</span> <span style="color:#008900">0x24</span>), <span style="color:#ec0000">*</span>(_DWORD <span style="color:#ec0000">*</span>)(v65 <span style="color:#ec0000">+</span> <span style="color:#008900">36</span>) <span style="color:#ec0000">-</span> <span style="color:#008900">1</span>);  
</span></span><span style="display:flex;"><span>            }  
</span></span><span style="display:flex;"><span>          } 
</span></span></code></pre></div><p>  可以看到这里正是我们需要的LVN_GETDISPINFOA，程序通过该回调设置真正的列表数据，程序经过最后面这个StrPLCopy，因此我们的重点是看谁改了v64，向上发现源头在<code>TCustomListView::GetItem</code>，跟进，发现最终源头为<code>SendMessageA(hWnd, LVM_GETITEM, 0, &amp;lvitem);</code>得到的<code>*(char*)(lvitem-&gt;lparam+0x24)</code>。最终结果。那么谁设置了lparam呢？继续追寻</p>
<pre tabindex="0"><code class="language-Txt" data-lang="Txt">-100 -101 -102 -150
LVN_ITEMCHANGING FFFFFF9C
LVN_ITEMCHANGED  FFFFFF9B
LVN_INSERTITEM   FFFFFF9A
LVN_GETDISPINFOA FFFFFF6A
</code></pre><p>  如果下消息断点，并不能发现LVM_SETITEM消息，可能是对delphi不了解吧，这时还要采用最古老的方法，既然显示给我们了，那么内存里已经有字符串，并且一定是解密的，winhex找到位置后，下硬件断点，到了这里：</p>
<pre tabindex="0"><code>FastDNS!DnslistFinalize+0x555:
0040ba8d 3a4d14          cmp     cl,byte ptr [ebp+14h]      ss:002b:0018fbf4=2c
</code></pre><p>  向上层回溯，看看拿到dns地址的根源在什么地方：</p>
<div class="highlight"><pre tabindex="0" style="color:#757575;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A258 sub_40A258      proc near              ; CODE <span style="color:#ec0000">XREF</span>: sub_402474<span style="color:#ec0000">+</span><span style="color:#008900">81</span> p  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A258  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A258                 push    ebp 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A259                 mov     ebp, esp 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A25B                 add     esp, <span style="color:#008900">0FF</span>FFFE80h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A261                 push    ebx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A262                 push    esi 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A263                 push    edi 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A264                 lea     ebx, [ebp<span style="color:#ec0000">+</span>var_114]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A26A                 mov     eax, offset unk_4B2A5C  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A26F                 call    <span style="color:#ec0000">@</span>__InitExceptBlockLDTC  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A274                 mov     edx, [ebp<span style="color:#ec0000">+</span>arg_0]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A277                 push    edx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A278                 call    sub_40C368  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A27D                 pop     ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A27E                 xor     eax, eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A280                 mov     word ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">10</span>h], <span style="color:#008900">14</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A286                 inc     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A289                 lea     ecx, [ebp<span style="color:#ec0000">-</span><span style="color:#008900">38</span>h]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A28C                 mov     [ebp<span style="color:#ec0000">+</span>var_118], ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A292                 mov     [ebp<span style="color:#ec0000">+</span>var_18], eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A295                 xor     edx, edx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A297                 xor     ecx, ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A299                 mov     [ebp<span style="color:#ec0000">+</span>var_18<span style="color:#ec0000">+</span><span style="color:#008900">4</span>], edx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A29C                 lea     eax, [ebp<span style="color:#ec0000">-</span><span style="color:#008900">40</span>h]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A29F                 inc     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A2A2                 mov     [ebp<span style="color:#ec0000">+</span>var_18<span style="color:#ec0000">+</span><span style="color:#008900">10</span>h], ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A2A5                 inc     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A2A8                 inc     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A2AB                 inc     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A2AE                 dec     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A2B1                 lea     edx, [ebp<span style="color:#ec0000">+</span>handle]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A2B4                 mov     word ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">10</span>h], <span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A2BA                 mov     word ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">10</span>h], <span style="color:#008900">2</span>Ch  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A2C0                 push    eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A2C1                 inc     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A2C4                 push    offset asc_4B2712 ; <span style="color:#008900">&#34;</span><span style="color:#008900">\r\n</span><span style="color:#008900">&#34;</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A2C9                 push    edx            ; _DWORD  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A2CA                 call    FormatString  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A2CF                 add     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch], <span style="color:#008900">4</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A2D3                 mov     ecx, [ebp<span style="color:#ec0000">+</span>var_18<span style="color:#ec0000">+</span><span style="color:#008900">4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A2D6                 add     esp, <span style="color:#008900">0</span>Ch  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A2D9                 cmp     ecx, [ebp<span style="color:#ec0000">+</span>var_18<span style="color:#ec0000">+</span><span style="color:#008900">10</span>h]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A2DC                 jz      <span style="color:#5f5fff">short</span> loc_40A316  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A2DE                 mov     eax, [ebp<span style="color:#ec0000">+</span>var_18<span style="color:#ec0000">+</span><span style="color:#008900">4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A2E1                 mov     [ebp<span style="color:#ec0000">+</span>var_11C], eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A2E7                 mov     edx, [ebp<span style="color:#ec0000">+</span>var_11C]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A2ED                 mov     [ebp<span style="color:#ec0000">-</span><span style="color:#008900">5</span>Ch], edx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A2F0                 test    edx, edx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A2F2                 jz      <span style="color:#5f5fff">short</span> loc_40A310  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A2F4                 mov     word ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">10</span>h], <span style="color:#008900">38</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A2FA                 lea     eax, [ebp<span style="color:#ec0000">+</span>handle]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A2FD                 push    eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A2FE                 mov     ecx, [ebp<span style="color:#ec0000">-</span><span style="color:#008900">5</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A301                 push    ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A302                 call    sub_40AD98  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A307                 mov     word ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">10</span>h], <span style="color:#008900">2</span>Ch  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A30D                 add     esp, <span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A310  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A310 <span style="color:#ec0000">loc_40A310</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: sub_40A258<span style="color:#ec0000">+</span><span style="color:#008900">9</span>A j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A310                 add     [ebp<span style="color:#ec0000">+</span>var_18<span style="color:#ec0000">+</span><span style="color:#008900">4</span>], <span style="color:#008900">18</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A314                 jmp     <span style="color:#5f5fff">short</span> loc_40A335  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A316 ; <span style="color:#ec0000">---------------------------------------------------------------------------</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A316  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A316 <span style="color:#ec0000">loc_40A316</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: sub_40A258<span style="color:#ec0000">+</span><span style="color:#008900">84</span> j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A316                 push    <span style="color:#008900">1</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A318                 push    <span style="color:#008900">1</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A31A                 lea     eax, [ebp<span style="color:#ec0000">+</span>var_124]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A320                 push    eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A321                 lea     edx, [ebp<span style="color:#ec0000">+</span>handle]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A324                 push    edx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A325                 mov     ecx, [ebp<span style="color:#ec0000">+</span>var_18<span style="color:#ec0000">+</span><span style="color:#008900">4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A328                 push    ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A329                 lea     eax, [ebp<span style="color:#ec0000">+</span>var_18]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A32C                 push    eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A32D                 call    sub_40A968  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A332                 add     esp, <span style="color:#008900">18</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A335  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A335 <span style="color:#ec0000">loc_40A335</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: sub_40A258<span style="color:#ec0000">+</span>BC j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A335                 dec     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A338                 mov     word ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">10</span>h], <span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A33E                 dec     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A341                 mov     edi, [ebp<span style="color:#ec0000">+</span>handle<span style="color:#ec0000">+</span><span style="color:#008900">10</span>h]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A344                 sub     edi, [ebp<span style="color:#ec0000">+</span>handle]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A347                 mov     esi, [ebp<span style="color:#ec0000">+</span>handle]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A34A                 test    esi, esi 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A34C                 jz      <span style="color:#5f5fff">short</span> loc_40A369  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A34E                 cmp     edi, <span style="color:#008900">80</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A354                 jbe     <span style="color:#5f5fff">short</span> loc_40A35F  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A356                 push    esi            ; handle  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A357                 call    __rtl_close  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A35C                 pop     ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A35D                 jmp     <span style="color:#5f5fff">short</span> loc_40A369  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A35F ; <span style="color:#ec0000">---------------------------------------------------------------------------</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A35F  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A35F <span style="color:#ec0000">loc_40A35F</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: sub_40A258<span style="color:#ec0000">+</span>FC j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A35F                 push    edi 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A360                 push    esi 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A361                 call    sub_4A0CA4  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A366                 add     esp, <span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A369  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A369 <span style="color:#ec0000">loc_40A369</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: sub_40A258<span style="color:#ec0000">+</span>F4 j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A369                                        ; sub_40A258<span style="color:#ec0000">+</span><span style="color:#008900">105</span> j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A369                 dec     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A36C                 dec     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A36F                 dec     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A372                 lea     eax, [ebp<span style="color:#ec0000">-</span><span style="color:#008900">64</span>h]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A375                 mov     word ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">10</span>h], <span style="color:#008900">5</span>Ch  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A37B                 push    eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A37C                 lea     edx, [ebp<span style="color:#ec0000">+</span>var_7C]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A37F                 inc     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A382                 push    offset asc_4B2715 ; <span style="color:#008900">&#34;</span><span style="color:#008900">\r</span><span style="color:#008900">&#34;</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A387                 push    edx            ; _DWORD  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A388                 call    FormatString  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A38D                 add     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch], <span style="color:#008900">4</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A391                 mov     ecx, [ebp<span style="color:#ec0000">+</span>var_18<span style="color:#ec0000">+</span><span style="color:#008900">4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A394                 add     esp, <span style="color:#008900">0</span>Ch  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A397                 cmp     ecx, [ebp<span style="color:#ec0000">+</span>var_18<span style="color:#ec0000">+</span><span style="color:#008900">10</span>h]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A39A                 jz      <span style="color:#5f5fff">short</span> loc_40A3D4  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A39C                 mov     eax, [ebp<span style="color:#ec0000">+</span>var_18<span style="color:#ec0000">+</span><span style="color:#008900">4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A39F                 mov     [ebp<span style="color:#ec0000">+</span>var_128], eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A3A5                 mov     edx, [ebp<span style="color:#ec0000">+</span>var_128]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A3AB                 mov     [ebp<span style="color:#ec0000">-</span><span style="color:#008900">80</span>h], edx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A3AE                 test    edx, edx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A3B0                 jz      <span style="color:#5f5fff">short</span> loc_40A3CE  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A3B2                 mov     word ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">10</span>h], <span style="color:#008900">68</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A3B8                 lea     eax, [ebp<span style="color:#ec0000">+</span>var_7C]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A3BB                 push    eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A3BC                 mov     ecx, [ebp<span style="color:#ec0000">-</span><span style="color:#008900">80</span>h]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A3BF                 push    ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A3C0                 call    sub_40AD98  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A3C5                 mov     word ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">10</span>h], <span style="color:#008900">5</span>Ch  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A3CB                 add     esp, <span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A3CE  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A3CE <span style="color:#ec0000">loc_40A3CE</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: sub_40A258<span style="color:#ec0000">+</span><span style="color:#008900">158</span> j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A3CE                 add     [ebp<span style="color:#ec0000">+</span>var_18<span style="color:#ec0000">+</span><span style="color:#008900">4</span>], <span style="color:#008900">18</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A3D2                 jmp     <span style="color:#5f5fff">short</span> loc_40A3F3  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A3D4 ; <span style="color:#ec0000">---------------------------------------------------------------------------</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A3D4  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A3D4 <span style="color:#ec0000">loc_40A3D4</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: sub_40A258<span style="color:#ec0000">+</span><span style="color:#008900">142</span> j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A3D4                 push    <span style="color:#008900">1</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A3D6                 push    <span style="color:#008900">1</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A3D8                 lea     eax, [ebp<span style="color:#ec0000">+</span>var_130]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A3DE                 push    eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A3DF                 lea     edx, [ebp<span style="color:#ec0000">+</span>var_7C]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A3E2                 push    edx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A3E3                 mov     ecx, [ebp<span style="color:#ec0000">+</span>var_18<span style="color:#ec0000">+</span><span style="color:#008900">4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A3E6                 push    ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A3E7                 lea     eax, [ebp<span style="color:#ec0000">+</span>var_18]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A3EA                 push    eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A3EB                 call    sub_40A968  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A3F0                 add     esp, <span style="color:#008900">18</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A3F3  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A3F3 <span style="color:#ec0000">loc_40A3F3</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: sub_40A258<span style="color:#ec0000">+</span><span style="color:#008900">17</span>A j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A3F3                 dec     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A3F6                 mov     word ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">10</span>h], <span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A3FC                 dec     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A3FF                 mov     edi, [ebp<span style="color:#ec0000">+</span>var_7C<span style="color:#ec0000">+</span><span style="color:#008900">10</span>h]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A402                 sub     edi, [ebp<span style="color:#ec0000">+</span>var_7C]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A405                 mov     esi, [ebp<span style="color:#ec0000">+</span>var_7C]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A408                 test    esi, esi 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A40A                 jz      <span style="color:#5f5fff">short</span> loc_40A427  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A40C                 cmp     edi, <span style="color:#008900">80</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A412                 jbe     <span style="color:#5f5fff">short</span> loc_40A41D  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A414                 push    esi            ; handle  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A415                 call    __rtl_close  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A41A                 pop     ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A41B                 jmp     <span style="color:#5f5fff">short</span> loc_40A427  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A41D ; <span style="color:#ec0000">---------------------------------------------------------------------------</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A41D  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A41D <span style="color:#ec0000">loc_40A41D</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: sub_40A258<span style="color:#ec0000">+</span><span style="color:#008900">1</span>BA j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A41D                 push    edi 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A41E                 push    esi 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A41F                 call    sub_4A0CA4  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A424                 add     esp, <span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A427  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A427 <span style="color:#ec0000">loc_40A427</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: sub_40A258<span style="color:#ec0000">+</span><span style="color:#008900">1</span>B2 j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A427                                        ; sub_40A258<span style="color:#ec0000">+</span><span style="color:#008900">1</span>C3 j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A427                 dec     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A42A                 dec     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A42D                 dec     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A430                 lea     eax, [ebp<span style="color:#ec0000">-</span><span style="color:#008900">88</span>h]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A436                 mov     word ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">10</span>h], <span style="color:#008900">8</span>Ch  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A43C                 push    eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A43D                 lea     edx, [ebp<span style="color:#ec0000">+</span>var_A0]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A443                 inc     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A446                 push    offset asc_4B2717 ; <span style="color:#008900">&#34;</span><span style="color:#008900">\n</span><span style="color:#008900">&#34;</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A44B                 push    edx            ; _DWORD  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A44C                 call    FormatString  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A451                 add     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch], <span style="color:#008900">4</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A455                 mov     ecx, [ebp<span style="color:#ec0000">+</span>var_18<span style="color:#ec0000">+</span><span style="color:#008900">4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A458                 add     esp, <span style="color:#008900">0</span>Ch  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A45B                 cmp     ecx, [ebp<span style="color:#ec0000">+</span>var_18<span style="color:#ec0000">+</span><span style="color:#008900">10</span>h]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A45E                 jz      <span style="color:#5f5fff">short</span> loc_40A4A1  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A460                 mov     eax, [ebp<span style="color:#ec0000">+</span>var_18<span style="color:#ec0000">+</span><span style="color:#008900">4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A463                 mov     [ebp<span style="color:#ec0000">+</span>var_134], eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A469                 mov     edx, [ebp<span style="color:#ec0000">+</span>var_134]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A46F                 mov     [ebp<span style="color:#ec0000">+</span>var_A4], edx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A475                 test    edx, edx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A477                 jz      <span style="color:#5f5fff">short</span> loc_40A49B  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A479                 mov     word ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">10</span>h], <span style="color:#008900">98</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A47F                 lea     eax, [ebp<span style="color:#ec0000">+</span>var_A0]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A485                 push    eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A486                 mov     ecx, [ebp<span style="color:#ec0000">+</span>var_A4]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A48C                 push    ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A48D                 call    sub_40AD98  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A492                 mov     word ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">10</span>h], <span style="color:#008900">8</span>Ch  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A498                 add     esp, <span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A49B  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A49B <span style="color:#ec0000">loc_40A49B</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: sub_40A258<span style="color:#ec0000">+</span><span style="color:#008900">21F</span> j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A49B                 add     [ebp<span style="color:#ec0000">+</span>var_18<span style="color:#ec0000">+</span><span style="color:#008900">4</span>], <span style="color:#008900">18</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A49F                 jmp     <span style="color:#5f5fff">short</span> loc_40A4C3  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A4A1 ; <span style="color:#ec0000">---------------------------------------------------------------------------</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A4A1  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A4A1 <span style="color:#ec0000">loc_40A4A1</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: sub_40A258<span style="color:#ec0000">+</span><span style="color:#008900">206</span> j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A4A1                 push    <span style="color:#008900">1</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A4A3                 push    <span style="color:#008900">1</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A4A5                 lea     eax, [ebp<span style="color:#ec0000">+</span>var_13C]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A4AB                 push    eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A4AC                 lea     edx, [ebp<span style="color:#ec0000">+</span>var_A0]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A4B2                 push    edx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A4B3                 mov     ecx, [ebp<span style="color:#ec0000">+</span>var_18<span style="color:#ec0000">+</span><span style="color:#008900">4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A4B6                 push    ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A4B7                 lea     eax, [ebp<span style="color:#ec0000">+</span>var_18]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A4BA                 push    eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A4BB                 call    sub_40A968  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A4C0                 add     esp, <span style="color:#008900">18</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A4C3  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A4C3 <span style="color:#ec0000">loc_40A4C3</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: sub_40A258<span style="color:#ec0000">+</span><span style="color:#008900">247</span> j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A4C3                 dec     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A4C6                 mov     word ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">10</span>h], <span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A4CC                 dec     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A4CF                 mov     edi, [ebp<span style="color:#ec0000">+</span>var_A0<span style="color:#ec0000">+</span><span style="color:#008900">10</span>h]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A4D5                 sub     edi, [ebp<span style="color:#ec0000">+</span>var_A0]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A4DB                 mov     esi, [ebp<span style="color:#ec0000">+</span>var_A0]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A4E1                 test    esi, esi 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A4E3                 jz      <span style="color:#5f5fff">short</span> loc_40A500  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A4E5                 cmp     edi, <span style="color:#008900">80</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A4EB                 jbe     <span style="color:#5f5fff">short</span> loc_40A4F6  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A4ED                 push    esi            ; handle  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A4EE                 call    __rtl_close  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A4F3                 pop     ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A4F4                 jmp     <span style="color:#5f5fff">short</span> loc_40A500  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A4F6 ; <span style="color:#ec0000">---------------------------------------------------------------------------</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A4F6  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A4F6 <span style="color:#ec0000">loc_40A4F6</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: sub_40A258<span style="color:#ec0000">+</span><span style="color:#008900">293</span> j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A4F6                 push    edi 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A4F7                 push    esi 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A4F8                 call    sub_4A0CA4  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A4FD                 add     esp, <span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A500  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A500 <span style="color:#ec0000">loc_40A500</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: sub_40A258<span style="color:#ec0000">+</span><span style="color:#008900">28</span>B j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A500                                        ; sub_40A258<span style="color:#ec0000">+</span><span style="color:#008900">29</span>C j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A500                 dec     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A503                 dec     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A506                 dec     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A509                 lea     eax, [ebp<span style="color:#ec0000">+</span>var_AC]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A50F                 mov     word ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">10</span>h], <span style="color:#008900">0</span>BCh  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A515                 inc     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A518                 mov     [ebp<span style="color:#ec0000">+</span>var_140], eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A51E                 xor     edx, edx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A520                 xor     ecx, ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A522                 mov     [ebp<span style="color:#ec0000">+</span>var_30], edx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A525                 mov     [ebp<span style="color:#ec0000">+</span>var_30<span style="color:#ec0000">+</span><span style="color:#008900">4</span>], ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A528                 inc     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A52B                 xor     eax, eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A52D                 mov     [ebp<span style="color:#ec0000">+</span>var_30<span style="color:#ec0000">+</span><span style="color:#008900">10</span>h], eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A530                 lea     edx, [ebp<span style="color:#ec0000">+</span>var_30]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A533                 inc     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A536                 inc     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A539                 inc     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A53C                 dec     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A53F                 lea     ecx, [ebp<span style="color:#ec0000">+</span>var_18]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A542                 mov     word ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">10</span>h], <span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A548                 push    edx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A549                 push    ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A54A                 mov     eax, [ebp<span style="color:#ec0000">+</span>arg_4]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A54D                 push    eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A54E                 call    sub_40B7F4  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A553                 add     esp, <span style="color:#008900">0</span>Ch  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A556                 mov     edi, [ebp<span style="color:#ec0000">+</span>var_30]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A559                 jmp     loc_40A850  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A55E ; <span style="color:#ec0000">---------------------------------------------------------------------------</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A55E  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A55E <span style="color:#ec0000">loc_40A55E</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: sub_40A258<span style="color:#ec0000">+</span><span style="color:#008900">5F</span>B j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A55E                 push    <span style="color:#008900">28</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A560                 call    <span style="color:#ec0000">@$</span>bnew<span style="color:#ec0000">$</span>qui     ; <span style="color:#ec0000">operator</span> <span style="color:#5f5fff">new</span>(uint)  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A565                 pop     ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A566                 mov     [ebp<span style="color:#ec0000">+</span>var_B0], eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A56C                 test    eax, eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A56E                 jz      <span style="color:#5f5fff">short</span> loc_40A5E6  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A570                 mov     word ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">10</span>h], <span style="color:#008900">0E0</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A576                 mov     edx, [ebp<span style="color:#ec0000">+</span>var_B0]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A57C                 xor     ecx, ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A57E                 mov     [edx<span style="color:#ec0000">+</span><span style="color:#008900">14</span>h], ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A581                 mov     eax, offset off_4B2DD4  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A586                 mov     edx, [ebp<span style="color:#ec0000">+</span>var_B0]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A58C                 mov     [edx<span style="color:#ec0000">+</span><span style="color:#008900">18</span>h], eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A58F                 mov     ecx, [ebp<span style="color:#ec0000">+</span>var_B0]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A595                 xor     eax, eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A597                 mov     [ecx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch], eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A59A                 mov     edx, offset off_4B2DE4  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A59F                 mov     ecx, [ebp<span style="color:#ec0000">+</span>var_B0]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A5A5                 mov     [ecx<span style="color:#ec0000">+</span><span style="color:#008900">18</span>h], edx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A5A8                 mov     esi, [ebp<span style="color:#ec0000">+</span>var_B0]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A5AE                 add     esi, <span style="color:#008900">20</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A5B1                 xor     eax, eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A5B3                 mov     [esi], eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A5B5                 inc     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A5B8                 mov     edx, [ebp<span style="color:#ec0000">+</span>var_B0]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A5BE                 add     edx, <span style="color:#008900">24</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A5C1                 mov     [ebp<span style="color:#ec0000">+</span>var_144], edx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A5C7                 mov     ecx, [ebp<span style="color:#ec0000">+</span>var_144]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A5CD                 xor     eax, eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A5CF                 mov     [ecx], eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A5D1                 inc     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A5D4                 add     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch], <span style="color:#008900">0FF</span>FFFFFEh  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A5D8                 mov     word ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">10</span>h], <span style="color:#008900">0</span>D4h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A5DE                 mov     edx, [ebp<span style="color:#ec0000">+</span>var_B0]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A5E4                 jmp     <span style="color:#5f5fff">short</span> loc_40A5EC  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A5E6 ; <span style="color:#ec0000">---------------------------------------------------------------------------</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A5E6  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A5E6 <span style="color:#ec0000">loc_40A5E6</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: sub_40A258<span style="color:#ec0000">+</span><span style="color:#008900">316</span> j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A5E6                 mov     edx, [ebp<span style="color:#ec0000">+</span>var_B0]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A5EC  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A5EC <span style="color:#ec0000">loc_40A5EC</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: sub_40A258<span style="color:#ec0000">+</span><span style="color:#008900">38</span>C j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A5EC                 mov     esi, edx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A5EE                 mov     word ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">10</span>h], <span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A5F4                 mov     word ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">10</span>h], <span style="color:#008900">0</span>ECh  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A5FA                 push    <span style="color:#008900">2</span>Ch  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A5FC                 push    <span style="color:#008900">0</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A5FE                 push    edi 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A5FF                 lea     eax, [ebp<span style="color:#ec0000">+</span>var_C8]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A605                 push    eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A606                 call    sub_40B96C  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A60B                 add     esp, <span style="color:#008900">10</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A60E                 lea     ecx, [ebp<span style="color:#ec0000">+</span>var_C8]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A614                 add     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch], <span style="color:#008900">4</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A618                 mov     [ebp<span style="color:#ec0000">+</span>var_148], ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A61E                 mov     eax, [ebp<span style="color:#ec0000">+</span>var_148]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A624                 mov     edx, [eax]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A626                 lea     eax, [ebp<span style="color:#ec0000">+</span>var_CC]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A62C                 call    <span style="color:#ec0000">@</span>System<span style="color:#ec0000">@</span>AnsiString<span style="color:#ec0000">@$</span>bctr<span style="color:#ec0000">$</span>qqrpxc ; System<span style="color:#ec0000">::</span>AnsiString<span style="color:#ec0000">::</span>AnsiString(<span style="color:#5f5fff">char</span> <span style="color:#ec0000">*</span>)  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A631                 inc     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A634                 lea     edx, [ebp<span style="color:#ec0000">+</span>var_CC]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A63A                 lea     eax, [esi<span style="color:#ec0000">+</span><span style="color:#008900">20</span>h]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A63D                 call    sub_4A0484  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A642                 dec     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A645                 lea     eax, [ebp<span style="color:#ec0000">+</span>var_CC]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A64B                 mov     edx, <span style="color:#008900">2</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A650                 call    <span style="color:#ec0000">@</span>System<span style="color:#ec0000">@</span>AnsiString<span style="color:#ec0000">@$</span>bdtr<span style="color:#ec0000">$</span>qqrv ; System<span style="color:#ec0000">::</span>AnsiString<span style="color:#ec0000">::~</span>AnsiString(<span style="color:#5f5fff">void</span>)  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A655                 dec     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A658                 mov     word ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">10</span>h], <span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A65E                 dec     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A661                 mov     ecx, [ebp<span style="color:#ec0000">+</span>var_B8]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A667                 mov     eax, [ebp<span style="color:#ec0000">+</span>var_C8]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A66D                 sub     ecx, eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A66F                 mov     [ebp<span style="color:#ec0000">+</span>var_14C], ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A675                 mov     [ebp<span style="color:#ec0000">+</span>var_150], eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A67B                 cmp     [ebp<span style="color:#ec0000">+</span>var_150], <span style="color:#008900">0</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A682                 jz      <span style="color:#5f5fff">short</span> loc_40A6B5  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A684                 cmp     [ebp<span style="color:#ec0000">+</span>var_14C], <span style="color:#008900">80</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A68E                 jbe     <span style="color:#5f5fff">short</span> loc_40A69F  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A690                 mov     edx, [ebp<span style="color:#ec0000">+</span>var_150]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A696                 push    edx            ; handle  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A697                 call    __rtl_close  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A69C                 pop     ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A69D                 jmp     <span style="color:#5f5fff">short</span> loc_40A6B5  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A69F ; <span style="color:#ec0000">---------------------------------------------------------------------------</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A69F  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A69F <span style="color:#ec0000">loc_40A69F</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: sub_40A258<span style="color:#ec0000">+</span><span style="color:#008900">436</span> j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A69F                 mov     ecx, [ebp<span style="color:#ec0000">+</span>var_14C]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A6A5                 push    ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A6A6                 mov     eax, [ebp<span style="color:#ec0000">+</span>var_150]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A6AC                 push    eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A6AD                 call    sub_4A0CA4  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A6B2                 add     esp, <span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A6B5  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A6B5 <span style="color:#ec0000">loc_40A6B5</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: sub_40A258<span style="color:#ec0000">+</span><span style="color:#008900">42</span>A j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A6B5                                        ; sub_40A258<span style="color:#ec0000">+</span><span style="color:#008900">445</span> j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A6B5                 dec     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A6B8                 dec     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A6BB                 xor     edx, edx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A6BD                 mov     word ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">10</span>h], <span style="color:#008900">110</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A6C3                 mov     [ebp<span style="color:#ec0000">+</span>var_D0], edx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A6C9                 lea     edx, [ebp<span style="color:#ec0000">+</span>var_D0]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A6CF                 inc     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A6D2                 lea     eax, [esi<span style="color:#ec0000">+</span><span style="color:#008900">20</span>h]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A6D5                 call    sub_4A05EC  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A6DA                 lea     edx, [ebp<span style="color:#ec0000">+</span>var_D0]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A6E0                 lea     eax, [esi<span style="color:#ec0000">+</span><span style="color:#008900">20</span>h]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A6E3                 call    sub_4A0484  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A6E8                 dec     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A6EB                 lea     eax, [ebp<span style="color:#ec0000">+</span>var_D0]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A6F1                 mov     edx, <span style="color:#008900">2</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A6F6                 call    <span style="color:#ec0000">@</span>System<span style="color:#ec0000">@</span>AnsiString<span style="color:#ec0000">@$</span>bdtr<span style="color:#ec0000">$</span>qqrv ; System<span style="color:#ec0000">::</span>AnsiString<span style="color:#ec0000">::~</span>AnsiString(<span style="color:#5f5fff">void</span>)  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A6FB                 mov     word ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">10</span>h], <span style="color:#008900">11</span>Ch  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A701                 push    <span style="color:#008900">2</span>Ch  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A703                 push    <span style="color:#008900">1</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A705                 push    edi 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A706                 lea     ecx, [ebp<span style="color:#ec0000">+</span>var_E8]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A70C                 push    ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A70D                 call    sub_40B96C  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A712                 add     esp, <span style="color:#008900">10</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A715                 lea     eax, [ebp<span style="color:#ec0000">+</span>var_E8]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A71B                 add     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch], <span style="color:#008900">4</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A71F                 mov     [ebp<span style="color:#ec0000">+</span>var_154], eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A725                 lea     eax, [ebp<span style="color:#ec0000">+</span>var_EC]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A72B                 mov     edx, [ebp<span style="color:#ec0000">+</span>var_154]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A731                 mov     edx, [edx]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A733                 call    <span style="color:#ec0000">@</span>System<span style="color:#ec0000">@</span>AnsiString<span style="color:#ec0000">@$</span>bctr<span style="color:#ec0000">$</span>qqrpxc ; System<span style="color:#ec0000">::</span>AnsiString<span style="color:#ec0000">::</span>AnsiString(<span style="color:#5f5fff">char</span> <span style="color:#ec0000">*</span>)  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A738                 inc     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A73B                 lea     edx, [ebp<span style="color:#ec0000">+</span>var_EC]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A741                 lea     eax, [esi<span style="color:#ec0000">+</span><span style="color:#008900">24</span>h]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A744                 call    sub_4A0484  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A749                 dec     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A74C                 lea     eax, [ebp<span style="color:#ec0000">+</span>var_EC]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A752                 mov     edx, <span style="color:#008900">2</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A757                 call    <span style="color:#ec0000">@</span>System<span style="color:#ec0000">@</span>AnsiString<span style="color:#ec0000">@$</span>bdtr<span style="color:#ec0000">$</span>qqrv ; System<span style="color:#ec0000">::</span>AnsiString<span style="color:#ec0000">::~</span>AnsiString(<span style="color:#5f5fff">void</span>)  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A75C                 dec     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A75F                 mov     word ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">10</span>h], <span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A765                 dec     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A768                 mov     ecx, [ebp<span style="color:#ec0000">+</span>var_D8]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A76E                 mov     eax, [ebp<span style="color:#ec0000">+</span>var_E8]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A774                 sub     ecx, eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A776                 mov     [ebp<span style="color:#ec0000">+</span>var_158], ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A77C                 mov     [ebp<span style="color:#ec0000">+</span>var_15C], eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A782                 cmp     [ebp<span style="color:#ec0000">+</span>var_15C], <span style="color:#008900">0</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A789                 jz      <span style="color:#5f5fff">short</span> loc_40A7BC  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A78B                 cmp     [ebp<span style="color:#ec0000">+</span>var_158], <span style="color:#008900">80</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A795                 jbe     <span style="color:#5f5fff">short</span> loc_40A7A6  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A797                 mov     edx, [ebp<span style="color:#ec0000">+</span>var_15C]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A79D                 push    edx            ; handle  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A79E                 call    __rtl_close  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A7A3                 pop     ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A7A4                 jmp     <span style="color:#5f5fff">short</span> loc_40A7BC  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A7A6 ; <span style="color:#ec0000">---------------------------------------------------------------------------</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A7A6  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A7A6 <span style="color:#ec0000">loc_40A7A6</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: sub_40A258<span style="color:#ec0000">+</span><span style="color:#008900">53</span>D j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A7A6                 mov     ecx, [ebp<span style="color:#ec0000">+</span>var_158]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A7AC                 push    ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A7AD                 mov     eax, [ebp<span style="color:#ec0000">+</span>var_15C]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A7B3                 push    eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A7B4                 call    sub_4A0CA4  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A7B9                 add     esp, <span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A7BC  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A7BC <span style="color:#ec0000">loc_40A7BC</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: sub_40A258<span style="color:#ec0000">+</span><span style="color:#008900">531</span> j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A7BC                                        ; sub_40A258<span style="color:#ec0000">+</span><span style="color:#008900">54</span>C j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A7BC                 dec     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A7BF                 dec     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A7C2                 xor     edx, edx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A7C4                 mov     [esi<span style="color:#ec0000">+</span><span style="color:#008900">8</span>], edx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A7C7                 mov     [esi<span style="color:#ec0000">+</span><span style="color:#008900">0</span>Ch], edx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A7CA                 lea     eax, [esi<span style="color:#ec0000">+</span><span style="color:#008900">20</span>h]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A7CD                 mov     byte ptr [esi<span style="color:#ec0000">+</span><span style="color:#008900">10</span>h], <span style="color:#008900">1</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A7D1                 cmp     dword ptr [eax], <span style="color:#008900">0</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A7D4                 jz      <span style="color:#5f5fff">short</span> loc_40A7DA  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A7D6                 mov     edx, [eax]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A7D8                 jmp     <span style="color:#5f5fff">short</span> loc_40A7DF  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A7DA ; <span style="color:#ec0000">---------------------------------------------------------------------------</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A7DA  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A7DA <span style="color:#ec0000">loc_40A7DA</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: sub_40A258<span style="color:#ec0000">+</span><span style="color:#008900">57</span>C j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A7DA                 mov     edx, offset unk_4B2719  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A7DF  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A7DF <span style="color:#ec0000">loc_40A7DF</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: sub_40A258<span style="color:#ec0000">+</span><span style="color:#008900">580</span> j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A7DF                 push    edx            ; cp  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A7E0                 call    inet_addr  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A7E5                 cmp     eax, <span style="color:#008900">0FF</span>FFFFFFh  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A7E8                 jz      <span style="color:#5f5fff">short</span> loc_40A7F9  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A7EA                 push    esi 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A7EB                 mov     eax, [ebp<span style="color:#ec0000">+</span>arg_0]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A7EE                 push    eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A7EF                 call    sub_40C46C  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A7F4                 add     esp, <span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A7F7                 jmp     <span style="color:#5f5fff">short</span> loc_40A84D  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A7F9 ; <span style="color:#ec0000">---------------------------------------------------------------------------</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A7F9  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A7F9 <span style="color:#ec0000">loc_40A7F9</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: sub_40A258<span style="color:#ec0000">+</span><span style="color:#008900">590</span> j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A7F9                 mov     [ebp<span style="color:#ec0000">+</span>var_F0], esi 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A7FF                 cmp     [ebp<span style="color:#ec0000">+</span>var_F0], <span style="color:#008900">0</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A806                 jz      <span style="color:#5f5fff">short</span> loc_40A84D  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A808                 mov     word ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">10</span>h], <span style="color:#008900">14</span>Ch  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A80E                 dec     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A811                 mov     edx, <span style="color:#008900">2</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A816                 mov     eax, [ebp<span style="color:#ec0000">+</span>var_F0]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A81C                 add     eax, <span style="color:#008900">24</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A81F                 call    <span style="color:#ec0000">@</span>System<span style="color:#ec0000">@</span>AnsiString<span style="color:#ec0000">@$</span>bdtr<span style="color:#ec0000">$</span>qqrv ; System<span style="color:#ec0000">::</span>AnsiString<span style="color:#ec0000">::~</span>AnsiString(<span style="color:#5f5fff">void</span>)  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A824                 dec     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A827                 mov     edx, <span style="color:#008900">2</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A82C                 mov     eax, [ebp<span style="color:#ec0000">+</span>var_F0]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A832                 add     eax, <span style="color:#008900">20</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A835                 call    <span style="color:#ec0000">@</span>System<span style="color:#ec0000">@</span>AnsiString<span style="color:#ec0000">@$</span>bdtr<span style="color:#ec0000">$</span>qqrv ; System<span style="color:#ec0000">::</span>AnsiString<span style="color:#ec0000">::~</span>AnsiString(<span style="color:#5f5fff">void</span>)  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A83A                 mov     ecx, [ebp<span style="color:#ec0000">+</span>var_F0]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A840                 push    ecx            ; handle  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A841                 call    __rtl_close  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A846                 pop     ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A847                 mov     word ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">10</span>h], <span style="color:#008900">140</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A84D  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A84D <span style="color:#ec0000">loc_40A84D</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: sub_40A258<span style="color:#ec0000">+</span><span style="color:#008900">59F</span> j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A84D                                        ; sub_40A258<span style="color:#ec0000">+</span><span style="color:#008900">5</span>AE j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A84D                 add     edi, <span style="color:#008900">18</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A850  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A850 <span style="color:#ec0000">loc_40A850</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: sub_40A258<span style="color:#ec0000">+</span><span style="color:#008900">301</span> j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A850                 cmp     edi, [ebp<span style="color:#ec0000">+</span>var_30<span style="color:#ec0000">+</span><span style="color:#008900">4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A853                 jnz     loc_40A55E  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A859                 dec     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A85C                 lea     ecx, [ebp<span style="color:#ec0000">+</span>var_164]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A862                 mov     eax, [ebp<span style="color:#ec0000">+</span>var_30<span style="color:#ec0000">+</span><span style="color:#008900">4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A865                 mov     edx, [ebp<span style="color:#ec0000">+</span>var_30]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A868                 push    ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A869                 push    eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A86A                 push    edx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A86B                 call    sub_40AB5C  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A870                 mov     word ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">10</span>h], <span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A876                 dec     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A879                 mov     ecx, <span style="color:#008900">18</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A87E                 mov     eax, [ebp<span style="color:#ec0000">+</span>var_30<span style="color:#ec0000">+</span><span style="color:#008900">10</span>h]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A881                 add     esp, <span style="color:#008900">0</span>Ch  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A884                 sub     eax, [ebp<span style="color:#ec0000">+</span>var_30]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A887                 cdq 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A888                 idiv    ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A88A                 mov     [ebp<span style="color:#ec0000">+</span>var_168], eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A890                 mov     esi, [ebp<span style="color:#ec0000">+</span>var_30]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A893                 test    esi, esi 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A895                 jz      <span style="color:#5f5fff">short</span> loc_40A8CE  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A897                 mov     eax, [ebp<span style="color:#ec0000">+</span>var_168]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A89D                 shl     eax, <span style="color:#008900">3</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A8A0                 lea     eax, [eax<span style="color:#ec0000">+</span>eax<span style="color:#ec0000">*</span><span style="color:#008900">2</span>]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A8A3                 mov     [ebp<span style="color:#ec0000">+</span>var_16C], eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A8A9                 cmp     [ebp<span style="color:#ec0000">+</span>var_16C], <span style="color:#008900">80</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A8B3                 jbe     <span style="color:#5f5fff">short</span> loc_40A8BE  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A8B5                 push    esi            ; handle  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A8B6                 call    __rtl_close  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A8BB                 pop     ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A8BC                 jmp     <span style="color:#5f5fff">short</span> loc_40A8CE  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A8BE ; <span style="color:#ec0000">---------------------------------------------------------------------------</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A8BE  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A8BE <span style="color:#ec0000">loc_40A8BE</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: sub_40A258<span style="color:#ec0000">+</span><span style="color:#008900">65</span>B j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A8BE                 mov     edx, [ebp<span style="color:#ec0000">+</span>var_16C]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A8C4                 push    edx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A8C5                 push    esi 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A8C6                 call    sub_4A0CA4  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A8CB                 add     esp, <span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A8CE  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A8CE <span style="color:#ec0000">loc_40A8CE</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: sub_40A258<span style="color:#ec0000">+</span><span style="color:#008900">63</span>D j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A8CE                                        ; sub_40A258<span style="color:#ec0000">+</span><span style="color:#008900">664</span> j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A8CE                 dec     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A8D1                 dec     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A8D4                 dec     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A8D7                 mov     eax, [ebp<span style="color:#ec0000">+</span>var_18<span style="color:#ec0000">+</span><span style="color:#008900">4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A8DA                 mov     edx, [ebp<span style="color:#ec0000">+</span>var_18]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A8DD                 mov     [ebp<span style="color:#ec0000">+</span>var_170], edx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A8E3                 lea     ecx, [ebp<span style="color:#ec0000">+</span>var_178]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A8E9                 push    ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A8EA                 push    eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A8EB                 mov     eax, [ebp<span style="color:#ec0000">+</span>var_170]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A8F1                 push    eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A8F2                 call    sub_40AB5C  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A8F7                 add     esp, <span style="color:#008900">0</span>Ch  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A8FA                 dec     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A8FD                 mov     eax, [ebp<span style="color:#ec0000">+</span>var_18<span style="color:#ec0000">+</span><span style="color:#008900">10</span>h]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A900                 sub     eax, [ebp<span style="color:#ec0000">+</span>var_18]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A903                 mov     ecx, <span style="color:#008900">18</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A908                 cdq 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A909                 idiv    ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A90B                 mov     [ebp<span style="color:#ec0000">+</span>var_17C], eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A911                 mov     esi, [ebp<span style="color:#ec0000">+</span>var_18]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A914                 test    esi, esi 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A916                 jz      <span style="color:#5f5fff">short</span> loc_40A94F  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A918                 mov     eax, [ebp<span style="color:#ec0000">+</span>var_17C]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A91E                 shl     eax, <span style="color:#008900">3</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A921                 lea     eax, [eax<span style="color:#ec0000">+</span>eax<span style="color:#ec0000">*</span><span style="color:#008900">2</span>]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A924                 mov     [ebp<span style="color:#ec0000">+</span>var_180], eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A92A                 cmp     [ebp<span style="color:#ec0000">+</span>var_180], <span style="color:#008900">80</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A934                 jbe     <span style="color:#5f5fff">short</span> loc_40A93F  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A936                 push    esi            ; handle  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A937                 call    __rtl_close  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A93C                 pop     ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A93D                 jmp     <span style="color:#5f5fff">short</span> loc_40A94F  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A93F ; <span style="color:#ec0000">---------------------------------------------------------------------------</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A93F  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A93F <span style="color:#ec0000">loc_40A93F</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: sub_40A258<span style="color:#ec0000">+</span><span style="color:#008900">6</span>DC j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A93F                 mov     edx, [ebp<span style="color:#ec0000">+</span>var_180]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A945                 push    edx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A946                 push    esi 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A947                 call    sub_4A0CA4  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A94C                 add     esp, <span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A94F  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A94F <span style="color:#ec0000">loc_40A94F</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: sub_40A258<span style="color:#ec0000">+</span><span style="color:#008900">6</span>BE j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A94F                                        ; sub_40A258<span style="color:#ec0000">+</span><span style="color:#008900">6E5</span> j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A94F                 dec     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A952                 dec     dword ptr [ebx<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A955                 mov     ecx, [ebx]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A957                 mov     large <span style="color:#ec0000">fs</span>:<span style="color:#008900">0</span>, ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A95E                 pop     edi 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A95F                 pop     esi 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A960                 pop     ebx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A961                 mov     esp, ebp 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A963                 pop     ebp 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>A964                 retn 
</span></span></code></pre></div><p>  这里已经在做字符串处理了，内存中是4.2.2.1,美国 科罗拉多州布隆菲尔德市Level 3通信公司这种形式，因此需要用逗号吧地址和位置分开，查看变量的访问情况后（这是个很耗时的过程）发现还要向上回溯：</p>
<div class="highlight"><pre tabindex="0" style="color:#757575;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00402474</span> sub_402474      proc near              ; CODE <span style="color:#ec0000">XREF</span>: sub_401B74<span style="color:#ec0000">+</span><span style="color:#008900">1</span>A8 p  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00402474</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00402474</span> var_48          <span style="color:#ec0000">=</span> byte ptr <span style="color:#ec0000">-</span><span style="color:#008900">48</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00402474</span> s               <span style="color:#ec0000">=</span> dword ptr <span style="color:#ec0000">-</span><span style="color:#008900">24</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00402474</span> var_20          <span style="color:#ec0000">=</span> byte ptr <span style="color:#ec0000">-</span><span style="color:#008900">20</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00402474</span> handle          <span style="color:#ec0000">=</span> dword ptr <span style="color:#ec0000">-</span><span style="color:#008900">18</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00402474</span> var_8           <span style="color:#ec0000">=</span> dword ptr <span style="color:#ec0000">-</span><span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00402474</span> arg_0           <span style="color:#ec0000">=</span> dword ptr  <span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00402474</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00402474</span>                 push    ebp 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00402475</span>                 mov     ebp, esp 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00402477</span>                 add     esp, <span style="color:#008900">0FF</span>FFFFB8h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040247</span>A                 mov     eax, offset unk_4A2564  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040247F</span>                 push    ebx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004024</span><span style="color:#008900">80</span>                 push    esi 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004024</span><span style="color:#008900">81</span>                 push    edi 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004024</span><span style="color:#008900">82</span>                 lea     edi, [ebp<span style="color:#ec0000">+</span>var_48]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004024</span><span style="color:#008900">85</span>                 mov     ebx, [ebp<span style="color:#ec0000">+</span>arg_0]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004024</span><span style="color:#008900">88</span>                 call    <span style="color:#ec0000">@</span>__InitExceptBlockLDTC  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004024</span><span style="color:#008900">8</span>D                 mov     word ptr [edi<span style="color:#ec0000">+</span><span style="color:#008900">10</span>h], <span style="color:#008900">14</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004024</span><span style="color:#008900">93</span>                 lea     edx, [ebp<span style="color:#ec0000">+</span>var_20]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004024</span><span style="color:#008900">96</span>                 xor     ecx, ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004024</span><span style="color:#008900">98</span>                 push    edx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004024</span><span style="color:#008900">99</span>                 lea     eax, [ebp<span style="color:#ec0000">+</span>s]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004024</span><span style="color:#008900">9</span>C                 inc     dword ptr [edi<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040249F</span>                 mov     [ebp<span style="color:#ec0000">+</span>s], ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004024</span>A2                 push    eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004024</span>A3                 inc     dword ptr [edi<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004024</span>A6                 call    sub_408F5C  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004024</span>AB                 cmp     [ebp<span style="color:#ec0000">+</span>s], <span style="color:#008900">0</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004024</span>AF                 pop     ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004024</span>B0                 jz      <span style="color:#5f5fff">short</span> loc_4024B7  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004024</span>B2                 mov     edx, [ebp<span style="color:#ec0000">+</span>s]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004024</span>B5                 jmp     <span style="color:#5f5fff">short</span> loc_4024BC  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004024</span>B7 ; <span style="color:#ec0000">---------------------------------------------------------------------------</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004024</span>B7  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004024</span>B7 <span style="color:#ec0000">loc_4024B7</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: sub_402474<span style="color:#ec0000">+</span><span style="color:#008900">3</span>C j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004024</span>B7                 mov     edx, offset unk_4A21CB  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004024</span>BC  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004024</span>BC <span style="color:#ec0000">loc_4024BC</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: sub_402474<span style="color:#ec0000">+</span><span style="color:#008900">41</span> j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004024</span>BC                 push    edx            ; s  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004024</span>BD                 lea     eax, [ebp<span style="color:#ec0000">+</span>handle]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004024</span>C0                 push    eax            ; _DWORD  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004024</span>C1                 call    FormatString  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004024</span>C6                 add     dword ptr [edi<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch], <span style="color:#008900">4</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004024</span>CA                 dec     dword ptr [edi<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004024</span>CD                 add     esp, <span style="color:#008900">0</span>Ch  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004024</span>D0                 dec     dword ptr [edi<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004024</span>D3                 lea     eax, [ebp<span style="color:#ec0000">+</span>s]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004024</span>D6                 mov     edx, <span style="color:#008900">2</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004024</span>DB                 call    <span style="color:#ec0000">@</span>System<span style="color:#ec0000">@</span>AnsiString<span style="color:#ec0000">@$</span>bdtr<span style="color:#ec0000">$</span>qqrv ; System<span style="color:#ec0000">::</span>AnsiString<span style="color:#ec0000">::~</span>AnsiString(<span style="color:#5f5fff">void</span>)  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004024E0</span>                 mov     word ptr [edi<span style="color:#ec0000">+</span><span style="color:#008900">10</span>h], <span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004024E6</span>                 mov     eax, [ebx<span style="color:#ec0000">+</span><span style="color:#008900">400</span>h]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004024</span>EC                 test    eax, eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004024</span>EE                 jz      <span style="color:#5f5fff">short</span> loc_4024FD  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004024F</span><span style="color:#008900">0</span>                 lea     edx, [ebp<span style="color:#ec0000">+</span>handle]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004024F</span><span style="color:#008900">3</span>                 push    edx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004024F</span><span style="color:#008900">4</span>                 push    eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004024F</span><span style="color:#008900">5</span>                 call    sub_40A258  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004024F</span>A                 add     esp, <span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004024F</span>D  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004024F</span>D <span style="color:#ec0000">loc_4024FD</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: sub_402474<span style="color:#ec0000">+</span><span style="color:#008900">7</span>A j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">004024F</span>D                 dec     dword ptr [edi<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00402500</span>                 dec     dword ptr [edi<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00402503</span>                 mov     esi, [ebp<span style="color:#ec0000">+</span>var_8]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00402506</span>                 mov     eax, [ebp<span style="color:#ec0000">+</span>handle]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040250</span><span style="color:#008900">9</span>                 sub     esi, eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040250</span>B                 mov     ebx, eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040250</span>D                 test    ebx, ebx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040250F</span>                 jz      <span style="color:#5f5fff">short</span> loc_40252C  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00402511</span>                 cmp     esi, <span style="color:#008900">80</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00402517</span>                 jbe     <span style="color:#5f5fff">short</span> loc_402522  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040251</span><span style="color:#008900">9</span>                 push    ebx            ; handle  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040251</span>A                 call    __rtl_close  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040251F</span>                 pop     ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00402520</span>                 jmp     <span style="color:#5f5fff">short</span> loc_40252C  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00402522</span> ; <span style="color:#ec0000">---------------------------------------------------------------------------</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00402522</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00402522</span> <span style="color:#ec0000">loc_402522</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: sub_402474<span style="color:#ec0000">+</span>A3 j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00402522</span>                 push    esi 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00402523</span>                 push    ebx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00402524</span>                 call    sub_4A0CA4  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040252</span><span style="color:#008900">9</span>                 add     esp, <span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040252</span>C  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040252</span>C <span style="color:#ec0000">loc_40252C</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: sub_402474<span style="color:#ec0000">+</span><span style="color:#008900">9</span>B j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040252</span>C                                        ; sub_402474<span style="color:#ec0000">+</span>AC j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040252</span>C                 dec     dword ptr [edi<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040252F</span>                 dec     dword ptr [edi<span style="color:#ec0000">+</span><span style="color:#008900">1</span>Ch]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00402532</span>                 mov     eax, [edi]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00402534</span>                 mov     large <span style="color:#ec0000">fs</span>:<span style="color:#008900">0</span>, eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040253</span>A                 pop     edi 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040253</span>B                 pop     esi 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040253</span>C                 pop     ebx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040253</span>D                 mov     esp, ebp 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040253F</span>                 pop     ebp 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00402540</span>                 retn 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040254</span>  
</span></span></code></pre></div><p>  再次调试，发现408F5C处得到的s已经包含地址，而之前再无修改s之处或者传递之处，因此确定sub_408F5C用于解密字符串，之所以是解密，是因为无法通过资源和字符串找到这些数据，也就说一定经过加密了。进入该函数，这下有趣了：</p>
<div class="highlight"><pre tabindex="0" style="color:#757575;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00408F</span><span style="color:#008900">5</span>C sub_408F5C      proc near              ; CODE <span style="color:#ec0000">XREF</span>: sub_402474<span style="color:#ec0000">+</span><span style="color:#008900">32</span> p  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00408F</span><span style="color:#008900">5</span>C  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00408F</span><span style="color:#008900">5</span>C var_28          <span style="color:#ec0000">=</span> dword ptr <span style="color:#ec0000">-</span><span style="color:#008900">28</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00408F</span><span style="color:#008900">5</span>C var_18          <span style="color:#ec0000">=</span> word ptr <span style="color:#ec0000">-</span><span style="color:#008900">18</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00408F</span><span style="color:#008900">5</span>C var_C           <span style="color:#ec0000">=</span> dword ptr <span style="color:#ec0000">-</span><span style="color:#008900">0</span>Ch  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00408F</span><span style="color:#008900">5</span>C var_4           <span style="color:#ec0000">=</span> dword ptr <span style="color:#ec0000">-</span><span style="color:#008900">4</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00408F</span><span style="color:#008900">5</span>C arg_0           <span style="color:#ec0000">=</span> dword ptr  <span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00408F</span><span style="color:#008900">5</span>C  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00408F</span><span style="color:#008900">5</span>C                 push    ebp 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00408F</span><span style="color:#008900">5</span>D                 mov     ebp, esp 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00408F5F</span>                 add     esp, <span style="color:#008900">0FF</span>FFFFD8h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00408F</span><span style="color:#008900">62</span>                 mov     eax, offset unk_4B1FA0  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00408F</span><span style="color:#008900">67</span>                 call    <span style="color:#ec0000">@</span>__InitExceptBlockLDTC  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00408F</span><span style="color:#008900">6</span>C                 mov     [ebp<span style="color:#ec0000">+</span>var_18], <span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00408F</span><span style="color:#008900">72</span>                 push    <span style="color:#008900">0</span>D3EEh  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00408F</span><span style="color:#008900">77</span>                 push    offset unk_4A4B80  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00408F</span><span style="color:#008900">7</span>C                 xor     edx, edx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00408F</span><span style="color:#008900">7</span>E                 mov     [ebp<span style="color:#ec0000">+</span>var_4], edx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00408F</span><span style="color:#008900">81</span>                 lea     ecx, [ebp<span style="color:#ec0000">+</span>var_4]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00408F</span><span style="color:#008900">84</span>                 push    ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00408F</span><span style="color:#008900">85</span>                 inc     [ebp<span style="color:#ec0000">+</span>var_C]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00408F</span><span style="color:#008900">88</span>                 call    decode  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00408F</span><span style="color:#008900">8</span>D                 add     esp, <span style="color:#008900">0</span>Ch  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00408F</span><span style="color:#008900">90</span>                 lea     edx, [ebp<span style="color:#ec0000">+</span>var_4]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00408F</span><span style="color:#008900">93</span>                 mov     eax, [ebp<span style="color:#ec0000">+</span>arg_0]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00408F</span><span style="color:#008900">96</span>                 call    sub_4A0484  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00408F</span><span style="color:#008900">9</span>B                 mov     eax, [ebp<span style="color:#ec0000">+</span>arg_0]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00408F</span><span style="color:#008900">9</span>E                 mov     edx, <span style="color:#008900">2</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00408F</span>A3                 mov     [ebp<span style="color:#ec0000">+</span>var_18], <span style="color:#008900">14</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00408F</span>A9                 push    eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00408F</span>AA                 lea     eax, [ebp<span style="color:#ec0000">+</span>var_4]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00408F</span>AD                 dec     [ebp<span style="color:#ec0000">+</span>var_C]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00408F</span>B0                 call    <span style="color:#ec0000">@</span>System<span style="color:#ec0000">@</span>AnsiString<span style="color:#ec0000">@$</span>bdtr<span style="color:#ec0000">$</span>qqrv ; System<span style="color:#ec0000">::</span>AnsiString<span style="color:#ec0000">::~</span>AnsiString(<span style="color:#5f5fff">void</span>)  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00408F</span>B5                 pop     eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00408F</span>B6                 mov     [ebp<span style="color:#ec0000">+</span>var_18], <span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00408F</span>BC                 inc     [ebp<span style="color:#ec0000">+</span>var_C]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00408F</span>BF                 mov     edx, [ebp<span style="color:#ec0000">+</span>var_28]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00408F</span>C2                 mov     large <span style="color:#ec0000">fs</span>:<span style="color:#008900">0</span>, edx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00408F</span>C9                 mov     esp, ebp 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00408F</span>CB                 pop     ebp 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00408F</span>CC                 retn 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">00408F</span>CC sub_408F5C      endp  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CA68 ; <span style="color:#5f5fff">int</span> <span style="color:#ec0000">__cdecl</span> <span style="color:#5f5fff">decode</span>(<span style="color:#5f5fff">int</span> dest, <span style="color:#5f5fff">int</span> src, <span style="color:#5f5fff">int</span> len)  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CA68 decode          proc near              ; CODE <span style="color:#ec0000">XREF</span>: dosetdns<span style="color:#ec0000">+</span><span style="color:#008900">7</span>B p  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CA68                                        ; sub_4082F4<span style="color:#ec0000">+</span><span style="color:#008900">75</span> p ...  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CA68  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CA68 var_30          <span style="color:#ec0000">=</span> dword ptr <span style="color:#ec0000">-</span><span style="color:#008900">30</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CA68 var_2C          <span style="color:#ec0000">=</span> dword ptr <span style="color:#ec0000">-</span><span style="color:#008900">2</span>Ch  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CA68 var_1C          <span style="color:#ec0000">=</span> word ptr <span style="color:#ec0000">-</span><span style="color:#008900">1</span>Ch  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CA68 var_10          <span style="color:#ec0000">=</span> dword ptr <span style="color:#ec0000">-</span><span style="color:#008900">10</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CA68 var_8           <span style="color:#ec0000">=</span> dword ptr <span style="color:#ec0000">-</span><span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CA68 var_4           <span style="color:#ec0000">=</span> byte ptr <span style="color:#ec0000">-</span><span style="color:#008900">4</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CA68 dest            <span style="color:#ec0000">=</span> dword ptr  <span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CA68 src             <span style="color:#ec0000">=</span> dword ptr  <span style="color:#008900">0</span>Ch  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CA68 len             <span style="color:#ec0000">=</span> dword ptr  <span style="color:#008900">10</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CA68  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CA68                 push    ebp 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CA69                 mov     ebp, esp 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CA6B                 add     esp, <span style="color:#008900">0FF</span>FFFFD0h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CA6E                 mov     eax, offset unk_4B3420  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CA73                 call    <span style="color:#ec0000">@</span>__InitExceptBlockLDTC  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CA78                 mov     [ebp<span style="color:#ec0000">+</span>var_1C], <span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CA7E                 lea     eax, [ebp<span style="color:#ec0000">+</span>var_4]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CA81                 call    unknown_libname_1128 ; CBuilder <span style="color:#008900">5</span> runtime  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CA86                 inc     [ebp<span style="color:#ec0000">+</span>var_10]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CA89                 mov     [ebp<span style="color:#ec0000">+</span>var_1C], <span style="color:#008900">14</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CA8F                 xor     edx, edx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CA91                 mov     [ebp<span style="color:#ec0000">+</span>var_30], edx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CA94                 mov     ecx, [ebp<span style="color:#ec0000">+</span>var_30]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CA97                 cmp     ecx, [ebp<span style="color:#ec0000">+</span>len]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CA9A                 jge     <span style="color:#5f5fff">short</span> loc_40CAE4  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CA9C  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CA9C <span style="color:#ec0000">loc_40CA9C</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: decode<span style="color:#ec0000">+</span><span style="color:#008900">7</span>A j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CA9C                 mov     [ebp<span style="color:#ec0000">+</span>var_1C], <span style="color:#008900">20</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CAA2                 mov     eax, [ebp<span style="color:#ec0000">+</span>var_30]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CAA5                 mov     edx, [ebp<span style="color:#ec0000">+</span>src]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CAA8                 xor     ecx, ecx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CAAA                 mov     cl, [edx<span style="color:#ec0000">+</span>eax]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CAAD                 mov     dl, byte_4B32CC[ecx]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CAB3                 lea     eax, [ebp<span style="color:#ec0000">+</span>var_8]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CAB6                 call    <span style="color:#ec0000">@</span>System<span style="color:#ec0000">@</span>AnsiString<span style="color:#ec0000">@$</span>bctr<span style="color:#ec0000">$</span>qqrc ; System<span style="color:#ec0000">::</span>AnsiString<span style="color:#ec0000">::</span>AnsiString(<span style="color:#5f5fff">char</span>)  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CABB                 inc     [ebp<span style="color:#ec0000">+</span>var_10]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CABE                 lea     edx, [ebp<span style="color:#ec0000">+</span>var_8]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CAC1                 lea     eax, [ebp<span style="color:#ec0000">+</span>var_4]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CAC4                 call    sub_4A0498  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CAC9                 dec     [ebp<span style="color:#ec0000">+</span>var_10]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CACC                 lea     eax, [ebp<span style="color:#ec0000">+</span>var_8]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CACF                 mov     edx, <span style="color:#008900">2</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CAD4                 call    <span style="color:#ec0000">@</span>System<span style="color:#ec0000">@</span>AnsiString<span style="color:#ec0000">@$</span>bdtr<span style="color:#ec0000">$</span>qqrv ; System<span style="color:#ec0000">::</span>AnsiString<span style="color:#ec0000">::~</span>AnsiString(<span style="color:#5f5fff">void</span>)  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CAD9                 inc     [ebp<span style="color:#ec0000">+</span>var_30]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CADC                 mov     ecx, [ebp<span style="color:#ec0000">+</span>var_30]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CADF                 cmp     ecx, [ebp<span style="color:#ec0000">+</span>len]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CAE2                 jl      <span style="color:#5f5fff">short</span> loc_40CA9C  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CAE4  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CAE4 <span style="color:#ec0000">loc_40CAE4</span>:                            ; CODE <span style="color:#ec0000">XREF</span>: decode<span style="color:#ec0000">+</span><span style="color:#008900">32</span> j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CAE4                 mov     [ebp<span style="color:#ec0000">+</span>var_1C], <span style="color:#008900">2</span>Ch  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CAEA                 lea     edx, [ebp<span style="color:#ec0000">+</span>var_4]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CAED                 mov     eax, [ebp<span style="color:#ec0000">+</span>dest]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CAF0                 call    sub_4A0484  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CAF5                 mov     eax, [ebp<span style="color:#ec0000">+</span>dest]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CAF8                 mov     [ebp<span style="color:#ec0000">+</span>var_1C], <span style="color:#008900">38</span>h  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CAFE                 push    eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CAFF                 dec     [ebp<span style="color:#ec0000">+</span>var_10]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CB02                 lea     eax, [ebp<span style="color:#ec0000">+</span>var_4]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CB05                 mov     edx, <span style="color:#008900">2</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CB0A                 call    <span style="color:#ec0000">@</span>System<span style="color:#ec0000">@</span>AnsiString<span style="color:#ec0000">@$</span>bdtr<span style="color:#ec0000">$</span>qqrv ; System<span style="color:#ec0000">::</span>AnsiString<span style="color:#ec0000">::~</span>AnsiString(<span style="color:#5f5fff">void</span>)  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CB0F                 pop     eax 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CB10                 mov     [ebp<span style="color:#ec0000">+</span>var_1C], <span style="color:#008900">2</span>Ch  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CB16                 inc     [ebp<span style="color:#ec0000">+</span>var_10]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CB19                 mov     edx, [ebp<span style="color:#ec0000">+</span>var_2C]  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CB1C                 mov     large <span style="color:#ec0000">fs</span>:<span style="color:#008900">0</span>, edx 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CB23                 mov     esp, ebp 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CB25                 pop     ebp 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text</span>:<span style="color:#008900">0040</span>CB26                 retn 
</span></span></code></pre></div><p>  4A4B80和4B32CC处在data段，可以看到作者煞费苦心地构造了2个数组，后者用于做ascii码可逆映射，前者是加密过的字符串数组。大小分别为54254和256，既然如此，我们写程序总不能把这些数据从文件提取出来再解密啊，所以还是用winhex拷贝来的快。这里只是一种好奇心，看看作者到底怎么存储和解密这些数据。</p>
<h2 id="fastdns怎么测网速的呢也就是最核心的部分">FASTDNS怎么测网速的呢？也就是最核心的部分？</h2>
<p>  根据前述，核心在TfrmFastDNS_actTestSpendingExecute中。</p>
<pre tabindex="0"><code class="language-Txt" data-lang="Txt">+00h virtualtable
    +0 STOP
    +4 FUNC1
    +8 FUNC2
+04h HANDLE hthread
+08h ????
+18h FARPROC func0
+1Ch LPVOID param0
+20h FARPROC func1//OnIdle处理函数
+24h LPVOID param1
+28h BOOL IsMainthread??
+30h struct*
     +00h int leftTime//剩余次数
     +08h double pertime//平均消耗时间
     +10h flag statu  //成功0 失败3
+38h FARPROC callbackfunc  //测试结束的回调函数showstatus
+3Ch DWORD param2                //callbackfunc的参数
+40h int repeatTime//取样次数
+44h int timeout//超时
+48h Class IdDNSResolver_TIdDNSResolver* extends TIdUDPBase extends TIdUDPBase extends....
//原来delphi自带了组件，好方便啊，不过我得自行解决
        +00h virtualtable 00412B24
                TIdUDPBase::AssignError
                TIdUDPBase:efineProperties
                TIdUDPBase::Assign
                TIdUDPBase:oaded
                。。。。。。。。。。
        +74h char* ipdns
        +7Ch int timeout
        +90h package*//发包结构体
        +94h int repeattime
        +9Ch int sendinfo//要发送的数据包
        。。。。。。。。        
+50h char* ipstart//存放ip地址字串起始位置
+54h char* ipend//存放ip地址字串结束位置
</code></pre><div class="highlight"><pre tabindex="0" style="color:#757575;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Asm" data-lang="Asm"><span style="display:flex;"><span><span style="color:#ec0000">text:</span><span style="color:#ec0000">0040970</span><span style="color:#5f5fff">C</span> ; DWORD __cdecl FUNC2(int structa, int *usedtime)  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text:</span><span style="color:#ec0000">0040970</span><span style="color:#5f5fff">C</span> <span style="color:#008900">FUNC2</span>           <span style="color:#008900">proc</span> <span style="color:#008900">near</span>               ; DATA XREF: .data:fastdns___CPPdebugHook+105D4 o  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text:</span><span style="color:#ec0000">0040970</span><span style="color:#5f5fff">C</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">0040970</span><span style="color:#008900">C</span> <span style="color:#008900">var_2C</span>          <span style="color:#ec0000">=</span> <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> -<span style="color:#008900">2</span><span style="color:#008900">Ch</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">0040970</span><span style="color:#008900">C</span> <span style="color:#008900">var_1C</span>          <span style="color:#ec0000">=</span> <span style="color:#008900">word</span> <span style="color:#008900">ptr</span> -<span style="color:#008900">1</span><span style="color:#008900">Ch</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">0040970</span><span style="color:#008900">C</span> <span style="color:#008900">var_10</span>          <span style="color:#ec0000">=</span> <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> -<span style="color:#008900">10</span><span style="color:#008900">h</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">0040970</span><span style="color:#008900">C</span> <span style="color:#008900">var_8</span>           <span style="color:#ec0000">=</span> <span style="color:#008900">byte</span> <span style="color:#008900">ptr</span> -<span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">0040970</span><span style="color:#008900">C</span> <span style="color:#008900">var_4</span>           <span style="color:#ec0000">=</span> <span style="color:#008900">byte</span> <span style="color:#008900">ptr</span> -<span style="color:#008900">4</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">0040970</span><span style="color:#008900">C</span> <span style="color:#008900">structa</span>         <span style="color:#ec0000">=</span> <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span>  <span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">0040970</span><span style="color:#008900">C</span> <span style="color:#008900">usedtime</span>        <span style="color:#ec0000">=</span> <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span>  <span style="color:#008900">0</span><span style="color:#008900">Ch</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">0040970</span><span style="color:#008900">C</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">0040970</span><span style="color:#008900">C</span>                 <span style="color:#008900">push</span>    <span style="color:#008900">ebp</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">0040970</span><span style="color:#008900">D</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">ebp</span>, <span style="color:#008900">esp</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">0040970</span><span style="color:#008900">F</span>                 <span style="color:#008900">add</span>     <span style="color:#008900">esp</span>, <span style="color:#008900">0</span><span style="color:#008900">FFFFFFD4h</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00409712</span>                 <span style="color:#008900">push</span>    <span style="color:#008900">ebx</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00409713</span>                 <span style="color:#008900">push</span>    <span style="color:#008900">esi</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00409714</span>                 <span style="color:#008900">push</span>    <span style="color:#008900">edi</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00409715</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">edi</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">usedtime</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00409718</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">ebx</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">structa</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">0040971</span><span style="color:#008900">B</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">eax</span>, <span style="color:#008900">offset</span> <span style="color:#008900">unk_4B25EC</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00409720</span>                 <span style="color:#008900">call</span>    <span style="color:#ec0000">@</span><span style="color:#008900">__InitExceptBlockLDTC</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00409725</span>                 <span style="color:#008900">mov</span>     [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_1C</span>], <span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">0040972</span><span style="color:#008900">B</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">esi</span>, [<span style="color:#008900">ebx</span><span style="color:#ec0000">+</span><span style="color:#008900">48</span><span style="color:#008900">h</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">0040972</span><span style="color:#008900">E</span>                 <span style="color:#008900">test</span>    <span style="color:#008900">esi</span>, <span style="color:#008900">esi</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00409730</span>                 <span style="color:#008900">jz</span>      <span style="color:#008900">loc_40984A</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00409736</span>                 <span style="color:#008900">mov</span>     [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_1C</span>], <span style="color:#008900">14</span><span style="color:#008900">h</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">0040973</span><span style="color:#008900">C</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">edx</span>, [<span style="color:#008900">ebx</span><span style="color:#ec0000">+</span><span style="color:#008900">50</span><span style="color:#008900">h</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">0040973</span><span style="color:#008900">F</span>                 <span style="color:#008900">lea</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00409742</span>                 <span style="color:#008900">call</span>    <span style="color:#ec0000">@</span><span style="color:#008900">System@AnsiString@$bctr$qqrpxc</span> ; System::AnsiString::AnsiString(char *)  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text:</span><span style="color:#ec0000">00409747</span>                 <span style="color:#5f5fff">mov</span>     <span style="color:#008900">edx</span>, <span style="color:#008900">eax</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00409749</span>                 <span style="color:#008900">inc</span>     [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_10</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">0040974</span><span style="color:#008900">C</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">eax</span>, <span style="color:#008900">esi</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">0040974</span><span style="color:#008900">E</span>                 <span style="color:#008900">add</span>     <span style="color:#008900">eax</span>, <span style="color:#008900">74</span><span style="color:#008900">h</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00409751</span>                 <span style="color:#008900">call</span>    <span style="color:#008900">sub_4A0484</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00409756</span>                 <span style="color:#008900">dec</span>     [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_10</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00409759</span>                 <span style="color:#008900">lea</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">0040975</span><span style="color:#008900">C</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">edx</span>, <span style="color:#008900">2</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00409761</span>                 <span style="color:#008900">call</span>    <span style="color:#ec0000">@</span><span style="color:#008900">System@AnsiString@$bdtr$qqrv</span> ; System::AnsiString::~AnsiString(void)  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text:</span><span style="color:#ec0000">00409766</span>                 <span style="color:#5f5fff">mov</span>     <span style="color:#008900">ecx</span>, [<span style="color:#008900">ebx</span><span style="color:#ec0000">+</span><span style="color:#008900">44</span><span style="color:#008900">h</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00409769</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">ebx</span><span style="color:#ec0000">+</span><span style="color:#008900">48</span><span style="color:#008900">h</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">0040976</span><span style="color:#008900">C</span>                 <span style="color:#008900">mov</span>     [<span style="color:#008900">eax</span><span style="color:#ec0000">+</span><span style="color:#008900">7</span><span style="color:#008900">Ch</span>], <span style="color:#008900">ecx</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">0040976</span><span style="color:#008900">F</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">edx</span>, [<span style="color:#008900">eax</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00409771</span>                 <span style="color:#008900">call</span>    <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> [<span style="color:#008900">edx</span><span style="color:#ec0000">+</span><span style="color:#008900">48</span><span style="color:#008900">h</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00409774</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">ecx</span>, [<span style="color:#008900">ebx</span><span style="color:#ec0000">+</span><span style="color:#008900">48</span><span style="color:#008900">h</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00409777</span>                 <span style="color:#008900">xor</span>     <span style="color:#008900">edx</span>, <span style="color:#008900">edx</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00409779</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">ecx</span><span style="color:#ec0000">+</span><span style="color:#008900">90</span><span style="color:#008900">h</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">0040977</span><span style="color:#008900">F</span>                 <span style="color:#008900">call</span>    <span style="color:#008900">sub_412E58</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00409784</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">ecx</span>, [<span style="color:#008900">ebx</span><span style="color:#ec0000">+</span><span style="color:#008900">48</span><span style="color:#008900">h</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00409787</span>                 <span style="color:#008900">xor</span>     <span style="color:#008900">edx</span>, <span style="color:#008900">edx</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00409789</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">ecx</span><span style="color:#ec0000">+</span><span style="color:#008900">90</span><span style="color:#008900">h</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">0040978</span><span style="color:#008900">F</span>                 <span style="color:#008900">call</span>    <span style="color:#008900">sub_412E6C</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00409794</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">ecx</span>, [<span style="color:#008900">ebx</span><span style="color:#ec0000">+</span><span style="color:#008900">48</span><span style="color:#008900">h</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00409797</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">dl</span>, <span style="color:#008900">1</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00409799</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">ecx</span><span style="color:#ec0000">+</span><span style="color:#008900">90</span><span style="color:#008900">h</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">0040979</span><span style="color:#008900">F</span>                 <span style="color:#008900">call</span>    <span style="color:#008900">sub_412E88</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">004097</span><span style="color:#008900">A4</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">ebx</span><span style="color:#ec0000">+</span><span style="color:#008900">48</span><span style="color:#008900">h</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">004097</span><span style="color:#008900">A7</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">edx</span>, [<span style="color:#008900">eax</span><span style="color:#ec0000">+</span><span style="color:#008900">90</span><span style="color:#008900">h</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">004097</span><span style="color:#008900">AD</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">word</span> <span style="color:#008900">ptr</span> [<span style="color:#008900">edx</span><span style="color:#ec0000">+</span><span style="color:#008900">0</span><span style="color:#008900">Ch</span>], <span style="color:#008900">1</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">004097</span><span style="color:#008900">B3</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">eax</span><span style="color:#ec0000">+</span><span style="color:#008900">94</span><span style="color:#008900">h</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">004097</span><span style="color:#008900">B9</span>                 <span style="color:#008900">call</span>    <span style="color:#ec0000">@</span><span style="color:#008900">TCollection@Clear</span> ; TCollection::Clear  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text:</span><span style="color:#ec0000">004097</span><span style="color:#5f5fff">BE</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">edx</span>, [<span style="color:#008900">ebx</span><span style="color:#ec0000">+</span><span style="color:#008900">48</span><span style="color:#008900">h</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">004097</span><span style="color:#008900">C1</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">edx</span><span style="color:#ec0000">+</span><span style="color:#008900">94</span><span style="color:#008900">h</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">004097</span><span style="color:#008900">C7</span>                 <span style="color:#008900">call</span>    <span style="color:#008900">sub_412EA8</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">004097</span><span style="color:#008900">CC</span>                 <span style="color:#008900">mov</span>     [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_1C</span>], <span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">004097</span><span style="color:#008900">D2</span>                 <span style="color:#008900">mov</span>     [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_1C</span>], <span style="color:#008900">20</span><span style="color:#008900">h</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">004097</span><span style="color:#008900">D8</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">esi</span>, <span style="color:#008900">eax</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">004097</span><span style="color:#008900">DA</span>                 <span style="color:#008900">lea</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_8</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">004097</span><span style="color:#008900">DD</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">edx</span>, <span style="color:#008900">offset</span> <span style="color:#008900">aWww_microsoft_</span> ; &#34;www.microsoft.com&#34; 
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text:</span><span style="color:#ec0000">004097</span><span style="color:#5f5fff">E2</span>                 <span style="color:#008900">call</span>    <span style="color:#ec0000">@</span><span style="color:#008900">System@AnsiString@$bctr$qqrpxc</span> ; System::AnsiString::AnsiString(char *)  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text:</span><span style="color:#ec0000">004097</span><span style="color:#5f5fff">E7</span>                 <span style="color:#008900">inc</span>     [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_10</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">004097</span><span style="color:#008900">EA</span>                 <span style="color:#008900">lea</span>     <span style="color:#008900">edx</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_8</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">004097</span><span style="color:#008900">ED</span>                 <span style="color:#008900">lea</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">esi</span><span style="color:#ec0000">+</span><span style="color:#008900">10</span><span style="color:#008900">h</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">004097</span><span style="color:#008900">F0</span>                 <span style="color:#008900">call</span>    <span style="color:#008900">sub_4A0484</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">004097</span><span style="color:#008900">F5</span>                 <span style="color:#008900">dec</span>     [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_10</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">004097</span><span style="color:#008900">F8</span>                 <span style="color:#008900">lea</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_8</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">004097</span><span style="color:#008900">FB</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">edx</span>, <span style="color:#008900">2</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00409800</span>                 <span style="color:#008900">call</span>    <span style="color:#ec0000">@</span><span style="color:#008900">System@AnsiString@$bdtr$qqrv</span> ; System::AnsiString::~AnsiString(void)  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text:</span><span style="color:#ec0000">00409805</span>                 <span style="color:#5f5fff">mov</span>     <span style="color:#008900">word</span> <span style="color:#008900">ptr</span> [<span style="color:#008900">esi</span><span style="color:#ec0000">+</span><span style="color:#008900">14</span><span style="color:#008900">h</span>], <span style="color:#008900">1</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">0040980</span><span style="color:#008900">B</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">word</span> <span style="color:#008900">ptr</span> [<span style="color:#008900">esi</span><span style="color:#ec0000">+</span><span style="color:#008900">0</span><span style="color:#008900">Ch</span>], <span style="color:#008900">1</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00409811</span>                 <span style="color:#008900">call</span>    <span style="color:#ec0000">@</span><span style="color:#008900">GetCurrentTime</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00409816</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">esi</span>, <span style="color:#008900">eax</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00409818</span>                 <span style="color:#008900">mov</span>     [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_1C</span>], <span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">0040981</span><span style="color:#008900">E</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">ebx</span><span style="color:#ec0000">+</span><span style="color:#008900">48</span><span style="color:#008900">h</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00409821</span>                 <span style="color:#008900">call</span>    <span style="color:#008900">sub_413174</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00409826</span>                 <span style="color:#008900">call</span>    <span style="color:#ec0000">@</span><span style="color:#008900">GetCurrentTime</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">0040982</span><span style="color:#008900">B</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">ebx</span>, <span style="color:#008900">eax</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">0040982</span><span style="color:#008900">D</span>                 <span style="color:#008900">sub</span>     <span style="color:#008900">ebx</span>, <span style="color:#008900">esi</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">0040982</span><span style="color:#008900">F</span>                 <span style="color:#008900">mov</span>     [<span style="color:#008900">edi</span>], <span style="color:#008900">ebx</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00409831</span>                 <span style="color:#008900">cmp</span>     <span style="color:#008900">ebx</span>, <span style="color:#008900">1</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00409834</span>                 <span style="color:#008900">jnb</span>     <span style="color:#008900">short</span> <span style="color:#008900">loc_40983C</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00409836</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> [<span style="color:#008900">edi</span>], <span style="color:#008900">1</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">0040983</span><span style="color:#008900">C</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">0040983</span><span style="color:#008900">C</span> <span style="color:#008900">loc_40983C</span>:                             ; CODE XREF: FUNC2+128 j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text:</span><span style="color:#ec0000">0040983</span><span style="color:#5f5fff">C</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">al</span>, <span style="color:#008900">1</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">0040983</span><span style="color:#008900">E</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">edx</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_2C</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00409841</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">large</span> <span style="color:#008900">fs</span>:<span style="color:#008900">0</span>, <span style="color:#008900">edx</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00409848</span>                 <span style="color:#008900">jmp</span>     <span style="color:#008900">short</span> <span style="color:#008900">loc_409869</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">0040984</span><span style="color:#008900">A</span> ; ---------------------------------------------------------------------------  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text:</span><span style="color:#ec0000">0040984</span><span style="color:#5f5fff">A</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">0040984</span><span style="color:#008900">A</span> <span style="color:#008900">loc_40984A</span>:                             ; CODE XREF: FUNC2+24 j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text:</span><span style="color:#ec0000">0040984</span><span style="color:#5f5fff">A</span>                 <span style="color:#008900">mov</span>     [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_1C</span>], <span style="color:#008900">0</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00409850</span>                 <span style="color:#008900">jmp</span>     <span style="color:#008900">short</span> <span style="color:#008900">loc_40985D</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00409852</span> ; ---------------------------------------------------------------------------  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text:</span><span style="color:#ec0000">00409852</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text:</span><span style="color:#ec0000">00409852</span> <span style="color:#ec0000">loc_409852:</span>                             ; DATA XREF: .data:fastdns___CPPdebugHook+1051C o  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text:</span><span style="color:#ec0000">00409852</span>                 <span style="color:#5f5fff">mov</span>     [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_1C</span>], <span style="color:#008900">10</span><span style="color:#008900">h</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00409858</span>                 <span style="color:#008900">call</span>    <span style="color:#ec0000">@</span><span style="color:#008900">_CatchCleanup$qv</span> ; _CatchCleanup(void)  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text:</span><span style="color:#ec0000">0040985</span><span style="color:#5f5fff">D</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">0040985</span><span style="color:#008900">D</span> <span style="color:#008900">loc_40985D</span>:                             ; CODE XREF: FUNC2+144 j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text:</span><span style="color:#ec0000">0040985</span><span style="color:#5f5fff">D</span>                 <span style="color:#008900">xor</span>     <span style="color:#008900">eax</span>, <span style="color:#008900">eax</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">0040985</span><span style="color:#008900">F</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">edx</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_2C</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00409862</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">large</span> <span style="color:#008900">fs</span>:<span style="color:#008900">0</span>, <span style="color:#008900">edx</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00409869</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00409869</span> <span style="color:#008900">loc_409869</span>:                             ; CODE XREF: FUNC2+13C j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text:</span><span style="color:#ec0000">00409869</span>                 <span style="color:#5f5fff">pop</span>     <span style="color:#008900">edi</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">0040986</span><span style="color:#008900">A</span>                 <span style="color:#008900">pop</span>     <span style="color:#008900">esi</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">0040986</span><span style="color:#008900">B</span>                 <span style="color:#008900">pop</span>     <span style="color:#008900">ebx</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">0040986</span><span style="color:#008900">C</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">esp</span>, <span style="color:#008900">ebp</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">0040986</span><span style="color:#008900">E</span>                 <span style="color:#008900">pop</span>     <span style="color:#008900">ebp</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">0040986</span><span style="color:#008900">F</span>                 <span style="color:#008900">retn</span> 
</span></span></code></pre></div><p>本段程序构造某网络包类，sub_413174为真正执行代码，在其前后取时间进行测速：</p>
<div class="highlight"><pre tabindex="0" style="color:#757575;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Asm" data-lang="Asm"><span style="display:flex;"><span><span style="color:#ec0000">text:</span><span style="color:#ec0000">00413174</span> <span style="color:#5f5fff">sub_413174</span>      <span style="color:#008900">proc</span> <span style="color:#008900">near</span>               ; CODE XREF: FUNC2+115 p  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text:</span><span style="color:#ec0000">00413174</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text:</span><span style="color:#ec0000">00413174</span> <span style="color:#5f5fff">var_8</span>           <span style="color:#ec0000">=</span> <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> -<span style="color:#008900">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00413174</span> <span style="color:#008900">var_4</span>           <span style="color:#ec0000">=</span> <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> -<span style="color:#008900">4</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00413174</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00413174</span>                 <span style="color:#008900">push</span>    <span style="color:#008900">ebp</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00413175</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">ebp</span>, <span style="color:#008900">esp</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00413177</span>                 <span style="color:#008900">add</span>     <span style="color:#008900">esp</span>, <span style="color:#008900">0</span><span style="color:#008900">FFFFFFF8h</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">0041317</span><span style="color:#008900">A</span>                 <span style="color:#008900">xor</span>     <span style="color:#008900">edx</span>, <span style="color:#008900">edx</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">0041317</span><span style="color:#008900">C</span>                 <span style="color:#008900">mov</span>     [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_8</span>], <span style="color:#008900">edx</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">0041317</span><span style="color:#008900">F</span>                 <span style="color:#008900">mov</span>     [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_4</span>], <span style="color:#008900">eax</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00413182</span>                 <span style="color:#008900">xor</span>     <span style="color:#008900">eax</span>, <span style="color:#008900">eax</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00413184</span>                 <span style="color:#008900">push</span>    <span style="color:#008900">ebp</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00413185</span>                 <span style="color:#008900">push</span>    <span style="color:#008900">offset</span> <span style="color:#008900">loc_413208</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">0041318</span><span style="color:#008900">A</span>                 <span style="color:#008900">push</span>    <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> <span style="color:#008900">fs</span>:[<span style="color:#008900">eax</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">0041318</span><span style="color:#008900">D</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">fs</span>:[<span style="color:#008900">eax</span>], <span style="color:#008900">esp</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00413190</span>                 <span style="color:#008900">xor</span>     <span style="color:#008900">eax</span>, <span style="color:#008900">eax</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00413192</span>                 <span style="color:#008900">push</span>    <span style="color:#008900">ebp</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00413193</span>                 <span style="color:#008900">push</span>    <span style="color:#008900">offset</span> <span style="color:#008900">loc_4131EB</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00413198</span>                 <span style="color:#008900">push</span>    <span style="color:#008900">dword</span> <span style="color:#008900">ptr</span> <span style="color:#008900">fs</span>:[<span style="color:#008900">eax</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">0041319</span><span style="color:#008900">B</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">fs</span>:[<span style="color:#008900">eax</span>], <span style="color:#008900">esp</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">0041319</span><span style="color:#008900">E</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">004131</span><span style="color:#008900">A1</span>                 <span style="color:#008900">call</span>    <span style="color:#008900">sub_413470</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">004131</span><span style="color:#008900">A6</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">004131</span><span style="color:#008900">A9</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">edx</span>, [<span style="color:#008900">eax</span><span style="color:#ec0000">+</span><span style="color:#008900">9</span><span style="color:#008900">Ch</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">004131</span><span style="color:#008900">AF</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">004131</span><span style="color:#008900">B2</span>                 <span style="color:#008900">call</span>    <span style="color:#ec0000">@</span><span style="color:#008900">TIdUDPClient@Send</span> ; TIdUDPClient::Send  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text:</span><span style="color:#ec0000">004131</span><span style="color:#5f5fff">B7</span>                 <span style="color:#008900">lea</span>     <span style="color:#008900">ecx</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_8</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">004131</span><span style="color:#008900">BA</span>                 <span style="color:#008900">or</span>      <span style="color:#008900">edx</span>, <span style="color:#008900">0</span><span style="color:#008900">FFFFFFFFh</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">004131</span><span style="color:#008900">BD</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">004131</span><span style="color:#008900">C0</span>                 <span style="color:#008900">call</span>    <span style="color:#ec0000">@</span><span style="color:#008900">TIdUDPBase@ReceiveString</span> ; TIdUDPBase::ReceiveString  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text:</span><span style="color:#ec0000">004131</span><span style="color:#5f5fff">C5</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">edx</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_8</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">004131</span><span style="color:#008900">C8</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">004131</span><span style="color:#008900">CB</span>                 <span style="color:#008900">add</span>     <span style="color:#008900">eax</span>, <span style="color:#008900">0</span><span style="color:#008900">A0h</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">004131</span><span style="color:#008900">D0</span>                 <span style="color:#008900">call</span>    <span style="color:#ec0000">@@</span><span style="color:#008900">LStrAsg</span>       ; __linkproc__ LStrAsg  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text:</span><span style="color:#ec0000">004131</span><span style="color:#5f5fff">D5</span>                 <span style="color:#008900">xor</span>     <span style="color:#008900">eax</span>, <span style="color:#008900">eax</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">004131</span><span style="color:#008900">D7</span>                 <span style="color:#008900">pop</span>     <span style="color:#008900">edx</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">004131</span><span style="color:#008900">D8</span>                 <span style="color:#008900">pop</span>     <span style="color:#008900">ecx</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">004131</span><span style="color:#008900">D9</span>                 <span style="color:#008900">pop</span>     <span style="color:#008900">ecx</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">004131</span><span style="color:#008900">DA</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">fs</span>:[<span style="color:#008900">eax</span>], <span style="color:#008900">edx</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">004131</span><span style="color:#008900">DD</span>                 <span style="color:#008900">push</span>    <span style="color:#008900">offset</span> <span style="color:#008900">loc_4131F2</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">004131</span><span style="color:#008900">E2</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">004131</span><span style="color:#008900">E2</span> <span style="color:#008900">loc_4131E2</span>:                             ; CODE XREF: sub_413174+7C j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text:</span><span style="color:#ec0000">004131</span><span style="color:#5f5fff">E2</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_4</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">004131</span><span style="color:#008900">E5</span>                 <span style="color:#008900">call</span>    <span style="color:#008900">sub_414B3C</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">004131</span><span style="color:#008900">EA</span>                 <span style="color:#008900">retn</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">004131</span><span style="color:#008900">EB</span> ; ---------------------------------------------------------------------------  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text:</span><span style="color:#ec0000">004131</span><span style="color:#5f5fff">EB</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">004131</span><span style="color:#008900">EB</span> <span style="color:#008900">loc_4131EB</span>:                             ; DATA XREF: sub_413174+1F o  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text:</span><span style="color:#ec0000">004131</span><span style="color:#5f5fff">EB</span>                 <span style="color:#008900">jmp</span>     <span style="color:#ec0000">@@</span><span style="color:#008900">HandleFinally</span> ; __linkproc__ HandleFinally  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text:</span><span style="color:#ec0000">004131</span><span style="color:#5f5fff">F0</span> ; ---------------------------------------------------------------------------  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text:</span><span style="color:#ec0000">004131</span><span style="color:#5f5fff">F0</span>                 <span style="color:#008900">jmp</span>     <span style="color:#008900">short</span> <span style="color:#008900">loc_4131E2</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">004131</span><span style="color:#008900">F2</span> ; ---------------------------------------------------------------------------  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text:</span><span style="color:#ec0000">004131</span><span style="color:#5f5fff">F2</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">004131</span><span style="color:#008900">F2</span> <span style="color:#008900">loc_4131F2</span>:                             ; CODE XREF: sub_413174+76 j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text:</span><span style="color:#ec0000">004131</span><span style="color:#5f5fff">F2</span>                                         ; DATA XREF: sub_413174+69 o  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text:</span><span style="color:#ec0000">004131</span><span style="color:#5f5fff">F2</span>                 <span style="color:#008900">xor</span>     <span style="color:#008900">eax</span>, <span style="color:#008900">eax</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">004131</span><span style="color:#008900">F4</span>                 <span style="color:#008900">pop</span>     <span style="color:#008900">edx</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">004131</span><span style="color:#008900">F5</span>                 <span style="color:#008900">pop</span>     <span style="color:#008900">ecx</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">004131</span><span style="color:#008900">F6</span>                 <span style="color:#008900">pop</span>     <span style="color:#008900">ecx</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">004131</span><span style="color:#008900">F7</span>                 <span style="color:#008900">mov</span>     <span style="color:#008900">fs</span>:[<span style="color:#008900">eax</span>], <span style="color:#008900">edx</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">004131</span><span style="color:#008900">FA</span>                 <span style="color:#008900">push</span>    <span style="color:#008900">offset</span> <span style="color:#008900">loc_41320F</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">004131</span><span style="color:#008900">FF</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">004131</span><span style="color:#008900">FF</span> <span style="color:#008900">loc_4131FF</span>:                             ; CODE XREF: sub_413174+99 j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text:</span><span style="color:#ec0000">004131</span><span style="color:#5f5fff">FF</span>                 <span style="color:#008900">lea</span>     <span style="color:#008900">eax</span>, [<span style="color:#008900">ebp</span><span style="color:#ec0000">+</span><span style="color:#008900">var_8</span>]  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00413202</span>                 <span style="color:#008900">call</span>    <span style="color:#ec0000">@@</span><span style="color:#008900">LStrClr</span>       ; __linkproc__ LStrClr  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text:</span><span style="color:#ec0000">00413207</span>                 <span style="color:#5f5fff">retn</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00413208</span> ; ---------------------------------------------------------------------------  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text:</span><span style="color:#ec0000">00413208</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text:</span><span style="color:#ec0000">00413208</span> <span style="color:#ec0000">loc_413208:</span>                             ; DATA XREF: sub_413174+11 o  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text:</span><span style="color:#ec0000">00413208</span>                 <span style="color:#5f5fff">jmp</span>     <span style="color:#ec0000">@@</span><span style="color:#008900">HandleFinally</span> ; __linkproc__ HandleFinally  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text:</span><span style="color:#ec0000">0041320</span><span style="color:#5f5fff">D</span> ; ---------------------------------------------------------------------------  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text:</span><span style="color:#ec0000">0041320</span><span style="color:#5f5fff">D</span>                 <span style="color:#008900">jmp</span>     <span style="color:#008900">short</span> <span style="color:#008900">loc_4131FF</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">0041320</span><span style="color:#008900">F</span> ; ---------------------------------------------------------------------------  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text:</span><span style="color:#ec0000">0041320</span><span style="color:#5f5fff">F</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">0041320</span><span style="color:#008900">F</span> <span style="color:#008900">loc_41320F</span>:                             ; CODE XREF: sub_413174+93 j  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text:</span><span style="color:#ec0000">0041320</span><span style="color:#5f5fff">F</span>                                         ; DATA XREF: sub_413174+86 o  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">text:</span><span style="color:#ec0000">0041320</span><span style="color:#5f5fff">F</span>                 <span style="color:#008900">pop</span>     <span style="color:#008900">ecx</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00413210</span>                 <span style="color:#008900">pop</span>     <span style="color:#008900">ecx</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00413211</span>                 <span style="color:#008900">pop</span>     <span style="color:#008900">ebp</span>  
</span></span><span style="display:flex;"><span><span style="color:#008900">text</span>:<span style="color:#008900">00413212</span>                 <span style="color:#008900">retn</span> 
</span></span></code></pre></div><p>  从以上代码可以得知，重要调用有：</p>
<ul>
<li>sub_413470</li>
<li>TIdDNSResolver::Send</li>
<li>TIdDNSResolver::ReceiveString</li>
<li>sub_414B3C</li>
</ul>
<p>  由于调用函数库较多，较为浪费时间，因此这里用WireShark抓取+API break的方式查看网络情况，可以得到如下结果：</p>
<p>启动时：对每个ip做inet_addr<br>
检测时：WSAStartup 101<br>
  socket af=AF_INET type=SOCK_DGRAM protocol=IPPROTO_IP<br>
  setsockopt level=SOL_SOCKET optname=SO_BROADCAST   optval=&quot;\0\0\0\0&quot; optlen=4<br>
  ntohs hostshort=53//DNS<br>
  sendto len=35 flags=0 tolen=sizeof(sockaddr) buf=<br>
    b4 c3 01 00 00 01 00 00-00 00 00 00 03 77 77 77  &hellip;&hellip;&hellip;&hellip;.www<br>
    09 6d 69 63 72 6f 73 6f-66 74 03 63 6f 6d 00 00  .microsoft.com..<br>
    01 00 01                         <br>
    sockaddr=02 00 00 35 04 02 02 01-00 00 00 00 00 00 00 00<br>
  select nfds=0 readfs={1,socket} writefds={0,0} exceptfds={0,0}<br>
    timeout{tv_sec=2 tv_usec=0}<br>
  recvfrom len=8192 flag=0 from=02 00 00 35 04 02 02 01-00 00 00 00 00 00 00 00<br>
    fromlen=sizeof(sockaddr) buf=<br>
    b4 c3 81 80 00 01 00 04-00 00 00 00 03 77 77 77  &hellip;&hellip;&hellip;&hellip;.www<br>
    09 6d 69 63 72 6f 73 6f-66 74 03 63 6f 6d 00 00  .microsoft.com..<br>
    01 00 01 c0 0c 00 05 00-01 00 00 0c fd 00 1a 06  &hellip;&hellip;&hellip;&hellip;&hellip;.</p>
<pre><code>            ntohs hostshort=13568
            shutdown how=SD_SEND
            closesocket
</code></pre>
<h2 id="结果">结果</h2>
<p>  直接使用udp层链接即可，另外按照前面所述，用WinHex可得到ip列表，此时要解决的问题都已解决，可以完整地写一个程序了^_^</p>
<ul>
<li>4.2.2.1,美国 科罗拉多州布隆菲尔德市Level 3通信公司</li>
<li>4.2.2.2,美国 科罗拉多州布隆菲尔德市Level 3通信公司</li>
<li>4.2.2.3,美国 科罗拉多州布隆菲尔德市Level 3通信公司</li>
<li>4.2.2.4,美国 科罗拉多州布隆菲尔德市Level 3通信公司</li>
<li>4.2.2.5,美国 科罗拉多州布隆菲尔德市Level 3通信公司</li>
</ul>
<h2 id="自制dns加速器">自制DNS加速器</h2>
<p>  1500行代码用boost和stl一气呵成，预期可以支持ipv6 dns，批量测试/停止，解析域名镜像（如google），支持大dns库和自定义dns库，甚至以后和代理功能结合到一起。由于是初稿，因此有bug，这里贴出源码，给出工程，望和大家一起探讨改进之处，理论上说这个工具会是很强大的！</p>
<div class="highlight"><pre tabindex="0" style="color:#757575;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span>//functions.h
</span></span><span style="display:flex;"><span>#pragma once  
</span></span><span style="display:flex;"><span>#ifndef FASTERDNS_COMMONHEADER  
</span></span><span style="display:flex;"><span>#define FASTERDNS_COMMONHEADER  
</span></span><span style="display:flex;"><span>#endif  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>#include &lt;string&gt;  
</span></span><span style="display:flex;"><span>#include &lt;vector&gt;  
</span></span><span style="display:flex;"><span>#include &lt;boost/asio.hpp&gt;  
</span></span><span style="display:flex;"><span>#include &lt;boost/function.hpp&gt;  
</span></span><span style="display:flex;"><span>#include &lt;boost/thread/mutex.hpp&gt;  
</span></span><span style="display:flex;"><span>#include &lt;boost/thread.hpp&gt;  
</span></span><span style="display:flex;"><span>#include &lt;boost/thread/detail/thread_group.hpp&gt;  
</span></span><span style="display:flex;"><span>#include &lt;deque&gt;  
</span></span><span style="display:flex;"><span>#include &lt;set&gt;  
</span></span><span style="display:flex;"><span>#include &#34;sqlite3.h&#34;  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>#define DATABASE &#34;dnss.db&#34;  
</span></span><span style="display:flex;"><span>#define CSVDATA &#34;nameservers.csv&#34;  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span><span style="color:#ec0000">class</span> <span style="color:#5f5fff">testSpeedData</span>//每轮测试所用数据  
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">public</span><span style="color:#ec0000">:</span>  
</span></span><span style="display:flex;"><span>    testSpeedData(<span style="color:#5f5fff">char</span><span style="color:#ec0000">*</span> _ip, <span style="color:#5f5fff">char</span><span style="color:#ec0000">*</span> _location) <span style="color:#ec0000">:</span>ip(_ip), location(_location)  
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>        responsetime <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>;  
</span></span><span style="display:flex;"><span>        testtime <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>;  
</span></span><span style="display:flex;"><span>        lefttime <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>;  
</span></span><span style="display:flex;"><span>        failtime <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>;  
</span></span><span style="display:flex;"><span>        timeout <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">public</span><span style="color:#ec0000">:</span>  
</span></span><span style="display:flex;"><span>    std<span style="color:#ec0000">::</span>string ip;//DNS地址  
</span></span><span style="display:flex;"><span>    std<span style="color:#ec0000">::</span>string location;//所在地  
</span></span><span style="display:flex;"><span>    <span style="color:#5f5fff">int</span> responsetime;//总响应时间  
</span></span><span style="display:flex;"><span>    <span style="color:#5f5fff">int</span> testtime;//总测试次数  
</span></span><span style="display:flex;"><span>    <span style="color:#5f5fff">int</span> lefttime;//剩余次数  
</span></span><span style="display:flex;"><span>    <span style="color:#5f5fff">int</span> failtime;//失败次数  
</span></span><span style="display:flex;"><span>    <span style="color:#5f5fff">int</span> timeout;//超时时间  
</span></span><span style="display:flex;"><span>};  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span><span style="color:#ec0000">typedef</span> <span style="color:#5f5fff">int</span>(<span style="color:#ec0000">*</span>DBCALLBACK)(<span style="color:#5f5fff">void</span> <span style="color:#ec0000">*</span>NotUsed, <span style="color:#5f5fff">int</span> argc, <span style="color:#5f5fff">char</span> <span style="color:#ec0000">**</span>argv, <span style="color:#5f5fff">char</span> <span style="color:#ec0000">**</span>azColName);  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">typedef</span> std<span style="color:#ec0000">::</span>vector<span style="color:#ec0000">&lt;</span>std<span style="color:#ec0000">::</span>string<span style="color:#ec0000">&gt;</span> spliter;  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">typedef</span> std<span style="color:#ec0000">::</span>vector<span style="color:#ec0000">&lt;</span>std<span style="color:#ec0000">::</span>pair<span style="color:#ec0000">&lt;</span>std<span style="color:#ec0000">::</span>string,std<span style="color:#ec0000">::</span>string<span style="color:#ec0000">&gt;&gt;</span> dbData;  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>//数据库相关  
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">bool</span> <span style="color:#5f5fff">doadddata</span>(dbData<span style="color:#ec0000">*</span> dataparam, HWND progctrl);  
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">bool</span> <span style="color:#5f5fff">dodeldata</span>(std<span style="color:#ec0000">::</span>vector<span style="color:#ec0000">&lt;</span>std<span style="color:#ec0000">::</span>string<span style="color:#ec0000">&gt;*</span> dataparam, HWND progctrl);  
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">bool</span> <span style="color:#5f5fff">getcount</span>(<span style="color:#5f5fff">int</span><span style="color:#ec0000">&amp;</span> count);  
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">bool</span> <span style="color:#5f5fff">getdata</span>(std<span style="color:#ec0000">::</span>vector<span style="color:#ec0000">&lt;</span>testSpeedData<span style="color:#ec0000">&gt;*</span> dataparam, HWND listctrl, HWND statu, boost<span style="color:#ec0000">::</span>mutex<span style="color:#ec0000">*</span> mu);  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>//网络操作相关  
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">bool</span> <span style="color:#5f5fff">dohttpconnect</span>(<span style="color:#ec0000">const</span> std<span style="color:#ec0000">::</span>string<span style="color:#ec0000">&amp;</span> ip, <span style="color:#5f5fff">uint32_t</span><span style="color:#ec0000">&amp;</span> timeout);  
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">bool</span> <span style="color:#5f5fff">dodnsconnect</span>(<span style="color:#ec0000">const</span> std<span style="color:#ec0000">::</span>string<span style="color:#ec0000">&amp;</span> ip, <span style="color:#5f5fff">uint32_t</span><span style="color:#ec0000">&amp;</span> timeout, std<span style="color:#ec0000">::</span>vector<span style="color:#ec0000">&lt;</span><span style="color:#5f5fff">uint8_t</span><span style="color:#ec0000">&gt;&amp;</span> bufferdata);  
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">void</span> <span style="color:#5f5fff">makedns</span>(std<span style="color:#ec0000">::</span>vector<span style="color:#ec0000">&lt;</span><span style="color:#5f5fff">uint8_t</span><span style="color:#ec0000">&gt;&amp;</span> bufferdata, <span style="color:#ec0000">const</span> std<span style="color:#ec0000">::</span>string<span style="color:#ec0000">&amp;</span> testdomain);  
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">void</span> <span style="color:#5f5fff">replaceXid</span>(std<span style="color:#ec0000">::</span>vector<span style="color:#ec0000">&lt;</span><span style="color:#5f5fff">uint8_t</span><span style="color:#ec0000">&gt;&amp;</span> bufferdata, <span style="color:#5f5fff">uint16_t</span> Xid);  
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">void</span> <span style="color:#5f5fff">resolveAnswer</span>(std<span style="color:#ec0000">::</span>vector<span style="color:#ec0000">&lt;</span><span style="color:#5f5fff">uint8_t</span><span style="color:#ec0000">&gt;&amp;</span> bufferdata, std<span style="color:#ec0000">::</span>set<span style="color:#ec0000">&lt;</span>std<span style="color:#ec0000">::</span>string<span style="color:#ec0000">&gt;&amp;</span> resolvedip, <span style="color:#5f5fff">int</span> originlen);  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>//系统设置相关  
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">bool</span> <span style="color:#5f5fff">getinterface</span>(std<span style="color:#ec0000">::</span>vector<span style="color:#ec0000">&lt;</span>std<span style="color:#ec0000">::</span>string<span style="color:#ec0000">&gt;&amp;</span> interfaces);  
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">bool</span> <span style="color:#5f5fff">setinterface</span>(std<span style="color:#ec0000">::</span>vector<span style="color:#ec0000">&lt;</span>std<span style="color:#ec0000">::</span>string<span style="color:#ec0000">&gt;&amp;</span> interfaces, std<span style="color:#ec0000">::</span>vector<span style="color:#ec0000">&lt;</span>std<span style="color:#ec0000">::</span>string<span style="color:#ec0000">&gt;&amp;</span> addresss, HWND progctrl);  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span><span style="color:#ec0000">enum</span> 
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span>    //解析CSV数据文件  
</span></span><span style="display:flex;"><span>    CSV_IP <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>,  
</span></span><span style="display:flex;"><span>    CSV_NAME,  
</span></span><span style="display:flex;"><span>    CSV_COUNTRYID,  
</span></span><span style="display:flex;"><span>    CSV_CITY,  
</span></span><span style="display:flex;"><span>    CSV_MAX,  
</span></span><span style="display:flex;"><span>    //解析普通数据文件  
</span></span><span style="display:flex;"><span>    COM_IP <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>,  
</span></span><span style="display:flex;"><span>    COM_LOCATION,  
</span></span><span style="display:flex;"><span>    COM_MAX,  
</span></span><span style="display:flex;"><span>    //端口  
</span></span><span style="display:flex;"><span>    PORT_HTTP <span style="color:#ec0000">=</span> <span style="color:#008900">80</span>,  
</span></span><span style="display:flex;"><span>    PORT_DNS <span style="color:#ec0000">=</span> <span style="color:#008900">53</span>,  
</span></span><span style="display:flex;"><span>    //DNS包  
</span></span><span style="display:flex;"><span>    SIZE_DNSHEADER <span style="color:#ec0000">=</span> <span style="color:#ec0000">sizeof</span>(DNS_HEADER),  
</span></span><span style="display:flex;"><span>    SIZE_DNSTAILER <span style="color:#ec0000">=</span> <span style="color:#008900">5</span>,  
</span></span><span style="display:flex;"><span>    //值域  
</span></span><span style="display:flex;"><span>    INIT_THREADNUM <span style="color:#ec0000">=</span> <span style="color:#008900">1</span>,  
</span></span><span style="display:flex;"><span>    LOW_THREADNUM <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>,  
</span></span><span style="display:flex;"><span>    HIGH_THREADNUM <span style="color:#ec0000">=</span> <span style="color:#008900">1000</span>,  
</span></span><span style="display:flex;"><span>    INIT_TIMEOUT <span style="color:#ec0000">=</span> <span style="color:#008900">1000</span>,  
</span></span><span style="display:flex;"><span>    LOW_TIMEOUT <span style="color:#ec0000">=</span> <span style="color:#008900">10</span>,  
</span></span><span style="display:flex;"><span>    HIGH_TIMEOUT <span style="color:#ec0000">=</span> <span style="color:#008900">10000</span>,  
</span></span><span style="display:flex;"><span>    INIT_TESTNUM <span style="color:#ec0000">=</span> <span style="color:#008900">1</span>,  
</span></span><span style="display:flex;"><span>    LOW_TESTNUM <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>,  
</span></span><span style="display:flex;"><span>    HIGH_TESTNUM <span style="color:#ec0000">=</span> <span style="color:#008900">100</span>,  
</span></span><span style="display:flex;"><span>    //显示列  
</span></span><span style="display:flex;"><span>    COL_IP <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>,  
</span></span><span style="display:flex;"><span>    COL_LOC,  
</span></span><span style="display:flex;"><span>    COL_RES,//平均响应时间  
</span></span><span style="display:flex;"><span>    COL_FAIL,//失败次数/总次数  
</span></span><span style="display:flex;"><span>    //其他  
</span></span><span style="display:flex;"><span>    IDC_PROGRESS <span style="color:#ec0000">=</span> <span style="color:#008900">12345</span>,  
</span></span><span style="display:flex;"><span>    MAX_DOMAIN_LENGTH <span style="color:#ec0000">=</span> <span style="color:#008900">256</span>,  
</span></span><span style="display:flex;"><span>    MAXS_RECVNUM <span style="color:#ec0000">=</span> <span style="color:#008900">65536</span>,  
</span></span><span style="display:flex;"><span>    HTTP_CONNECTTIME <span style="color:#ec0000">=</span> <span style="color:#008900">5000</span>,  
</span></span><span style="display:flex;"><span>    TIMER1_ID<span style="color:#ec0000">=</span><span style="color:#008900">10000</span>,  
</span></span><span style="display:flex;"><span>};  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span><span style="color:#ec0000">class</span> <span style="color:#5f5fff">ipcontainer</span><span style="color:#ec0000">:</span><span style="color:#ec0000">public</span> boost<span style="color:#ec0000">::</span>noncopyable  
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">public</span><span style="color:#ec0000">:</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">static</span> ipcontainer<span style="color:#ec0000">&amp;</span> getInstance();  
</span></span><span style="display:flex;"><span>    <span style="color:#5f5fff">bool</span> <span style="color:#5f5fff">adddata</span>(<span style="color:#ec0000">const</span> std<span style="color:#ec0000">::</span>string<span style="color:#ec0000">&amp;</span> ip, <span style="color:#ec0000">const</span> std<span style="color:#ec0000">::</span>string<span style="color:#ec0000">&amp;</span> addr);  
</span></span><span style="display:flex;"><span>    <span style="color:#5f5fff">bool</span> <span style="color:#5f5fff">deldata</span>(<span style="color:#ec0000">const</span> std<span style="color:#ec0000">::</span>string<span style="color:#ec0000">&amp;</span> ip);  
</span></span><span style="display:flex;"><span>    <span style="color:#5f5fff">bool</span> <span style="color:#5f5fff">getdata</span>(std<span style="color:#ec0000">::</span>vector<span style="color:#ec0000">&lt;</span>testSpeedData<span style="color:#ec0000">&gt;*</span> dataparam,HWND listctrl);  
</span></span><span style="display:flex;"><span>    <span style="color:#5f5fff">bool</span> <span style="color:#5f5fff">getcount</span>(<span style="color:#5f5fff">int</span><span style="color:#ec0000">&amp;</span> pcount);  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">virtual</span> <span style="color:#ec0000">~</span>ipcontainer();  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">private</span><span style="color:#ec0000">:</span>  
</span></span><span style="display:flex;"><span>    ipcontainer();  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">static</span> <span style="color:#5f5fff">int</span> <span style="color:#5f5fff">getdatacallback</span>(<span style="color:#5f5fff">void</span> <span style="color:#ec0000">*</span>NotUsed, <span style="color:#5f5fff">int</span> argc, <span style="color:#5f5fff">char</span> <span style="color:#ec0000">**</span>argv, <span style="color:#5f5fff">char</span> <span style="color:#ec0000">**</span>azColName);  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">static</span> <span style="color:#5f5fff">int</span> <span style="color:#5f5fff">getcountcallback</span>(<span style="color:#5f5fff">void</span> <span style="color:#ec0000">*</span>NotUsed, <span style="color:#5f5fff">int</span> argc, <span style="color:#5f5fff">char</span> <span style="color:#ec0000">**</span>argv, <span style="color:#5f5fff">char</span> <span style="color:#ec0000">**</span>azColName);  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">private</span><span style="color:#ec0000">:</span>  
</span></span><span style="display:flex;"><span>    sqlite3<span style="color:#ec0000">*</span> db;  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">static</span> <span style="color:#5f5fff">int</span><span style="color:#ec0000">*</span> pcount;  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">static</span> std<span style="color:#ec0000">::</span>vector<span style="color:#ec0000">&lt;</span>testSpeedData<span style="color:#ec0000">&gt;*</span> testdata;  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">static</span> HWND pwnd;  
</span></span><span style="display:flex;"><span>};  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span><span style="color:#ec0000">template</span><span style="color:#ec0000">&lt;</span><span style="color:#ec0000">typename</span> D<span style="color:#ec0000">&gt;</span>  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">class</span> <span style="color:#5f5fff">ThreadPool</span>  
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">public</span><span style="color:#ec0000">:</span>  
</span></span><span style="display:flex;"><span>    ThreadPool(boost<span style="color:#ec0000">::</span>mutex<span style="color:#ec0000">&amp;</span> _mu) <span style="color:#ec0000">:</span>mu(_mu)  
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>        threadnum <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>;  
</span></span><span style="display:flex;"><span>        task <span style="color:#ec0000">=</span> <span style="color:#ec0000">NULL</span>;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">virtual</span> <span style="color:#ec0000">~</span>ThreadPool()  
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">if</span> (ppio)  
</span></span><span style="display:flex;"><span>        {  
</span></span><span style="display:flex;"><span>            <span style="color:#ec0000">for</span> (<span style="color:#5f5fff">int</span> i <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>; i <span style="color:#ec0000">&lt;</span> threadnum; i<span style="color:#ec0000">++</span>)  
</span></span><span style="display:flex;"><span>                <span style="color:#ec0000">delete</span> ppio[i];  
</span></span><span style="display:flex;"><span>            <span style="color:#ec0000">delete</span>[]ppio;  
</span></span><span style="display:flex;"><span>        }  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>    <span style="color:#5f5fff">bool</span> <span style="color:#5f5fff">Attach</span>(<span style="color:#5f5fff">int</span> _threadnum, std<span style="color:#ec0000">::</span>deque<span style="color:#ec0000">&lt;</span><span style="color:#5f5fff">int</span><span style="color:#ec0000">&gt;*</span> _task, std<span style="color:#ec0000">::</span>vector<span style="color:#ec0000">&lt;</span>D<span style="color:#ec0000">&gt;*</span> _dataarray, HWND _listview)  
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">if</span> (<span style="color:#ec0000">!</span>_task <span style="color:#ec0000">||</span> _task<span style="color:#ec0000">-&gt;</span>empty() <span style="color:#ec0000">||</span> <span style="color:#ec0000">!</span>_dataarray)  
</span></span><span style="display:flex;"><span>            <span style="color:#ec0000">return</span> <span style="color:#ec0000">false</span>;//任务未结束  
</span></span><span style="display:flex;"><span>        task <span style="color:#ec0000">=</span> _task;  
</span></span><span style="display:flex;"><span>        dataarray <span style="color:#ec0000">=</span> _dataarray;  
</span></span><span style="display:flex;"><span>        threadnum <span style="color:#ec0000">=</span> _threadnum;  
</span></span><span style="display:flex;"><span>        listview <span style="color:#ec0000">=</span> _listview;  
</span></span><span style="display:flex;"><span>        ppio <span style="color:#ec0000">=</span> <span style="color:#ec0000">new</span> boost<span style="color:#ec0000">::</span>asio<span style="color:#ec0000">::</span>io_service<span style="color:#ec0000">*</span>[threadnum];  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">if</span> (<span style="color:#ec0000">!</span>ppio)  
</span></span><span style="display:flex;"><span>            <span style="color:#ec0000">return</span> <span style="color:#ec0000">false</span>;  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">for</span> (<span style="color:#5f5fff">int</span> i <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>; i <span style="color:#ec0000">&lt;</span> threadnum; i<span style="color:#ec0000">++</span>)  
</span></span><span style="display:flex;"><span>        {  
</span></span><span style="display:flex;"><span>            ppio[i] <span style="color:#ec0000">=</span> <span style="color:#ec0000">new</span> boost<span style="color:#ec0000">::</span>asio<span style="color:#ec0000">::</span>io_service;  
</span></span><span style="display:flex;"><span>            <span style="color:#ec0000">if</span> (<span style="color:#ec0000">!</span>ppio[i])//模拟new[]的行为，释放之前成功分配的内存  
</span></span><span style="display:flex;"><span>            {  
</span></span><span style="display:flex;"><span>                <span style="color:#ec0000">for</span> (<span style="color:#5f5fff">int</span> j <span style="color:#ec0000">=</span> i<span style="color:#ec0000">-</span><span style="color:#008900">1</span>; j <span style="color:#ec0000">&gt;=</span> <span style="color:#008900">0</span>; j<span style="color:#ec0000">--</span>)  
</span></span><span style="display:flex;"><span>                    <span style="color:#ec0000">delete</span> ppio[j];  
</span></span><span style="display:flex;"><span>                <span style="color:#ec0000">delete</span>[]ppio;  
</span></span><span style="display:flex;"><span>                <span style="color:#ec0000">return</span> <span style="color:#ec0000">false</span>;  
</span></span><span style="display:flex;"><span>            }  
</span></span><span style="display:flex;"><span>        }  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">return</span> <span style="color:#ec0000">true</span>;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>    <span style="color:#5f5fff">bool</span> <span style="color:#5f5fff">Exec</span>(<span style="color:#5f5fff">void</span>(<span style="color:#ec0000">*</span>f)(<span style="color:#5f5fff">int</span>, std<span style="color:#ec0000">::</span>vector<span style="color:#ec0000">&lt;</span>D<span style="color:#ec0000">&gt;*</span>, HWND))  
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">try</span> 
</span></span><span style="display:flex;"><span>        {  
</span></span><span style="display:flex;"><span>            boost<span style="color:#ec0000">::</span>thread_group tg;  
</span></span><span style="display:flex;"><span>            //建立线程组  
</span></span><span style="display:flex;"><span>            <span style="color:#ec0000">for</span> (<span style="color:#5f5fff">int</span> i <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>; i <span style="color:#ec0000">&lt;</span> threadnum; i<span style="color:#ec0000">++</span>)  
</span></span><span style="display:flex;"><span>            {  
</span></span><span style="display:flex;"><span>                tg.create_thread(boost<span style="color:#ec0000">::</span>bind(<span style="color:#ec0000">&amp;</span>ThreadPool<span style="color:#ec0000">::</span>wrapper, <span style="color:#ec0000">this</span>, ppio[i],f));  
</span></span><span style="display:flex;"><span>            }  
</span></span><span style="display:flex;"><span>            //等待所有任务执行完毕  
</span></span><span style="display:flex;"><span>            tg.join_all();  
</span></span><span style="display:flex;"><span>        }  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">catch</span> (...)  
</span></span><span style="display:flex;"><span>        {  
</span></span><span style="display:flex;"><span>            //确保释放new  
</span></span><span style="display:flex;"><span>            <span style="color:#ec0000">return</span> <span style="color:#ec0000">false</span>;  
</span></span><span style="display:flex;"><span>        }  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">return</span> <span style="color:#ec0000">true</span>;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span><span style="color:#ec0000">private</span><span style="color:#ec0000">:</span>  
</span></span><span style="display:flex;"><span>    //用于将task里的任务分配各给threadnum个活动线程，分配时要进行线程同步  
</span></span><span style="display:flex;"><span>    <span style="color:#5f5fff">void</span> wrapper(boost<span style="color:#ec0000">::</span>asio<span style="color:#ec0000">::</span>io_service<span style="color:#ec0000">*</span> service, <span style="color:#5f5fff">void</span>(<span style="color:#ec0000">*</span>f)(<span style="color:#5f5fff">int</span>, std<span style="color:#ec0000">::</span>vector<span style="color:#ec0000">&lt;</span>D<span style="color:#ec0000">&gt;*</span>, HWND))  
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">while</span> (<span style="color:#ec0000">true</span>)  
</span></span><span style="display:flex;"><span>        {  
</span></span><span style="display:flex;"><span>            mu.lock();  
</span></span><span style="display:flex;"><span>            <span style="color:#ec0000">if</span> (task<span style="color:#ec0000">-&gt;</span>empty())  
</span></span><span style="display:flex;"><span>            {  
</span></span><span style="display:flex;"><span>                mu.unlock();  
</span></span><span style="display:flex;"><span>                <span style="color:#ec0000">return</span>;  
</span></span><span style="display:flex;"><span>            }  
</span></span><span style="display:flex;"><span>            service<span style="color:#ec0000">-&gt;</span>post(boost<span style="color:#ec0000">::</span>bind(f, task<span style="color:#ec0000">-&gt;</span>front(), dataarray, listview));  
</span></span><span style="display:flex;"><span>            task<span style="color:#ec0000">-&gt;</span>pop_front();  
</span></span><span style="display:flex;"><span>            mu.unlock();  
</span></span><span style="display:flex;"><span>            service<span style="color:#ec0000">-&gt;</span>run();  
</span></span><span style="display:flex;"><span>            service<span style="color:#ec0000">-&gt;</span>reset();  
</span></span><span style="display:flex;"><span>        }  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span><span style="color:#ec0000">private</span><span style="color:#ec0000">:</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#5f5fff">int</span> threadnum;  
</span></span><span style="display:flex;"><span>    HWND listview;  
</span></span><span style="display:flex;"><span>    boost<span style="color:#ec0000">::</span>mutex<span style="color:#ec0000">&amp;</span> mu;//分配任务用锁  
</span></span><span style="display:flex;"><span>    std<span style="color:#ec0000">::</span>deque<span style="color:#ec0000">&lt;</span><span style="color:#5f5fff">int</span><span style="color:#ec0000">&gt;*</span> task;//要分配的总任务索引  
</span></span><span style="display:flex;"><span>    std<span style="color:#ec0000">::</span>vector<span style="color:#ec0000">&lt;</span>D<span style="color:#ec0000">&gt;*</span> dataarray;//原始数据  
</span></span><span style="display:flex;"><span>    boost<span style="color:#ec0000">::</span>asio<span style="color:#ec0000">::</span>io_service<span style="color:#ec0000">**</span> ppio;//耗费的线程资源       
</span></span><span style="display:flex;"><span>};  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>#pragma pack(push)  
</span></span><span style="display:flex;"><span>#pragma pack(2)  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">typedef</span> <span style="color:#ec0000">struct</span> <span style="color:#5f5fff">_DNSANSWER_HEADER</span>  
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span>    WORD Name;  
</span></span><span style="display:flex;"><span>    WORD Type;  
</span></span><span style="display:flex;"><span>    WORD Class;  
</span></span><span style="display:flex;"><span>    DWORD Timetolive;  
</span></span><span style="display:flex;"><span>    WORD Datalength;  
</span></span><span style="display:flex;"><span>}DNSANSWER_HEADER, <span style="color:#ec0000">*</span>PDNSANSWER_HEADER;  
</span></span><span style="display:flex;"><span>#pragma pack(pop)  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>#define DNS_BYTE_FLIP_ANSWERHEADER_COUNTS(pHeader)\  
</span></span><span style="display:flex;"><span>    {<span style="color:#ec0000">\</span>  
</span></span><span style="display:flex;"><span>    PDNSANSWER_HEADER _head <span style="color:#ec0000">=</span> (pHeader); <span style="color:#ec0000">\</span>  
</span></span><span style="display:flex;"><span>    INLINE_HTONS(_head<span style="color:#ec0000">-&gt;</span>Name,        _head<span style="color:#ec0000">-&gt;</span>Name);<span style="color:#ec0000">\</span>  
</span></span><span style="display:flex;"><span>    INLINE_HTONS(_head<span style="color:#ec0000">-&gt;</span>Type,        _head<span style="color:#ec0000">-&gt;</span>Type); <span style="color:#ec0000">\</span>  
</span></span><span style="display:flex;"><span>    INLINE_HTONS(_head<span style="color:#ec0000">-&gt;</span>Class,       _head<span style="color:#ec0000">-&gt;</span>Class); <span style="color:#ec0000">\</span>  
</span></span><span style="display:flex;"><span>    INLINE_HTONS(_head<span style="color:#ec0000">-&gt;</span>Timetolive, _head<span style="color:#ec0000">-&gt;</span>Timetolive); <span style="color:#ec0000">\</span>  
</span></span><span style="display:flex;"><span>    INLINE_HTONS(_head<span style="color:#ec0000">-&gt;</span>Datalength, _head<span style="color:#ec0000">-&gt;</span>Datalength); <span style="color:#ec0000">\</span>  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span><span style="color:#ec0000">class</span> <span style="color:#5f5fff">udpclient</span>//只为做超时处理  
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">public</span><span style="color:#ec0000">:</span>  
</span></span><span style="display:flex;"><span>    udpclient(<span style="color:#ec0000">const</span> boost<span style="color:#ec0000">::</span>asio<span style="color:#ec0000">::</span>ip<span style="color:#ec0000">::</span>udp<span style="color:#ec0000">::</span>endpoint<span style="color:#ec0000">&amp;</span> listen_endpoint) <span style="color:#ec0000">:</span>socket_(io_service_, listen_endpoint), deadline_(io_service_)  
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>        deadline_.expires_at(boost<span style="color:#ec0000">::</span>posix_time<span style="color:#ec0000">::</span>pos_infin);  
</span></span><span style="display:flex;"><span>        check_deadline();  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    std<span style="color:#ec0000">::</span>size_t receive(<span style="color:#ec0000">const</span> boost<span style="color:#ec0000">::</span>asio<span style="color:#ec0000">::</span>mutable_buffer<span style="color:#ec0000">&amp;</span> buffer, boost<span style="color:#ec0000">::</span>posix_time<span style="color:#ec0000">::</span>time_duration timeout, boost<span style="color:#ec0000">::</span>system<span style="color:#ec0000">::</span>error_code<span style="color:#ec0000">&amp;</span> ec)  
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>        deadline_.expires_from_now(timeout);  
</span></span><span style="display:flex;"><span>        ec <span style="color:#ec0000">=</span> boost<span style="color:#ec0000">::</span>asio<span style="color:#ec0000">::</span>error<span style="color:#ec0000">::</span>would_block;  
</span></span><span style="display:flex;"><span>        std<span style="color:#ec0000">::</span>size_t length <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>;  
</span></span><span style="display:flex;"><span>        socket_.async_receive(boost<span style="color:#ec0000">::</span>asio<span style="color:#ec0000">::</span>buffer(buffer), boost<span style="color:#ec0000">::</span>bind(<span style="color:#ec0000">&amp;</span>udpclient<span style="color:#ec0000">::</span>handle_receive, _1, _2, <span style="color:#ec0000">&amp;</span>ec, <span style="color:#ec0000">&amp;</span>length));  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">do</span> io_service_.run_one(); <span style="color:#ec0000">while</span> (ec <span style="color:#ec0000">==</span> boost<span style="color:#ec0000">::</span>asio<span style="color:#ec0000">::</span>error<span style="color:#ec0000">::</span>would_block);  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">return</span> length;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">private</span><span style="color:#ec0000">:</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#5f5fff">void</span> check_deadline()  
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">if</span> (deadline_.expires_at() <span style="color:#ec0000">&lt;=</span> boost<span style="color:#ec0000">::</span>asio<span style="color:#ec0000">::</span>deadline_timer<span style="color:#ec0000">::</span>traits_type<span style="color:#ec0000">::</span>now())  
</span></span><span style="display:flex;"><span>        {  
</span></span><span style="display:flex;"><span>            socket_.cancel();  
</span></span><span style="display:flex;"><span>            deadline_.expires_at(boost<span style="color:#ec0000">::</span>posix_time<span style="color:#ec0000">::</span>pos_infin);  
</span></span><span style="display:flex;"><span>        }  
</span></span><span style="display:flex;"><span>        deadline_.async_wait(boost<span style="color:#ec0000">::</span>bind(<span style="color:#ec0000">&amp;</span>udpclient<span style="color:#ec0000">::</span>check_deadline, <span style="color:#ec0000">this</span>));  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">static</span> <span style="color:#5f5fff">void</span> <span style="color:#5f5fff">handle_receive</span>(<span style="color:#ec0000">const</span> boost<span style="color:#ec0000">::</span>system<span style="color:#ec0000">::</span>error_code<span style="color:#ec0000">&amp;</span> ec, std<span style="color:#ec0000">::</span>size_t length,  
</span></span><span style="display:flex;"><span>        boost<span style="color:#ec0000">::</span>system<span style="color:#ec0000">::</span>error_code<span style="color:#ec0000">*</span> out_ec, std<span style="color:#ec0000">::</span>size_t<span style="color:#ec0000">*</span> out_length)  
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">*</span>out_ec <span style="color:#ec0000">=</span> ec;  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">*</span>out_length <span style="color:#ec0000">=</span> length;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">private</span><span style="color:#ec0000">:</span>  
</span></span><span style="display:flex;"><span>    boost<span style="color:#ec0000">::</span>asio<span style="color:#ec0000">::</span>io_service io_service_;  
</span></span><span style="display:flex;"><span>    boost<span style="color:#ec0000">::</span>asio<span style="color:#ec0000">::</span>deadline_timer deadline_;  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">public</span><span style="color:#ec0000">:</span>  
</span></span><span style="display:flex;"><span>    boost<span style="color:#ec0000">::</span>asio<span style="color:#ec0000">::</span>ip<span style="color:#ec0000">::</span>udp<span style="color:#ec0000">::</span>socket socket_;  
</span></span><span style="display:flex;"><span>};  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span><span style="color:#ec0000">class</span> <span style="color:#5f5fff">tcpclient</span>//只为做超时处理  
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">public</span><span style="color:#ec0000">:</span>  
</span></span><span style="display:flex;"><span>    tcpclient() <span style="color:#ec0000">:</span>socket_(io_service_), deadline_(io_service_)  
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>        deadline_.expires_at(boost<span style="color:#ec0000">::</span>posix_time<span style="color:#ec0000">::</span>pos_infin);  
</span></span><span style="display:flex;"><span>        check_deadline();  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#5f5fff">void</span> <span style="color:#5f5fff">connect</span>(<span style="color:#ec0000">const</span> boost<span style="color:#ec0000">::</span>asio<span style="color:#ec0000">::</span>ip<span style="color:#ec0000">::</span>tcp<span style="color:#ec0000">::</span>endpoint ep, boost<span style="color:#ec0000">::</span>posix_time<span style="color:#ec0000">::</span>time_duration timeout, boost<span style="color:#ec0000">::</span>system<span style="color:#ec0000">::</span>error_code<span style="color:#ec0000">&amp;</span> ec)  
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>        deadline_.expires_from_now(timeout);  
</span></span><span style="display:flex;"><span>        ec <span style="color:#ec0000">=</span> boost<span style="color:#ec0000">::</span>asio<span style="color:#ec0000">::</span>error<span style="color:#ec0000">::</span>would_block;  
</span></span><span style="display:flex;"><span>        socket_.async_connect(ep,boost<span style="color:#ec0000">::</span>bind(<span style="color:#ec0000">&amp;</span>tcpclient<span style="color:#ec0000">::</span>handle_connect, _1, <span style="color:#ec0000">&amp;</span>ec));  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">do</span> io_service_.run_one(); <span style="color:#ec0000">while</span> (ec <span style="color:#ec0000">==</span> boost<span style="color:#ec0000">::</span>asio<span style="color:#ec0000">::</span>error<span style="color:#ec0000">::</span>would_block);  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">private</span><span style="color:#ec0000">:</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#5f5fff">void</span> check_deadline()  
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">if</span> (deadline_.expires_at() <span style="color:#ec0000">&lt;=</span> boost<span style="color:#ec0000">::</span>asio<span style="color:#ec0000">::</span>deadline_timer<span style="color:#ec0000">::</span>traits_type<span style="color:#ec0000">::</span>now())  
</span></span><span style="display:flex;"><span>        {  
</span></span><span style="display:flex;"><span>            socket_.cancel();  
</span></span><span style="display:flex;"><span>            deadline_.expires_at(boost<span style="color:#ec0000">::</span>posix_time<span style="color:#ec0000">::</span>pos_infin);  
</span></span><span style="display:flex;"><span>        }  
</span></span><span style="display:flex;"><span>        deadline_.async_wait(boost<span style="color:#ec0000">::</span>bind(<span style="color:#ec0000">&amp;</span>tcpclient<span style="color:#ec0000">::</span>check_deadline, <span style="color:#ec0000">this</span>));  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">static</span> <span style="color:#5f5fff">void</span> <span style="color:#5f5fff">handle_connect</span>(<span style="color:#ec0000">const</span> boost<span style="color:#ec0000">::</span>system<span style="color:#ec0000">::</span>error_code<span style="color:#ec0000">&amp;</span> ec, boost<span style="color:#ec0000">::</span>system<span style="color:#ec0000">::</span>error_code<span style="color:#ec0000">*</span> out_ec)  
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">*</span>out_ec <span style="color:#ec0000">=</span> ec;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">private</span><span style="color:#ec0000">:</span>  
</span></span><span style="display:flex;"><span>    boost<span style="color:#ec0000">::</span>asio<span style="color:#ec0000">::</span>io_service io_service_;  
</span></span><span style="display:flex;"><span>    boost<span style="color:#ec0000">::</span>asio<span style="color:#ec0000">::</span>deadline_timer deadline_;  
</span></span><span style="display:flex;"><span><span style="color:#ec0000">public</span><span style="color:#ec0000">:</span>  
</span></span><span style="display:flex;"><span>    boost<span style="color:#ec0000">::</span>asio<span style="color:#ec0000">::</span>ip<span style="color:#ec0000">::</span>tcp<span style="color:#ec0000">::</span>socket socket_;  
</span></span><span style="display:flex;"><span>}; 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>// FasterDNSDlg.cpp : 实现文件  
</span></span><span style="display:flex;"><span>#include &#34;stdafx.h&#34;  
</span></span><span style="display:flex;"><span>#include &#34;FasterDNS.h&#34;  
</span></span><span style="display:flex;"><span>#include &#34;FasterDNSDlg.h&#34;  
</span></span><span style="display:flex;"><span>#include &#34;SetDnsDlg.h&#34;  
</span></span><span style="display:flex;"><span>#include &#34;afxdialogex.h&#34;  
</span></span><span style="display:flex;"><span>#include &lt;boost/scoped_ptr.hpp&gt;  
</span></span><span style="display:flex;"><span>#include &lt;boost/bind.hpp&gt;  
</span></span><span style="display:flex;"><span>#include &lt;boost/thread.hpp&gt;  
</span></span><span style="display:flex;"><span>#include &lt;boost/range.hpp&gt;  
</span></span><span style="display:flex;"><span>#include &lt;boost/algorithm/string.hpp&gt;  
</span></span><span style="display:flex;"><span>#include &lt;boost/xpressive/xpressive.hpp&gt;  
</span></span><span style="display:flex;"><span>#include &lt;boost/asio.hpp&gt;  
</span></span><span style="display:flex;"><span>#include &lt;boost/lexical_cast.hpp&gt;  
</span></span><span style="display:flex;"><span>#include &lt;boost/format.hpp&gt;  
</span></span><span style="display:flex;"><span>#include &lt;queue&gt;  
</span></span><span style="display:flex;"><span>#include &lt;fstream&gt;  
</span></span><span style="display:flex;"><span>#include &lt;set&gt;  
</span></span><span style="display:flex;"><span>#include &#34;functions.h&#34;  
</span></span><span style="display:flex;"><span>#include &lt;stdlib.h&gt;  
</span></span><span style="display:flex;"><span>#include &#34;ShowIp.h&#34;  
</span></span><span style="display:flex;"><span>#include &#34;GlobalSetting.h&#34;  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>#ifdef _DEBUG  
</span></span><span style="display:flex;"><span>#define new DEBUG_NEW  
</span></span><span style="display:flex;"><span>#endif  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>CFasterDNSDlg<span style="color:#ec0000">::</span>CFasterDNSDlg(CWnd<span style="color:#ec0000">*</span> pParent /*=NULL*/)  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">:</span> CDialogEx(CFasterDNSDlg<span style="color:#ec0000">::</span>IDD, pParent)  
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span>    m_hIcon <span style="color:#ec0000">=</span> AfxGetApp()<span style="color:#ec0000">-&gt;</span>LoadIcon(IDR_MAINFRAME);  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">void</span> CFasterDNSDlg<span style="color:#ec0000">::</span>DoDataExchange(CDataExchange<span style="color:#ec0000">*</span> pDX)  
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span>    CDialogEx<span style="color:#ec0000">::</span>DoDataExchange(pDX);  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>BEGIN_MESSAGE_MAP(CFasterDNSDlg, CDialogEx)  
</span></span><span style="display:flex;"><span>    ON_WM_PAINT()  
</span></span><span style="display:flex;"><span>    ON_BN_CLICKED(IDC_ADDDNS, <span style="color:#ec0000">&amp;</span>CFasterDNSDlg<span style="color:#ec0000">::</span>OnBnClickedAddDNS)  
</span></span><span style="display:flex;"><span>    ON_NOTIFY(LVN_GETDISPINFO, IDC_IPLIST, <span style="color:#ec0000">&amp;</span>CFasterDNSDlg<span style="color:#ec0000">::</span>OnLvnGetdispinfoIplist)  
</span></span><span style="display:flex;"><span>    ON_COMMAND(ID_ABOUT, <span style="color:#ec0000">&amp;</span>CFasterDNSDlg<span style="color:#ec0000">::</span>OnAbout)  
</span></span><span style="display:flex;"><span>    ON_COMMAND(ID_SETDNS, <span style="color:#ec0000">&amp;</span>CFasterDNSDlg<span style="color:#ec0000">::</span>OnSetdns)  
</span></span><span style="display:flex;"><span>    ON_NOTIFY(HDN_ITEMCLICK, <span style="color:#008900">0</span>, <span style="color:#ec0000">&amp;</span>CFasterDNSDlg<span style="color:#ec0000">::</span>OnHdnItemclickIplist)  
</span></span><span style="display:flex;"><span>    ON_NOTIFY(NM_RCLICK, IDC_IPLIST, <span style="color:#ec0000">&amp;</span>CFasterDNSDlg<span style="color:#ec0000">::</span>OnNMRClickIplist)  
</span></span><span style="display:flex;"><span>    ON_COMMAND(ID_DELDNS, <span style="color:#ec0000">&amp;</span>CFasterDNSDlg<span style="color:#ec0000">::</span>OnDeldns)  
</span></span><span style="display:flex;"><span>    ON_BN_CLICKED(IDC_ALLINONE, <span style="color:#ec0000">&amp;</span>CFasterDNSDlg<span style="color:#ec0000">::</span>OnBnClickedAllinone)  
</span></span><span style="display:flex;"><span>    ON_BN_CLICKED(IDC_START, <span style="color:#ec0000">&amp;</span>CFasterDNSDlg<span style="color:#ec0000">::</span>OnBnClickedStart)  
</span></span><span style="display:flex;"><span>    ON_BN_CLICKED(IDC_STOP, <span style="color:#ec0000">&amp;</span>CFasterDNSDlg<span style="color:#ec0000">::</span>OnBnClickedStop)  
</span></span><span style="display:flex;"><span>    ON_BN_CLICKED(IDC_VIEWIP, <span style="color:#ec0000">&amp;</span>CFasterDNSDlg<span style="color:#ec0000">::</span>OnBnClickedViewip)  
</span></span><span style="display:flex;"><span>    ON_WM_TIMER()  
</span></span><span style="display:flex;"><span>    ON_COMMAND(ID_ADDDNS, <span style="color:#ec0000">&amp;</span>CFasterDNSDlg<span style="color:#ec0000">::</span>OnAdddns)  
</span></span><span style="display:flex;"><span>    ON_COMMAND(ID_MODIFY, <span style="color:#ec0000">&amp;</span>CFasterDNSDlg<span style="color:#ec0000">::</span>OnModify)  
</span></span><span style="display:flex;"><span>    ON_COMMAND(ID_STARTALL, <span style="color:#ec0000">&amp;</span>CFasterDNSDlg<span style="color:#ec0000">::</span>OnStartall)  
</span></span><span style="display:flex;"><span>    ON_COMMAND(ID_STOPALL, <span style="color:#ec0000">&amp;</span>CFasterDNSDlg<span style="color:#ec0000">::</span>OnStopall)  
</span></span><span style="display:flex;"><span>    ON_COMMAND(ID_TESTIP, <span style="color:#ec0000">&amp;</span>CFasterDNSDlg<span style="color:#ec0000">::</span>OnTestip)  
</span></span><span style="display:flex;"><span>    ON_COMMAND(ID_EXIT, <span style="color:#ec0000">&amp;</span>CFasterDNSDlg<span style="color:#ec0000">::</span>OnExit)  
</span></span><span style="display:flex;"><span>    ON_COMMAND(ID_ALLINONE, <span style="color:#ec0000">&amp;</span>CFasterDNSDlg<span style="color:#ec0000">::</span>OnAllinone)  
</span></span><span style="display:flex;"><span>    ON_COMMAND(ID_START, <span style="color:#ec0000">&amp;</span>CFasterDNSDlg<span style="color:#ec0000">::</span>OnStart)  
</span></span><span style="display:flex;"><span>    ON_COMMAND(ID_STOP, <span style="color:#ec0000">&amp;</span>CFasterDNSDlg<span style="color:#ec0000">::</span>OnStop)  
</span></span><span style="display:flex;"><span>END_MESSAGE_MAP()  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>BOOL CFasterDNSDlg<span style="color:#ec0000">::</span>OnInitDialog()  
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span>    CDialogEx<span style="color:#ec0000">::</span>OnInitDialog();  
</span></span><span style="display:flex;"><span>    SetIcon(m_hIcon, TRUE);         // 设置大图标  
</span></span><span style="display:flex;"><span>    SetIcon(m_hIcon, FALSE);        // 设置小图标  
</span></span><span style="display:flex;"><span>    m_list <span style="color:#ec0000">=</span> (CListCtrl<span style="color:#ec0000">*</span>)GetDlgItem(IDC_IPLIST);  
</span></span><span style="display:flex;"><span>    m_list<span style="color:#ec0000">-&gt;</span>SendMessage(LVM_SETEXTENDEDLISTVIEWSTYLE, LVS_EX_FULLROWSELECT, LVS_EX_FULLROWSELECT);  
</span></span><span style="display:flex;"><span>    RECT rt;  
</span></span><span style="display:flex;"><span>    m_list<span style="color:#ec0000">-&gt;</span>GetClientRect(<span style="color:#ec0000">&amp;</span>rt);  
</span></span><span style="display:flex;"><span>    m_list<span style="color:#ec0000">-&gt;</span>InsertColumn(COL_IP, <span style="color:#008900">&#34;DNS地址&#34;</span>, LVCFMT_LEFT, rt.right <span style="color:#ec0000">/</span> <span style="color:#008900">5</span>);  
</span></span><span style="display:flex;"><span>    m_list<span style="color:#ec0000">-&gt;</span>InsertColumn(COL_LOC, <span style="color:#008900">&#34;所在地&#34;</span>, LVCFMT_LEFT, rt.right <span style="color:#ec0000">/</span> <span style="color:#008900">5</span>);  
</span></span><span style="display:flex;"><span>    m_list<span style="color:#ec0000">-&gt;</span>InsertColumn(COL_RES, <span style="color:#008900">&#34;响应时间&#34;</span>, LVCFMT_LEFT, rt.right <span style="color:#ec0000">/</span> <span style="color:#008900">5</span>);  
</span></span><span style="display:flex;"><span>    m_list<span style="color:#ec0000">-&gt;</span>InsertColumn(COL_FAIL, <span style="color:#008900">&#34;失败率&#34;</span>, LVCFMT_LEFT, rt.right <span style="color:#ec0000">/</span> <span style="color:#008900">5</span>);  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>    boost<span style="color:#ec0000">::</span><span style="color:#ec0000">thread</span>(boost<span style="color:#ec0000">::</span>bind(getdata, <span style="color:#ec0000">&amp;</span>dataarray, m_list<span style="color:#ec0000">-&gt;</span>m_hWnd, GetDlgItem(IDC_STATU)<span style="color:#ec0000">-&gt;</span>m_hWnd, <span style="color:#ec0000">&amp;</span>datamutex));  
</span></span><span style="display:flex;"><span>    issorting <span style="color:#ec0000">=</span> <span style="color:#ec0000">false</span>;  
</span></span><span style="display:flex;"><span>    maxtask <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>;  
</span></span><span style="display:flex;"><span>    repeattime <span style="color:#ec0000">=</span> <span style="color:#008900">3</span>;  
</span></span><span style="display:flex;"><span>    threadnum <span style="color:#ec0000">=</span> <span style="color:#008900">3</span>;  
</span></span><span style="display:flex;"><span>    timeout <span style="color:#ec0000">=</span> <span style="color:#008900">1000</span>;  
</span></span><span style="display:flex;"><span>    SetDlgItemText(IDC_DOMAIN, <span style="color:#008900">&#34;www.microsoft.com&#34;</span>);  
</span></span><span style="display:flex;"><span>    SetTimer(TIMER1_ID, <span style="color:#008900">1000</span>, <span style="color:#ec0000">NULL</span>);  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">return</span> TRUE;  // 除非将焦点设置到控件，否则返回 TRUE  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">void</span> CFasterDNSDlg<span style="color:#ec0000">::</span>OnPaint()  
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">if</span> (IsIconic())  
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>        CPaintDC <span style="color:#5f5fff">dc</span>(<span style="color:#ec0000">this</span>); // 用于绘制的设备上下文  
</span></span><span style="display:flex;"><span>        SendMessage(WM_ICONERASEBKGND, <span style="color:#ec0000">reinterpret_cast</span><span style="color:#ec0000">&lt;</span>WPARAM<span style="color:#ec0000">&gt;</span>(dc.GetSafeHdc()), <span style="color:#008900">0</span>);  
</span></span><span style="display:flex;"><span>        <span style="color:#5f5fff">int</span> cxIcon <span style="color:#ec0000">=</span> GetSystemMetrics(SM_CXICON);  
</span></span><span style="display:flex;"><span>        <span style="color:#5f5fff">int</span> cyIcon <span style="color:#ec0000">=</span> GetSystemMetrics(SM_CYICON);  
</span></span><span style="display:flex;"><span>        CRect rect;  
</span></span><span style="display:flex;"><span>        GetClientRect(<span style="color:#ec0000">&amp;</span>rect);  
</span></span><span style="display:flex;"><span>        <span style="color:#5f5fff">int</span> x <span style="color:#ec0000">=</span> (rect.Width() <span style="color:#ec0000">-</span> cxIcon <span style="color:#ec0000">+</span> <span style="color:#008900">1</span>) <span style="color:#ec0000">/</span> <span style="color:#008900">2</span>;  
</span></span><span style="display:flex;"><span>        <span style="color:#5f5fff">int</span> y <span style="color:#ec0000">=</span> (rect.Height() <span style="color:#ec0000">-</span> cyIcon <span style="color:#ec0000">+</span> <span style="color:#008900">1</span>) <span style="color:#ec0000">/</span> <span style="color:#008900">2</span>;  
</span></span><span style="display:flex;"><span>        dc.DrawIcon(x, y, m_hIcon);  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">else</span> 
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>        CDialogEx<span style="color:#ec0000">::</span>OnPaint();  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">void</span> CFasterDNSDlg<span style="color:#ec0000">::</span>OnBnClickedAddDNS()  
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span>    CFileDialog  <span style="color:#5f5fff">dlg</span>(TRUE, <span style="color:#ec0000">NULL</span>, <span style="color:#ec0000">NULL</span>, OFN_HIDEREADONLY <span style="color:#ec0000">|</span> OFN_OVERWRITEPROMPT, <span style="color:#008900">&#34;*.*&#34;</span>, <span style="color:#ec0000">NULL</span>);  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">if</span> (IDOK <span style="color:#ec0000">==</span> dlg.DoModal())  
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>        //读取文件，解析出ip  
</span></span><span style="display:flex;"><span>        std<span style="color:#ec0000">::</span>fstream file;  
</span></span><span style="display:flex;"><span>        std<span style="color:#ec0000">::</span>string line;  
</span></span><span style="display:flex;"><span>        dbData toadd;  
</span></span><span style="display:flex;"><span>        boost<span style="color:#ec0000">::</span>asio<span style="color:#ec0000">::</span>ip<span style="color:#ec0000">::</span>address addr;  
</span></span><span style="display:flex;"><span>        spliter splitvec;  
</span></span><span style="display:flex;"><span>        //获取大小  
</span></span><span style="display:flex;"><span>        file.open(dlg.GetPathName(), std<span style="color:#ec0000">::</span>ios<span style="color:#ec0000">::</span>in);  
</span></span><span style="display:flex;"><span>        file.seekg(<span style="color:#008900">0</span>,std<span style="color:#ec0000">::</span>ios<span style="color:#ec0000">::</span>end);  
</span></span><span style="display:flex;"><span>        <span style="color:#5f5fff">int</span> totalsize <span style="color:#ec0000">=</span> file.tellg();  
</span></span><span style="display:flex;"><span>        file.seekg(<span style="color:#008900">0</span>,std<span style="color:#ec0000">::</span>ios<span style="color:#ec0000">::</span>beg);  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>        CProgressCtrl m_progctrl;  
</span></span><span style="display:flex;"><span>        m_progctrl.Create(WS_CHILD <span style="color:#ec0000">|</span> WS_VISIBLE, CRect(<span style="color:#008900">0</span>, <span style="color:#008900">0</span>, <span style="color:#008900">400</span>, <span style="color:#008900">50</span>), <span style="color:#ec0000">this</span>,  
</span></span><span style="display:flex;"><span>            IDC_PROGRESS);  
</span></span><span style="display:flex;"><span>        m_progctrl.SetRange(<span style="color:#008900">0</span>, <span style="color:#008900">100</span>);  
</span></span><span style="display:flex;"><span>        boost<span style="color:#ec0000">::</span>mutex<span style="color:#ec0000">::</span>scoped_lock mdata(datamutex);  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">if</span> (dlg.GetFileName() <span style="color:#ec0000">==</span> CSVDATA)  
</span></span><span style="display:flex;"><span>        {  
</span></span><span style="display:flex;"><span>            getline(file, line);//跳过第一行  
</span></span><span style="display:flex;"><span>            <span style="color:#ec0000">while</span> (<span style="color:#ec0000">!</span>file.eof())  
</span></span><span style="display:flex;"><span>            {  
</span></span><span style="display:flex;"><span>                <span style="color:#5f5fff">int</span> pos2 <span style="color:#ec0000">=</span> file.tellg();  
</span></span><span style="display:flex;"><span>                m_progctrl.SetPos(<span style="color:#5f5fff">int</span>(<span style="color:#008900">100</span><span style="color:#ec0000">*</span>(<span style="color:#5f5fff">double</span>)file.tellg()<span style="color:#ec0000">/</span>totalsize));  
</span></span><span style="display:flex;"><span>                getline(file, line);  
</span></span><span style="display:flex;"><span>                boost<span style="color:#ec0000">::</span>split(splitvec, line, boost<span style="color:#ec0000">::</span>is_any_of(<span style="color:#008900">&#34;,&#34;</span>));  
</span></span><span style="display:flex;"><span>                <span style="color:#ec0000">try</span> 
</span></span><span style="display:flex;"><span>                {  
</span></span><span style="display:flex;"><span>                    <span style="color:#ec0000">if</span> (splitvec.size() <span style="color:#ec0000">&lt;</span> CSV_MAX)  
</span></span><span style="display:flex;"><span>                        <span style="color:#ec0000">throw</span> <span style="color:#008900">&#34;Error&#34;</span>;  
</span></span><span style="display:flex;"><span>                    addr <span style="color:#ec0000">=</span> addr.from_string(splitvec[CSV_IP]);  
</span></span><span style="display:flex;"><span>                }  
</span></span><span style="display:flex;"><span>                <span style="color:#ec0000">catch</span> (...)  
</span></span><span style="display:flex;"><span>                {  
</span></span><span style="display:flex;"><span>                    <span style="color:#ec0000">break</span>;  
</span></span><span style="display:flex;"><span>                }  
</span></span><span style="display:flex;"><span>                LVITEM item <span style="color:#ec0000">=</span> { <span style="color:#008900">0</span> };  
</span></span><span style="display:flex;"><span>                item.mask <span style="color:#ec0000">=</span> LVIF_TEXT;  
</span></span><span style="display:flex;"><span>                item.iItem <span style="color:#ec0000">=</span> dataarray.size();  
</span></span><span style="display:flex;"><span>                item.lParam <span style="color:#ec0000">=</span> item.iItem;  
</span></span><span style="display:flex;"><span>                item.pszText <span style="color:#ec0000">=</span> LPSTR_TEXTCALLBACK;  
</span></span><span style="display:flex;"><span>                dataarray.push_back(testSpeedData((<span style="color:#5f5fff">char</span><span style="color:#ec0000">*</span>)splitvec[CSV_IP].c_str(), (<span style="color:#5f5fff">char</span><span style="color:#ec0000">*</span>)(splitvec[CSV_COUNTRYID] <span style="color:#ec0000">+</span> <span style="color:#008900">&#34; &#34;</span> <span style="color:#ec0000">+</span> splitvec[CSV_CITY]).c_str()));  
</span></span><span style="display:flex;"><span>                m_list<span style="color:#ec0000">-&gt;</span>InsertItem(<span style="color:#ec0000">&amp;</span>item);  
</span></span><span style="display:flex;"><span>                toadd.push_back(make_pair(splitvec[CSV_IP], splitvec[CSV_COUNTRYID] <span style="color:#ec0000">+</span> <span style="color:#008900">&#34; &#34;</span> <span style="color:#ec0000">+</span> splitvec[CSV_CITY]));  
</span></span><span style="display:flex;"><span>            }  
</span></span><span style="display:flex;"><span>        }  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">else</span> 
</span></span><span style="display:flex;"><span>        {//普通文件，ip地址和位置信息用逗号分隔  
</span></span><span style="display:flex;"><span>            <span style="color:#ec0000">while</span> (<span style="color:#ec0000">!</span>file.eof())  
</span></span><span style="display:flex;"><span>            {  
</span></span><span style="display:flex;"><span>                m_progctrl.SetPos(<span style="color:#5f5fff">int</span>(<span style="color:#008900">100</span><span style="color:#ec0000">*</span>(<span style="color:#5f5fff">double</span>)file.tellg() <span style="color:#ec0000">/</span> totalsize));  
</span></span><span style="display:flex;"><span>                getline(file, line);  
</span></span><span style="display:flex;"><span>                boost<span style="color:#ec0000">::</span>split(splitvec, line, boost<span style="color:#ec0000">::</span>is_any_of(<span style="color:#008900">&#34;,&#34;</span>));  
</span></span><span style="display:flex;"><span>                <span style="color:#ec0000">try</span> 
</span></span><span style="display:flex;"><span>                {  
</span></span><span style="display:flex;"><span>                    <span style="color:#ec0000">if</span> (splitvec.size() <span style="color:#ec0000">&lt;</span> COM_MAX)  
</span></span><span style="display:flex;"><span>                        <span style="color:#ec0000">throw</span> <span style="color:#008900">&#34;Error&#34;</span>;  
</span></span><span style="display:flex;"><span>                    addr <span style="color:#ec0000">=</span> addr.from_string(splitvec[COM_IP]);  
</span></span><span style="display:flex;"><span>                }  
</span></span><span style="display:flex;"><span>                <span style="color:#ec0000">catch</span> (...)  
</span></span><span style="display:flex;"><span>                {  
</span></span><span style="display:flex;"><span>                    <span style="color:#ec0000">break</span>;  
</span></span><span style="display:flex;"><span>                }  
</span></span><span style="display:flex;"><span>                LVITEM item <span style="color:#ec0000">=</span> { <span style="color:#008900">0</span> };  
</span></span><span style="display:flex;"><span>                item.mask <span style="color:#ec0000">=</span> LVIF_TEXT;  
</span></span><span style="display:flex;"><span>                item.iItem <span style="color:#ec0000">=</span> dataarray.size();  
</span></span><span style="display:flex;"><span>                item.lParam <span style="color:#ec0000">=</span> item.iItem;  
</span></span><span style="display:flex;"><span>                item.pszText <span style="color:#ec0000">=</span> LPSTR_TEXTCALLBACK;  
</span></span><span style="display:flex;"><span>                dataarray.push_back(testSpeedData((<span style="color:#5f5fff">char</span><span style="color:#ec0000">*</span>)splitvec[COM_IP].c_str(), (<span style="color:#5f5fff">char</span><span style="color:#ec0000">*</span>)splitvec[COM_LOCATION].c_str()));  
</span></span><span style="display:flex;"><span>                m_list<span style="color:#ec0000">-&gt;</span>InsertItem(<span style="color:#ec0000">&amp;</span>item);  
</span></span><span style="display:flex;"><span>                toadd.push_back(make_pair(splitvec[COM_IP], splitvec[COM_LOCATION]));  
</span></span><span style="display:flex;"><span>            }  
</span></span><span style="display:flex;"><span>        }  
</span></span><span style="display:flex;"><span>        file.close();  
</span></span><span style="display:flex;"><span>        ProgressThread(<span style="color:#008900">&#34;正在添加&#34;</span>,doadddata,<span style="color:#ec0000">&amp;</span>toadd);  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span><span style="color:#ec0000">template</span><span style="color:#ec0000">&lt;</span><span style="color:#ec0000">typename</span> F,<span style="color:#ec0000">typename</span> D<span style="color:#ec0000">&gt;</span>  
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">void</span> CFasterDNSDlg<span style="color:#ec0000">::</span>ProgressThread(LPCTSTR wndname,F<span style="color:#ec0000">&amp;</span> threadfunc,D paramdata)  
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span>    CProgressCtrl m_progctrl;  
</span></span><span style="display:flex;"><span>    m_progctrl.Create(WS_CHILD <span style="color:#ec0000">|</span> WS_VISIBLE <span style="color:#ec0000">|</span> PBS_SMOOTH, CRect(<span style="color:#008900">0</span>, <span style="color:#008900">0</span>, <span style="color:#008900">400</span>, <span style="color:#008900">50</span>), <span style="color:#ec0000">this</span>, IDC_PROGRESS);  
</span></span><span style="display:flex;"><span>    m_progctrl.SetRange(<span style="color:#008900">0</span>, <span style="color:#008900">100</span>);  
</span></span><span style="display:flex;"><span>    m_progctrl.SetWindowText(wndname);  
</span></span><span style="display:flex;"><span>    //绑定进度条到threadfunc，抽象出逻辑使在其内部动态更新进度条  
</span></span><span style="display:flex;"><span>    boost<span style="color:#ec0000">::</span>packaged_task<span style="color:#ec0000">&lt;</span><span style="color:#5f5fff">bool</span><span style="color:#ec0000">&gt;</span> pt(boost<span style="color:#ec0000">::</span>bind(threadfunc, paramdata, m_progctrl.m_hWnd));  
</span></span><span style="display:flex;"><span>    boost<span style="color:#ec0000">::</span>unique_future<span style="color:#ec0000">&lt;</span><span style="color:#5f5fff">bool</span><span style="color:#ec0000">&gt;</span> uf <span style="color:#ec0000">=</span> pt.get_future();  
</span></span><span style="display:flex;"><span>    boost<span style="color:#ec0000">::</span><span style="color:#ec0000">thread</span>(boost<span style="color:#ec0000">::</span>move(pt));  
</span></span><span style="display:flex;"><span>    uf.wait();  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">if</span> (uf.get())  
</span></span><span style="display:flex;"><span>        SetDlgItemText(IDC_STATU, <span style="color:#008900">&#34;操作成功！&#34;</span>);  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">else</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#5f5fff">SetDlgItemText</span>(IDC_STATU, <span style="color:#008900">&#34;操作失败！&#34;</span>);  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">char</span> toformat[<span style="color:#008900">256</span>];  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">void</span> CFasterDNSDlg<span style="color:#ec0000">::</span>OnLvnGetdispinfoIplist(NMHDR <span style="color:#ec0000">*</span>pNMHDR, LRESULT <span style="color:#ec0000">*</span>pResult)  
</span></span><span style="display:flex;"><span>{//刷新数据  
</span></span><span style="display:flex;"><span>    NMLVDISPINFO <span style="color:#ec0000">*</span>pDispInfo <span style="color:#ec0000">=</span> <span style="color:#ec0000">reinterpret_cast</span><span style="color:#ec0000">&lt;</span>NMLVDISPINFO<span style="color:#ec0000">*&gt;</span>(pNMHDR);  
</span></span><span style="display:flex;"><span>    // TODO:  在此添加控件通知处理程序代码  
</span></span><span style="display:flex;"><span>    <span style="color:#5f5fff">int</span> index <span style="color:#ec0000">=</span> pDispInfo<span style="color:#ec0000">-&gt;</span>item.iItem;  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">if</span> (dataarray.size() <span style="color:#ec0000">==</span> <span style="color:#008900">0</span> <span style="color:#ec0000">||</span> index <span style="color:#ec0000">&gt;</span> dataarray.size() <span style="color:#ec0000">-</span> <span style="color:#008900">1</span>)  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">return</span>;  
</span></span><span style="display:flex;"><span>    testSpeedData<span style="color:#ec0000">&amp;</span> cur <span style="color:#ec0000">=</span> dataarray[index];  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">switch</span> (pDispInfo<span style="color:#ec0000">-&gt;</span>item.iSubItem)  
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">case</span> <span style="color:#ec0000">COL_IP</span>:  
</span></span><span style="display:flex;"><span>        pDispInfo<span style="color:#ec0000">-&gt;</span>item.pszText <span style="color:#ec0000">=</span> (<span style="color:#5f5fff">char</span><span style="color:#ec0000">*</span>)cur.ip.c_str();  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">break</span>;  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">case</span> <span style="color:#ec0000">COL_LOC</span>:  
</span></span><span style="display:flex;"><span>        pDispInfo<span style="color:#ec0000">-&gt;</span>item.pszText <span style="color:#ec0000">=</span> (<span style="color:#5f5fff">char</span><span style="color:#ec0000">*</span>)cur.location.c_str();  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">break</span>;  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">case</span> <span style="color:#ec0000">COL_RES</span>:  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">if</span> (cur.responsetime <span style="color:#ec0000">==</span> <span style="color:#008900">0</span>)  
</span></span><span style="display:flex;"><span>            pDispInfo<span style="color:#ec0000">-&gt;</span>item.pszText <span style="color:#ec0000">=</span> <span style="color:#008900">&#34;未测速&#34;</span>;  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">else</span> <span style="color:#5f5fff">if</span> (cur.testtime <span style="color:#ec0000">==</span> cur.failtime)  
</span></span><span style="display:flex;"><span>            pDispInfo<span style="color:#ec0000">-&gt;</span>item.pszText <span style="color:#ec0000">=</span> <span style="color:#008900">&#34;测速失败&#34;</span>;  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">else</span> 
</span></span><span style="display:flex;"><span>        {  
</span></span><span style="display:flex;"><span>            sprintf_s(toformat, <span style="color:#008900">&#34;%d ms&#34;</span>, cur.responsetime <span style="color:#ec0000">/</span> (cur.testtime <span style="color:#ec0000">-</span> cur.failtime));  
</span></span><span style="display:flex;"><span>            pDispInfo<span style="color:#ec0000">-&gt;</span>item.pszText <span style="color:#ec0000">=</span> toformat;  
</span></span><span style="display:flex;"><span>        }  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">break</span>;  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">case</span> <span style="color:#ec0000">COL_FAIL</span>:  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">if</span> (dataarray[index].testtime <span style="color:#ec0000">==</span> <span style="color:#008900">0</span>)  
</span></span><span style="display:flex;"><span>            pDispInfo<span style="color:#ec0000">-&gt;</span>item.pszText <span style="color:#ec0000">=</span> <span style="color:#008900">&#34;未测速&#34;</span>;  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">else</span> 
</span></span><span style="display:flex;"><span>        {  
</span></span><span style="display:flex;"><span>            sprintf_s(toformat, <span style="color:#008900">&#34;%d/%d&#34;</span>, cur.failtime, cur.testtime);  
</span></span><span style="display:flex;"><span>            pDispInfo<span style="color:#ec0000">-&gt;</span>item.pszText <span style="color:#ec0000">=</span> toformat;  
</span></span><span style="display:flex;"><span>        }  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">break</span>;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">*</span>pResult <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>;  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">void</span> CFasterDNSDlg<span style="color:#ec0000">::</span>OnAbout()  
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span>    AfxMessageBox(<span style="color:#008900">&#34;该程序在‘彗星DNS优化器’基础上修改得到，增加了数据库，有望未来支持ipv6</span><span style="color:#008900">\r\n</span><span style="color:#008900">作者:lichao890427 qq:571652571&#34;</span>);  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">void</span> CFasterDNSDlg<span style="color:#ec0000">::</span>OnSetdns()  
</span></span><span style="display:flex;"><span>{//显示网卡窗口  
</span></span><span style="display:flex;"><span>    std<span style="color:#ec0000">::</span>vector<span style="color:#ec0000">&lt;</span>std<span style="color:#ec0000">::</span>string<span style="color:#ec0000">&gt;</span> selip;  
</span></span><span style="display:flex;"><span>    <span style="color:#5f5fff">int</span> uSelectedCount <span style="color:#ec0000">=</span> m_list<span style="color:#ec0000">-&gt;</span>GetSelectedCount();  
</span></span><span style="display:flex;"><span>    <span style="color:#5f5fff">int</span> nItem <span style="color:#ec0000">=</span> <span style="color:#ec0000">-</span><span style="color:#008900">1</span>;  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">if</span> (uSelectedCount <span style="color:#ec0000">&gt;</span> <span style="color:#008900">0</span>)  
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">for</span> (<span style="color:#5f5fff">int</span> i <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>; i <span style="color:#ec0000">&lt;</span> uSelectedCount; i<span style="color:#ec0000">++</span>)  
</span></span><span style="display:flex;"><span>        {  
</span></span><span style="display:flex;"><span>            nItem <span style="color:#ec0000">=</span> m_list<span style="color:#ec0000">-&gt;</span>GetNextItem(nItem, LVNI_SELECTED);  
</span></span><span style="display:flex;"><span>            selip.push_back(dataarray[nItem].ip);  
</span></span><span style="display:flex;"><span>        }  
</span></span><span style="display:flex;"><span>        boost<span style="color:#ec0000">::</span><span style="color:#ec0000">thread</span>(boost<span style="color:#ec0000">::</span>bind(<span style="color:#ec0000">&amp;</span>CFasterDNSDlg<span style="color:#ec0000">::</span>DoDNSConnection, <span style="color:#ec0000">this</span>));  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>    CSetDnsDlg <span style="color:#5f5fff">setdns</span>(selip);  
</span></span><span style="display:flex;"><span>    setdns.DoModal();  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">bool</span> <span style="color:#5f5fff">CompareIP</span>(testSpeedData<span style="color:#ec0000">&amp;</span> lParam1, testSpeedData<span style="color:#ec0000">&amp;</span> lParam2)  
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">using</span> <span style="color:#ec0000">namespace</span> boost<span style="color:#ec0000">::</span>asio;  
</span></span><span style="display:flex;"><span>    ip<span style="color:#ec0000">::</span>address<span style="color:#ec0000">&amp;</span> addr1 <span style="color:#ec0000">=</span> ip<span style="color:#ec0000">::</span>address<span style="color:#ec0000">::</span>from_string(lParam1.ip);  
</span></span><span style="display:flex;"><span>    ip<span style="color:#ec0000">::</span>address<span style="color:#ec0000">&amp;</span> addr2 <span style="color:#ec0000">=</span> ip<span style="color:#ec0000">::</span>address<span style="color:#ec0000">::</span>from_string(lParam2.ip);  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">if</span> (addr1.is_v4())  
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">if</span> (addr2.is_v4())  
</span></span><span style="display:flex;"><span>        {  
</span></span><span style="display:flex;"><span>            <span style="color:#ec0000">return</span> addr1.to_v4().to_ulong() <span style="color:#ec0000">&lt;</span> addr2.to_v4().to_ulong();  
</span></span><span style="display:flex;"><span>        }  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">else</span> 
</span></span><span style="display:flex;"><span>            <span style="color:#ec0000">return</span> <span style="color:#ec0000">true</span>;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">else</span> 
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">return</span> <span style="color:#ec0000">false</span>;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">bool</span> <span style="color:#5f5fff">CompareLOC</span>(testSpeedData<span style="color:#ec0000">&amp;</span> lParam1, testSpeedData<span style="color:#ec0000">&amp;</span> lParam2)  
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">return</span> lParam1.location <span style="color:#ec0000">&lt;</span> lParam2.location;  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">bool</span> <span style="color:#5f5fff">CompareRES</span>(testSpeedData<span style="color:#ec0000">&amp;</span> lParam1, testSpeedData<span style="color:#ec0000">&amp;</span> lParam2)  
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">if</span> (lParam1.failtime <span style="color:#ec0000">||</span> lParam1.lefttime)  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">return</span> <span style="color:#ec0000">true</span>;  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">else</span> <span style="color:#ec0000">if</span> (lParam2.failtime <span style="color:#ec0000">||</span> lParam2.lefttime)  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">return</span> <span style="color:#ec0000">false</span>;  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">else</span> <span style="color:#ec0000">if</span> (<span style="color:#ec0000">!</span>lParam1.testtime <span style="color:#ec0000">||</span> <span style="color:#ec0000">!</span>lParam2.testtime)  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">return</span> lParam1.testtime <span style="color:#ec0000">&lt;</span> lParam2.testtime;  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">else</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">return</span> lParam1.responsetime <span style="color:#ec0000">/</span> lParam1.testtime <span style="color:#ec0000">&lt;</span> lParam2.responsetime <span style="color:#ec0000">/</span> lParam2.testtime;  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">void</span> CFasterDNSDlg<span style="color:#ec0000">::</span>DoSort(<span style="color:#5f5fff">bool</span>(<span style="color:#ec0000">*</span>f)(testSpeedData<span style="color:#ec0000">&amp;</span>, testSpeedData<span style="color:#ec0000">&amp;</span>))  
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">if</span> (issorting)  
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>        AfxMessageBox(<span style="color:#008900">&#34;排序尚未完成！&#34;</span>);  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">return</span>;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>    boost<span style="color:#ec0000">::</span>mutex<span style="color:#ec0000">::</span>scoped_lock mdata(datamutex);  
</span></span><span style="display:flex;"><span>    SetDlgItemText(IDC_STATU, <span style="color:#008900">&#34;正在排序&#34;</span>);  
</span></span><span style="display:flex;"><span>    issorting <span style="color:#ec0000">=</span> <span style="color:#ec0000">true</span>;  
</span></span><span style="display:flex;"><span>    std<span style="color:#ec0000">::</span>sort(dataarray.begin(), dataarray.end(), f);  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">for</span> (<span style="color:#5f5fff">int</span> i <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>; i <span style="color:#ec0000">&lt;</span> dataarray.size(); i<span style="color:#ec0000">++</span>)  
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>        LVITEM item <span style="color:#ec0000">=</span> { <span style="color:#008900">0</span> };  
</span></span><span style="display:flex;"><span>        item.mask <span style="color:#ec0000">=</span> LVIF_TEXT;  
</span></span><span style="display:flex;"><span>        item.iItem <span style="color:#ec0000">=</span> i;  
</span></span><span style="display:flex;"><span>        item.pszText <span style="color:#ec0000">=</span> LPSTR_TEXTCALLBACK;  
</span></span><span style="display:flex;"><span>        m_list<span style="color:#ec0000">-&gt;</span>SendMessage(LVM_SETITEMTEXT, i, (LPARAM)<span style="color:#ec0000">&amp;</span>item);  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    SetDlgItemText(IDC_STATU, <span style="color:#008900">&#34;排序完毕&#34;</span>);  
</span></span><span style="display:flex;"><span>    issorting <span style="color:#ec0000">=</span> <span style="color:#ec0000">false</span>;  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">void</span> CFasterDNSDlg<span style="color:#ec0000">::</span>OnHdnItemclickIplist(NMHDR <span style="color:#ec0000">*</span>pNMHDR, LRESULT <span style="color:#ec0000">*</span>pResult)  
</span></span><span style="display:flex;"><span>{//排序  
</span></span><span style="display:flex;"><span>    LPNMHEADER phdr <span style="color:#ec0000">=</span> <span style="color:#ec0000">reinterpret_cast</span><span style="color:#ec0000">&lt;</span>LPNMHEADER<span style="color:#ec0000">&gt;</span>(pNMHDR);  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">switch</span> (phdr<span style="color:#ec0000">-&gt;</span>iItem)  
</span></span><span style="display:flex;"><span>    {//不要直接修改listview，而是先修改和listview绑定的data，再通知listview  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">case</span> <span style="color:#ec0000">COL_IP</span>:  
</span></span><span style="display:flex;"><span>            boost<span style="color:#ec0000">::</span><span style="color:#ec0000">thread</span>(boost<span style="color:#ec0000">::</span>bind(<span style="color:#ec0000">&amp;</span>CFasterDNSDlg<span style="color:#ec0000">::</span>DoSort, <span style="color:#ec0000">this</span>, CompareIP));  
</span></span><span style="display:flex;"><span>            <span style="color:#ec0000">break</span>;  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">case</span> <span style="color:#ec0000">COL_LOC</span>:  
</span></span><span style="display:flex;"><span>            boost<span style="color:#ec0000">::</span><span style="color:#ec0000">thread</span>(boost<span style="color:#ec0000">::</span>bind(<span style="color:#ec0000">&amp;</span>CFasterDNSDlg<span style="color:#ec0000">::</span>DoSort, <span style="color:#ec0000">this</span>, CompareLOC));  
</span></span><span style="display:flex;"><span>            <span style="color:#ec0000">break</span>;  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">case</span> <span style="color:#ec0000">COL_RES</span>:  
</span></span><span style="display:flex;"><span>            boost<span style="color:#ec0000">::</span><span style="color:#ec0000">thread</span>(boost<span style="color:#ec0000">::</span>bind(<span style="color:#ec0000">&amp;</span>CFasterDNSDlg<span style="color:#ec0000">::</span>DoSort, <span style="color:#ec0000">this</span>, CompareRES));  
</span></span><span style="display:flex;"><span>            <span style="color:#ec0000">break</span>;  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">case</span> <span style="color:#ec0000">COL_FAIL</span>:  
</span></span><span style="display:flex;"><span>            <span style="color:#ec0000">break</span>;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">*</span>pResult <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>;  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">void</span> CFasterDNSDlg<span style="color:#ec0000">::</span>OnNMRClickIplist(NMHDR <span style="color:#ec0000">*</span>pNMHDR, LRESULT <span style="color:#ec0000">*</span>pResult)  
</span></span><span style="display:flex;"><span>{//右键弹出菜单  
</span></span><span style="display:flex;"><span>    LPNMITEMACTIVATE pNMItemActivate <span style="color:#ec0000">=</span> <span style="color:#ec0000">reinterpret_cast</span><span style="color:#ec0000">&lt;</span>LPNMITEMACTIVATE<span style="color:#ec0000">&gt;</span>(pNMHDR);  
</span></span><span style="display:flex;"><span>    CMenu menu;  
</span></span><span style="display:flex;"><span>    menu.LoadMenu(IDR_POPUPMENU);  
</span></span><span style="display:flex;"><span>    CMenu<span style="color:#ec0000">*</span> pPopup <span style="color:#ec0000">=</span> menu.GetSubMenu(<span style="color:#008900">0</span>);  
</span></span><span style="display:flex;"><span>    POINT pt;  
</span></span><span style="display:flex;"><span>    GetCursorPos(<span style="color:#ec0000">&amp;</span>pt);  
</span></span><span style="display:flex;"><span>    pPopup<span style="color:#ec0000">-&gt;</span>TrackPopupMenu(TPM_LEFTALIGN <span style="color:#ec0000">|</span> TPM_LEFTBUTTON, pt.x, pt.y, <span style="color:#ec0000">this</span>);  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">*</span>pResult <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>;  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">void</span> CFasterDNSDlg<span style="color:#ec0000">::</span>OnDeldns()  
</span></span><span style="display:flex;"><span>{//删除dns，先从数据库中删，再重新加载数据  
</span></span><span style="display:flex;"><span>    <span style="color:#5f5fff">int</span> uSelectedCount <span style="color:#ec0000">=</span> m_list<span style="color:#ec0000">-&gt;</span>GetSelectedCount();  
</span></span><span style="display:flex;"><span>    <span style="color:#5f5fff">int</span> nItem <span style="color:#ec0000">=</span> <span style="color:#ec0000">-</span><span style="color:#008900">1</span>;  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">if</span> (uSelectedCount <span style="color:#ec0000">&gt;</span> <span style="color:#008900">0</span>)  
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>        boost<span style="color:#ec0000">::</span>mutex<span style="color:#ec0000">::</span>scoped_lock mdata(datamutex);  
</span></span><span style="display:flex;"><span>        std<span style="color:#ec0000">::</span>vector<span style="color:#ec0000">&lt;</span>std<span style="color:#ec0000">::</span>string<span style="color:#ec0000">&gt;</span> temp;  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">for</span> (<span style="color:#5f5fff">int</span> i <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>; i <span style="color:#ec0000">&lt;</span> uSelectedCount; i<span style="color:#ec0000">++</span>)  
</span></span><span style="display:flex;"><span>        {  
</span></span><span style="display:flex;"><span>            nItem <span style="color:#ec0000">=</span> m_list<span style="color:#ec0000">-&gt;</span>GetNextItem(nItem, LVNI_SELECTED);  
</span></span><span style="display:flex;"><span>            temp.push_back(dataarray[nItem].ip);  
</span></span><span style="display:flex;"><span>        }  
</span></span><span style="display:flex;"><span>        dodeldata(<span style="color:#ec0000">&amp;</span>temp, m_list<span style="color:#ec0000">-&gt;</span>m_hWnd);  
</span></span><span style="display:flex;"><span>        dataarray.clear();  
</span></span><span style="display:flex;"><span>        m_list<span style="color:#ec0000">-&gt;</span>DeleteAllItems();  
</span></span><span style="display:flex;"><span>        boost<span style="color:#ec0000">::</span><span style="color:#ec0000">thread</span>(boost<span style="color:#ec0000">::</span>bind(getdata, <span style="color:#ec0000">&amp;</span>dataarray, m_list<span style="color:#ec0000">-&gt;</span>m_hWnd, GetDlgItem(IDC_STATU)<span style="color:#ec0000">-&gt;</span>m_hWnd, <span style="color:#ec0000">&amp;</span>datamutex));  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>std<span style="color:#ec0000">::</span>set<span style="color:#ec0000">&lt;</span>std<span style="color:#ec0000">::</span>string<span style="color:#ec0000">&gt;</span> resolvedip;  
</span></span><span style="display:flex;"><span>std<span style="color:#ec0000">::</span>string domain<span style="color:#ec0000">=</span><span style="color:#008900">&#34;www.microsoft.com&#34;</span>;  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">void</span> <span style="color:#5f5fff">testFunc</span>(<span style="color:#5f5fff">int</span> index, std<span style="color:#ec0000">::</span>vector<span style="color:#ec0000">&lt;</span>testSpeedData<span style="color:#ec0000">&gt;*</span> rawdata, HWND listview)  
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span>    testSpeedData<span style="color:#ec0000">&amp;</span> curdata <span style="color:#ec0000">=</span> (<span style="color:#ec0000">*</span>rawdata).at(index);  
</span></span><span style="display:flex;"><span>    std<span style="color:#ec0000">::</span>vector<span style="color:#ec0000">&lt;</span><span style="color:#5f5fff">uint8_t</span><span style="color:#ec0000">&gt;</span> bufferdata;  
</span></span><span style="display:flex;"><span>    <span style="color:#5f5fff">bool</span> got <span style="color:#ec0000">=</span> <span style="color:#ec0000">false</span>;  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">while</span> (curdata.lefttime)  
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>        makedns(bufferdata, domain);  
</span></span><span style="display:flex;"><span>        <span style="color:#5f5fff">int</span> originlen <span style="color:#ec0000">=</span> bufferdata.size();//发送包大小，用于定位返回answer  
</span></span><span style="display:flex;"><span>        replaceXid(bufferdata, rand() <span style="color:#ec0000">&amp;</span> <span style="color:#008900">0xFFFF</span>);  
</span></span><span style="display:flex;"><span>        <span style="color:#5f5fff">uint32_t</span> usedtime <span style="color:#ec0000">=</span> curdata.timeout;  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">if</span> (<span style="color:#ec0000">!</span>dodnsconnect(curdata.ip, usedtime, bufferdata))  
</span></span><span style="display:flex;"><span>            curdata.failtime<span style="color:#ec0000">++</span>;  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">else</span> 
</span></span><span style="display:flex;"><span>        {  
</span></span><span style="display:flex;"><span>            curdata.responsetime <span style="color:#ec0000">+=</span> usedtime;  
</span></span><span style="display:flex;"><span>            <span style="color:#ec0000">if</span> (<span style="color:#ec0000">!</span>got)  
</span></span><span style="display:flex;"><span>            {//解析返回包  
</span></span><span style="display:flex;"><span>                resolveAnswer(bufferdata, resolvedip, originlen);  
</span></span><span style="display:flex;"><span>                got <span style="color:#ec0000">=</span> <span style="color:#ec0000">true</span>;  
</span></span><span style="display:flex;"><span>            }  
</span></span><span style="display:flex;"><span>        }     
</span></span><span style="display:flex;"><span>        curdata.lefttime<span style="color:#ec0000">--</span>;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    //刷新listview  
</span></span><span style="display:flex;"><span>    LVITEM item <span style="color:#ec0000">=</span> { <span style="color:#008900">0</span> };  
</span></span><span style="display:flex;"><span>    item.mask <span style="color:#ec0000">=</span> LVIF_TEXT;  
</span></span><span style="display:flex;"><span>    item.iItem <span style="color:#ec0000">=</span> index;  
</span></span><span style="display:flex;"><span>    item.pszText <span style="color:#ec0000">=</span> LPSTR_TEXTCALLBACK;  
</span></span><span style="display:flex;"><span>    SendMessage(listview, LVM_SETITEMTEXT, index, (LPARAM)<span style="color:#ec0000">&amp;</span>item);  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">void</span> CFasterDNSDlg<span style="color:#ec0000">::</span>OnTimer(UINT_PTR nIDEvent)  
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span>    <span style="color:#5f5fff">char</span> status[<span style="color:#008900">256</span>];  
</span></span><span style="display:flex;"><span>    sprintf_s(status,<span style="color:#008900">&#34;%06d/%06d/%06d&#34;</span>, task.size(), maxtask, dataarray.size());  
</span></span><span style="display:flex;"><span>    SetDlgItemText(IDC_TESTPROG, status);  
</span></span><span style="display:flex;"><span>    CDialogEx<span style="color:#ec0000">::</span>OnTimer(nIDEvent);  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">void</span> CFasterDNSDlg<span style="color:#ec0000">::</span>DoDNSConnection()  
</span></span><span style="display:flex;"><span>{//设置testSpeedData  
</span></span><span style="display:flex;"><span>    maxtask <span style="color:#ec0000">=</span> task.size();  
</span></span><span style="display:flex;"><span>    CString domaina;  
</span></span><span style="display:flex;"><span>    GetDlgItemText(IDC_DOMAIN, domaina);  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">::</span>domain <span style="color:#ec0000">=</span> (LPCTSTR)domaina;  
</span></span><span style="display:flex;"><span>    resolvedip.clear();  
</span></span><span style="display:flex;"><span>    ThreadPool<span style="color:#ec0000">&lt;</span>testSpeedData<span style="color:#ec0000">&gt;</span> newtaskset(taskmutex);  
</span></span><span style="display:flex;"><span>    newtaskset.Attach(threadnum, <span style="color:#ec0000">&amp;</span>task, <span style="color:#ec0000">&amp;</span>dataarray,m_list<span style="color:#ec0000">-&gt;</span>m_hWnd);  
</span></span><span style="display:flex;"><span>    newtaskset.Exec(testFunc);  
</span></span><span style="display:flex;"><span>    OnBnClickedViewip();  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">void</span> CFasterDNSDlg<span style="color:#ec0000">::</span>InitOne(testSpeedData<span style="color:#ec0000">&amp;</span> obj)  
</span></span><span style="display:flex;"><span>{//初始化单个数据  
</span></span><span style="display:flex;"><span>    obj.failtime <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>;  
</span></span><span style="display:flex;"><span>    obj.lefttime <span style="color:#ec0000">=</span> repeattime;  
</span></span><span style="display:flex;"><span>    obj.responsetime <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>;  
</span></span><span style="display:flex;"><span>    obj.testtime <span style="color:#ec0000">=</span> repeattime;  
</span></span><span style="display:flex;"><span>    obj.timeout <span style="color:#ec0000">=</span> timeout;  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">void</span> CFasterDNSDlg<span style="color:#ec0000">::</span>OnBnClickedAllinone()  
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span>    boost<span style="color:#ec0000">::</span>mutex<span style="color:#ec0000">::</span>scoped_lock mtask(taskmutex);  
</span></span><span style="display:flex;"><span>    //list和data绑定，数据更改通过data更新list而不直接操作list，因此该锁同时绑定data和list  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">if</span> (<span style="color:#ec0000">!</span>task.empty())  
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>        AfxMessageBox(<span style="color:#008900">&#34;测试尚未结束，请先停止测试&#34;</span>);  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">return</span>;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#5f5fff">int</span> nCount <span style="color:#ec0000">=</span> m_list<span style="color:#ec0000">-&gt;</span>GetItemCount();  
</span></span><span style="display:flex;"><span>    task.clear();  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">for</span> (<span style="color:#5f5fff">int</span> i <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>; i <span style="color:#ec0000">&lt;</span> nCount; i<span style="color:#ec0000">++</span>)  
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>        task.push_back(i);  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    boost<span style="color:#ec0000">::</span><span style="color:#ec0000">thread</span>(boost<span style="color:#ec0000">::</span>bind(<span style="color:#ec0000">&amp;</span>CFasterDNSDlg<span style="color:#ec0000">::</span>DoDNSConnection, <span style="color:#ec0000">this</span>));  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">void</span> CFasterDNSDlg<span style="color:#ec0000">::</span>OnBnClickedStart()  
</span></span><span style="display:flex;"><span>{//测试选中  
</span></span><span style="display:flex;"><span>    boost<span style="color:#ec0000">::</span>mutex<span style="color:#ec0000">::</span>scoped_lock mtask(taskmutex);  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">if</span> (<span style="color:#ec0000">!</span>task.empty())  
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>        AfxMessageBox(<span style="color:#008900">&#34;测试尚未结束，请先停止测试&#34;</span>);  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">return</span>;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#5f5fff">int</span> uSelectedCount <span style="color:#ec0000">=</span> m_list<span style="color:#ec0000">-&gt;</span>GetSelectedCount();  
</span></span><span style="display:flex;"><span>    <span style="color:#5f5fff">int</span> nItem <span style="color:#ec0000">=</span> <span style="color:#ec0000">-</span><span style="color:#008900">1</span>;  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">if</span> (uSelectedCount <span style="color:#ec0000">&gt;</span> <span style="color:#008900">0</span>)  
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>        task.clear();  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">for</span> (<span style="color:#5f5fff">int</span> i <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>; i <span style="color:#ec0000">&lt;</span> uSelectedCount; i<span style="color:#ec0000">++</span>)  
</span></span><span style="display:flex;"><span>        {  
</span></span><span style="display:flex;"><span>            nItem <span style="color:#ec0000">=</span> m_list<span style="color:#ec0000">-&gt;</span>GetNextItem(nItem, LVNI_SELECTED);  
</span></span><span style="display:flex;"><span>            InitOne(dataarray[nItem]);  
</span></span><span style="display:flex;"><span>            task.push_back(nItem);  
</span></span><span style="display:flex;"><span>        }  
</span></span><span style="display:flex;"><span>        boost<span style="color:#ec0000">::</span><span style="color:#ec0000">thread</span>(boost<span style="color:#ec0000">::</span>bind(<span style="color:#ec0000">&amp;</span>CFasterDNSDlg<span style="color:#ec0000">::</span>DoDNSConnection, <span style="color:#ec0000">this</span>));  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">void</span> CFasterDNSDlg<span style="color:#ec0000">::</span>OnBnClickedStop()  
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span>    //停止当前任务意味着清除剩余分配任务task  
</span></span><span style="display:flex;"><span>    boost<span style="color:#ec0000">::</span>mutex<span style="color:#ec0000">::</span>scoped_lock mio(taskmutex);  
</span></span><span style="display:flex;"><span>    //使用同一个锁保证不和分配任务线程操作冲突  
</span></span><span style="display:flex;"><span>    task.clear();  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">void</span> CFasterDNSDlg<span style="color:#ec0000">::</span>OnBnClickedViewip()  
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span>    CShowIp <span style="color:#5f5fff">ipdlg</span>(domain, resolvedip);  
</span></span><span style="display:flex;"><span>    ipdlg.DoModal();  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">void</span> CFasterDNSDlg<span style="color:#ec0000">::</span>OnAdddns()  
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span>    OnBnClickedAddDNS();  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">void</span> CFasterDNSDlg<span style="color:#ec0000">::</span>OnModify()  
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span>    CGlobalSetting <span style="color:#5f5fff">settings</span>(threadnum, timeout, repeattime);  
</span></span><span style="display:flex;"><span>    settings.DoModal();  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">void</span> CFasterDNSDlg<span style="color:#ec0000">::</span>OnStartall()  
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span>    OnBnClickedAllinone();  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">void</span> CFasterDNSDlg<span style="color:#ec0000">::</span>OnStopall()  
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span>    OnBnClickedStop();  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">void</span> CFasterDNSDlg<span style="color:#ec0000">::</span>OnTestip()  
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span>    OnBnClickedViewip();  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">void</span> CFasterDNSDlg<span style="color:#ec0000">::</span>OnExit()  
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span>    SendMessage(WM_CLOSE, <span style="color:#008900">0</span>, <span style="color:#008900">0</span>);  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">void</span> CFasterDNSDlg<span style="color:#ec0000">::</span>OnAllinone()  
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span>    OnBnClickedAllinone();  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">void</span> CFasterDNSDlg<span style="color:#ec0000">::</span>OnStart()  
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span>    OnBnClickedStart();  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">void</span> CFasterDNSDlg<span style="color:#ec0000">::</span>OnStop()  
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span>    OnBnClickedStop();  
</span></span><span style="display:flex;"><span>} 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>// functions.cpp
</span></span><span style="display:flex;"><span>#include &#34;stdafx.h&#34;    
</span></span><span style="display:flex;"><span>#include &lt;boost/function.hpp&gt;  
</span></span><span style="display:flex;"><span>#include &lt;boost/asio.hpp&gt;  
</span></span><span style="display:flex;"><span>#include &lt;boost/thread.hpp&gt;  
</span></span><span style="display:flex;"><span>#include &lt;boost/bind.hpp&gt;  
</span></span><span style="display:flex;"><span>#include &lt;boost/date_time.hpp&gt;  
</span></span><span style="display:flex;"><span>#include &lt;boost/algorithm/string.hpp&gt;  
</span></span><span style="display:flex;"><span>#include &lt;boost/lexical_cast.hpp&gt;  
</span></span><span style="display:flex;"><span>#include &lt;boost/format.hpp&gt;  
</span></span><span style="display:flex;"><span>#include &lt;boost/system/error_code.hpp&gt;  
</span></span><span style="display:flex;"><span>#include &lt;vector&gt;  
</span></span><span style="display:flex;"><span>#include &lt;set&gt;  
</span></span><span style="display:flex;"><span>#include &lt;winsock.h&gt;  
</span></span><span style="display:flex;"><span>#include &lt;stdint.h&gt;  
</span></span><span style="display:flex;"><span>#include &lt;iphlpapi.h&gt;  
</span></span><span style="display:flex;"><span>#include &lt;windows.h&gt;  
</span></span><span style="display:flex;"><span>#include &#34;functions.h&#34;  
</span></span><span style="display:flex;"><span>#include &#34;sqlite3.h&#34;  
</span></span><span style="display:flex;"><span>#pragma comment(lib,&#34;sqlite3.lib&#34;)  
</span></span><span style="display:flex;"><span>#pragma comment(lib,&#34;iphlpapi.lib&#34;)  
</span></span><span style="display:flex;"><span>/************************************************************************/ 
</span></span><span style="display:flex;"><span>/* 单例模式获取实例                                                     */ 
</span></span><span style="display:flex;"><span>/************************************************************************/ 
</span></span><span style="display:flex;"><span>std<span style="color:#ec0000">::</span>vector<span style="color:#ec0000">&lt;</span>testSpeedData<span style="color:#ec0000">&gt;*</span> ipcontainer<span style="color:#ec0000">::</span>testdata <span style="color:#ec0000">=</span> <span style="color:#ec0000">NULL</span>;  
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">int</span><span style="color:#ec0000">*</span> ipcontainer<span style="color:#ec0000">::</span>pcount <span style="color:#ec0000">=</span> <span style="color:#ec0000">NULL</span>;  
</span></span><span style="display:flex;"><span>HWND ipcontainer<span style="color:#ec0000">::</span>pwnd <span style="color:#ec0000">=</span> <span style="color:#ec0000">NULL</span>;  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>ipcontainer<span style="color:#ec0000">&amp;</span> ipcontainer<span style="color:#ec0000">::</span>getInstance()  
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span>    boost<span style="color:#ec0000">::</span>mutex mio;  
</span></span><span style="display:flex;"><span>    boost<span style="color:#ec0000">::</span>mutex<span style="color:#ec0000">::</span>scoped_lock lock(mio);  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">static</span> ipcontainer container;  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">return</span> container;  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>/************************************************************************/ 
</span></span><span style="display:flex;"><span>/* 向数据库中增加dns数据  
</span></span><span style="display:flex;"><span>    ip:待添加dns服务器ip地址(非域名)   addr:待添加dns服务器地理位置  */ 
</span></span><span style="display:flex;"><span>/************************************************************************/ 
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">bool</span> ipcontainer<span style="color:#ec0000">::</span>adddata(<span style="color:#ec0000">const</span> std<span style="color:#ec0000">::</span>string<span style="color:#ec0000">&amp;</span> ip, <span style="color:#ec0000">const</span> std<span style="color:#ec0000">::</span>string<span style="color:#ec0000">&amp;</span> addr)  
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span>    <span style="color:#5f5fff">int</span> status <span style="color:#ec0000">=</span> SQLITE_OK;  
</span></span><span style="display:flex;"><span>    <span style="color:#5f5fff">char</span><span style="color:#ec0000">*</span> zErrMsg <span style="color:#ec0000">=</span> <span style="color:#ec0000">NULL</span>;  
</span></span><span style="display:flex;"><span>    std<span style="color:#ec0000">::</span>string toadd <span style="color:#ec0000">=</span> <span style="color:#008900">&#34;insert into dnss values (&#39;&#34;</span> <span style="color:#ec0000">+</span> ip <span style="color:#ec0000">+</span> <span style="color:#008900">&#34;&#39;,&#39;&#34;</span> <span style="color:#ec0000">+</span> addr <span style="color:#ec0000">+</span> <span style="color:#008900">&#34;&#39;)&#34;</span>;  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">try</span> 
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>        status <span style="color:#ec0000">=</span> sqlite3_exec(db, toadd.c_str(), <span style="color:#ec0000">NULL</span>, <span style="color:#ec0000">NULL</span>, <span style="color:#ec0000">&amp;</span>zErrMsg);  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">if</span> (status <span style="color:#ec0000">!=</span> SQLITE_OK)  
</span></span><span style="display:flex;"><span>            <span style="color:#ec0000">throw</span> <span style="color:#008900">&#34;Add failed!&#34;</span>;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">catch</span> (...)  
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">return</span> <span style="color:#ec0000">false</span>;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">return</span> <span style="color:#ec0000">true</span>;  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>/************************************************************************/ 
</span></span><span style="display:flex;"><span>/* 从数据库中删除dns数据  
</span></span><span style="display:flex;"><span>    ip:待删除dns服务器ip地址(非域名)                                   */ 
</span></span><span style="display:flex;"><span>/************************************************************************/ 
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">bool</span> ipcontainer<span style="color:#ec0000">::</span>deldata(<span style="color:#ec0000">const</span> std<span style="color:#ec0000">::</span>string<span style="color:#ec0000">&amp;</span> ip)  
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span>    <span style="color:#5f5fff">int</span> status <span style="color:#ec0000">=</span> SQLITE_OK;  
</span></span><span style="display:flex;"><span>    <span style="color:#5f5fff">char</span><span style="color:#ec0000">*</span> zErrMsg <span style="color:#ec0000">=</span> <span style="color:#ec0000">NULL</span>;  
</span></span><span style="display:flex;"><span>    std<span style="color:#ec0000">::</span>string toadd <span style="color:#ec0000">=</span> <span style="color:#008900">&#34;delete from dnss where ipaddr = &#39;&#34;</span> <span style="color:#ec0000">+</span> ip <span style="color:#ec0000">+</span> <span style="color:#008900">&#34;&#39;&#34;</span>;  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">try</span> 
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>        status <span style="color:#ec0000">=</span> sqlite3_exec(db, toadd.c_str(), <span style="color:#ec0000">NULL</span>, <span style="color:#ec0000">NULL</span>, <span style="color:#ec0000">&amp;</span>zErrMsg);  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">if</span> (status <span style="color:#ec0000">!=</span> SQLITE_OK)  
</span></span><span style="display:flex;"><span>            <span style="color:#ec0000">throw</span> <span style="color:#008900">&#34;Del failed!&#34;</span>;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">catch</span> (...)  
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">return</span> <span style="color:#ec0000">false</span>;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">return</span> <span style="color:#ec0000">true</span>;  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>/************************************************************************/ 
</span></span><span style="display:flex;"><span>/* 获取dns数据总入口  
</span></span><span style="display:flex;"><span>    dataparam:存放获得数据结果                                          */ 
</span></span><span style="display:flex;"><span>/************************************************************************/ 
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">bool</span> ipcontainer<span style="color:#ec0000">::</span>getdata(std<span style="color:#ec0000">::</span>vector<span style="color:#ec0000">&lt;</span>testSpeedData<span style="color:#ec0000">&gt;*</span> dataparam, HWND listctrl)  
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">try</span> 
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>        ipcontainer<span style="color:#ec0000">::</span>testdata <span style="color:#ec0000">=</span> dataparam;  
</span></span><span style="display:flex;"><span>        ipcontainer<span style="color:#ec0000">::</span>pwnd <span style="color:#ec0000">=</span> listctrl;  
</span></span><span style="display:flex;"><span>        <span style="color:#5f5fff">int</span> status <span style="color:#ec0000">=</span> SQLITE_OK;  
</span></span><span style="display:flex;"><span>        <span style="color:#5f5fff">char</span><span style="color:#ec0000">*</span> zErrMsg <span style="color:#ec0000">=</span> <span style="color:#ec0000">NULL</span>;  
</span></span><span style="display:flex;"><span>        status <span style="color:#ec0000">=</span> sqlite3_exec(db, <span style="color:#008900">&#34;select * from dnss&#34;</span>, getdatacallback, <span style="color:#ec0000">NULL</span>, <span style="color:#ec0000">&amp;</span>zErrMsg);  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">if</span> (status <span style="color:#ec0000">!=</span> SQLITE_OK)  
</span></span><span style="display:flex;"><span>            <span style="color:#ec0000">throw</span> <span style="color:#008900">&#34;Get failed!&#34;</span>;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">catch</span> (...)  
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>        ipcontainer<span style="color:#ec0000">::</span>testdata <span style="color:#ec0000">=</span> <span style="color:#ec0000">NULL</span>;  
</span></span><span style="display:flex;"><span>        ipcontainer<span style="color:#ec0000">::</span>pwnd <span style="color:#ec0000">=</span> <span style="color:#ec0000">NULL</span>;  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">return</span> <span style="color:#ec0000">false</span>;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    ipcontainer<span style="color:#ec0000">::</span>testdata <span style="color:#ec0000">=</span> <span style="color:#ec0000">NULL</span>;  
</span></span><span style="display:flex;"><span>    ipcontainer<span style="color:#ec0000">::</span>pwnd <span style="color:#ec0000">=</span> <span style="color:#ec0000">NULL</span>;  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">return</span> <span style="color:#ec0000">true</span>;  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>/************************************************************************/ 
</span></span><span style="display:flex;"><span>/* 获取dns数据记录总数                                                  */ 
</span></span><span style="display:flex;"><span>/************************************************************************/ 
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">bool</span> ipcontainer<span style="color:#ec0000">::</span>getcount(<span style="color:#5f5fff">int</span><span style="color:#ec0000">&amp;</span> count)  
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">try</span> 
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>        ipcontainer<span style="color:#ec0000">::</span>pcount <span style="color:#ec0000">=</span> <span style="color:#ec0000">&amp;</span>count;  
</span></span><span style="display:flex;"><span>        <span style="color:#5f5fff">int</span> status <span style="color:#ec0000">=</span> SQLITE_OK;  
</span></span><span style="display:flex;"><span>        <span style="color:#5f5fff">char</span><span style="color:#ec0000">*</span> zErrMsg <span style="color:#ec0000">=</span> <span style="color:#ec0000">NULL</span>;  
</span></span><span style="display:flex;"><span>        status <span style="color:#ec0000">=</span> sqlite3_exec(db, <span style="color:#008900">&#34;select count(*) from dnss&#34;</span>, getcountcallback, <span style="color:#ec0000">NULL</span>, <span style="color:#ec0000">&amp;</span>zErrMsg);  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">if</span> (status <span style="color:#ec0000">!=</span> SQLITE_OK)  
</span></span><span style="display:flex;"><span>            <span style="color:#ec0000">throw</span> <span style="color:#008900">&#34;Get failed!&#34;</span>;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">catch</span> (...)  
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>        ipcontainer<span style="color:#ec0000">::</span>pcount <span style="color:#ec0000">=</span> <span style="color:#ec0000">NULL</span>;  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">return</span> <span style="color:#ec0000">false</span>;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    ipcontainer<span style="color:#ec0000">::</span>pcount <span style="color:#ec0000">=</span> <span style="color:#ec0000">NULL</span>;  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">return</span> <span style="color:#ec0000">true</span>;  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>/************************************************************************/ 
</span></span><span style="display:flex;"><span>/* 析构时关闭数据库                                                     */ 
</span></span><span style="display:flex;"><span>/************************************************************************/ 
</span></span><span style="display:flex;"><span>ipcontainer<span style="color:#ec0000">::~</span>ipcontainer()  
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span>    ipcontainer<span style="color:#ec0000">::</span>testdata <span style="color:#ec0000">=</span> <span style="color:#ec0000">NULL</span>;  
</span></span><span style="display:flex;"><span>    ipcontainer<span style="color:#ec0000">::</span>pcount <span style="color:#ec0000">=</span> <span style="color:#ec0000">NULL</span>;  
</span></span><span style="display:flex;"><span>    ipcontainer<span style="color:#ec0000">::</span>pwnd <span style="color:#ec0000">=</span> <span style="color:#ec0000">NULL</span>;  
</span></span><span style="display:flex;"><span>    sqlite3_close(db);  
</span></span><span style="display:flex;"><span>    db <span style="color:#ec0000">=</span> <span style="color:#ec0000">NULL</span>;  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>/************************************************************************/ 
</span></span><span style="display:flex;"><span>/* 构造函数打开数据库                                                    */ 
</span></span><span style="display:flex;"><span>/************************************************************************/ 
</span></span><span style="display:flex;"><span>ipcontainer<span style="color:#ec0000">::</span>ipcontainer()  
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span>    <span style="color:#5f5fff">int</span> status <span style="color:#ec0000">=</span> SQLITE_OK;  
</span></span><span style="display:flex;"><span>    db <span style="color:#ec0000">=</span> <span style="color:#ec0000">NULL</span>;  
</span></span><span style="display:flex;"><span>    status <span style="color:#ec0000">=</span> sqlite3_open(DATABASE, <span style="color:#ec0000">&amp;</span>db);  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">if</span> (status <span style="color:#ec0000">!=</span> SQLITE_OK)  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">throw</span> <span style="color:#008900">&#34;Open failed!&#34;</span>;  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>/************************************************************************/ 
</span></span><span style="display:flex;"><span>/* 获取记录数据数组的回调函数，用于获取记录数据数组  
</span></span><span style="display:flex;"><span>    argc:获得条目个数=2       argv[0]:ip          argv:location           */ 
</span></span><span style="display:flex;"><span>/************************************************************************/ 
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">int</span> ipcontainer<span style="color:#ec0000">::</span>getdatacallback(<span style="color:#5f5fff">void</span> <span style="color:#ec0000">*</span>NotUsed, <span style="color:#5f5fff">int</span> argc, <span style="color:#5f5fff">char</span> <span style="color:#ec0000">**</span>argv, <span style="color:#5f5fff">char</span> <span style="color:#ec0000">**</span>azColName)  
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span>    LVITEM item <span style="color:#ec0000">=</span> { <span style="color:#008900">0</span> };  
</span></span><span style="display:flex;"><span>    item.mask <span style="color:#ec0000">=</span> LVIF_TEXT;  
</span></span><span style="display:flex;"><span>    item.iItem <span style="color:#ec0000">=</span> ipcontainer<span style="color:#ec0000">::</span>testdata<span style="color:#ec0000">-&gt;</span>size();  
</span></span><span style="display:flex;"><span>    item.lParam <span style="color:#ec0000">=</span> item.iItem;  
</span></span><span style="display:flex;"><span>    item.pszText <span style="color:#ec0000">=</span> LPSTR_TEXTCALLBACK;  
</span></span><span style="display:flex;"><span>    ipcontainer<span style="color:#ec0000">::</span>testdata<span style="color:#ec0000">-&gt;</span>push_back(testSpeedData(argv[<span style="color:#008900">0</span>], argv[<span style="color:#008900">1</span>]));  
</span></span><span style="display:flex;"><span>    SendMessage(pwnd, LVM_INSERTITEM, <span style="color:#008900">0</span>, (LPARAM)<span style="color:#ec0000">&amp;</span>item);  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">return</span> <span style="color:#008900">0</span>;  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>/************************************************************************/ 
</span></span><span style="display:flex;"><span>/* 获取记录条目的回调函数，用于得到记录条目      
</span></span><span style="display:flex;"><span>    argc:获得条目个数=1       argv[0]:记录条目                            */ 
</span></span><span style="display:flex;"><span>/************************************************************************/ 
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">int</span> ipcontainer<span style="color:#ec0000">::</span>getcountcallback(<span style="color:#5f5fff">void</span> <span style="color:#ec0000">*</span>NotUsed, <span style="color:#5f5fff">int</span> argc, <span style="color:#5f5fff">char</span> <span style="color:#ec0000">**</span>argv, <span style="color:#5f5fff">char</span> <span style="color:#ec0000">**</span>azColName)  
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">try</span> 
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">*</span>ipcontainer<span style="color:#ec0000">::</span>pcount <span style="color:#ec0000">=</span> boost<span style="color:#ec0000">::</span>lexical_cast<span style="color:#ec0000">&lt;</span><span style="color:#5f5fff">int</span><span style="color:#ec0000">&gt;</span>(argv[<span style="color:#008900">0</span>]);  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">catch</span> (...)  
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">*</span>ipcontainer<span style="color:#ec0000">::</span>pcount <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">return</span> <span style="color:#008900">0</span>;  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>/************************************************************************/ 
</span></span><span style="display:flex;"><span>/* 增加dns数据总入口  
</span></span><span style="display:flex;"><span>setpos:设置进度显示回调函数       dataparam:要添加的数据阵列*/ 
</span></span><span style="display:flex;"><span>/************************************************************************/ 
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">bool</span> <span style="color:#5f5fff">doadddata</span>(dbData<span style="color:#ec0000">*</span> dataparam, HWND progctrl)  
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span>    <span style="color:#5f5fff">int</span> size <span style="color:#ec0000">=</span> dataparam<span style="color:#ec0000">-&gt;</span>size() <span style="color:#ec0000">/</span> <span style="color:#008900">100</span>;  
</span></span><span style="display:flex;"><span>    <span style="color:#5f5fff">int</span> i <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>, j <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>;  
</span></span><span style="display:flex;"><span>    SendMessage(progctrl, PBM_SETPOS, <span style="color:#008900">0</span>, <span style="color:#008900">0</span>);  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">try</span> 
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>        dbData<span style="color:#ec0000">::</span>const_iterator itor <span style="color:#ec0000">=</span> dataparam<span style="color:#ec0000">-&gt;</span>begin();  
</span></span><span style="display:flex;"><span>        ipcontainer<span style="color:#ec0000">&amp;</span> container<span style="color:#ec0000">=</span>ipcontainer<span style="color:#ec0000">::</span>getInstance();  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">while</span> (itor <span style="color:#ec0000">!=</span> dataparam<span style="color:#ec0000">-&gt;</span>end())  
</span></span><span style="display:flex;"><span>        {  
</span></span><span style="display:flex;"><span>            container.adddata(itor<span style="color:#ec0000">-&gt;</span>first, itor<span style="color:#ec0000">-&gt;</span>second);  
</span></span><span style="display:flex;"><span>            <span style="color:#ec0000">++</span>itor;  
</span></span><span style="display:flex;"><span>            <span style="color:#ec0000">++</span>i;  
</span></span><span style="display:flex;"><span>            <span style="color:#ec0000">if</span> (i <span style="color:#ec0000">&gt;=</span> size)  
</span></span><span style="display:flex;"><span>            {  
</span></span><span style="display:flex;"><span>                i <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>;  
</span></span><span style="display:flex;"><span>                SendMessage(progctrl, PBM_SETPOS, <span style="color:#ec0000">++</span>j, <span style="color:#008900">0</span>);  
</span></span><span style="display:flex;"><span>            }  
</span></span><span style="display:flex;"><span>        }  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">catch</span> (...)  
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>        //发生错误  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">return</span> <span style="color:#ec0000">false</span>;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">return</span> <span style="color:#ec0000">true</span>;  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>/************************************************************************/ 
</span></span><span style="display:flex;"><span>/* 删除dns数据总入口  
</span></span><span style="display:flex;"><span>setpos:设置进度显示回调函数       dataparam:要删除的数据阵列*/ 
</span></span><span style="display:flex;"><span>/************************************************************************/ 
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">bool</span> <span style="color:#5f5fff">dodeldata</span>(std<span style="color:#ec0000">::</span>vector<span style="color:#ec0000">&lt;</span>std<span style="color:#ec0000">::</span>string<span style="color:#ec0000">&gt;*</span> dataparam, HWND progctrl)  
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span>    <span style="color:#5f5fff">int</span> size <span style="color:#ec0000">=</span> dataparam<span style="color:#ec0000">-&gt;</span>size() <span style="color:#ec0000">/</span> <span style="color:#008900">100</span>;  
</span></span><span style="display:flex;"><span>    <span style="color:#5f5fff">int</span> i <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>, j <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>;  
</span></span><span style="display:flex;"><span>    SendMessage(progctrl, PBM_SETPOS, <span style="color:#008900">0</span>, <span style="color:#008900">0</span>);  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">try</span> 
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>        std<span style="color:#ec0000">::</span>vector<span style="color:#ec0000">&lt;</span>std<span style="color:#ec0000">::</span>string<span style="color:#ec0000">&gt;::</span>iterator itor <span style="color:#ec0000">=</span> dataparam<span style="color:#ec0000">-&gt;</span>begin();  
</span></span><span style="display:flex;"><span>        ipcontainer<span style="color:#ec0000">&amp;</span> container <span style="color:#ec0000">=</span> ipcontainer<span style="color:#ec0000">::</span>getInstance();  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">while</span> (itor <span style="color:#ec0000">!=</span> dataparam<span style="color:#ec0000">-&gt;</span>end())  
</span></span><span style="display:flex;"><span>        {  
</span></span><span style="display:flex;"><span>            container.deldata(<span style="color:#ec0000">*</span>itor);  
</span></span><span style="display:flex;"><span>            <span style="color:#ec0000">++</span>itor;  
</span></span><span style="display:flex;"><span>            <span style="color:#ec0000">++</span>i;  
</span></span><span style="display:flex;"><span>            <span style="color:#ec0000">if</span> (i <span style="color:#ec0000">&gt;=</span> size)  
</span></span><span style="display:flex;"><span>            {  
</span></span><span style="display:flex;"><span>                i <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>;  
</span></span><span style="display:flex;"><span>                SendMessage(progctrl, PBM_SETPOS, <span style="color:#ec0000">++</span>j, <span style="color:#008900">0</span>);  
</span></span><span style="display:flex;"><span>            }  
</span></span><span style="display:flex;"><span>        }  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">catch</span> (...)  
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>        //发生错误  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">return</span> <span style="color:#ec0000">false</span>;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">return</span> <span style="color:#ec0000">true</span>;  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>/************************************************************************/ 
</span></span><span style="display:flex;"><span>/* 尝试http连接  
</span></span><span style="display:flex;"><span>    ip:要测试连通性的地址        timeout:超时返回                        */ 
</span></span><span style="display:flex;"><span>/************************************************************************/ 
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">bool</span> <span style="color:#5f5fff">dohttpconnect</span>(<span style="color:#ec0000">const</span> std<span style="color:#ec0000">::</span>string<span style="color:#ec0000">&amp;</span> ip,<span style="color:#5f5fff">uint32_t</span><span style="color:#ec0000">&amp;</span> timeout)  
</span></span><span style="display:flex;"><span>{//ip不能是域名 timeout同时用于设置超时和计时  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">using</span> <span style="color:#ec0000">namespace</span> boost<span style="color:#ec0000">::</span>asio;  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">using</span> <span style="color:#ec0000">namespace</span> boost<span style="color:#ec0000">::</span>posix_time;  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">try</span> 
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>        tcpclient c;  
</span></span><span style="display:flex;"><span>        boost<span style="color:#ec0000">::</span>system<span style="color:#ec0000">::</span>error_code ec;  
</span></span><span style="display:flex;"><span>        setsockopt(c.socket_.native(), SOL_SOCKET, SO_RCVTIMEO, (<span style="color:#ec0000">const</span> <span style="color:#5f5fff">char</span><span style="color:#ec0000">*</span>)timeout, <span style="color:#ec0000">sizeof</span>(timeout));  
</span></span><span style="display:flex;"><span>        ip<span style="color:#ec0000">::</span>tcp<span style="color:#ec0000">::</span>endpoint ep(ip<span style="color:#ec0000">::</span>address<span style="color:#ec0000">::</span>from_string(ip), PORT_HTTP);  
</span></span><span style="display:flex;"><span>        ptime ptStart <span style="color:#ec0000">=</span> microsec_clock<span style="color:#ec0000">::</span>local_time();  
</span></span><span style="display:flex;"><span>        c.connect(ep, boost<span style="color:#ec0000">::</span>posix_time<span style="color:#ec0000">::</span>millisec(timeout), ec);  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">if</span> (ec.value())  
</span></span><span style="display:flex;"><span>            <span style="color:#ec0000">throw</span> <span style="color:#008900">&#34;error&#34;</span>;  
</span></span><span style="display:flex;"><span>        ptime ptEnd <span style="color:#ec0000">=</span> microsec_clock<span style="color:#ec0000">::</span>local_time();  
</span></span><span style="display:flex;"><span>        timeout <span style="color:#ec0000">=</span> (<span style="color:#5f5fff">int32_t</span>)(ptEnd <span style="color:#ec0000">-</span> ptStart).total_milliseconds();  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">catch</span> (...)  
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">return</span> <span style="color:#ec0000">false</span>;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">return</span> <span style="color:#ec0000">true</span>;  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>/************************************************************************/ 
</span></span><span style="display:flex;"><span>/* 尝试dns连接  
</span></span><span style="display:flex;"><span>    ip:要测试连通性的地址        timeout:超时返回          
</span></span><span style="display:flex;"><span>    bufferdata:用于发送和接收数据                                        */ 
</span></span><span style="display:flex;"><span>/************************************************************************/ 
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">bool</span> <span style="color:#5f5fff">dodnsconnect</span>(<span style="color:#ec0000">const</span> std<span style="color:#ec0000">::</span>string<span style="color:#ec0000">&amp;</span> ip, <span style="color:#5f5fff">uint32_t</span><span style="color:#ec0000">&amp;</span> timeout,std<span style="color:#ec0000">::</span>vector<span style="color:#ec0000">&lt;</span><span style="color:#5f5fff">uint8_t</span><span style="color:#ec0000">&gt;&amp;</span> bufferdata)  
</span></span><span style="display:flex;"><span>{//bufferdata用于输入和输出 ip为服务器地址  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">using</span> <span style="color:#ec0000">namespace</span> boost<span style="color:#ec0000">::</span>asio;  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">using</span> <span style="color:#ec0000">namespace</span> boost<span style="color:#ec0000">::</span>posix_time;  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">try</span> 
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>        udpclient c(ip<span style="color:#ec0000">::</span>udp<span style="color:#ec0000">::</span>endpoint(ip<span style="color:#ec0000">::</span>udp<span style="color:#ec0000">::</span>v4(), rand() <span style="color:#ec0000">&amp;</span> <span style="color:#008900">0x7FFF</span> <span style="color:#ec0000">+</span> <span style="color:#008900">0x8000</span>));  
</span></span><span style="display:flex;"><span>        boost<span style="color:#ec0000">::</span>system<span style="color:#ec0000">::</span>error_code ec;  
</span></span><span style="display:flex;"><span>        setsockopt(c.socket_.native(), SOL_SOCKET, SO_RCVTIMEO, (<span style="color:#ec0000">const</span> <span style="color:#5f5fff">char</span><span style="color:#ec0000">*</span>)timeout, <span style="color:#ec0000">sizeof</span>(timeout));  
</span></span><span style="display:flex;"><span>        setsockopt(c.socket_.native(), SOL_SOCKET, SO_BROADCAST, <span style="color:#008900">&#34;</span><span style="color:#008900">\0\0\0\0</span><span style="color:#008900">&#34;</span>, <span style="color:#008900">4</span>);  
</span></span><span style="display:flex;"><span>        ip<span style="color:#ec0000">::</span>udp<span style="color:#ec0000">::</span>endpoint ep(ip<span style="color:#ec0000">::</span>address<span style="color:#ec0000">::</span>from_string(ip), PORT_DNS);  
</span></span><span style="display:flex;"><span>        c.socket_.send_to(buffer((bufferdata)),ep);  
</span></span><span style="display:flex;"><span>        bufferdata.clear();  
</span></span><span style="display:flex;"><span>        bufferdata.resize(MAXS_RECVNUM);  
</span></span><span style="display:flex;"><span>        ptime ptStart <span style="color:#ec0000">=</span> microsec_clock<span style="color:#ec0000">::</span>local_time();  
</span></span><span style="display:flex;"><span>        c.receive(buffer(bufferdata), boost<span style="color:#ec0000">::</span>posix_time<span style="color:#ec0000">::</span>millisec(timeout), ec);  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">if</span> (ec.value())  
</span></span><span style="display:flex;"><span>            <span style="color:#ec0000">throw</span> <span style="color:#008900">&#34;error&#34;</span>;  
</span></span><span style="display:flex;"><span>        ptime ptEnd <span style="color:#ec0000">=</span> microsec_clock<span style="color:#ec0000">::</span>local_time();  
</span></span><span style="display:flex;"><span>        timeout <span style="color:#ec0000">=</span> (<span style="color:#5f5fff">int32_t</span>)(ptEnd <span style="color:#ec0000">-</span> ptStart).total_milliseconds();  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">catch</span> (...)  
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">return</span> <span style="color:#ec0000">false</span>;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">return</span> <span style="color:#ec0000">true</span>;  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>/************************************************************************/ 
</span></span><span style="display:flex;"><span>/* 构造dns数据包  
</span></span><span style="display:flex;"><span>    bufferdata:用于存储构造数据包结果  
</span></span><span style="display:flex;"><span>    testdomain:用于验证的域名，不能用ip地址                              */ 
</span></span><span style="display:flex;"><span>/************************************************************************/ 
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">void</span> <span style="color:#5f5fff">makedns</span>(std<span style="color:#ec0000">::</span>vector<span style="color:#ec0000">&lt;</span><span style="color:#5f5fff">uint8_t</span><span style="color:#ec0000">&gt;&amp;</span> bufferdata, <span style="color:#ec0000">const</span> std<span style="color:#ec0000">::</span>string<span style="color:#ec0000">&amp;</span> testdomain)  
</span></span><span style="display:flex;"><span>{//testip为验证ip，此函数用于testip更换时；Xid更换时用replaceXid  
</span></span><span style="display:flex;"><span>    bufferdata.resize(<span style="color:#ec0000">sizeof</span>(DNS_HEADER));  
</span></span><span style="display:flex;"><span>    DNS_HEADER<span style="color:#ec0000">*</span> pheader <span style="color:#ec0000">=</span> (DNS_HEADER<span style="color:#ec0000">*</span>)bufferdata.data();  
</span></span><span style="display:flex;"><span>    memset(pheader, <span style="color:#008900">0</span>, <span style="color:#ec0000">sizeof</span>(DNS_HEADER));  
</span></span><span style="display:flex;"><span>    pheader<span style="color:#ec0000">-&gt;</span>RecursionDesired <span style="color:#ec0000">=</span> <span style="color:#008900">1</span>;  
</span></span><span style="display:flex;"><span>    pheader<span style="color:#ec0000">-&gt;</span>QuestionCount <span style="color:#ec0000">=</span> <span style="color:#008900">1</span>;//查询一个域名  
</span></span><span style="display:flex;"><span>    DNS_BYTE_FLIP_HEADER_COUNTS(pheader);  
</span></span><span style="display:flex;"><span>    boost<span style="color:#ec0000">::</span>asio<span style="color:#ec0000">::</span>ip<span style="color:#ec0000">::</span>address addr;  
</span></span><span style="display:flex;"><span>    spliter splitvec;  
</span></span><span style="display:flex;"><span>    boost<span style="color:#ec0000">::</span>split(splitvec, testdomain, boost<span style="color:#ec0000">::</span>is_any_of(<span style="color:#008900">&#34;.&#34;</span>));  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">for</span> (spliter<span style="color:#ec0000">::</span>iterator itor <span style="color:#ec0000">=</span> splitvec.begin(); itor <span style="color:#ec0000">!=</span> splitvec.end(); <span style="color:#ec0000">++</span>itor)  
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>        bufferdata.push_back((<span style="color:#ec0000">*</span>itor).length());  
</span></span><span style="display:flex;"><span>        bufferdata.insert(bufferdata.end(), (<span style="color:#ec0000">*</span>itor).begin(),(<span style="color:#ec0000">*</span>itor).end());  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#5f5fff">uint8_t</span> tailer[SIZE_DNSTAILER] <span style="color:#ec0000">=</span> { <span style="color:#008900">0x00</span>, <span style="color:#008900">0x00</span>, <span style="color:#008900">0x01</span>, <span style="color:#008900">0x00</span>, <span style="color:#008900">0x01</span> };  
</span></span><span style="display:flex;"><span>    bufferdata.insert(bufferdata.end(), tailer, tailer<span style="color:#ec0000">+</span>SIZE_DNSTAILER);  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>/************************************************************************/ 
</span></span><span style="display:flex;"><span>/* 修改dns数据包的TransactionID，考虑优化使用  
</span></span><span style="display:flex;"><span>    bufferdata:待修改数据        Xid:新的TransactionID             */ 
</span></span><span style="display:flex;"><span>/************************************************************************/ 
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">void</span> <span style="color:#5f5fff">replaceXid</span>(std<span style="color:#ec0000">::</span>vector<span style="color:#ec0000">&lt;</span><span style="color:#5f5fff">uint8_t</span><span style="color:#ec0000">&gt;&amp;</span> bufferdata, <span style="color:#5f5fff">uint16_t</span> Xid)  
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span>    ((DNS_HEADER<span style="color:#ec0000">*</span>)bufferdata.data())<span style="color:#ec0000">-&gt;</span>Xid <span style="color:#ec0000">=</span> htons(Xid);  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>/************************************************************************/ 
</span></span><span style="display:flex;"><span>/*从返回包结果中解析获取到的地址     
</span></span><span style="display:flex;"><span>    bufferdata:服务器返回的待解析数据  resolveip:存储结果  
</span></span><span style="display:flex;"><span>    originlen:发送包大小*/ 
</span></span><span style="display:flex;"><span>/************************************************************************/ 
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">void</span> <span style="color:#5f5fff">resolveAnswer</span>(std<span style="color:#ec0000">::</span>vector<span style="color:#ec0000">&lt;</span><span style="color:#5f5fff">uint8_t</span><span style="color:#ec0000">&gt;&amp;</span> bufferdata, std<span style="color:#ec0000">::</span>set<span style="color:#ec0000">&lt;</span>std<span style="color:#ec0000">::</span>string<span style="color:#ec0000">&gt;&amp;</span> resolvedip, <span style="color:#5f5fff">int</span> originlen)  
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span>    DNS_HEADER<span style="color:#ec0000">*</span> pheader <span style="color:#ec0000">=</span> (DNS_HEADER<span style="color:#ec0000">*</span>)bufferdata.data();  
</span></span><span style="display:flex;"><span>    DNS_BYTE_FLIP_HEADER_COUNTS(pheader);  
</span></span><span style="display:flex;"><span>    <span style="color:#5f5fff">uint8_t</span><span style="color:#ec0000">*</span> ptr <span style="color:#ec0000">=</span> (<span style="color:#5f5fff">uint8_t</span><span style="color:#ec0000">*</span>)pheader <span style="color:#ec0000">+</span> originlen;  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">for</span> (<span style="color:#5f5fff">int</span> i <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>; i <span style="color:#ec0000">&lt;</span> pheader<span style="color:#ec0000">-&gt;</span>AnswerCount; i<span style="color:#ec0000">++</span>)  
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>        DNSANSWER_HEADER<span style="color:#ec0000">*</span> aheader <span style="color:#ec0000">=</span> (DNSANSWER_HEADER<span style="color:#ec0000">*</span>)ptr;  
</span></span><span style="display:flex;"><span>        DNS_BYTE_FLIP_ANSWERHEADER_COUNTS(aheader);  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">if</span>(aheader<span style="color:#ec0000">-&gt;</span>Type <span style="color:#ec0000">==</span> <span style="color:#008900">1</span>)//A:host address  
</span></span><span style="display:flex;"><span>        {  
</span></span><span style="display:flex;"><span>            BYTE<span style="color:#ec0000">*</span> cdata <span style="color:#ec0000">=</span> (BYTE<span style="color:#ec0000">*</span>)aheader <span style="color:#ec0000">+</span> <span style="color:#ec0000">sizeof</span>(DNSANSWER_HEADER);  
</span></span><span style="display:flex;"><span>            <span style="color:#ec0000">if</span> (aheader<span style="color:#ec0000">-&gt;</span>Datalength <span style="color:#ec0000">==</span> <span style="color:#008900">4</span>)//ipv4  
</span></span><span style="display:flex;"><span>            {  
</span></span><span style="display:flex;"><span>                <span style="color:#5f5fff">char</span> temp[<span style="color:#008900">16</span>];  
</span></span><span style="display:flex;"><span>                sprintf_s(temp, <span style="color:#008900">&#34;%d.%d.%d.%d&#34;</span>, cdata[<span style="color:#008900">0</span>], cdata[<span style="color:#008900">1</span>], cdata[<span style="color:#008900">2</span>], cdata[<span style="color:#008900">3</span>]);  
</span></span><span style="display:flex;"><span>                resolvedip.insert(std<span style="color:#ec0000">::</span>string(temp));  
</span></span><span style="display:flex;"><span>            }  
</span></span><span style="display:flex;"><span>            <span style="color:#ec0000">else</span> <span style="color:#ec0000">if</span> (aheader<span style="color:#ec0000">-&gt;</span>Datalength <span style="color:#ec0000">==</span> <span style="color:#008900">6</span>)//ipv6  
</span></span><span style="display:flex;"><span>            {  
</span></span><span style="display:flex;"><span>                //v6的没有条件研究呢。。。  
</span></span><span style="display:flex;"><span>            }  
</span></span><span style="display:flex;"><span>        }  
</span></span><span style="display:flex;"><span>        ptr <span style="color:#ec0000">+=</span> aheader<span style="color:#ec0000">-&gt;</span>Datalength <span style="color:#ec0000">+</span> <span style="color:#ec0000">sizeof</span>(DNSANSWER_HEADER);  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>/************************************************************************/ 
</span></span><span style="display:flex;"><span>/* 获取网卡适配器  
</span></span><span style="display:flex;"><span>    interfaces:存储结果                                                 */ 
</span></span><span style="display:flex;"><span>/************************************************************************/ 
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">bool</span> <span style="color:#5f5fff">getinterface</span>(std<span style="color:#ec0000">::</span>vector<span style="color:#ec0000">&lt;</span>std<span style="color:#ec0000">::</span>string<span style="color:#ec0000">&gt;&amp;</span> interfaces)  
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span>    DWORD dwRetVal <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>;  
</span></span><span style="display:flex;"><span>    ULONG outBufLen <span style="color:#ec0000">=</span> <span style="color:#008900">15000</span>;  
</span></span><span style="display:flex;"><span>    LPVOID lpMsgBuf <span style="color:#ec0000">=</span> <span style="color:#ec0000">NULL</span>;  
</span></span><span style="display:flex;"><span>    PIP_ADAPTER_ADDRESSES pAddress <span style="color:#ec0000">=</span> <span style="color:#ec0000">NULL</span>;  
</span></span><span style="display:flex;"><span>    interfaces.clear();  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">do</span> 
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>        pAddress <span style="color:#ec0000">=</span> (IP_ADAPTER_ADDRESSES<span style="color:#ec0000">*</span>)HeapAlloc(GetProcessHeap(), <span style="color:#008900">0</span>, outBufLen);  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">if</span> (pAddress <span style="color:#ec0000">==</span> <span style="color:#ec0000">NULL</span>)  
</span></span><span style="display:flex;"><span>            <span style="color:#ec0000">return</span> <span style="color:#ec0000">false</span>;  
</span></span><span style="display:flex;"><span>        dwRetVal <span style="color:#ec0000">=</span> GetAdaptersAddresses(AF_UNSPEC, GAA_FLAG_INCLUDE_PREFIX, <span style="color:#ec0000">NULL</span>, pAddress, <span style="color:#ec0000">&amp;</span>outBufLen);  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">if</span> (dwRetVal <span style="color:#ec0000">==</span> ERROR_BUFFER_OVERFLOW)  
</span></span><span style="display:flex;"><span>        {  
</span></span><span style="display:flex;"><span>            HeapFree(GetProcessHeap(), <span style="color:#008900">0</span>, pAddress);  
</span></span><span style="display:flex;"><span>            pAddress <span style="color:#ec0000">=</span> <span style="color:#ec0000">NULL</span>;  
</span></span><span style="display:flex;"><span>        }  
</span></span><span style="display:flex;"><span>    } <span style="color:#ec0000">while</span> (dwRetVal <span style="color:#ec0000">==</span> ERROR_BUFFER_OVERFLOW);  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">if</span> (dwRetVal <span style="color:#ec0000">!=</span> NO_ERROR)  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">return</span> <span style="color:#ec0000">false</span>;  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>    PIP_ADAPTER_ADDRESSES pCurrAddresses <span style="color:#ec0000">=</span> pAddress;  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">while</span> (pCurrAddresses)  
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>        HKEY hkResult;  
</span></span><span style="display:flex;"><span>        std<span style="color:#ec0000">::</span>string query <span style="color:#ec0000">=</span> <span style="color:#008900">&#34;SYSTEM</span><span style="color:#008900">\\</span><span style="color:#008900">CurrentControlSet</span><span style="color:#008900">\\</span><span style="color:#008900">Control</span><span style="color:#008900">\\</span><span style="color:#008900">Network</span><span style="color:#008900">\\</span><span style="color:#008900">{4D36E972-E325-11CE-BFC1-08002BE10318}</span><span style="color:#008900">\\</span><span style="color:#008900">&#34;</span>;  
</span></span><span style="display:flex;"><span>        query <span style="color:#ec0000">+=</span> pCurrAddresses<span style="color:#ec0000">-&gt;</span>AdapterName;  
</span></span><span style="display:flex;"><span>        query <span style="color:#ec0000">+=</span> <span style="color:#008900">&#34;</span><span style="color:#008900">\\</span><span style="color:#008900">Connection</span><span style="color:#008900">\\</span><span style="color:#008900">&#34;</span>;  
</span></span><span style="display:flex;"><span>        dwRetVal <span style="color:#ec0000">=</span> RegOpenKey(HKEY_LOCAL_MACHINE, query.c_str(), <span style="color:#ec0000">&amp;</span>hkResult);  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">if</span> (dwRetVal <span style="color:#ec0000">==</span> ERROR_SUCCESS)  
</span></span><span style="display:flex;"><span>        {  
</span></span><span style="display:flex;"><span>            <span style="color:#5f5fff">char</span> buffer[<span style="color:#008900">256</span>];  
</span></span><span style="display:flex;"><span>            LONG cbData <span style="color:#ec0000">=</span> <span style="color:#008900">256</span>;  
</span></span><span style="display:flex;"><span>            dwRetVal <span style="color:#ec0000">=</span> RegQueryValue(hkResult, <span style="color:#008900">&#34;Name&#34;</span>, buffer, <span style="color:#ec0000">&amp;</span>cbData);  
</span></span><span style="display:flex;"><span>            <span style="color:#ec0000">if</span> (dwRetVal <span style="color:#ec0000">==</span> ERROR_SUCCESS)  
</span></span><span style="display:flex;"><span>            {  
</span></span><span style="display:flex;"><span>                interfaces.push_back((<span style="color:#5f5fff">char</span><span style="color:#ec0000">*</span>)buffer);  
</span></span><span style="display:flex;"><span>            }  
</span></span><span style="display:flex;"><span>        }  
</span></span><span style="display:flex;"><span>        pCurrAddresses <span style="color:#ec0000">=</span> pCurrAddresses<span style="color:#ec0000">-&gt;</span>Next;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">if</span> (pAddress)  
</span></span><span style="display:flex;"><span>        HeapFree(GetProcessHeap(), <span style="color:#008900">0</span>, pAddress);  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">return</span> <span style="color:#ec0000">true</span>;  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>/************************************************************************/ 
</span></span><span style="display:flex;"><span>/* 设置指定网卡适配器dns  
</span></span><span style="display:flex;"><span>    setpos:设置进度显示回调函数       interfaces:待设置适配器         
</span></span><span style="display:flex;"><span>    address为点分十进制地址                                             */ 
</span></span><span style="display:flex;"><span>/************************************************************************/ 
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">bool</span> <span style="color:#5f5fff">setinterface</span>(std<span style="color:#ec0000">::</span>vector<span style="color:#ec0000">&lt;</span>std<span style="color:#ec0000">::</span>string<span style="color:#ec0000">&gt;&amp;</span> interfaces, std<span style="color:#ec0000">::</span>vector<span style="color:#ec0000">&lt;</span>std<span style="color:#ec0000">::</span>string<span style="color:#ec0000">&gt;&amp;</span> addresss, HWND progctrl)  
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">using</span> <span style="color:#ec0000">namespace</span> boost<span style="color:#ec0000">::</span>asio;  
</span></span><span style="display:flex;"><span>    STARTUPINFO StartupInfo <span style="color:#ec0000">=</span> { <span style="color:#008900">0</span> };  
</span></span><span style="display:flex;"><span>    PROCESS_INFORMATION ProcessInfo <span style="color:#ec0000">=</span> { <span style="color:#008900">0</span> };  
</span></span><span style="display:flex;"><span>    StartupInfo.cb <span style="color:#ec0000">=</span> <span style="color:#ec0000">sizeof</span>(STARTUPINFO);  
</span></span><span style="display:flex;"><span>    StartupInfo.dwFlags <span style="color:#ec0000">=</span> STARTF_USESHOWWINDOW;  
</span></span><span style="display:flex;"><span>    StartupInfo.wShowWindow <span style="color:#ec0000">=</span> SW_HIDE;  
</span></span><span style="display:flex;"><span>    std<span style="color:#ec0000">::</span>string cmd;  
</span></span><span style="display:flex;"><span>    <span style="color:#5f5fff">int</span> count <span style="color:#ec0000">=</span> <span style="color:#008900">0</span>;  
</span></span><span style="display:flex;"><span>    SendMessage(progctrl, PBM_SETPOS, <span style="color:#008900">0</span>, <span style="color:#008900">0</span>);  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">for</span> (std<span style="color:#ec0000">::</span>vector<span style="color:#ec0000">&lt;</span>std<span style="color:#ec0000">::</span>string<span style="color:#ec0000">&gt;::</span>iterator itori <span style="color:#ec0000">=</span> interfaces.begin(); itori <span style="color:#ec0000">!=</span> interfaces.end(); <span style="color:#ec0000">++</span>itori)  
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>        BOOL bRet;  
</span></span><span style="display:flex;"><span>        cmd <span style="color:#ec0000">=</span> <span style="color:#008900">&#34;netsh interface ipv4 set dns name=</span><span style="color:#008900">\&#34;</span><span style="color:#008900">&#34;</span> <span style="color:#ec0000">+</span> <span style="color:#ec0000">*</span>itori <span style="color:#ec0000">+</span> <span style="color:#008900">&#34;</span><span style="color:#008900">\&#34;</span><span style="color:#008900"> source=static addr=none&#34;</span>;  
</span></span><span style="display:flex;"><span>        //清除DNS设置     
</span></span><span style="display:flex;"><span>        bRet<span style="color:#ec0000">=</span>CreateProcess(<span style="color:#ec0000">NULL</span>, (<span style="color:#5f5fff">char</span><span style="color:#ec0000">*</span>)cmd.c_str(), <span style="color:#ec0000">NULL</span>, <span style="color:#ec0000">NULL</span>, FALSE, CREATE_NO_WINDOW, <span style="color:#ec0000">NULL</span>, <span style="color:#ec0000">NULL</span>, <span style="color:#ec0000">&amp;</span>StartupInfo, <span style="color:#ec0000">&amp;</span>ProcessInfo);  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">if</span> (<span style="color:#ec0000">!</span>bRet)  
</span></span><span style="display:flex;"><span>            <span style="color:#ec0000">return</span> <span style="color:#ec0000">false</span>;  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">if</span> (ProcessInfo.hProcess)  
</span></span><span style="display:flex;"><span>            WaitForSingleObject(ProcessInfo.hProcess, INFINITE);  
</span></span><span style="display:flex;"><span>        cmd <span style="color:#ec0000">=</span> <span style="color:#008900">&#34;netsh interface ipv6 set dns name=</span><span style="color:#008900">\&#34;</span><span style="color:#008900">&#34;</span> <span style="color:#ec0000">+</span> <span style="color:#ec0000">*</span>itori <span style="color:#ec0000">+</span> <span style="color:#008900">&#34;</span><span style="color:#008900">\&#34;</span><span style="color:#008900"> source=static addr=none&#34;</span>;  
</span></span><span style="display:flex;"><span>        bRet <span style="color:#ec0000">=</span> CreateProcess(<span style="color:#ec0000">NULL</span>, (<span style="color:#5f5fff">char</span><span style="color:#ec0000">*</span>)cmd.c_str(), <span style="color:#ec0000">NULL</span>, <span style="color:#ec0000">NULL</span>, FALSE, CREATE_NO_WINDOW, <span style="color:#ec0000">NULL</span>, <span style="color:#ec0000">NULL</span>, <span style="color:#ec0000">&amp;</span>StartupInfo, <span style="color:#ec0000">&amp;</span>ProcessInfo);  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">if</span> (<span style="color:#ec0000">!</span>bRet)  
</span></span><span style="display:flex;"><span>            <span style="color:#ec0000">return</span> <span style="color:#ec0000">false</span>;  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">if</span> (ProcessInfo.hProcess)  
</span></span><span style="display:flex;"><span>            WaitForSingleObject(ProcessInfo.hProcess, INFINITE);  
</span></span><span style="display:flex;"><span>        SendMessage(progctrl, PBM_SETPOS, <span style="color:#5f5fff">int</span>(<span style="color:#008900">100</span> <span style="color:#ec0000">*</span> (<span style="color:#5f5fff">float</span>)count<span style="color:#ec0000">++</span> <span style="color:#ec0000">/</span> interfaces.size()), <span style="color:#008900">0</span>);  
</span></span><span style="display:flex;"><span>        SetWindowText(progctrl, (<span style="color:#008900">&#34;正在清除设置 &#34;</span> <span style="color:#ec0000">+</span> <span style="color:#ec0000">*</span>itori).c_str());  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">for</span> (std<span style="color:#ec0000">::</span>vector<span style="color:#ec0000">&lt;</span>std<span style="color:#ec0000">::</span>string<span style="color:#ec0000">&gt;::</span>iterator itora <span style="color:#ec0000">=</span> addresss.begin(); itora <span style="color:#ec0000">!=</span> interfaces.end(); <span style="color:#ec0000">++</span>itora)  
</span></span><span style="display:flex;"><span>        {  
</span></span><span style="display:flex;"><span>            <span style="color:#ec0000">if</span> ((ip<span style="color:#ec0000">::</span>address<span style="color:#ec0000">::</span>from_string(<span style="color:#ec0000">*</span>itora)).is_v4())  
</span></span><span style="display:flex;"><span>                cmd <span style="color:#ec0000">=</span> <span style="color:#008900">&#34;netsh interface ipv4 add dns name=</span><span style="color:#008900">\&#34;</span><span style="color:#008900">&#34;</span> <span style="color:#ec0000">+</span> <span style="color:#ec0000">*</span>itori <span style="color:#ec0000">+</span> <span style="color:#008900">&#34;</span><span style="color:#008900">\&#34;</span><span style="color:#008900"> addr=&#34;</span> <span style="color:#ec0000">+</span> <span style="color:#ec0000">*</span>itora;  
</span></span><span style="display:flex;"><span>            <span style="color:#ec0000">else</span> 
</span></span><span style="display:flex;"><span>                cmd <span style="color:#ec0000">=</span> <span style="color:#008900">&#34;netsh interface ipv6 add dns name=</span><span style="color:#008900">\&#34;</span><span style="color:#008900">&#34;</span> <span style="color:#ec0000">+</span> <span style="color:#ec0000">*</span>itori <span style="color:#ec0000">+</span> <span style="color:#008900">&#34;</span><span style="color:#008900">\&#34;</span><span style="color:#008900"> addr=&#34;</span> <span style="color:#ec0000">+</span> <span style="color:#ec0000">*</span>itora;  
</span></span><span style="display:flex;"><span>            SetWindowText(progctrl, (<span style="color:#008900">&#34;正在设置 &#34;</span> <span style="color:#ec0000">+</span> <span style="color:#ec0000">*</span>itora).c_str());  
</span></span><span style="display:flex;"><span>            bRet <span style="color:#ec0000">=</span> CreateProcess(<span style="color:#ec0000">NULL</span>, (<span style="color:#5f5fff">char</span><span style="color:#ec0000">*</span>)cmd.c_str(), <span style="color:#ec0000">NULL</span>, <span style="color:#ec0000">NULL</span>, FALSE, CREATE_NO_WINDOW, <span style="color:#ec0000">NULL</span>, <span style="color:#ec0000">NULL</span>, <span style="color:#ec0000">&amp;</span>StartupInfo, <span style="color:#ec0000">&amp;</span>ProcessInfo);  
</span></span><span style="display:flex;"><span>            <span style="color:#ec0000">if</span> (<span style="color:#ec0000">!</span>bRet)  
</span></span><span style="display:flex;"><span>                <span style="color:#ec0000">return</span> <span style="color:#ec0000">false</span>;  
</span></span><span style="display:flex;"><span>            <span style="color:#ec0000">if</span> (ProcessInfo.hProcess)  
</span></span><span style="display:flex;"><span>                WaitForSingleObject(ProcessInfo.hProcess, INFINITE);  
</span></span><span style="display:flex;"><span>        }  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">return</span> <span style="color:#ec0000">true</span>;  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>/************************************************************************/ 
</span></span><span style="display:flex;"><span>/* 封装getcount                                                         */ 
</span></span><span style="display:flex;"><span>/************************************************************************/ 
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">bool</span> <span style="color:#5f5fff">getcount</span>(<span style="color:#5f5fff">int</span><span style="color:#ec0000">&amp;</span> count)  
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">try</span> 
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>        ipcontainer<span style="color:#ec0000">::</span>getInstance().getcount(count);  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">catch</span> (...)  
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">return</span> <span style="color:#ec0000">false</span>;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">return</span> <span style="color:#ec0000">true</span>;  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>/************************************************************************/ 
</span></span><span style="display:flex;"><span>/* 封装getdata                                                          */ 
</span></span><span style="display:flex;"><span>/************************************************************************/ 
</span></span><span style="display:flex;"><span><span style="color:#5f5fff">bool</span> <span style="color:#5f5fff">getdata</span>(std<span style="color:#ec0000">::</span>vector<span style="color:#ec0000">&lt;</span>testSpeedData<span style="color:#ec0000">&gt;*</span> dataparam, HWND listctrl, HWND statu, boost<span style="color:#ec0000">::</span>mutex<span style="color:#ec0000">*</span> mu)  
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span>    boost<span style="color:#ec0000">::</span>mutex<span style="color:#ec0000">::</span>scoped_lock mdata(<span style="color:#ec0000">*</span>mu);  
</span></span><span style="display:flex;"><span>    SetWindowText(statu, <span style="color:#008900">&#34;正在初始化数据！&#34;</span>);  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">try</span> 
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>        ipcontainer<span style="color:#ec0000">::</span>getInstance().getdata(dataparam, listctrl);  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">catch</span> (...)  
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>        <span style="color:#ec0000">return</span> <span style="color:#ec0000">false</span>;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    SetWindowText(statu, <span style="color:#008900">&#34;初始化完毕！&#34;</span>);  
</span></span><span style="display:flex;"><span>    <span style="color:#ec0000">return</span> <span style="color:#ec0000">true</span>;  
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div>
    
    <script src="https://giscus.app/client.js"
        data-repo="lich4/lich4.github.io"
        data-repo-id="R_kgDOMTT_mw"
        data-category=""
        data-category-id="DIC_kwDOMTT_m84Cjbim"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="preferred_color_scheme"
        data-lang="en"
        data-loading="lazy"
        crossorigin="anonymous"
        async>
</script>

    
  </div>

  


  

  
  

<div class="single-pagination">
    <hr />

    <div class="flex">

        <div class="single-pagination-prev">
            
            <div class="single-pagination-container-prev">
                <div class="single-pagination-text">←</div>
                <div class="single-pagination-text">
                    <a href="/win_posts/20150208_gearnt/">
                        变速齿轮原理浅析
                    </a>
                </div>
            </div>
            
        </div>

        <div class="single-pagination-next">
            
            <div class="single-pagination-container-next">
                <div class="single-pagination-text">
                    <a href="/win_posts/20150224_windbg_dir/">
                        Windbg符号文件夹中像MD5的文件夹名如何生成
                    </a>
                </div>
                <div class="single-pagination-text">→</div>
            </div>
            
        </div>

    </div>

    <hr />
</div>



  

  

  
  <div class="back-to-top">
    <a href="#top">
      back to top
    </a>
  </div>
  

</div>


      </main>
    </div>

    <footer>
      

    
    <p>Powered by
        <a href="https://gohugo.io/">Hugo</a>
        and
        <a href="https://github.com/tomfran/typo">tomfran/typo</a>
    </p>
    
    
    



    </footer>
    
  </body>

  <script>

  function isAuto() {
    return document.body.classList.contains("auto");
  }

  function setTheme() {
    if (!isAuto()) {
      return
    }

    document.body.classList.remove("auto");
    let cls = "light";
    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
      cls = "dark";
    }

    document.body.classList.add(cls);
  }

  function invertBody() {
    document.body.classList.toggle("dark");
    document.body.classList.toggle("light");
  }

  if (isAuto()) {
    window.matchMedia('(prefers-color-scheme: dark)').addListener(invertBody);
  }

  setTheme();

</script>

</html>